import{_ as n,c as a,f as l,o as e}from"./app-chPKMbRn.js";const i={};function p(c,s){return e(),a("div",null,s[0]||(s[0]=[l(`<h2 id="迁移步骤" tabindex="-1"><a class="header-anchor" href="#迁移步骤"><span>迁移步骤</span></a></h2><h3 id="安装-ovftools-工具" tabindex="-1"><a class="header-anchor" href="#安装-ovftools-工具"><span>安装 ovftools 工具</span></a></h3><p>在 <a href="https://customerconnect.vmware.com/cn/downloads/search?query=ovftool" target="_blank" rel="noopener noreferrer">ovftool 下载</a> 下载对应的 ovftool 文件，如 VMware-ovftool-4.4.0-15722219-lin.x86_64.bundle，上传到相应的文件夹中，执行</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sh</span><span style="color:#A3BE8C;"> VMware-ovftool-4.4.0-15722219-lin.x86_64.bundle</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 验证</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ovftool</span><span style="color:#A3BE8C;"> -v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 导出远程ESXI中虚拟机的OVF模板到本地，密码如果存在特殊字符需要进行 url 编码</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ovftool</span><span style="color:#A3BE8C;"> --X:logFile=./ovftool.log</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	vi://root:password%40123@127.0.0.1/source</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	./source.ovf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ll</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;">.vmdk</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="转换镜像" tabindex="-1"><a class="header-anchor" href="#转换镜像"><span>转换镜像</span></a></h3><h4 id="方式1-转换为-qcow2-格式" tabindex="-1"><a class="header-anchor" href="#方式1-转换为-qcow2-格式"><span>方式1：转换为 QCOW2 格式</span></a></h4><p>在 ESXi 中运行的虚拟机可以转换为 OpenStack 支持的 QCOW2 镜像格式</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> qemu-img</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 转换镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">qemu-img</span><span style="color:#A3BE8C;"> convert</span><span style="color:#A3BE8C;"> -f</span><span style="color:#A3BE8C;"> vmdk</span><span style="color:#A3BE8C;"> -O</span><span style="color:#A3BE8C;"> qcow2</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/path/to/source.vmdk</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/path/to/destination.qcow2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">	</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 修改密码（可选）</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9;"> LIBGUESTFS_BACKEND</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;">direct</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virt-customize</span><span style="color:#A3BE8C;"> -a</span><span style="color:#A3BE8C;"> /path/to/destination.qcow2</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --root-password</span><span style="color:#A3BE8C;"> password:123456</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 登录 openstack</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /etc/kolla/admin-openrc.sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 创建镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> create</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">test-image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --property</span><span style="color:#A3BE8C;"> hw_disk_bus=ide</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--disk-format</span><span style="color:#A3BE8C;"> qcow2</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--container-format</span><span style="color:#A3BE8C;"> bare</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--file</span><span style="color:#A3BE8C;"> ./destination.qcow2</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.6</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> list</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="方式2-转换为-raw-格式" tabindex="-1"><a class="header-anchor" href="#方式2-转换为-raw-格式"><span>方式2：转换为 RAW 格式</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> qemu-img</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 转换镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">qemu-img</span><span style="color:#A3BE8C;"> convert</span><span style="color:#A3BE8C;"> -f</span><span style="color:#A3BE8C;"> vmdk</span><span style="color:#A3BE8C;"> -O</span><span style="color:#A3BE8C;"> raw</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/path/to/source.vmdk</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/path/to/destination.raw</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 登录 openstack</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /etc/kolla/admin-openrc.sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 创建镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> create</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">test-image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --property</span><span style="color:#A3BE8C;"> hw_disk_bus=ide</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--disk-format</span><span style="color:#A3BE8C;"> raw</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--container-format</span><span style="color:#A3BE8C;"> bare</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--file</span><span style="color:#A3BE8C;"> ./destination.raw</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> list</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="方式3-直接使用-vmdk-格式" tabindex="-1"><a class="header-anchor" href="#方式3-直接使用-vmdk-格式"><span>方式3：直接使用 VMDK 格式</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 登录 openstack</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /etc/kolla/admin-openrc.sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> create</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">test-vmdk</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--property</span><span style="color:#A3BE8C;"> hw_disk_bus=ide</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--disk-format</span><span style="color:#A3BE8C;"> vmdk</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--container-format</span><span style="color:#A3BE8C;"> bare</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--file</span><span style="color:#A3BE8C;"> ./destination.vmdk</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> list</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="参考资料" tabindex="-1"><a class="header-anchor" href="#参考资料"><span>参考资料</span></a></h3><ul><li>https://www.51cto.com/article/618604.html</li><li>https://blog.csdn.net/jmh1996/article/details/102815195</li><li>https://blog.51cto.com/qsyj/6066745</li></ul>`,14)]))}const r=n(i,[["render",p],["__file","ESXI虚机迁移至OpenStack.html.vue"]]),d=JSON.parse('{"path":"/md/article/cloud/openstack/ESXI%E8%99%9A%E6%9C%BA%E8%BF%81%E7%A7%BB%E8%87%B3OpenStack.html","title":"ESXI虚机迁移至OpenStack","lang":"en-US","frontmatter":{"title":"ESXI虚机迁移至OpenStack","sidebar":"heading"},"headers":[{"level":2,"title":"迁移步骤","slug":"迁移步骤","link":"#迁移步骤","children":[{"level":3,"title":"安装 ovftools 工具","slug":"安装-ovftools-工具","link":"#安装-ovftools-工具","children":[]},{"level":3,"title":"转换镜像","slug":"转换镜像","link":"#转换镜像","children":[]},{"level":3,"title":"参考资料","slug":"参考资料","link":"#参考资料","children":[]}]}],"git":{"updatedTime":1735803006000,"contributors":[{"name":"hyfly233","username":"hyfly233","email":"hyfly233@outlook.com","commits":4,"url":"https://github.com/hyfly233"}]},"filePathRelative":"md/article/cloud/openstack/ESXI虚机迁移至OpenStack.md"}');export{r as comp,d as data};
