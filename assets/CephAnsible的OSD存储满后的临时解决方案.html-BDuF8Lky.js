import{_ as n,c as a,f as l,o as e}from"./app-chPKMbRn.js";const p={};function o(c,s){return e(),a("div",null,s[0]||(s[0]=[l(`<h1 id="ceph的osd存储满后的临时解决方案" tabindex="-1"><a class="header-anchor" href="#ceph的osd存储满后的临时解决方案"><span>Ceph的OSD存储满后的临时解决方案</span></a></h1><h2 id="问题描述" tabindex="-1"><a class="header-anchor" href="#问题描述"><span>问题描述</span></a></h2><p>硬盘容量不足，导致Ceph功能异常</p><h2 id="查看-ceph-健康状况" tabindex="-1"><a class="header-anchor" href="#查看-ceph-健康状况"><span>查看 ceph 健康状况</span></a></h2><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 查看健康状况</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> health</span><span style="color:#A3BE8C;"> detail</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 输出内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">HEALTH_ERR</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> full</span><span style="color:#A3BE8C;"> osd</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">s</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span><span style="color:#88C0D0;"> 10</span><span style="color:#A3BE8C;"> pool</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">s</span><span style="color:#ECEFF4;">)</span><span style="color:#A3BE8C;"> full</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Degraded</span><span style="color:#A3BE8C;"> data</span><span style="color:#A3BE8C;"> redundancy:</span><span style="color:#A3BE8C;"> 2220/890481</span><span style="color:#A3BE8C;"> objects</span><span style="color:#A3BE8C;"> degraded</span><span style="color:#D8DEE9FF;"> (0.249%), 8 pgs degraded, 8 pgs undersized</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Full</span><span style="color:#A3BE8C;"> OSDs</span><span style="color:#A3BE8C;"> blocking</span><span style="color:#A3BE8C;"> recovery:</span><span style="color:#B48EAD;"> 8</span><span style="color:#A3BE8C;"> pgs</span><span style="color:#A3BE8C;"> recovery_toofull</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">1</span><span style="color:#A3BE8C;"> pools</span><span style="color:#A3BE8C;"> have</span><span style="color:#A3BE8C;"> too</span><span style="color:#A3BE8C;"> many</span><span style="color:#A3BE8C;"> placement</span><span style="color:#A3BE8C;"> groups</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mons</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> allowing</span><span style="color:#A3BE8C;"> insecure</span><span style="color:#A3BE8C;"> global_id</span><span style="color:#A3BE8C;"> reclaim</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">OSD_FULL</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> full</span><span style="color:#A3BE8C;"> osd</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">s</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    osd.3</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">POOL_FULL</span><span style="color:#B48EAD;"> 10</span><span style="color:#A3BE8C;"> pool</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">s</span><span style="color:#ECEFF4;">)</span><span style="color:#A3BE8C;"> full</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">cephfs_data</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">cephfs_metadata</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">.rgw.root</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">default.rgw.control</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">default.rgw.meta</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">default.rgw.log</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">images</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">instances</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">volumes</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    pool</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">backups</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> full</span><span style="color:#D8DEE9FF;"> (no </span><span style="color:#A3BE8C;">space</span><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="查找-volumes-池中的虚拟硬盘" tabindex="-1"><a class="header-anchor" href="#查找-volumes-池中的虚拟硬盘"><span>查找 volumes 池中的虚拟硬盘</span></a></h2><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> ls</span><span style="color:#A3BE8C;"> volumes</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="查看虚拟硬盘的详情" tabindex="-1"><a class="header-anchor" href="#查看虚拟硬盘的详情"><span>查看虚拟硬盘的详情</span></a></h2><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> info</span><span style="color:#A3BE8C;"> volumes/volume-b2056888-245d-4890-85ed-bf187cb1fa4e</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> image</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">volume-b2056888-245d-4890-85ed-bf187cb1fa4e</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	size</span><span style="color:#B48EAD;"> 160</span><span style="color:#A3BE8C;"> GiB</span><span style="color:#A3BE8C;"> in</span><span style="color:#B48EAD;"> 40960</span><span style="color:#A3BE8C;"> objects</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	order</span><span style="color:#B48EAD;"> 22</span><span style="color:#D8DEE9FF;"> (4 </span><span style="color:#A3BE8C;">MiB</span><span style="color:#A3BE8C;"> objects</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	snapshot_count:</span><span style="color:#B48EAD;"> 0</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	id:</span><span style="color:#A3BE8C;"> 73823d21437986</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	block_name_prefix:</span><span style="color:#A3BE8C;"> rbd_data.73823d21437986</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	format:</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	features:</span><span style="color:#A3BE8C;"> layering,</span><span style="color:#A3BE8C;"> exclusive-lock,</span><span style="color:#A3BE8C;"> object-map,</span><span style="color:#A3BE8C;"> fast-diff,</span><span style="color:#A3BE8C;"> deep-flatten</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	op_features:</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	flags:</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	create_timestamp:</span><span style="color:#A3BE8C;"> Tue</span><span style="color:#A3BE8C;"> Sep</span><span style="color:#B48EAD;">  5</span><span style="color:#A3BE8C;"> 14:22:02</span><span style="color:#B48EAD;"> 2023</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	access_timestamp:</span><span style="color:#A3BE8C;"> Tue</span><span style="color:#A3BE8C;"> Sep</span><span style="color:#B48EAD;">  5</span><span style="color:#A3BE8C;"> 17:07:24</span><span style="color:#B48EAD;"> 2023</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">	modify_timestamp:</span><span style="color:#A3BE8C;"> Tue</span><span style="color:#A3BE8C;"> Sep</span><span style="color:#B48EAD;">  5</span><span style="color:#A3BE8C;"> 17:07:31</span><span style="color:#B48EAD;"> 2023</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ceph-磁盘满了导致虚机无法操作" tabindex="-1"><a class="header-anchor" href="#ceph-磁盘满了导致虚机无法操作"><span>Ceph 磁盘满了导致虚机无法操作</span></a></h2><p>获取到 OpenStack Cinder 卷与 ceph object 的对应关系</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> exec</span><span style="color:#A3BE8C;"> -it</span><span style="color:#A3BE8C;"> cinder_volume</span><span style="color:#A3BE8C;"> /bin/sh</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><a href="https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/5/html/troubleshooting_guide/troubleshooting-ceph-osds#deleting-data-from-a-full-storage-cluster_diag" target="_blank" rel="noopener noreferrer">https://access.redhat.com/documentation/en-us/red_hat_ceph_storage/5/html/troubleshooting_guide/troubleshooting-ceph-osds#deleting-data-from-a-full-storage-cluster_diag</a></p><h2 id="修改-osd-存储满的比例" tabindex="-1"><a class="header-anchor" href="#修改-osd-存储满的比例"><span>修改 OSD 存储满的比例</span></a></h2><p>临时解决方案，修改 OSD 存储满的比例，Ceph 服务正常后应该扩充存储来解决问题</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> exec</span><span style="color:#A3BE8C;"> -it</span><span style="color:#A3BE8C;"> ceph-osd</span><span style="color:#A3BE8C;"> /bin/sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> dump</span><span style="color:#81A1C1;"> |</span><span style="color:#88C0D0;"> grep</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> full</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> set-full-ratio</span><span style="color:#B48EAD;"> 0.97</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,16)]))}const r=n(p,[["render",o],["__file","CephAnsible的OSD存储满后的临时解决方案.html.vue"]]),t=JSON.parse('{"path":"/md/article/storage/CephAnsible%E7%9A%84OSD%E5%AD%98%E5%82%A8%E6%BB%A1%E5%90%8E%E7%9A%84%E4%B8%B4%E6%97%B6%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88.html","title":"CephAnsible的OSD存储满后的临时解决方案","lang":"en-US","frontmatter":{"title":"CephAnsible的OSD存储满后的临时解决方案","sidebar":"heading"},"headers":[{"level":2,"title":"问题描述","slug":"问题描述","link":"#问题描述","children":[]},{"level":2,"title":"查看 ceph 健康状况","slug":"查看-ceph-健康状况","link":"#查看-ceph-健康状况","children":[]},{"level":2,"title":"查找 volumes 池中的虚拟硬盘","slug":"查找-volumes-池中的虚拟硬盘","link":"#查找-volumes-池中的虚拟硬盘","children":[]},{"level":2,"title":"查看虚拟硬盘的详情","slug":"查看虚拟硬盘的详情","link":"#查看虚拟硬盘的详情","children":[]},{"level":2,"title":"Ceph 磁盘满了导致虚机无法操作","slug":"ceph-磁盘满了导致虚机无法操作","link":"#ceph-磁盘满了导致虚机无法操作","children":[]},{"level":2,"title":"修改 OSD 存储满的比例","slug":"修改-osd-存储满的比例","link":"#修改-osd-存储满的比例","children":[]}],"git":{"updatedTime":1735864944000,"contributors":[{"name":"hyfly233","username":"hyfly233","email":"hyfly233@outlook.com","commits":2,"url":"https://github.com/hyfly233"}]},"filePathRelative":"md/article/storage/CephAnsible的OSD存储满后的临时解决方案.md"}');export{r as comp,t as data};
