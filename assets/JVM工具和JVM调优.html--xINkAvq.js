import{_ as l,c as n,f as a,o as i}from"./app-chPKMbRn.js";const e={};function r(o,s){return i(),n("div",null,s[0]||(s[0]=[a(`<h2 id="性能监控与故障处理工具" tabindex="-1"><a class="header-anchor" href="#性能监控与故障处理工具"><span>性能监控与故障处理工具</span></a></h2><h3 id="命令行工具" tabindex="-1"><a class="header-anchor" href="#命令行工具"><span>命令行工具</span></a></h3><h4 id="jps" tabindex="-1"><a class="header-anchor" href="#jps"><span>jps</span></a></h4><h4 id="jinfo" tabindex="-1"><a class="header-anchor" href="#jinfo"><span>jinfo</span></a></h4><h4 id="jstack" tabindex="-1"><a class="header-anchor" href="#jstack"><span>jstack</span></a></h4><h4 id="jmap" tabindex="-1"><a class="header-anchor" href="#jmap"><span>jmap</span></a></h4><h4 id="jstat" tabindex="-1"><a class="header-anchor" href="#jstat"><span>jstat</span></a></h4><h4 id="jstatd" tabindex="-1"><a class="header-anchor" href="#jstatd"><span>jstatd</span></a></h4><h4 id="jcmd" tabindex="-1"><a class="header-anchor" href="#jcmd"><span>jcmd</span></a></h4><h3 id="图形化工具" tabindex="-1"><a class="header-anchor" href="#图形化工具"><span>图形化工具</span></a></h3><h4 id="jconsole" tabindex="-1"><a class="header-anchor" href="#jconsole"><span>jconsole</span></a></h4><h4 id="jmc" tabindex="-1"><a class="header-anchor" href="#jmc"><span>jmc</span></a></h4><h4 id="visualvm" tabindex="-1"><a class="header-anchor" href="#visualvm"><span>visualvm</span></a></h4><h3 id="远程连接" tabindex="-1"><a class="header-anchor" href="#远程连接"><span>远程连接</span></a></h3><h4 id="jmx" tabindex="-1"><a class="header-anchor" href="#jmx"><span>jmx</span></a></h4><h4 id="jstatd-1" tabindex="-1"><a class="header-anchor" href="#jstatd-1"><span>jstatd</span></a></h4><h2 id="jvm-调优" tabindex="-1"><a class="header-anchor" href="#jvm-调优"><span>JVM 调优</span></a></h2><h3 id="jvm-如何调优、调什么、目标" tabindex="-1"><a class="header-anchor" href="#jvm-如何调优、调什么、目标"><span>JVM 如何调优、调什么、目标</span></a></h3><h4 id="内存方面" tabindex="-1"><a class="header-anchor" href="#内存方面"><span>内存方面</span></a></h4><ul><li>JVM 需要的内存总大小</li><li>各块内存分配，新生代，老年代，存活区</li><li>选择合适的垃圾回收算法，控制 GC 停顿次数和时间</li><li>解决内存泄漏的问题，辅助代码优化</li><li>内存热点，检查那些对象在系统中数量最大，辅助代码优化</li><li>死锁检查，辅助代码优化</li><li>Dump 线程详细信息：查看线程内部运行情况，查找竞争线程，辅助代码优化</li><li>CPU 热点，检查系统那些方法占用了大量 CPU 时间，辅助代码优化</li></ul><h4 id="线程方面" tabindex="-1"><a class="header-anchor" href="#线程方面"><span>线程方面</span></a></h4><h3 id="调优步骤" tabindex="-1"><a class="header-anchor" href="#调优步骤"><span>调优步骤</span></a></h3><ul><li>监控 JVM 的状态，主要是内存、线程、代码、I/O 等</li><li>分析结果，判断是否需要优化</li><li>调整垃圾回收算法和内存分配，优化代码</li><li>不断重复监控、分析和调整，直到找到优化平衡点</li></ul><h3 id="调优目标" tabindex="-1"><a class="header-anchor" href="#调优目标"><span>调优目标</span></a></h3><ul><li>GC 的时间要足够小</li><li>GC 的次数要足够少</li><li>将转移到老年代的对象数量降低到最小</li><li>减少 Full GC 的执行时间</li><li>发生 Full GC 的间隔足够的长</li></ul><h3 id="jvm-调优策略" tabindex="-1"><a class="header-anchor" href="#jvm-调优策略"><span>JVM 调优策略</span></a></h3><ul><li>减少创建对象的数量</li><li>减少使用全局变量和大对象</li><li>调整新生代、老年代的大小到最合适</li><li>选择合适的 GC 收集器，并设置合理的参数</li></ul><h3 id="jvm-调优冷思考" tabindex="-1"><a class="header-anchor" href="#jvm-调优冷思考"><span>JVM 调优冷思考</span></a></h3><ul><li>多少的 Java 应用不需要在服务器上进行 GC 优化</li><li>多数导致 GC 问题的 Java 应用，都不是因为参数设置错误导致的，而是代码问题</li><li>在应用上线之前，先考虑将机器的 JVM 参数设置到最优</li><li>JVM 优化是最后不得已才采用的手段，优先是优化代码</li><li>在实际情况中，分析 JVM 情况优化代码比优化 JVM 本身要多得多</li><li>如下情况通常不用优化 <ul><li>Minor GC 执行时间不到 50 ms</li><li>Minor GC 执行不频繁，约 10 秒一次</li><li>Full GC 执行时间不到 1 秒</li><li>Full GC 执行不频繁，约 10 分钟一次</li></ul></li></ul><h3 id="jvm-调优经验" tabindex="-1"><a class="header-anchor" href="#jvm-调优经验"><span>JVM 调优经验</span></a></h3><ul><li>要注意 32 位和 64 位的区别，通常 32 位的仅支持 2 - 3 g 左右的内存</li><li>要注意 client 模式和 server 模式的选择</li><li>要想 GC 时间小必须要一个更小的堆，而要保证 GC 次数足够少，又必须保证一个更大的堆，这两个是冲突的，只能取其平衡</li><li>针对 JVM 堆的设置，一般通过 -Xms -Xmx 限定其最小最大值，防止垃圾收集器在最小、最大之间收缩堆而产生额外的时间开销，通常把最大、最小设置为相同的值</li><li>新生代和老年代将根据默认的比例（1 : 2）来分配堆内存，可以通过 NewRadio 来调整比例，也可以通过 -XX:newSize -XX:MaxNewSize 来设置其绝对大小，同样，为了防止新生的堆收缩，通常会把 -XX:newSize -XX:MaxNewSize 设置为相同大小</li><li>合理规划新生代和老年代的大小</li><li>如果应用存在大量的临时对象，应该选择更大的新生代；如果存在相对较多的持久对象，应该适当的增大老年代。在抉择时应该本着 Full GC 尽量少的原则，让老年代尽量缓存常用对象，JVM 的默认比例 1 : 2 也是这个道理</li><li>通过观察应用一段时间，看其在峰值时老年代会占用多少内存，在不影响 Full GC 的前提下，根据实际情况加大新生代，但应该给老年代至少预留 1/3 的增长空间</li><li>线程堆栈的设置：每个线程默认会开启 1 M 的堆栈，用于存放栈帧、调用参数、局部变量等，对于大多数应用而言这个默认值太大，一般 256 K 够用，在内存不变的情况下，减少每个线程的堆栈，可以产生更多的线程</li></ul><h4 id="内存泄漏" tabindex="-1"><a class="header-anchor" href="#内存泄漏"><span>内存泄漏</span></a></h4><ul><li>内存泄漏导致系统崩溃前的一些现象，如： <ul><li>每次垃圾回收的时间越来越长，FullGC 时间也延长到好几秒</li><li>FullGC 的次数越来越多，最频繁时间间隔不到 1 分钟，内存泄漏后是不会释放内存的</li><li>老年代的内存越来越大，并且每次 FullGC 后老年代没有内存被释放</li><li>老年代堆空间被占满</li></ul></li><li>解决方案：一般根据垃圾回收前后情况对比，同时根据对象引用情况分析，辅助去查找泄漏点</li><li>堆栈溢出的情况： <ul><li>通常抛出 StackOverflowError</li><li>一般是递归调用没退出，或者循环调用造成</li></ul></li></ul><h1 id="jvm-工具和-jvm-调优指南" tabindex="-1"><a class="header-anchor" href="#jvm-工具和-jvm-调优指南"><span>JVM 工具和 JVM 调优指南</span></a></h1><h2 id="_1-性能监控与故障处理工具" tabindex="-1"><a class="header-anchor" href="#_1-性能监控与故障处理工具"><span>1. 性能监控与故障处理工具</span></a></h2><h3 id="_1-1-命令行工具" tabindex="-1"><a class="header-anchor" href="#_1-1-命令行工具"><span>1.1 命令行工具</span></a></h3><h4 id="_1-1-1-jps-jvm-process-status-tool" tabindex="-1"><a class="header-anchor" href="#_1-1-1-jps-jvm-process-status-tool"><span>1.1.1 jps（JVM Process Status Tool）</span></a></h4><ul><li><strong>功能</strong>：显示系统内所有的 HotSpot 虚拟机进程</li><li><strong>用法</strong>：<code>jps [options] [hostid]</code></li><li><strong>常用参数</strong>： <ul><li><code>-l</code>：输出主类的全名，如果进程执行的是 Jar 包，输出 Jar 路径</li><li><code>-v</code>：输出虚拟机进程启动时 JVM 参数</li><li><code>-m</code>：输出传递给 Java 进程 main()函数的参数</li></ul></li><li><strong>示例</strong>：<code>jps -l -v</code></li></ul><h4 id="_1-1-2-jinfo-configuration-info-for-java" tabindex="-1"><a class="header-anchor" href="#_1-1-2-jinfo-configuration-info-for-java"><span>1.1.2 jinfo（Configuration Info for Java）</span></a></h4><ul><li><strong>功能</strong>：实时查看和调整虚拟机各项参数</li><li><strong>用法</strong>：<code>jinfo [option] pid</code></li><li><strong>常用参数</strong>： <ul><li><code>-flag &lt;name&gt;</code>：查看指定的 JVM 参数值</li><li><code>-flag [+|-]&lt;name&gt;</code>：开启或关闭指定的 JVM 参数</li><li><code>-flag &lt;name&gt;=&lt;value&gt;</code>：设置指定的 JVM 参数值</li><li><code>-flags</code>：查看所有的 JVM 参数</li></ul></li><li><strong>示例</strong>：<code>jinfo -flag UseG1GC 12345</code></li></ul><h4 id="_1-1-3-jstack-stack-trace-for-java" tabindex="-1"><a class="header-anchor" href="#_1-1-3-jstack-stack-trace-for-java"><span>1.1.3 jstack（Stack Trace for Java）</span></a></h4><ul><li><strong>功能</strong>：生成虚拟机当前时刻的线程快照</li><li><strong>用法</strong>：<code>jstack [option] pid</code></li><li><strong>常用参数</strong>： <ul><li><code>-F</code>：当正常输出的请求不被响应时，强制输出线程堆栈</li><li><code>-l</code>：除堆栈外，显示关于锁的附加信息</li><li><code>-m</code>：如果调用到本地方法的话，可以显示 C/C++的堆栈</li></ul></li><li><strong>应用场景</strong>：定位线程停顿、死锁、性能瓶颈等问题</li></ul><h4 id="_1-1-4-jmap-memory-map-for-java" tabindex="-1"><a class="header-anchor" href="#_1-1-4-jmap-memory-map-for-java"><span>1.1.4 jmap（Memory Map for Java）</span></a></h4><ul><li><strong>功能</strong>：生成堆转储快照（heap dump）</li><li><strong>用法</strong>：<code>jmap [option] pid</code></li><li><strong>常用参数</strong>： <ul><li><code>-dump</code>：生成 Java 堆转储快照</li><li><code>-finalizerinfo</code>：显示在 F-Queue 中等待 Finalizer 线程执行 finalize 方法的对象</li><li><code>-heap</code>：显示 Java 堆详细信息</li><li><code>-histo</code>：显示堆中对象统计信息</li></ul></li><li><strong>示例</strong>：<code>jmap -dump:format=b,file=heap.hprof 12345</code></li></ul><h4 id="_1-1-5-jstat-jvm-statistics-monitoring-tool" tabindex="-1"><a class="header-anchor" href="#_1-1-5-jstat-jvm-statistics-monitoring-tool"><span>1.1.5 jstat（JVM Statistics Monitoring Tool）</span></a></h4><ul><li><strong>功能</strong>：监视虚拟机各种运行状态信息</li><li><strong>用法</strong>：<code>jstat [option vmid [interval[s|ms] [count]]]</code></li><li><strong>常用选项</strong>： <ul><li><code>-gc</code>：监视 Java 堆状况，包括 Eden 区、两个 Survivor 区、老年代等</li><li><code>-gccapacity</code>：监视内容与-gc 基本相同，但输出主要关注 Java 堆各个区域使用到的最大、最小空间</li><li><code>-gcutil</code>：监视内容与-gc 基本相同，但输出主要关注已使用空间占总空间的百分比</li><li><code>-gccause</code>：与-gcutil 功能一样，但是会额外输出导致上一次 GC 产生的原因</li></ul></li><li><strong>示例</strong>：<code>jstat -gc 12345 1s 10</code></li></ul><h4 id="_1-1-6-jstatd-jvm-jstat-daemon" tabindex="-1"><a class="header-anchor" href="#_1-1-6-jstatd-jvm-jstat-daemon"><span>1.1.6 jstatd（JVM jstat Daemon）</span></a></h4><ul><li><strong>功能</strong>：jstat 的守护进程，启动一个 RMI 服务器应用程序</li><li><strong>用法</strong>：<code>jstatd [options]</code></li><li><strong>作用</strong>：提供远程监控 JVM 的能力</li></ul><h4 id="_1-1-7-jcmd-jvm-command" tabindex="-1"><a class="header-anchor" href="#_1-1-7-jcmd-jvm-command"><span>1.1.7 jcmd（JVM Command）</span></a></h4><ul><li><strong>功能</strong>：多功能命令行工具，可以用来导出堆、查看 Java 进程、导出线程信息等</li><li><strong>用法</strong>：<code>jcmd &lt;pid | main class&gt; &lt;command [options]&gt;</code></li><li><strong>常用命令</strong>： <ul><li><code>jcmd &lt;pid&gt; help</code>：查看可用命令</li><li><code>jcmd &lt;pid&gt; VM.flags</code>：查看 JVM 参数</li><li><code>jcmd &lt;pid&gt; GC.run_finalization</code>：执行 finalization</li></ul></li></ul><h3 id="_1-2-图形化工具" tabindex="-1"><a class="header-anchor" href="#_1-2-图形化工具"><span>1.2 图形化工具</span></a></h3><h4 id="_1-2-1-jconsole" tabindex="-1"><a class="header-anchor" href="#_1-2-1-jconsole"><span>1.2.1 JConsole</span></a></h4><ul><li><strong>功能</strong>：基于 JMX 的可视化监视、管理工具</li><li><strong>特点</strong>： <ul><li>内存监控：监控内存使用情况，可以手动执行 GC</li><li>线程监控：监控线程使用情况，检测死锁</li><li>类加载监控：监控类的加载情况</li><li>MBean 监控：监控 MBean 的属性和操作</li></ul></li><li><strong>启动方式</strong>： <ul><li>本地：直接运行<code>jconsole</code>命令</li><li>远程：需要在目标 JVM 启动时设置相关参数</li></ul></li></ul><h4 id="_1-2-2-java-mission-control-jmc" tabindex="-1"><a class="header-anchor" href="#_1-2-2-java-mission-control-jmc"><span>1.2.2 Java Mission Control（JMC）</span></a></h4><ul><li><strong>功能</strong>：Oracle 官方提供的性能分析工具</li><li><strong>特点</strong>： <ul><li>低开销的持续收集性能数据</li><li>支持 Java Flight Recorder（JFR）</li><li>提供详细的性能分析报告</li><li>支持自定义事件监控</li></ul></li><li><strong>优势</strong>：生产环境可用，开销极低</li></ul><h4 id="_1-2-3-visualvm" tabindex="-1"><a class="header-anchor" href="#_1-2-3-visualvm"><span>1.2.3 VisualVM</span></a></h4><ul><li><strong>功能</strong>：多合一故障处理工具</li><li><strong>特点</strong>： <ul><li>显示虚拟机进程以及进程的配置、环境信息</li><li>监视应用程序的 CPU、GC、堆、方法区以及线程的信息</li><li>dump 以及分析堆转储文件</li><li>方法级的程序运行性能分析，找到被调用最多、运行时间最长的方法</li><li>离线程序快照：收集程序的运行时配置、线程 dump、内存 dump 等信息建立一个快照</li></ul></li><li><strong>插件支持</strong>：支持大量第三方插件扩展功能</li></ul><h3 id="_1-3-远程监控配置" tabindex="-1"><a class="header-anchor" href="#_1-3-远程监控配置"><span>1.3 远程监控配置</span></a></h3><h4 id="_1-3-1-jmx-远程连接" tabindex="-1"><a class="header-anchor" href="#_1-3-1-jmx-远程连接"><span>1.3.1 JMX 远程连接</span></a></h4><p><strong>启用 JMX 远程监控</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.port</span><span style="color:#A3BE8C;">=9999</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.authenticate</span><span style="color:#A3BE8C;">=</span><span style="color:#88C0D0;">false</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.ssl</span><span style="color:#A3BE8C;">=</span><span style="color:#88C0D0;">false</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>安全配置</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.authenticate</span><span style="color:#A3BE8C;">=</span><span style="color:#88C0D0;">true</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.password.file</span><span style="color:#A3BE8C;">=/path/to/jmxremote.password</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Dcom.sun.management.jmxremote.access.file</span><span style="color:#A3BE8C;">=/path/to/jmxremote.access</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_1-3-2-jstatd-远程服务" tabindex="-1"><a class="header-anchor" href="#_1-3-2-jstatd-远程服务"><span>1.3.2 jstatd 远程服务</span></a></h4><p><strong>启动 jstatd 服务</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 创建安全策略文件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#A3BE8C;"> jstatd.policy</span><span style="color:#81A1C1;"> &lt;&lt;</span><span style="color:#ECEFF4;"> EOF</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">grant codebase &quot;file:</span><span style="color:#EBCB8B;">\\$</span><span style="color:#A3BE8C;">{java.home}/../lib/tools.jar&quot; {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">    permission java.security.AllPermission;</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">};</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">EOF</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 启动jstatd服务</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jstatd</span><span style="color:#A3BE8C;"> -J-Djava.security.policy=jstatd.policy</span><span style="color:#A3BE8C;"> -p</span><span style="color:#B48EAD;"> 1099</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_2-jvm-调优" tabindex="-1"><a class="header-anchor" href="#_2-jvm-调优"><span>2. JVM 调优</span></a></h2><h3 id="_2-1-调优概述" tabindex="-1"><a class="header-anchor" href="#_2-1-调优概述"><span>2.1 调优概述</span></a></h3><h4 id="_2-1-1-调优目标" tabindex="-1"><a class="header-anchor" href="#_2-1-1-调优目标"><span>2.1.1 调优目标</span></a></h4><p>JVM 调优的核心目标是在保证系统稳定运行的前提下，最大化应用程序的性能：</p><p><strong>性能指标</strong>：</p><ul><li><strong>响应时间</strong>：应用程序响应请求的时间</li><li><strong>吞吐量</strong>：单位时间内处理的请求数量</li><li><strong>并发用户数</strong>：系统能够同时支持的用户数量</li><li><strong>资源利用率</strong>：CPU、内存、网络等资源的使用效率</li></ul><p><strong>GC 性能目标</strong>：</p><ul><li>GC 暂停时间要足够短（一般要求低于 100ms）</li><li>GC 执行频率要合理（Minor GC 间隔 10 秒以上，Full GC 间隔 10 分钟以上）</li><li>减少对象晋升到老年代的数量</li><li>降低 Full GC 的执行时间和频率</li></ul><h4 id="_2-1-2-调优范围" tabindex="-1"><a class="header-anchor" href="#_2-1-2-调优范围"><span>2.1.2 调优范围</span></a></h4><p><strong>内存调优</strong>：</p><ul><li>确定 JVM 所需的总内存大小</li><li>合理分配各内存区域（新生代、老年代、Survivor 区）</li><li>选择合适的垃圾收集器和参数</li><li>解决内存泄漏问题</li><li>识别内存热点对象</li><li>优化对象生命周期管理</li></ul><p><strong>线程调优</strong>：</p><ul><li>线程池配置优化</li><li>死锁检测和解决</li><li>线程竞争分析</li><li>线程栈大小调整</li></ul><p><strong>代码调优</strong>：</p><ul><li>CPU 热点方法分析</li><li>I/O 操作优化</li><li>算法和数据结构优化</li><li>缓存策略优化</li></ul><h3 id="_2-2-调优流程" tabindex="-1"><a class="header-anchor" href="#_2-2-调优流程"><span>2.2 调优流程</span></a></h3><h4 id="_2-2-1-标准调优步骤" tabindex="-1"><a class="header-anchor" href="#_2-2-1-标准调优步骤"><span>2.2.1 标准调优步骤</span></a></h4><ol><li><p><strong>建立监控基线</strong></p><ul><li>收集应用程序在正常负载下的性能数据</li><li>记录 GC 日志、内存使用情况、线程状态等</li><li>建立性能基准指标</li></ul></li><li><p><strong>性能瓶颈分析</strong></p><ul><li>分析 GC 日志，识别 GC 问题</li><li>使用 profiling 工具分析 CPU 热点</li><li>检查内存使用模式和对象分配</li><li>分析线程状态和并发情况</li></ul></li><li><p><strong>制定优化方案</strong></p><ul><li>根据分析结果确定优化重点</li><li>选择合适的 JVM 参数调整策略</li><li>识别需要代码优化的部分</li></ul></li><li><p><strong>参数调整与测试</strong></p><ul><li>在测试环境中调整 JVM 参数</li><li>进行压力测试验证效果</li><li>对比优化前后的性能指标</li></ul></li><li><p><strong>生产环境部署</strong></p><ul><li>在非高峰期逐步部署优化参数</li><li>持续监控系统性能变化</li><li>根据实际运行情况进一步微调</li></ul></li><li><p><strong>持续监控优化</strong></p><ul><li>建立长期监控机制</li><li>定期分析性能趋势</li><li>根据业务变化调整优化策略</li></ul></li></ol><h4 id="_2-2-2-调优决策原则" tabindex="-1"><a class="header-anchor" href="#_2-2-2-调优决策原则"><span>2.2.2 调优决策原则</span></a></h4><p><strong>何时需要调优</strong>：</p><ul><li>Minor GC 频率过高（间隔小于 10 秒）</li><li>Minor GC 耗时过长（超过 50ms）</li><li>Full GC 频率过高（间隔小于 10 分钟）</li><li>Full GC 耗时过长（超过 1 秒）</li><li>内存使用率持续过高（超过 80%）</li><li>应用响应时间不满足要求</li></ul><p><strong>何时不需要调优</strong>：</p><ul><li>Minor GC 执行时间小于 50ms 且频率合理</li><li>Full GC 执行时间小于 1 秒且频率合理</li><li>系统性能满足业务需求</li><li>资源利用率在合理范围内</li></ul><h3 id="_2-3-调优策略" tabindex="-1"><a class="header-anchor" href="#_2-3-调优策略"><span>2.3 调优策略</span></a></h3><h4 id="_2-3-1-应用层面优化策略" tabindex="-1"><a class="header-anchor" href="#_2-3-1-应用层面优化策略"><span>2.3.1 应用层面优化策略</span></a></h4><p><strong>对象创建优化</strong>：</p><ul><li>减少不必要的对象创建</li><li>复用对象（如 StringBuilder、线程池等）</li><li>使用对象池技术</li><li>避免在循环中创建对象</li></ul><p><strong>内存使用优化</strong>：</p><ul><li>减少全局变量和静态变量的使用</li><li>及时释放不再使用的对象引用</li><li>使用合适的数据结构（如 ArrayList vs LinkedList）</li><li>避免创建过大的对象</li></ul><p><strong>算法和数据结构优化</strong>：</p><ul><li>选择高效的算法实现</li><li>使用合适的集合类型</li><li>优化数据访问模式</li><li>减少不必要的计算</li></ul><h4 id="_2-3-2-jvm-层面优化策略" tabindex="-1"><a class="header-anchor" href="#_2-3-2-jvm-层面优化策略"><span>2.3.2 JVM 层面优化策略</span></a></h4><p><strong>堆内存配置</strong>：</p><ul><li>设置合适的堆大小（-Xms、-Xmx）</li><li>调整新生代和老年代的比例（-XX:NewRatio）</li><li>配置 Survivor 区大小（-XX:SurvivorRatio）</li><li>设置合适的晋升阈值（-XX:MaxTenuringThreshold）</li></ul><p><strong>垃圾收集器选择</strong>：</p><ul><li><strong>G1 收集器</strong>：适用于大堆内存、低延迟要求的应用</li><li><strong>CMS 收集器</strong>：适用于响应时间敏感的应用</li><li><strong>Parallel 收集器</strong>：适用于吞吐量优先的批处理应用</li><li><strong>ZGC/Shenandoah</strong>：适用于超大堆、超低延迟要求的应用</li></ul><p><strong>其他参数优化</strong>：</p><ul><li>线程栈大小调整（-Xss）</li><li>方法区大小设置（-XX:MetaspaceSize）</li><li>直接内存配置（-XX:MaxDirectMemorySize）</li></ul><h3 id="_2-4-调优最佳实践" tabindex="-1"><a class="header-anchor" href="#_2-4-调优最佳实践"><span>2.4 调优最佳实践</span></a></h3><h4 id="_2-4-1-调优理念" tabindex="-1"><a class="header-anchor" href="#_2-4-1-调优理念"><span>2.4.1 调优理念</span></a></h4><p><strong>代码优先原则</strong>：</p><ul><li>大部分性能问题源于代码层面，而非 JVM 参数配置</li><li>优先进行代码 Review 和算法优化</li><li>JVM 调优应该是最后的优化手段</li><li>在上线前就应该设置合理的 JVM 参数</li></ul><p><strong>渐进式优化</strong>：</p><ul><li>一次只调整一个参数，观察效果</li><li>避免同时修改多个参数</li><li>详细记录每次调整的参数和效果</li><li>建立参数变更的回滚方案</li></ul><p><strong>监控驱动优化</strong>：</p><ul><li>基于实际监控数据进行决策</li><li>避免盲目调参或经验主义</li><li>建立完善的监控体系</li><li>定期分析性能趋势</li></ul><h4 id="_2-4-2-常见调优误区" tabindex="-1"><a class="header-anchor" href="#_2-4-2-常见调优误区"><span>2.4.2 常见调优误区</span></a></h4><p><strong>盲目追求极致性能</strong>：</p><ul><li>过度优化可能导致系统不稳定</li><li>忽略了代码可维护性</li><li>没有考虑业务实际需求</li></ul><p><strong>参数设置过于激进</strong>：</p><ul><li>堆内存设置过大导致 GC 时间过长</li><li>新生代设置过小导致频繁 Minor GC</li><li>并发线程数设置不当</li></ul><p><strong>忽略业务特性</strong>：</p><ul><li>没有考虑应用的访问模式</li><li>忽略了对象的生命周期特征</li><li>不了解系统的负载特点</li></ul><h3 id="_2-5-内存配置实践" tabindex="-1"><a class="header-anchor" href="#_2-5-内存配置实践"><span>2.5 内存配置实践</span></a></h3><h4 id="_2-5-1-堆内存配置原则" tabindex="-1"><a class="header-anchor" href="#_2-5-1-堆内存配置原则"><span>2.5.1 堆内存配置原则</span></a></h4><p><strong>基本配置策略</strong>：</p><ul><li><strong>堆大小设置</strong>：<code>-Xms</code>和<code>-Xmx</code>设置为相同值，避免动态扩展开销</li><li><strong>平台差异</strong>：32 位 JVM 最大支持约 4GB 内存，64 位 JVM 理论上无限制</li><li><strong>运行模式</strong>：Server 模式适用于服务器应用，Client 模式适用于桌面应用</li></ul><p><strong>新生代和老年代比例</strong>：</p><ul><li><strong>默认比例</strong>：新生代:老年代 = 1:2（可通过<code>-XX:NewRatio</code>调整）</li><li><strong>绝对大小</strong>：使用<code>-XX:NewSize</code>和<code>-XX:MaxNewSize</code>设置绝对值</li><li><strong>统一设置</strong>：为避免动态调整开销，建议将最小值和最大值设置相同</li></ul><p><strong>Eden 和 Survivor 区配置</strong>：</p><ul><li><strong>默认比例</strong>：Eden:Survivor1:Survivor2 = 8:1:1</li><li><strong>调整参数</strong>：使用<code>-XX:SurvivorRatio</code>调整比例</li><li><strong>空间利用</strong>：实际可用新生代空间为 90%（Eden + 1 个 Survivor）</li></ul><h4 id="_2-5-2-内存分配策略" tabindex="-1"><a class="header-anchor" href="#_2-5-2-内存分配策略"><span>2.5.2 内存分配策略</span></a></h4><p><strong>对象特征分析</strong>：</p><ul><li><strong>短生命周期对象多</strong>：增大新生代比例，减少对象晋升</li><li><strong>长生命周期对象多</strong>：适当增大老年代，减少 Full GC 频率</li><li><strong>大对象处理</strong>：配置<code>-XX:PretenureSizeThreshold</code>直接分配到老年代</li></ul><p><strong>实际配置步骤</strong>：</p><ol><li><strong>观察业务峰值</strong>：统计老年代在峰值时的内存占用</li><li><strong>预留增长空间</strong>：为老年代预留至少 1/3 的增长空间</li><li><strong>新生代优化</strong>：在不影响 Full GC 的前提下，尽可能增大新生代</li><li><strong>持续监控</strong>：根据实际运行情况进行微调</li></ol><h4 id="_2-5-3-线程栈配置" tabindex="-1"><a class="header-anchor" href="#_2-5-3-线程栈配置"><span>2.5.3 线程栈配置</span></a></h4><p><strong>栈大小优化</strong>：</p><ul><li><strong>默认大小</strong>：每个线程默认 1MB 栈空间</li><li><strong>一般建议</strong>：多数应用 256KB 已足够使用</li><li><strong>配置参数</strong>：使用<code>-Xss256k</code>调整栈大小</li><li><strong>收益分析</strong>：在相同内存下可以创建更多线程</li></ul><p><strong>参数示例</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 基础内存配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xms4g</span><span style="color:#A3BE8C;"> -Xmx4g</span><span style="color:#616E88;">                    # 堆内存4GB</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:NewRatio</span><span style="color:#A3BE8C;">=2</span><span style="color:#616E88;">                   # 新生代:老年代 = 1:2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:SurvivorRatio</span><span style="color:#A3BE8C;">=8</span><span style="color:#616E88;">              # Eden:Survivor = 8:1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xss256k</span><span style="color:#616E88;">                         # 线程栈256KB</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 高级配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:MetaspaceSize</span><span style="color:#A3BE8C;">=256m</span><span style="color:#616E88;">           # 元空间初始大小</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:MaxMetaspaceSize</span><span style="color:#A3BE8C;">=512m</span><span style="color:#616E88;">        # 元空间最大大小</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:MaxDirectMemorySize</span><span style="color:#A3BE8C;">=1g</span><span style="color:#616E88;">       # 直接内存最大大小</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-6-故障诊断与解决" tabindex="-1"><a class="header-anchor" href="#_2-6-故障诊断与解决"><span>2.6 故障诊断与解决</span></a></h3><h4 id="_2-6-1-内存泄漏诊断" tabindex="-1"><a class="header-anchor" href="#_2-6-1-内存泄漏诊断"><span>2.6.1 内存泄漏诊断</span></a></h4><p><strong>内存泄漏症状</strong>：</p><ul><li>垃圾回收时间逐渐增长，Full GC 耗时达到数秒</li><li>Full GC 频率越来越高，间隔可能少于 1 分钟</li><li>老年代内存使用率持续上升</li><li>Full GC 后老年代内存无法有效释放</li><li>最终导致老年代堆空间被完全占满</li></ul><p><strong>诊断步骤</strong>：</p><ol><li><p><strong>监控 GC 行为</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 启用详细GC日志</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCDetails</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCTimeStamps</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xloggc:gc.log</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>生成堆转储</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 手动生成heap dump</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jmap</span><span style="color:#A3BE8C;"> -dump:format=b,file=heap.dump</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># OOM时自动生成</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+HeapDumpOnOutOfMemoryError</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:HeapDumpPath</span><span style="color:#A3BE8C;">=/path/to/dumps/</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>分析堆转储文件</strong>：</p><ul><li>使用 Eclipse MAT、VisualVM 等工具分析</li><li>查找占用内存最多的对象</li><li>分析对象引用链，找到泄漏根源</li></ul></li></ol><p><strong>常见泄漏场景</strong>：</p><ul><li>集合类只添加不删除</li><li>监听器注册后未注销</li><li>线程池使用不当</li><li>静态集合持有对象引用</li><li>数据库连接、文件流未关闭</li></ul><h4 id="_2-6-2-栈溢出问题" tabindex="-1"><a class="header-anchor" href="#_2-6-2-栈溢出问题"><span>2.6.2 栈溢出问题</span></a></h4><p><strong>栈溢出症状</strong>：</p><ul><li>抛出<code>StackOverflowError</code>异常</li><li>通常发生在深度递归或无限递归中</li></ul><p><strong>常见原因</strong>：</p><ul><li>递归调用没有正确的退出条件</li><li>递归深度超过栈容量限制</li><li>相互调用形成循环依赖</li></ul><p><strong>解决方案</strong>：</p><ul><li>检查递归逻辑，确保有正确的退出条件</li><li>使用迭代代替深度递归</li><li>适当增加栈大小（-Xss 参数）</li><li>优化算法，减少调用深度</li></ul><h4 id="_2-6-3-性能问题诊断" tabindex="-1"><a class="header-anchor" href="#_2-6-3-性能问题诊断"><span>2.6.3 性能问题诊断</span></a></h4><p><strong>CPU 热点分析</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 生成线程堆栈</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jstack</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#A3BE8C;"> thread.dump</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 分析CPU使用率高的线程</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">top</span><span style="color:#A3BE8C;"> -H</span><span style="color:#A3BE8C;"> -p</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>内存使用分析</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 查看堆内存使用情况</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jstat</span><span style="color:#A3BE8C;"> -gc</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span><span style="color:#A3BE8C;"> 1s</span><span style="color:#B48EAD;"> 10</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 查看对象分布</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jmap</span><span style="color:#A3BE8C;"> -histo</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>GC 分析</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 实时监控GC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">jstat</span><span style="color:#A3BE8C;"> -gcutil</span><span style="color:#81A1C1;"> &lt;</span><span style="color:#A3BE8C;">pi</span><span style="color:#D8DEE9FF;">d</span><span style="color:#81A1C1;">&gt;</span><span style="color:#A3BE8C;"> 1s</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 分析GC日志</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 使用GCViewer、GCPlot等工具</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_3-监控与日志配置" tabindex="-1"><a class="header-anchor" href="#_3-监控与日志配置"><span>3. 监控与日志配置</span></a></h2><h3 id="_3-1-gc-日志配置" tabindex="-1"><a class="header-anchor" href="#_3-1-gc-日志配置"><span>3.1 GC 日志配置</span></a></h3><h4 id="_3-1-1-jdk-8-及以前版本" tabindex="-1"><a class="header-anchor" href="#_3-1-1-jdk-8-及以前版本"><span>3.1.1 JDK 8 及以前版本</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 基础GC日志</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCDetails</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCTimeStamps</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCDateStamps</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xloggc:/path/to/gc.log</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 高级配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseGCLogFileRotation</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:NumberOfGCLogFiles</span><span style="color:#A3BE8C;">=5</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:GCLogFileSize</span><span style="color:#A3BE8C;">=100M</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+PrintGCApplicationStoppedTime</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_3-1-2-jdk-9-及以后版本" tabindex="-1"><a class="header-anchor" href="#_3-1-2-jdk-9-及以后版本"><span>3.1.2 JDK 9 及以后版本</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 统一日志配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xlog:gc*:gc.log:time,tags</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xlog:gc*:gc-%t.log:time,tags</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 日志轮转</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseGCLogFileRotation</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:NumberOfGCLogFiles</span><span style="color:#A3BE8C;">=5</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:GCLogFileSize</span><span style="color:#A3BE8C;">=100M</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_3-2-监控指标" tabindex="-1"><a class="header-anchor" href="#_3-2-监控指标"><span>3.2 监控指标</span></a></h3><h4 id="_3-2-1-关键性能指标" tabindex="-1"><a class="header-anchor" href="#_3-2-1-关键性能指标"><span>3.2.1 关键性能指标</span></a></h4><ul><li><strong>堆内存使用率</strong>：各代内存使用情况</li><li><strong>GC 频率和耗时</strong>：Minor GC 和 Full GC 的执行情况</li><li><strong>线程状态</strong>：线程数量、状态分布、死锁检测</li><li><strong>类加载</strong>：类加载数量和速度</li><li><strong>CPU 使用率</strong>：JVM 进程 CPU 占用情况</li></ul><h4 id="_3-2-2-告警阈值建议" tabindex="-1"><a class="header-anchor" href="#_3-2-2-告警阈值建议"><span>3.2.2 告警阈值建议</span></a></h4><ul><li>老年代使用率超过 80%</li><li>Full GC 频率高于每 10 分钟一次</li><li>GC 停顿时间超过 100ms</li><li>堆内存使用率持续上升</li><li>出现 OutOfMemoryError</li></ul><h2 id="_4-实际案例分析" tabindex="-1"><a class="header-anchor" href="#_4-实际案例分析"><span>4. 实际案例分析</span></a></h2><h3 id="_4-1-高并发-web-应用优化" tabindex="-1"><a class="header-anchor" href="#_4-1-高并发-web-应用优化"><span>4.1 高并发 Web 应用优化</span></a></h3><p><strong>场景描述</strong>：电商网站，高并发访问，响应时间要求低于 100ms</p><p><strong>优化策略</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># G1收集器配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseG1GC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:MaxGCPauseMillis</span><span style="color:#A3BE8C;">=50</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:G1HeapRegionSize</span><span style="color:#A3BE8C;">=16m</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xms8g</span><span style="color:#A3BE8C;"> -Xmx8g</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 其他优化</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+DisableExplicitGC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseStringDeduplication</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-大数据批处理应用" tabindex="-1"><a class="header-anchor" href="#_4-2-大数据批处理应用"><span>4.2 大数据批处理应用</span></a></h3><p><strong>场景描述</strong>：数据分析任务，处理大量数据，追求吞吐量</p><p><strong>优化策略</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># Parallel收集器配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseParallelGC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseParallelOldGC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:ParallelGCThreads</span><span style="color:#A3BE8C;">=8</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xms16g</span><span style="color:#A3BE8C;"> -Xmx16g</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 大对象优化</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:PretenureSizeThreshold</span><span style="color:#A3BE8C;">=1m</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-微服务应用" tabindex="-1"><a class="header-anchor" href="#_4-3-微服务应用"><span>4.3 微服务应用</span></a></h3><p><strong>场景描述</strong>：容器化部署，内存资源有限，启动速度要求高</p><p><strong>优化策略</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 内存限制配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-Xms512m</span><span style="color:#A3BE8C;"> -Xmx1g</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseG1GC</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:MaxGCPauseMillis</span><span style="color:#A3BE8C;">=100</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 启动优化</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:TieredStopAtLevel</span><span style="color:#A3BE8C;">=1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">-XX:+UseStringDeduplication</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,183)]))}const d=l(e,[["render",r],["__file","JVM工具和JVM调优.html.vue"]]),c=JSON.parse('{"path":"/md/article/language/java/jvm/JVM%E5%B7%A5%E5%85%B7%E5%92%8CJVM%E8%B0%83%E4%BC%98.html","title":"JVM 工具和 JVM 调优指南","lang":"en-US","frontmatter":{},"headers":[{"level":2,"title":"性能监控与故障处理工具","slug":"性能监控与故障处理工具","link":"#性能监控与故障处理工具","children":[{"level":3,"title":"命令行工具","slug":"命令行工具","link":"#命令行工具","children":[]},{"level":3,"title":"图形化工具","slug":"图形化工具","link":"#图形化工具","children":[]},{"level":3,"title":"远程连接","slug":"远程连接","link":"#远程连接","children":[]}]},{"level":2,"title":"JVM 调优","slug":"jvm-调优","link":"#jvm-调优","children":[{"level":3,"title":"JVM 如何调优、调什么、目标","slug":"jvm-如何调优、调什么、目标","link":"#jvm-如何调优、调什么、目标","children":[]},{"level":3,"title":"调优步骤","slug":"调优步骤","link":"#调优步骤","children":[]},{"level":3,"title":"调优目标","slug":"调优目标","link":"#调优目标","children":[]},{"level":3,"title":"JVM 调优策略","slug":"jvm-调优策略","link":"#jvm-调优策略","children":[]},{"level":3,"title":"JVM 调优冷思考","slug":"jvm-调优冷思考","link":"#jvm-调优冷思考","children":[]},{"level":3,"title":"JVM 调优经验","slug":"jvm-调优经验","link":"#jvm-调优经验","children":[]}]},{"level":2,"title":"1. 性能监控与故障处理工具","slug":"_1-性能监控与故障处理工具","link":"#_1-性能监控与故障处理工具","children":[{"level":3,"title":"1.1 命令行工具","slug":"_1-1-命令行工具","link":"#_1-1-命令行工具","children":[]},{"level":3,"title":"1.2 图形化工具","slug":"_1-2-图形化工具","link":"#_1-2-图形化工具","children":[]},{"level":3,"title":"1.3 远程监控配置","slug":"_1-3-远程监控配置","link":"#_1-3-远程监控配置","children":[]}]},{"level":2,"title":"2. JVM 调优","slug":"_2-jvm-调优","link":"#_2-jvm-调优","children":[{"level":3,"title":"2.1 调优概述","slug":"_2-1-调优概述","link":"#_2-1-调优概述","children":[]},{"level":3,"title":"2.2 调优流程","slug":"_2-2-调优流程","link":"#_2-2-调优流程","children":[]},{"level":3,"title":"2.3 调优策略","slug":"_2-3-调优策略","link":"#_2-3-调优策略","children":[]},{"level":3,"title":"2.4 调优最佳实践","slug":"_2-4-调优最佳实践","link":"#_2-4-调优最佳实践","children":[]},{"level":3,"title":"2.5 内存配置实践","slug":"_2-5-内存配置实践","link":"#_2-5-内存配置实践","children":[]},{"level":3,"title":"2.6 故障诊断与解决","slug":"_2-6-故障诊断与解决","link":"#_2-6-故障诊断与解决","children":[]}]},{"level":2,"title":"3. 监控与日志配置","slug":"_3-监控与日志配置","link":"#_3-监控与日志配置","children":[{"level":3,"title":"3.1 GC 日志配置","slug":"_3-1-gc-日志配置","link":"#_3-1-gc-日志配置","children":[]},{"level":3,"title":"3.2 监控指标","slug":"_3-2-监控指标","link":"#_3-2-监控指标","children":[]}]},{"level":2,"title":"4. 实际案例分析","slug":"_4-实际案例分析","link":"#_4-实际案例分析","children":[{"level":3,"title":"4.1 高并发 Web 应用优化","slug":"_4-1-高并发-web-应用优化","link":"#_4-1-高并发-web-应用优化","children":[]},{"level":3,"title":"4.2 大数据批处理应用","slug":"_4-2-大数据批处理应用","link":"#_4-2-大数据批处理应用","children":[]},{"level":3,"title":"4.3 微服务应用","slug":"_4-3-微服务应用","link":"#_4-3-微服务应用","children":[]}]}],"git":{"updatedTime":1718018615000,"contributors":[{"name":"hyfly233","username":"hyfly233","email":"hyfly233@outlook.com","commits":6,"url":"https://github.com/hyfly233"}]},"filePathRelative":"md/article/language/java/jvm/JVM工具和JVM调优.md"}');export{d as comp,c as data};
