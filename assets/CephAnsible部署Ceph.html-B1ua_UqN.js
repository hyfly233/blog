import{_ as n,c as a,f as l,o as e}from"./app-chPKMbRn.js";const i={};function p(c,s){return e(),a("div",null,s[0]||(s[0]=[l(`<h1 id="ceph-ansible-部署-ceph" tabindex="-1"><a class="header-anchor" href="#ceph-ansible-部署-ceph"><span>Ceph-Ansible 部署 Ceph</span></a></h1><h2 id="安装-ceph-ansible" tabindex="-1"><a class="header-anchor" href="#安装-ceph-ansible"><span>安装 Ceph-Ansible</span></a></h2><h3 id="创建虚拟环境" tabindex="-1"><a class="header-anchor" href="#创建虚拟环境"><span>创建虚拟环境</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 安装虚拟环境依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> python-devel</span><span style="color:#A3BE8C;"> libselinux-python</span><span style="color:#A3BE8C;"> python-virtualenv</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建虚拟环境</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virtualenv</span><span style="color:#A3BE8C;"> /opt/ceph/venv/</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 激活虚拟环境</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /opt/ceph/venv/bin/activate</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="虚拟环境中安装-ceph-ansible-stable-4-0" tabindex="-1"><a class="header-anchor" href="#虚拟环境中安装-ceph-ansible-stable-4-0"><span>虚拟环境中安装 Ceph-Ansible stable-4.0</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 克隆源码</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">git</span><span style="color:#A3BE8C;"> clone</span><span style="color:#A3BE8C;"> https://github.com/ceph/ceph-ansible.git</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> git</span><span style="color:#A3BE8C;"> checkout</span><span style="color:#A3BE8C;"> stable-4.0</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> pip</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> setuptools</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 安装 ceph-ansible 依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -r</span><span style="color:#A3BE8C;"> requirements.txt</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 编辑 ansible 配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/ansible/ansible.cfg</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">defaults</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">host_key_checking</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">False</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">pipelining</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">True</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">forks</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">100</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写-ceph-inventory" tabindex="-1"><a class="header-anchor" href="#编写-ceph-inventory"><span>编写 Ceph Inventory</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/hosts</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容 mons osds grafana-server 是必须要的</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mons</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:5]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">osds</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:5]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mgrs</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mdss</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">grafana-server</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-group-vars-all-yml-配置" tabindex="-1"><a class="header-anchor" href="#修改-group-vars-all-yml-配置"><span>修改 group_vars/all.yml 配置</span></a></h3><p>在 Docker 中部署 Ceph</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/group_vars</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 备份 group_vars 下的文件</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9;"> file</span><span style="color:#81A1C1;"> in</span><span style="color:#A3BE8C;"> *</span><span style="color:#81A1C1;">;</span><span style="color:#81A1C1;"> do</span><span style="color:#88C0D0;"> cp</span><span style="color:#D8DEE9;"> $file</span><span style="color:#81A1C1;"> \${</span><span style="color:#D8DEE9;">file</span><span style="color:#81A1C1;">%</span><span style="color:#D8DEE9FF;">.</span><span style="color:#81A1C1;">*};</span><span style="color:#81A1C1;"> done</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 编辑 all.yml</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/group_vars/all.yml</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">---</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">dummy:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cluster:</span><span style="color:#A3BE8C;"> ceph</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mon_group_name:</span><span style="color:#A3BE8C;"> mons</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">osd_group_name:</span><span style="color:#A3BE8C;"> osds</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rgw_group_name:</span><span style="color:#A3BE8C;"> rgws</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mds_group_name:</span><span style="color:#A3BE8C;"> mdss</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">nfs_group_name:</span><span style="color:#A3BE8C;"> nfss</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbdmirror_group_name:</span><span style="color:#A3BE8C;"> rbdmirrors</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">client_group_name:</span><span style="color:#A3BE8C;"> clients</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">iscsi_gw_group_name:</span><span style="color:#A3BE8C;"> iscsigws</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mgr_group_name:</span><span style="color:#A3BE8C;"> mgrs</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rgwloadbalancer_group_name:</span><span style="color:#A3BE8C;"> rgwloadbalancers</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">grafana_server_group_name:</span><span style="color:#A3BE8C;"> grafana-server</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">configure_firewall:</span><span style="color:#A3BE8C;"> False</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ntp_service_enabled:</span><span style="color:#81A1C1;"> false</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">upgrade_ceph_packages:</span><span style="color:#A3BE8C;"> False</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_origin:</span><span style="color:#A3BE8C;"> repository</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_repository:</span><span style="color:#A3BE8C;"> community</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_mirror:</span><span style="color:#A3BE8C;"> http://mirrors.aliyun.com/ceph</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_key:</span><span style="color:#A3BE8C;"> http://mirrors.aliyun.com/ceph/keys/release.asc</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_release:</span><span style="color:#A3BE8C;"> nautilus</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_repo:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">{{ ceph_mirror }}/rpm-{{ ceph_stable_release }}</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">monitor_interface:</span><span style="color:#A3BE8C;"> ens33</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">public_network:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.93.0/24</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">radosgw_interface:</span><span style="color:#A3BE8C;"> ens33</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_docker_image_tag:</span><span style="color:#A3BE8C;"> v4.0.22-stable-4.0-nautilus-centos-7-x86_64</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">containerized_deployment:</span><span style="color:#A3BE8C;"> True</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">dashboard_admin_password:</span><span style="color:#A3BE8C;"> password@123456</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">grafana_admin_password:</span><span style="color:#A3BE8C;"> password@123456</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">no_log_on_ceph_key_tasks:</span><span style="color:#A3BE8C;"> False</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-group-vars-osds-yml" tabindex="-1"><a class="header-anchor" href="#修改-group-vars-osds-yml"><span>修改 group_vars/osds.yml</span></a></h3><div class="language-yaml line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-yaml;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">devices</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdb</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdc</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdd</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker-ceph-部署" tabindex="-1"><a class="header-anchor" href="#docker-ceph-部署"><span>Docker Ceph 部署</span></a></h3><p>可能遇到 ceph-ansible 和已安装的 docker 冲突的情况</p><ul><li><a href="https://github.com/ceph/ceph-ansible/issues/5159" target="_blank" rel="noopener noreferrer">https://github.com/ceph/ceph-ansible/issues/5159</a></li><li><a href="https://github.com/ceph/ceph-ansible/issues/3609" target="_blank" rel="noopener noreferrer">https://github.com/ceph/ceph-ansible/issues/3609</a></li></ul><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> site-container.yml.sample</span><span style="color:#A3BE8C;"> site-container.yml</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 验证连通性</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> all</span><span style="color:#A3BE8C;"> -m</span><span style="color:#A3BE8C;"> ping</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 部署 ceph</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> site-container.yml</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/opt/ceph/venv/bin/python</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 或者指定 /usr/bin/python2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> site-container.yml</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/usr/bin/python2</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="部署后-ceph-service-位置" tabindex="-1"><a class="header-anchor" href="#部署后-ceph-service-位置"><span>部署后 Ceph Service 位置</span></a></h3><p>ceph-ansible 将会把所有的 ceph 组件分别对应到各自的 service 中</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">ls</span><span style="color:#A3BE8C;"> -l</span><span style="color:#A3BE8C;"> /etc/systemd/system/ceph</span><span style="color:#81A1C1;">*</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="出错回滚" tabindex="-1"><a class="header-anchor" href="#出错回滚"><span>出错回滚</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 清理集群，会将所有的容器和镜像全部清除</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> infrastructure-playbooks/purge-cluster.yml</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 手动清除 ceph 相关文件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rm</span><span style="color:#A3BE8C;"> -rf</span><span style="color:#A3BE8C;"> /etc/ceph/</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> rm</span><span style="color:#A3BE8C;"> -rf</span><span style="color:#A3BE8C;"> /var/lib/ceph/</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 检测硬盘分区</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">lsblk</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 如输出内容，需要移除 LVM 逻辑卷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sdc</span><span style="color:#A3BE8C;">     8:32</span><span style="color:#B48EAD;">   0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">└─ceph--399e8b5a--4348xxxx</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 移除 LVM 逻辑卷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">lvremove</span><span style="color:#A3BE8C;"> /dev/ceph-399e8b5a--4348xxxx</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="集群升级" tabindex="-1"><a class="header-anchor" href="#集群升级"><span>集群升级</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 升级集群</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> infrastructure-playbooks/rolling_update.yml</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \\</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问控制台" tabindex="-1"><a class="header-anchor" href="#访问控制台"><span>访问控制台</span></a></h3><ul><li>Ceph 控制台：https://192.168.93.101:8443/#/login，账号密码 admin/password@123456</li><li>Grafana 控制台：https://10.247.53.6:3000/login，账号密码 admin/password@123456</li></ul>`,26)]))}const d=n(i,[["render",p],["__file","CephAnsible部署Ceph.html.vue"]]),o=JSON.parse('{"path":"/md/article/storage/CephAnsible%E9%83%A8%E7%BD%B2Ceph.html","title":"CephAnsible部署Ceph","lang":"en-US","frontmatter":{"title":"CephAnsible部署Ceph","sidebar":"heading"},"headers":[{"level":2,"title":"安装 Ceph-Ansible","slug":"安装-ceph-ansible","link":"#安装-ceph-ansible","children":[{"level":3,"title":"创建虚拟环境","slug":"创建虚拟环境","link":"#创建虚拟环境","children":[]},{"level":3,"title":"虚拟环境中安装 Ceph-Ansible stable-4.0","slug":"虚拟环境中安装-ceph-ansible-stable-4-0","link":"#虚拟环境中安装-ceph-ansible-stable-4-0","children":[]},{"level":3,"title":"编写 Ceph Inventory","slug":"编写-ceph-inventory","link":"#编写-ceph-inventory","children":[]},{"level":3,"title":"修改 group_vars/all.yml 配置","slug":"修改-group-vars-all-yml-配置","link":"#修改-group-vars-all-yml-配置","children":[]},{"level":3,"title":"修改 group_vars/osds.yml","slug":"修改-group-vars-osds-yml","link":"#修改-group-vars-osds-yml","children":[]},{"level":3,"title":"Docker Ceph 部署","slug":"docker-ceph-部署","link":"#docker-ceph-部署","children":[]},{"level":3,"title":"部署后 Ceph Service 位置","slug":"部署后-ceph-service-位置","link":"#部署后-ceph-service-位置","children":[]},{"level":3,"title":"出错回滚","slug":"出错回滚","link":"#出错回滚","children":[]},{"level":3,"title":"集群升级","slug":"集群升级","link":"#集群升级","children":[]},{"level":3,"title":"访问控制台","slug":"访问控制台","link":"#访问控制台","children":[]}]}],"git":{"updatedTime":1735864944000,"contributors":[{"name":"hyfly233","username":"hyfly233","email":"hyfly233@outlook.com","commits":1,"url":"https://github.com/hyfly233"}]},"filePathRelative":"md/article/storage/CephAnsible部署Ceph.md"}');export{d as comp,o as data};
