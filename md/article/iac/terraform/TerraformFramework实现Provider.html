<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>TerraformFramework实现Provider | とんぼの気持ち</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-nxaj3WOG.css" as="style"><link rel="stylesheet" href="/blog/assets/style-nxaj3WOG.css">
    <link rel="modulepreload" href="/blog/assets/app-chPKMbRn.js"><link rel="modulepreload" href="/blog/assets/TerraformFramework实现Provider.html-DmR-BbHm.js">
    <link rel="prefetch" href="/blog/assets/directory.html-CM077g0X.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WkqGtERh.js" as="script"><link rel="prefetch" href="/blog/assets/directory.html-BH0WGkAw.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible扩充OSD节点.html-DQGhyA8S.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible的OSD存储满后的临时解决方案.html-BDuF8Lky.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible部署Ceph.html-B1ua_UqN.js" as="script"><link rel="prefetch" href="/blog/assets/iSCSI安装.html-HVTL7fJU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BceON7lL.js" as="script"><link rel="prefetch" href="/blog/assets/如何升级系统构架.html-B16ubYTA.js" as="script"><link rel="prefetch" href="/blog/assets/如何正确加锁.html-DjvlAowS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3nYQ7aQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BmNefUmR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJsvdjYt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlgG4jCN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bp1xrcuH.js" as="script"><link rel="prefetch" href="/blog/assets/linear_search.html-Dr3lRrFe.js" as="script"><link rel="prefetch" href="/blog/assets/binary_tree_sort.html-BZSaHXpo.js" as="script"><link rel="prefetch" href="/blog/assets/bitonic_sort.html-DZHRyZF8.js" as="script"><link rel="prefetch" href="/blog/assets/bubble_sort.html-XLBBj8rD.js" as="script"><link rel="prefetch" href="/blog/assets/bucket_sort.html-D1NDEl5q.js" as="script"><link rel="prefetch" href="/blog/assets/cocktail_shaker_sort.html-sQF3C84o.js" as="script"><link rel="prefetch" href="/blog/assets/comb_sort.html-B6Z7wIqt.js" as="script"><link rel="prefetch" href="/blog/assets/counting_sort.html-D8wkfUEd.js" as="script"><link rel="prefetch" href="/blog/assets/gnome_sort.html-ClFIwPrf.js" as="script"><link rel="prefetch" href="/blog/assets/heap_sort.html-Rp3rKaBj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DSXsiBgb.js" as="script"><link rel="prefetch" href="/blog/assets/insertion_sort.html-Cb45Fk0s.js" as="script"><link rel="prefetch" href="/blog/assets/merge_sort.html-DKhyfHNj.js" as="script"><link rel="prefetch" href="/blog/assets/odd_even_sort.html-BUUtGCfM.js" as="script"><link rel="prefetch" href="/blog/assets/pancake_sort.html-CLbqQfeK.js" as="script"><link rel="prefetch" href="/blog/assets/quick_sort.html-DsTl6rI_.js" as="script"><link rel="prefetch" href="/blog/assets/radix_sort.html-DGfsIMQr.js" as="script"><link rel="prefetch" href="/blog/assets/selection_sort.html-CWB7HCPo.js" as="script"><link rel="prefetch" href="/blog/assets/shell_sort.html-RYeqqTj9.js" as="script"><link rel="prefetch" href="/blog/assets/smooth_sort.html-B0t6JSLd.js" as="script"><link rel="prefetch" href="/blog/assets/stooge_sort.html-YfhFB3iG.js" as="script"><link rel="prefetch" href="/blog/assets/tim_sort.html-BoCSzhxx.js" as="script"><link rel="prefetch" href="/blog/assets/ESXI虚机迁移至OpenStack.html-6EM4grfG.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla使用Libvirt.html-BH6Q3PvO.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla及Ceph部署.html-DBRpVcxj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlM2okaw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DuySOOS7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COYjVXza.js" as="script"><link rel="prefetch" href="/blog/assets/环境搭建.html-BwslABub.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bk5wCQBA.js" as="script"><link rel="prefetch" href="/blog/assets/Schema变更.html-CmXDyeR-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bl4wowJu.js" as="script"><link rel="prefetch" href="/blog/assets/动态分区和RoutineLoad.html-BYzTxZd0.js" as="script"><link rel="prefetch" href="/blog/assets/存算分离.html-9GVDpuqQ.js" as="script"><link rel="prefetch" href="/blog/assets/数据划分.html-yeEAwxQ-.js" as="script"><link rel="prefetch" href="/blog/assets/数据库建表最佳实践.html-CU31WBJ2.js" as="script"><link rel="prefetch" href="/blog/assets/日志存储最佳实践.html-BJPmJmHB.js" as="script"><link rel="prefetch" href="/blog/assets/表模型.html-lvuDP8dJ.js" as="script"><link rel="prefetch" href="/blog/assets/表索引.html-Ck9S3vCk.js" as="script"><link rel="prefetch" href="/blog/assets/表设计.html-tk_DoCsV.js" as="script"><link rel="prefetch" href="/blog/assets/集群部署.html-4idh13Cl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cth5DVaR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZicgUK5U.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DoXHiDiT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CrHNcY8F.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUx8GfJe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHVKGkTF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COz27HnP.js" as="script"><link rel="prefetch" href="/blog/assets/query.html-DoPeGCPi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-w3kLOssO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTpqBRxQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxORDID2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-k7IOKuSo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CQB9Z0b8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EtRq-J4i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVp3vOGH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DQBe6C8G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHiZJrZY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DIai_jYU.js" as="script"><link rel="prefetch" href="/blog/assets/Terraform命令.html-CSe_xkG9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-1hZwCU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DCKXXjZh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C0awBswM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wn39Nn3s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bzvj5tms.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BE5TLZ79.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BH9xzrDi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fENjPdqb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DBCYo0z6.js" as="script"><link rel="prefetch" href="/blog/assets/Rsyslog日志转存.html-VynoGpA4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-49epSqc8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B_flGDt0.js" as="script"><link rel="prefetch" href="/blog/assets/SeaTunnel数据库CDC配置.html-ON8CoGPS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ChXgdJTg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bc5oNQiy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-dcPYv2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ck1dZsqe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3t4G-zts.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KRPZcEBU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RQaezZK1.js" as="script"><link rel="prefetch" href="/blog/assets/ZabbixAgent安装及自定义脚本.html-DKURZalB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C29L2VNh.js" as="script"><link rel="prefetch" href="/blog/assets/zabbix安装.html-FEQL6thK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-R3ii_NIK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5_B4zlm.js" as="script"><link rel="prefetch" href="/blog/assets/SQL.html-89x0k9Cm.js" as="script"><link rel="prefetch" href="/blog/assets/数据库优化.html-K6nWNgZK.js" as="script"><link rel="prefetch" href="/blog/assets/数据库索引.html-BX4K5xTn.js" as="script"><link rel="prefetch" href="/blog/assets/数据库锁与事务.html-CS8d_ANn.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatis.html-CIkBxdDk.js" as="script"><link rel="prefetch" href="/blog/assets/Java基础.html-D_QRBbpt.js" as="script"><link rel="prefetch" href="/blog/assets/Java调优.html-B4RoEDf7.js" as="script"><link rel="prefetch" href="/blog/assets/Java进阶.html-Db99JmhM.js" as="script"><link rel="prefetch" href="/blog/assets/反射.html-B9fatXTn.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-CxbSCpUd.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html-B6SpjkfJ.js" as="script"><link rel="prefetch" href="/blog/assets/集合.html-CUZ1m7It.js" as="script"><link rel="prefetch" href="/blog/assets/面向对象.html-UMaUbHDD.js" as="script"><link rel="prefetch" href="/blog/assets/jvm.html-BWNS3e3B.js" as="script"><link rel="prefetch" href="/blog/assets/JUC.html-DLUivWNX.js" as="script"><link rel="prefetch" href="/blog/assets/ThreadLocal.html-BYxYh7yT.js" as="script"><link rel="prefetch" href="/blog/assets/多线程.html-BmpsxTLI.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-DwozZdb4.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html--5qDdUfD.js" as="script"><link rel="prefetch" href="/blog/assets/Redis.html-BsKKSiRX.js" as="script"><link rel="prefetch" href="/blog/assets/ElasticSearch.html-Pn1J3Cur.js" as="script"><link rel="prefetch" href="/blog/assets/JVM.html-DNvsmY-J.js" as="script"><link rel="prefetch" href="/blog/assets/JVM内存模型.html-CZyniu0B.js" as="script"><link rel="prefetch" href="/blog/assets/JVM对高效并发的支持.html-eb1cM9Dq.js" as="script"><link rel="prefetch" href="/blog/assets/JVM工具和JVM调优.html--xINkAvq.js" as="script"><link rel="prefetch" href="/blog/assets/垃圾回收.html-WnvI2chO.js" as="script"><link rel="prefetch" href="/blog/assets/Spring.html-B4O33Fe1.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot.html-O44ccL2x.js" as="script"><link rel="prefetch" href="/blog/assets/SpringMvc.html-C8kgBqP7.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloud.html-DTSK6rgN.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudAlibaba.html-BXlIalpv.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudNetflix.html-BP0KK0nB.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-BlOTU2g8.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-BphbxoLK.js" as="script"><link rel="prefetch" href="/blog/assets/分布式锁.html-CgINm6oC.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-5cdhF5yj.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-CYpgxpoD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="vp-site-logo" src="/blog/assets/img/game.ico" alt="とんぼの気持ち"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">とんぼの気持ち</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">TerraformFramework实现Provider <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h1 id="使用-terraform-framework-实现-provider" tabindex="-1"><a class="header-anchor" href="#使用-terraform-framework-实现-provider"><span>使用 Terraform Framework 实现 provider</span></a></h1><h2 id="先决条件" tabindex="-1"><a class="header-anchor" href="#先决条件"><span>先决条件</span></a></h2><ul><li>Go 1.19+ 已安装并配置</li><li>Terraform v1.0.3+ 本地安装</li><li>Docker 本地安装</li></ul><h2 id="设置开发环境" tabindex="-1"><a class="header-anchor" href="#设置开发环境"><span>设置开发环境</span></a></h2><p>克隆项目 <a href="https://github.com/hashicorp/terraform-provider-scaffolding-framework" target="_blank" rel="noopener noreferrer">Terraform Provider Scaffolding Framework repository</a></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> git</span><span style="color:#A3BE8C;"> clone</span><span style="color:#A3BE8C;"> https://github.com/hashicorp/terraform-provider-scaffolding-framework</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>项目重命名<code>terraform-provider-hashicups-pf</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> mv</span><span style="color:#A3BE8C;"> terraform-provider-scaffolding-framework</span><span style="color:#A3BE8C;"> terraform-provider-hashicups-pf</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>切换到克隆的项目</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> terraform-provider-hashicups-pf</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重命名模块 <code>go.mod</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> mod</span><span style="color:#A3BE8C;"> edit</span><span style="color:#A3BE8C;"> -module</span><span style="color:#A3BE8C;"> terraform-provider-hashicups-pf</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>安装依赖</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> mod</span><span style="color:#A3BE8C;"> tidy</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> go</span><span style="color:#A3BE8C;"> install</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="设置-docker-compose" tabindex="-1"><a class="header-anchor" href="#设置-docker-compose"><span>设置 docker compose</span></a></h3><p>在项目中创建一个 <code>docker_compose</code> 目录，该目录将包含启动 HashiCups 本地实例所需的 Docker 配置</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> mkdir</span><span style="color:#A3BE8C;"> docker_compose</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建文件 <code>docker_compose/conf.json</code></p><div class="language-json line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="json" data-title="json"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-json;"><code><span class="line"><span class="line"><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">db_connection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">host=db port=5432 user=postgres password=password dbname=products sslmode=disable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">bind_address</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0.0.0.0:9090</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#8FBCBB;">metrics_address</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">localhost:9102</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建文件 <code>docker_compose/docker-compose.yml</code></p><div class="language-yaml line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-yaml;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">3.7</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">services</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  api</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    image</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorpdemoapp/product-api:v0.0.22</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    ports</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">19090:9090</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    volumes</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#A3BE8C;"> ./conf.json:/config/config.json</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    environment</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">      CONFIG_FILE</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">/config/config.json</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    depends_on</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#A3BE8C;"> db</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  db</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    image</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorpdemoapp/product-api-db:v0.0.22</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    ports</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">15432:5432</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    environment</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">      POSTGRES_DB</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">products</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">      POSTGRES_USER</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">postgres</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">      POSTGRES_PASSWORD</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">password</span><span style="color:#ECEFF4;">&#39;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>启动 docker 容器</p><h2 id="provider" tabindex="-1"><a class="header-anchor" href="#provider"><span>Provider</span></a></h2><h3 id="实现-provider" tabindex="-1"><a class="header-anchor" href="#实现-provider"><span>实现 Provider</span></a></h3><p>Provider 使用 <code>provider.Provider</code> 接口作为所有实现 provider 细节的起点，此接口需要满足以下条件：</p><ol><li>Metadata 方法，用于定义要包含在每个 data source 和 resource 类型名称中的 provider 类型名称</li><li>Schema 方法，用于定义 provider 的 schema</li><li>Configure 方法，用于为 data source 和 resource 实现配置共享客户端</li><li>DataSources 方法，用于定义 provider 的 data sources</li><li>Resources 方法，用于定义 provider 的 resource</li></ol><p>打开 <code>internal/provider/provider.go</code> 替换为以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Provider </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// New is a helper function to simplify provider server and testing implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> New</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">version</span><span style="color:#81A1C1;"> string</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Provider </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Provider </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            version</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> version</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// hashicupsProvider is the provider implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> hashicupsProvider </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // version is set to the provider version on release, &quot;dev&quot; when the</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // provider is built and ran locally, and &quot;test&quot; when running acceptance</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // testing.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    version</span><span style="color:#81A1C1;"> string</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Metadata returns the provider type name.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Metadata</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">TypeName</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Version</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> p</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">version</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the provider-level schema for configuration data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Configure prepares a HashiCups API client for data sources and resources.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Configure</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// DataSources defines the data sources implemented in the provider.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> DataSources</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> nil</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Resources defines the resources implemented in the provider.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Resources</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> nil</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-provider-server" tabindex="-1"><a class="header-anchor" href="#实现-provider-server"><span>实现 Provider Server</span></a></h3><p>Terraform provider 是与 Terraform 交互以处理每个 data source 和 resource 操作的服务器进程</p><p>打开 <code>main.go</code> 替换为以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">flag</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">log</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/providerserver</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">terraform-provider-hashicups-pf/internal/provider</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> debug</span><span style="color:#81A1C1;"> bool</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    flag</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">BoolVar</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">&amp;</span><span style="color:#D8DEE9;">debug</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">debug</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">set to true to run the provider with support for debuggers like delve</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    flag</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Parse</span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    opts</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9FF;"> providerserver</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ServeOpts</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // NOTE: This is not a typical Terraform Registry provider address,</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // such as registry.terraform.io/hashicorp/hashicups. This specific</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // provider address is used in these tutorials in conjunction with a</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // specific Terraform CLI configuration for manual development testing</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // of this provider.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Address</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorp.com/edu/hashicups-pf</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Debug</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">   debug</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> providerserver</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Serve</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">context</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Background</span><span style="color:#ECEFF4;">(),</span><span style="color:#D8DEE9;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">New</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">version</span><span style="color:#ECEFF4;">),</span><span style="color:#D8DEE9;"> opts</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        log</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Fatal</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证-provider" tabindex="-1"><a class="header-anchor" href="#验证-provider"><span>验证 Provider</span></a></h3><p>运行程序，输出如下内容为正确情况</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> run</span><span style="color:#A3BE8C;"> main.go</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">This</span><span style="color:#A3BE8C;"> binary</span><span style="color:#A3BE8C;"> is</span><span style="color:#A3BE8C;"> a</span><span style="color:#A3BE8C;"> plugin.</span><span style="color:#A3BE8C;"> These</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> not</span><span style="color:#A3BE8C;"> meant</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> be</span><span style="color:#A3BE8C;"> executed</span><span style="color:#A3BE8C;"> directly.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Please</span><span style="color:#A3BE8C;"> execute</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> program</span><span style="color:#A3BE8C;"> that</span><span style="color:#A3BE8C;"> consumes</span><span style="color:#A3BE8C;"> these</span><span style="color:#A3BE8C;"> plugins,</span><span style="color:#A3BE8C;"> which</span><span style="color:#A3BE8C;"> will</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">load</span><span style="color:#A3BE8C;"> any</span><span style="color:#A3BE8C;"> plugins</span><span style="color:#A3BE8C;"> automatically</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">exit</span><span style="color:#A3BE8C;"> status</span><span style="color:#B48EAD;"> 1</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="进行本地-provider-安装" tabindex="-1"><a class="header-anchor" href="#进行本地-provider-安装"><span>进行本地 Provider 安装</span></a></h3><p>当运行 <code>Terraform init</code> 时，Terraform 会安装 provider 并验证它们的版本和校验和</p><p>Terraform 将从 <code>provider registry</code> 或<code>本地注册中心</code>下载 provider</p><p>Terraform 通过在配置文件 <code>.terraformrc</code> 中设置 <code>dev_overrides</code> 块来指定使用本地 provider</p><ol><li>首先，找到 Go 安装二进制文件的 <code>GOBIN</code> 路径</li></ol><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> env</span><span style="color:#A3BE8C;"> GOBIN</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">/Users/</span><span style="color:#D8DEE9FF;">&lt;Username&gt;/go/bin</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>编辑 <code>.terraformrc</code> 文件，将 <code>PATH</code> 替换为 <code>go env GOBIN</code> 的值</li></ol><div class="language-hcl line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="hcl" data-title="hcl"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-hcl;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">provider_installation </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  dev_overrides </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">hashicorp.com/edu/hashicups-pf</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> = </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">&lt;PATH&gt;</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">  # For all other providers, install them directly from their origin provider</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">  # registries as normal. If you omit this, Terraform will _only_ use</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">  # the dev_overrides block, and so no other providers will be available.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  direct </span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="本地安装-provider-并使用-terraform-进行验证" tabindex="-1"><a class="header-anchor" href="#本地安装-provider-并使用-terraform-进行验证"><span>本地安装 Provider 并使用 Terraform 进行验证</span></a></h3><p>编译后的二进制文件将会安装在 <code>GOBIN</code> 路径中</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建目录 <code>examples/provider-install-verification</code>，该目录将包含用于验证本地 provider 的 terraform 配置</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> mkdir</span><span style="color:#A3BE8C;"> examples/provider-install-verification</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> cd</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#81A1C1;">$_</span><span style="color:#ECEFF4;">&quot;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>使用以下内容创建文件 <code>examples/provider-install-verification/main.tf</code></p><div class="language-terraform line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="terraform" data-title="terraform"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-terraform;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">terraform </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  required_providers </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    hashicups</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      source</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorp.com/edu/hashicups-pf</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">provider </span><span style="color:#D8DEE9;">&quot;hashicups&quot;</span><span style="color:#ECEFF4;"> {}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">data </span><span style="color:#D8DEE9;">&quot;hashicups_coffees&quot;</span><span style="color:#D8DEE9;"> &quot;example&quot;</span><span style="color:#ECEFF4;"> {}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行 <code>Terraform plan</code> 将报错，但能够验证 Terraform 能够成功启动本地安装的 provider</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">╷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> Warning:</span><span style="color:#A3BE8C;"> Provider</span><span style="color:#A3BE8C;"> development</span><span style="color:#A3BE8C;"> overrides</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> in</span><span style="color:#A3BE8C;"> effect</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> The</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> provider</span><span style="color:#A3BE8C;"> development</span><span style="color:#A3BE8C;"> overrides</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> set</span><span style="color:#A3BE8C;"> in</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> CLI</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> configuration:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">  -</span><span style="color:#A3BE8C;"> hashicorp.com/edu/hashicups-pf</span><span style="color:#A3BE8C;"> in</span><span style="color:#A3BE8C;"> /Users/</span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;">Usernam</span><span style="color:#D8DEE9FF;">e</span><span style="color:#81A1C1;">&gt;</span><span style="color:#A3BE8C;">/go/bin</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> The</span><span style="color:#A3BE8C;"> behavior</span><span style="color:#A3BE8C;"> may</span><span style="color:#A3BE8C;"> therefore</span><span style="color:#A3BE8C;"> not</span><span style="color:#A3BE8C;"> match</span><span style="color:#A3BE8C;"> any</span><span style="color:#A3BE8C;"> released</span><span style="color:#A3BE8C;"> version</span><span style="color:#A3BE8C;"> of</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> provider</span><span style="color:#A3BE8C;"> and</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> applying</span><span style="color:#A3BE8C;"> changes</span><span style="color:#A3BE8C;"> may</span><span style="color:#A3BE8C;"> cause</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> state</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> become</span><span style="color:#A3BE8C;"> incompatible</span><span style="color:#A3BE8C;"> with</span><span style="color:#A3BE8C;"> published</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> releases.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">╵</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">╷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> Error:</span><span style="color:#A3BE8C;"> Invalid</span><span style="color:#A3BE8C;"> data</span><span style="color:#A3BE8C;"> source</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   on</span><span style="color:#A3BE8C;"> main.tf</span><span style="color:#A3BE8C;"> line</span><span style="color:#A3BE8C;"> 11,</span><span style="color:#A3BE8C;"> in</span><span style="color:#A3BE8C;"> data</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   11:</span><span style="color:#A3BE8C;"> data</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">example</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {}</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;"> The</span><span style="color:#A3BE8C;"> provider</span><span style="color:#A3BE8C;"> hashicorp.com/edu/hashicups-pf</span><span style="color:#A3BE8C;"> does</span><span style="color:#A3BE8C;"> not</span><span style="color:#A3BE8C;"> support</span><span style="color:#A3BE8C;"> data</span><span style="color:#A3BE8C;"> source</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">╵</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-provider-schema" tabindex="-1"><a class="header-anchor" href="#实现-provider-schema"><span>实现 Provider schema</span></a></h3><p>Terraform Plugin Framework 使用 provider 的 <code>Schema</code> 方法来定义可接受的配置属性名称和类型。HashiCups 客户端需要正确配置主机、用户名和密码。Terraform Plugin Framework 的<code>types</code> 包含 schema 和 data model，可以使用 Terraform 的空值、未知值或已知值。</p><p>编辑文件<code>internal/provider/provider.go</code> 添加以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the provider-level schema for configuration data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Optional</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Optional</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Optional</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;">  true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Sensitive</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-provider-data-model" tabindex="-1"><a class="header-anchor" href="#实现-provider-data-model"><span>实现 Provider data model</span></a></h3><p>Terraform Plugin Framework 使用带有 tfsdk 结构字段标签的 Go 语言结构类型，将 schema 定义映射为带有实际数据的 Go 语言类型。结构体中的类型必须与 schema 中的类型保持一致</p><p>编辑文件 <code>internal/provider/provider.go</code> 添加以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// hashicupsProviderModel maps provider schema data to a Go type.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> hashicupsProviderModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Host</span><span style="color:#D8DEE9FF;">     types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;host&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Username</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;username&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Password</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;password&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="实现客户端配置功能" tabindex="-1"><a class="header-anchor" href="#实现客户端配置功能"><span>实现客户端配置功能</span></a></h2><p>provider 使用 Configure 方法从 Terraform 配置或环境变量中读取 API Client 的配置值。在验证值之后，将创建 API Client，并使其可用于 data source 和 resource 使用，Configure 方法遵循以下步骤：</p><ol><li>从配置中检索值。该方法将尝试从提供程序配置中检索值，并将其转换为 <code>providerModel</code> 结构体</li><li>检查未知的配置值。如果只有在应用另一个资源后才知道 Terraform 配置值，则该方法可以防止意外配置错误的客户端</li><li>从环境变量中检索值。该方法从环境变量中检索值，然后用任何已设置的 Terraform 配置值覆盖它们</li><li>创建 API Client。该方法调用HashiCups API客户端的 <code>NewClient</code> 函数</li><li>存储已配置的客户端供 data source 和 resource 使用。该方法设置 response 的 <code>DataSourceData</code> 和 <code>ResourceData</code> 字段，因此客户端可供 data source 和 resource 实现使用</li></ol><p>编辑文件 <code>internal/provider/provider.go</code> 添加以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">os</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/path</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Configure</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Retrieve provider data from configuration</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> config</span><span style="color:#D8DEE9FF;"> hashicupsProviderModel</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Config</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Get</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // If practitioner provided a configuration value for any of the</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // attributes, it must be a known value.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Host</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsUnknown</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unknown HashiCups API Host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is an unknown configuration value for the HashiCups API host. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Either target apply the source of the value first, set the value statically in the configuration, or use the HASHICUPS_HOST environment variable.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Username</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsUnknown</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unknown HashiCups API Username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is an unknown configuration value for the HashiCups API username. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Either target apply the source of the value first, set the value statically in the configuration, or use the HASHICUPS_USERNAME environment variable.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Password</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsUnknown</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unknown HashiCups API Password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is an unknown configuration value for the HashiCups API password. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Either target apply the source of the value first, set the value statically in the configuration, or use the HASHICUPS_PASSWORD environment variable.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Default values to environment variables, but override</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // with Terraform configuration value if set.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    host</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> os</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Getenv</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HASHICUPS_HOST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    username</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> os</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Getenv</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HASHICUPS_USERNAME</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    password</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> os</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Getenv</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HASHICUPS_PASSWORD</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#81A1C1;"> !</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Host</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsNull</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        host</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Host</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#81A1C1;"> !</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Username</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsNull</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        username</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Username</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#81A1C1;"> !</span><span style="color:#D8DEE9;">config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Password</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">IsNull</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        password</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> config</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Password</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // If any of the expected configurations are missing, return</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // errors with provider-specific guidance.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> host</span><span style="color:#81A1C1;"> ==</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Missing HashiCups API Host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is a missing or empty value for the HashiCups API host. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Set the host value in the configuration or use the HASHICUPS_HOST environment variable. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">If either is already set, ensure the value is not empty.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> username</span><span style="color:#81A1C1;"> ==</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Missing HashiCups API Username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is a missing or empty value for the HashiCups API username. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Set the username value in the configuration or use the HASHICUPS_USERNAME environment variable. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">If either is already set, ensure the value is not empty.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> password</span><span style="color:#81A1C1;"> ==</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddAttributeError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Missing HashiCups API Password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">The provider cannot create the HashiCups API client as there is a missing or empty value for the HashiCups API password. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">Set the password value in the configuration or use the HASHICUPS_PASSWORD environment variable. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">If either is already set, ensure the value is not empty.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Create a new HashiCups client using the configuration values</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewClient</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">&amp;</span><span style="color:#D8DEE9;">host</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unable to Create HashiCups API Client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">An unexpected error occurred when creating the HashiCups API client. </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">If the error is not clear, please contact the provider developers.</span><span style="color:#EBCB8B;">\n\n</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                &quot;</span><span style="color:#A3BE8C;">HashiCups Client Error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Make the HashiCups client available during DataSource and Resource</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // type Configure methods.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">DataSourceData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ResourceData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更新所有依赖</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> mod</span><span style="color:#A3BE8C;"> tidy</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>生成并安装更新的 provider</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="在本地启动-hashicups" tabindex="-1"><a class="header-anchor" href="#在本地启动-hashicups"><span>在本地启动 HashiCups</span></a></h2><p>您的 HashiCups provider 需要一个正在运行的 HashiCups 实例。</p><p>在另一个终端窗口中，导航到该目录。<code>docker_compose</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> docker_compose</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> docker-compose</span><span style="color:#A3BE8C;"> up</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>验证 HashiCups 是否正在运行</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> curl</span><span style="color:#A3BE8C;"> localhost:19090/health/readyz</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ok</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="创建-hashicups-用户" tabindex="-1"><a class="header-anchor" href="#创建-hashicups-用户"><span>创建 HashiCups 用户</span></a></h2><p>HashiCups 需要用户名和密码来生成 JWT 令牌，用于对受保护的端点进行身份验证。在 HashiCups 上创建一个名为education 的用户，密码为 test123</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> curl</span><span style="color:#A3BE8C;"> -X</span><span style="color:#A3BE8C;"> POST</span><span style="color:#A3BE8C;"> localhost:19090/signup</span><span style="color:#A3BE8C;"> -d</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">{&quot;username&quot;:&quot;education&quot;, &quot;password&quot;:&quot;test123&quot;}</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;">&quot;UserID&quot;</span><span style="color:#88C0D0;">:1,</span><span style="color:#88C0D0;">&quot;Username&quot;</span><span style="color:#88C0D0;">:</span><span style="color:#88C0D0;">&quot;education&quot;</span><span style="color:#88C0D0;">,</span><span style="color:#88C0D0;">&quot;token&quot;</span><span style="color:#88C0D0;">:</span><span style="color:#88C0D0;">&quot;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJleHAiOjE1OTEwNzgwODUsInVzZXJfaWQiOjIsInVzZXJuYW1lIjoiZWR1Y2F0aW9uIn0.CguceCNILKdjOQ7Gx0u4UAMlOTaH3Dw-fsll2iXDrYU&quot;</span><span style="color:#88C0D0;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>设置环境变量 HASHICUPS_TOKEN</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> export</span><span style="color:#A3BE8C;"> HASHICUPS_TOKEN=ey...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="data-source" tabindex="-1"><a class="header-anchor" href="#data-source"><span>Data Source</span></a></h2><h3 id="初始-data-source-代码" tabindex="-1"><a class="header-anchor" href="#初始-data-source-代码"><span>初始 data source 代码</span></a></h3><p>实现 <code>datasource.DataSource</code> 接口，此接口需要满足以下条件：</p><ol><li>Metadata 方法。定义 data source 类型名称</li><li>Schema 方法。定义任意 data source 配置和 state data 的 schema</li><li>Read 方法。定义为 data source 设置 Terraform state 的逻辑</li></ol><p>添加并编辑 <code>internal/provider/coffees_data_source.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// NewCoffeesDataSource is a helper function to simplify the provider implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> NewCoffeesDataSource</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// coffeesDataSource is the data source implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesDataSource </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Metadata returns the data source type name.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Metadata</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">TypeName</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderTypeName</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">_coffees</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the schema for the data source.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Read refreshes the Terraform state with the latest data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将-data-source-添加到-provider" tabindex="-1"><a class="header-anchor" href="#将-data-source-添加到-provider"><span>将 data source 添加到 provider</span></a></h3><p>将 data source 添加到 provider 的 <code>DataSources</code> 方法中</p><p>打开并编辑 <code>internal/provider/provider.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// DataSources defines the data sources implemented in the provider.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> DataSources</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        NewCoffeesDataSource</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-source-客户端功能" tabindex="-1"><a class="header-anchor" href="#实现-data-source-客户端功能"><span>实现 data source 客户端功能</span></a></h3><p>数据源使用可选的 Configure 方法从提供程序获取已配置的客户端。提供者配置 HashiCups 客户端，数据源可以为其操作保存对该客户端的引用。</p><p>打开并编辑 <code>internal/provider/coffees_data_source.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSource              </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DataSourceWithConfigure </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// coffeesDataSource is the data source implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesDataSource </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Client</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Configure adds the provider configured client to the data source.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Configure</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#81A1C1;"> ==</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ok</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#ECEFF4;">.(</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Client</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#81A1C1;"> !</span><span style="color:#D8DEE9;">ok</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unexpected Data Source Configure Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Sprintf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Expected *hashicups.Client, got: </span><span style="color:#EBCB8B;">%T</span><span style="color:#A3BE8C;">. Please report this issue to the provider developers.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    d</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-source-schema" tabindex="-1"><a class="header-anchor" href="#实现-data-source-schema"><span>实现 data source schema</span></a></h3><p>替换 data source 的 Schema 方法</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the schema for the data source.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ListNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                NestedObject</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">NestedAttributeObject</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Float64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">ingredients</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ListNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            NestedObject</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">NestedAttributeObject</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                    &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                        Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-source-的-data-model" tabindex="-1"><a class="header-anchor" href="#实现-data-source-的-data-model"><span>实现 data source 的 data model</span></a></h3><p>使用以下内容向 data source 添加 data model</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">fmt</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// coffeesDataSourceModel maps the data source schema data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesDataSourceModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Coffees</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">coffeesModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;coffees&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// coffeesModel maps coffees schema data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64               </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Name</span><span style="color:#D8DEE9FF;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String              </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;name&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Teaser</span><span style="color:#D8DEE9FF;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String              </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;teaser&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Description</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String              </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;description&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Price</span><span style="color:#D8DEE9FF;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Float64             </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;price&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Image</span><span style="color:#D8DEE9FF;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String              </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;image&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Ingredients</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">coffeesIngredientsModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;ingredients&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// coffeesIngredientsModel maps coffee ingredients data</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesIngredientsModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64 </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-source-的-read" tabindex="-1"><a class="header-anchor" href="#实现-data-source-的-read"><span>实现 data source 的 read</span></a></h3><p>data source 使用 Read 方法根据 schema 数据刷新 Terraform state，读取方法遵循以下步骤：</p><ol><li>Read 方法，该方法调用 API Client 的 GetCoffees 方法</li><li>将 response 正文映射到 schema 属性中</li><li>设置 Terraform state</li></ol><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Read refreshes the Terraform state with the latest data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> state</span><span style="color:#D8DEE9FF;"> coffeesDataSourceModel</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    coffees</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> d</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">GetCoffees</span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unable to Read HashiCups Coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Map response body to model</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> coffee</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> coffees</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        coffeeState</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9FF;"> coffeesModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Name</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Teaser</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Teaser</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Description</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Description</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Price</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Float64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Price</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Image</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Image</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ingredient</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Ingredient</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            coffeeState</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Ingredients</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">coffeeState</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Ingredients</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> coffeesIngredientsModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ingredient</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffees</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffees</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> coffeeState</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Set state</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Set</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>生成并安装更新的 provider</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="验证-data-source" tabindex="-1"><a class="header-anchor" href="#验证-data-source"><span>验证 data source</span></a></h3><p>导航到该目录 <code>examples/coffees</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> examples/coffees</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>创建并编辑 <code>examples/coffees/main.tf</code></p><div class="language-terraform line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="terraform" data-title="terraform"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-terraform;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">terraform </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  required_providers </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    hashicups</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      source</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorp.com/edu/hashicups-pf</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">provider </span><span style="color:#D8DEE9;">&quot;hashicups&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  host</span><span style="color:#81A1C1;">     =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://localhost:19090</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  username</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">education</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">test123</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">data </span><span style="color:#D8DEE9;">&quot;hashicups_coffees&quot;</span><span style="color:#D8DEE9;"> &quot;edu&quot;</span><span style="color:#ECEFF4;"> {}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">output </span><span style="color:#D8DEE9;">&quot;edu_coffees&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;">.</span><span style="color:#D8DEE9;">hashicups_coffees</span><span style="color:#81A1C1;">.</span><span style="color:#D8DEE9;">edu</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行 Terraform plan，Terraform将报告它从 HashiCups API 检索到的数据</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">data.hashicups_coffees.edu:</span><span style="color:#A3BE8C;"> Reading...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">data.hashicups_coffees.edu:</span><span style="color:#A3BE8C;"> Read</span><span style="color:#A3BE8C;"> complete</span><span style="color:#A3BE8C;"> after</span><span style="color:#A3BE8C;"> 0s</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Changes</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> Outputs:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  +</span><span style="color:#A3BE8C;"> edu_coffees</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      +</span><span style="color:#A3BE8C;"> coffees</span><span style="color:#A3BE8C;"> =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">          +</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> description</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;">          =</span><span style="color:#B48EAD;"> 1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;">       =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> ingredients</span><span style="color:#A3BE8C;"> =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  +</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                      +</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;"> =</span><span style="color:#B48EAD;"> 6</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">                    },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">                ]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> name</span><span style="color:#A3BE8C;">        =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HCP Aeropress</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> price</span><span style="color:#A3BE8C;">       =</span><span style="color:#B48EAD;"> 200</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              +</span><span style="color:#A3BE8C;"> teaser</span><span style="color:#A3BE8C;">      =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Automation in a cup</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">You</span><span style="color:#A3BE8C;"> can</span><span style="color:#A3BE8C;"> apply</span><span style="color:#A3BE8C;"> this</span><span style="color:#A3BE8C;"> plan</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> save</span><span style="color:#A3BE8C;"> these</span><span style="color:#A3BE8C;"> new</span><span style="color:#A3BE8C;"> output</span><span style="color:#A3BE8C;"> values</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> Terraform</span><span style="color:#A3BE8C;"> state,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">without</span><span style="color:#A3BE8C;"> changing</span><span style="color:#A3BE8C;"> any</span><span style="color:#A3BE8C;"> real</span><span style="color:#A3BE8C;"> infrastructure.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">───────────────────────────────────────────────────────────────────────────────</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Note:</span><span style="color:#A3BE8C;"> You</span><span style="color:#A3BE8C;"> didn</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">t use the -out option to save this plan, so Terraform can</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">t</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">guarantee</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> take</span><span style="color:#A3BE8C;"> exactly</span><span style="color:#A3BE8C;"> these</span><span style="color:#A3BE8C;"> actions</span><span style="color:#A3BE8C;"> if</span><span style="color:#A3BE8C;"> you</span><span style="color:#A3BE8C;"> run</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">terraform apply</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> now.</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>复制</p><p>导航到该目录。<code>terraform-provider-hashicups-pf</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> ../..</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h2 id="日志记录" tabindex="-1"><a class="header-anchor" href="#日志记录"><span>日志记录</span></a></h2><h3 id="实现日志消息" tabindex="-1"><a class="header-anchor" href="#实现日志消息"><span>实现日志消息</span></a></h3><p>provider 支持通过 <code>github.com/hashicorp/terraform-plugin-log</code> 模块的 <code>tflog</code> 包进行日志记录。这个包实现了结构化的日志记录和过滤功能</p><p>编辑<code>internal/provider/provider.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">os</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/datasource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/path</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/provider/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-log/tflog</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Configure</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">provider</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Info</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Configuring HashiCups client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Retrieve provider data from configuration</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> config</span><span style="color:#D8DEE9FF;"> hashicupsProviderModel</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现结构化日志字段" tabindex="-1"><a class="header-anchor" href="#实现结构化日志字段"><span>实现结构化日志字段</span></a></h3><p><code>tflog</code> 包支持向日志中添加额外的键值对，以实现一致性和跟踪流。这些对可以通过 <code>tlog.setfield()</code> 调用添加到 provider 请求的其余部分，或者作为任何日志调用的最终参数内联。</p><p>编辑 <code>internal/provider/provider.go</code></p><p>在 provider 的 <code>Configure</code> 方法中，在 <code>hashicup.newclient()</code> 调用之前立即设置三个日志字段和一条日志消息，如下所示。</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> username</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> password</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Debug</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Creating HashiCups client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Create a new HashiCups client using the configuration values</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewClient</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">&amp;</span><span style="color:#D8DEE9;">host</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">username</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">password</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>Configure </code>方法的末尾添加一条日志消息</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Make the HashiCups client available during DataSource and Resource</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // type Configure methods.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">DataSourceData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ResourceData</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Info</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Configured HashiCups client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">any</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">success</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">})</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现日志过滤" tabindex="-1"><a class="header-anchor" href="#实现日志过滤"><span>实现日志过滤</span></a></h3><p>在 <code>tflog. Debug(ctx, &quot;Creating HashiCups client&quot;) </code> 之前添加过滤器来屏蔽用户的密码</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_host</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> host</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_username</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> username</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">SetField</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> password</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ctx</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">MaskFieldValuesWithFieldKeys</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_password</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    tflog</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Debug</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Creating HashiCups client</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    /* ... */</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成-provider" tabindex="-1"><a class="header-anchor" href="#生成-provider"><span>生成 provider</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="查看所有-terraform-日志输出" tabindex="-1"><a class="header-anchor" href="#查看所有-terraform-日志输出"><span>查看所有 Terraform 日志输出</span></a></h3><p>Terraform的日志输出由各种环境变量控制，例如 <code>TF_LOG</code> 或 <code>TF_LOG_</code> 为前缀。</p><p>移动到 <code>examples/coffees</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> examples/coffees</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>运行一个将 <code>TF_LOG</code> 环境变量设置为 <code>TRACE</code> 的 Terraform plan</p><p>Terraform 将为 Terraform 本身、Terraform 插件框架和任何 provider 日志记录中的所有组件输出大量日志条目。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_LOG=TRACE</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-19T09:33:34.487-0500</span><span style="color:#D8DEE9FF;"> [INFO]  provider.terraform-provider-hashicups-pf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-19T09:33:34.487-0500</span><span style="color:#D8DEE9FF;"> [DEBUG] provider.terraform-provider-hashicups-pf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-19T09:33:34.517-0500</span><span style="color:#D8DEE9FF;"> [INFO]  provider.terraform-provider-hashicups-pf</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="保存所有-terraform-日志输出" tabindex="-1"><a class="header-anchor" href="#保存所有-terraform-日志输出"><span>保存所有 Terraform 日志输出</span></a></h3><p>运行 terraform plan 同时设置 <code>TF_LOG</code> 和 <code>TF_LOG_PATH</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_LOG=TRACE</span><span style="color:#A3BE8C;"> TF_LOG_PATH=trace.txt</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>日志将保存在 <code>examples/coffees/trace.txt</code>中</p><h3 id="查看特定的-terraform-日志输出" tabindex="-1"><a class="header-anchor" href="#查看特定的-terraform-日志输出"><span>查看特定的 Terraform 日志输出</span></a></h3><p>日志级别包括 <code>DEBUG</code> <code>INFO</code> <code>WARN</code> <code>ERROR</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_LOG=INFO</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-30T16:27:38.446-0500</span><span style="color:#D8DEE9FF;"> [INFO]  Terraform version: 1.3.0</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-30T16:27:38.447-0500</span><span style="color:#D8DEE9FF;"> [INFO]  Go runtime version: go1.19.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-09-30T16:27:38.447-0500</span><span style="color:#D8DEE9FF;"> [INFO]  CLI args: </span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9FF;">string{</span><span style="color:#88C0D0;">&quot;terraform&quot;</span><span style="color:#88C0D0;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">plan</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="仅输出-provider-日志" tabindex="-1"><a class="header-anchor" href="#仅输出-provider-日志"><span>仅输出 provider 日志</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_LOG_PROVIDER=INFO</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-12-14T10:39:33.247-0600</span><span style="color:#D8DEE9FF;"> [INFO]  provider.terraform-provider-hashicups-pf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">2022-12-14T10:39:33.255-0600</span><span style="color:#D8DEE9FF;"> [INFO]  provider.terraform-provider-hashicups-pf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">data.hashicups_coffees.edu:</span><span style="color:#A3BE8C;"> Reading...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">data.hashicups_coffees.edu:</span><span style="color:#A3BE8C;"> Read</span><span style="color:#A3BE8C;"> complete</span><span style="color:#A3BE8C;"> after</span><span style="color:#A3BE8C;"> 0s</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="resource" tabindex="-1"><a class="header-anchor" href="#resource"><span>Resource</span></a></h2><h3 id="实现-resource-创建和读取的准备工作" tabindex="-1"><a class="header-anchor" href="#实现-resource-创建和读取的准备工作"><span>实现 resource 创建和读取的准备工作</span></a></h3><h4 id="步骤" tabindex="-1"><a class="header-anchor" href="#步骤"><span>步骤</span></a></h4><ol><li>定义初始 resource 类型</li><li>将 resource 添加到 provider 中</li><li>在 resource 中实现 HashiCups 客户端</li><li>定义 resource 的 schema</li><li>定义 resource 的 data mode</li><li>定义 resource 的 create 逻辑</li><li>定义 resource 的 read 逻辑</li><li>验证 resource 的行为</li></ol><h3 id="实现初始-resource-类型" tabindex="-1"><a class="header-anchor" href="#实现初始-resource-类型"><span>实现初始 resource 类型</span></a></h3><p>Provider 使用接口类型 <code>resource.Resource</code> 的实现作为 resource 实现的起点</p><p>此接口需要满足以下条件：</p><ol><li>用于定义 resource 类型名称的元数据 Metadata 方法</li><li>Schema 方法，用于定义 resource 的 configure、plan 和 state data</li><li>Create 方法，用于定义创建 resource 并设置其初始 Terraform 状态的逻辑</li><li>Read 方法，用于定义刷新 resource 的 Terraform 状态的逻辑</li><li>Update 方法，用于定义更新并在成功时设置 resource 的 Terraform 状态的逻辑</li><li>Delete 方法，用于定义删除并在成功时移除 resource 的 Terraform 状态的逻辑</li></ol><h3 id="创建文件-order-resource-go" tabindex="-1"><a class="header-anchor" href="#创建文件-order-resource-go"><span>创建文件 order_resource.go</span></a></h3><p>文件路径 <code>internal/provider/order_resource.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// NewOrderResource is a helper function to simplify the provider implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> NewOrderResource</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// orderResource is the resource implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderResource </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Metadata returns the resource type name.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Metadata</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">MetadataResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">TypeName</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderTypeName</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">_order</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the schema for the resource.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Create creates the resource and sets the initial Terraform state.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Create</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">CreateRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">CreateResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Read refreshes the Terraform state with the latest data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Update updates the resource and sets the updated Terraform state on success.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Update</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">UpdateRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">UpdateResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Delete deletes the resource and removes the Terraform state on success.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Delete</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DeleteRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DeleteResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="将-resource-添加到-provider-中" tabindex="-1"><a class="header-anchor" href="#将-resource-添加到-provider-中"><span>将 resource 添加到 provider 中</span></a></h3><p>provider 使用 <code>Resources</code> 方法返回其支持的 resource</p><p>打开文件 <code>internal/provider/provider.go</code></p><p>将 resource 中的 <code>NewOrderResource</code> 方法替换为以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Resources defines the resources implemented in the provider.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">p </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicupsProvider</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Resources</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    return</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        NewOrderResource</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-客户端功能" tabindex="-1"><a class="header-anchor" href="#实现-resource-客户端功能"><span>实现 resource 客户端功能</span></a></h3><p>resource 使用可选的 <code>Configure</code> 方法从提供程序中获取已配置的客户端。provider 已经配置了 HashiCups 客户端， resource 可以为其操作保存对该客户端的引用</p><p>打开文件 <code>internal/provider/order_resource.go</code></p><p>通过将 <code>orderResource</code> 类型替换为以下内容，允许 resource 类型存储对 HashiCups 客户端的引用</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// orderResource is the resource implementation.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderResource </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Client</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>确保 resource 满足框架定义的 Resource 和 ResourceWithConfigure 接口，可用下面的语句替换 var 语句</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource              </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ResourceWithConfigure </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>添加一个 <code>Configure</code> 方法，使用以下代码配置 HashiCups 客户端</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Configure adds the provider configured client to the resource.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Configure</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ConfigureResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#81A1C1;"> ==</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    client</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ok</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#ECEFF4;">.(</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Client</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#81A1C1;"> !</span><span style="color:#D8DEE9;">ok</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Unexpected Data Source Configure Type</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            fmt</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Sprintf</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Expected *hashicups.Client, got: </span><span style="color:#EBCB8B;">%T</span><span style="color:#A3BE8C;">. Please report this issue to the provider developers.</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ProviderData</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> client</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-schema" tabindex="-1"><a class="header-anchor" href="#实现-schema"><span>实现 Schema</span></a></h3><p>该资源使用 <code>Schema</code> 方法来定义支持的 configuration、plan 和 state attribute names/types</p><p>将 resource 的 <code>Schema</code> 方法替换为以下内容</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Schema defines the schema for the resource.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">last_updated</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">items</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ListNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Required</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                NestedObject</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">NestedAttributeObject</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Required</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        &quot;</span><span style="color:#A3BE8C;">coffee</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SingleNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Required</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                            Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Required</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Float64Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                &quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                                    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-model" tabindex="-1"><a class="header-anchor" href="#实现-data-model"><span>实现 data model</span></a></h3><p>将资源的以下 data model 添加到 order_resource.go</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// orderResourceModel maps the resource schema data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderResourceModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String     </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Items</span><span style="color:#ECEFF4;">       []</span><span style="color:#D8DEE9FF;">orderItemModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;items&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    LastUpdated</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String     </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;last_updated&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// orderItemModel maps order item data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderItemModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Coffee</span><span style="color:#D8DEE9FF;">   orderItemCoffeeModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;coffee&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Quantity</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64          </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;quantity&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// orderItemCoffeeModel maps coffee order item data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderItemCoffeeModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Int64   </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Name</span><span style="color:#D8DEE9FF;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String  </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;name&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Teaser</span><span style="color:#D8DEE9FF;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String  </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;teaser&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Description</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String  </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;description&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Price</span><span style="color:#D8DEE9FF;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Float64 </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;price&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Image</span><span style="color:#D8DEE9FF;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String  </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;image&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-create" tabindex="-1"><a class="header-anchor" href="#实现-resource-create"><span>实现 Resource Create</span></a></h3><p>provider 使用 <code>Create</code> 方法基于 data model 创建新资源，create 方法遵循以下步骤</p><ol><li>检查是否配置 API Client。如果不是，resource 抛出一个错误</li><li>从 plan 中检索值。该方法将尝试从 plan 中检索值并将其转换为 <code>orderResourceModel</code></li><li>根据 plan 的值生成 API 请求体。该方法循环遍历每个 plan 项并将其映射到 <code>hashicups.OrderItem</code></li><li>创建一个新订单。该方法调用 API 客户端的 <code>CreateOrder</code> 方法</li><li>将响应体映射到 resource schema attributes 属性中。该方法创建一个订单后，它会映射 <code>hashicups.Order</code> 响应到 <code>[]OrderItem</code>，以便提供程序可以更新 Terraform 的 state</li><li>设置 Terraform 的 state 与新订单的详细信息</li></ol><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">fmt</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">strconv</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">time</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Create a new resource.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Create</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">CreateRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">CreateResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Retrieve values from plan</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> plan</span><span style="color:#D8DEE9FF;"> orderResourceModel</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Plan</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Get</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Generate API request body from plan</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> items</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">OrderItem</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> item</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        items</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">OrderItem</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Coffee</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Coffee</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> int</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueInt64</span><span style="color:#ECEFF4;">()),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Quantity</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> int</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Quantity</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueInt64</span><span style="color:#ECEFF4;">()),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Create new order</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    order</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">CreateOrder</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">items</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Error creating order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Could not create order, unexpected error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Map response body to schema and populate Computed attribute values</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">strconv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Itoa</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">order</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> orderItemIndex</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> orderItem</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> order</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9;">orderItemIndex</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> orderItemModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Coffee</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> orderItemCoffeeModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Name</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Teaser</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Teaser</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Description</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Description</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Price</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Float64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Price</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Image</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Image</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Quantity</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">orderItem</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Quantity</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LastUpdated</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">time</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Now</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Format</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">time</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RFC850</span><span style="color:#ECEFF4;">))</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Set state to fully populated data</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Set</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> plan</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-read" tabindex="-1"><a class="header-anchor" href="#实现-resource-read"><span>实现 Resource Read</span></a></h3><p>provider 使用 <code>Read</code> 方法来检索 resource 的信息并更新 Terraform 的 state 以反映 resource 的当前状态。provider 在每个 plan 生成 resource 当前 state 和 configuration 之间的准确差异之前调用此函数，read 方法遵循以下步骤:</p><ol><li>获取当前状态。如果不能，则 provider 响应一个错误</li><li>从 Terraform 的 state 中获取订单 ID</li><li>从客户端获取订单详情。该方法使用订单 ID 调用 API 客户端的 <code>GetOrder</code> 方法</li><li>将响应体映射到 resource schema attributes 属性上。方法检索到顺序后，映射 <code>hashicups.Order</code> 响应到 <code>[]OrderItem</code>，以便提供程序可以更新 Terraform 的 state</li><li>设置 Terraform 的 state 与订单的详细信息</li></ol><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// Read resource information.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Get current state</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> state</span><span style="color:#D8DEE9FF;"> orderResourceModel</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Get</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Get refreshed order value from HashiCups</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    order</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">GetOrder</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Error Reading HashiCups Order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Could not read HashiCups order ID </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">+</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Overwrite items with refreshed state</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">orderItemModel</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> item</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> order</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> orderItemModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Coffee</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> orderItemCoffeeModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Name</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Teaser</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Teaser</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Description</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Description</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Price</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Float64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Price</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Image</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Image</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Quantity</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Quantity</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Set refreshed state</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Set</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成并安装-provider" tabindex="-1"><a class="header-anchor" href="#生成并安装-provider"><span>生成并安装 provider</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="验证-resource" tabindex="-1"><a class="header-anchor" href="#验证-resource"><span>验证 resource</span></a></h3><p>创建一个 <code>examples/order</code> 目录</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">mkdir</span><span style="color:#A3BE8C;"> examples/order</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> cd</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#81A1C1;">$_</span><span style="color:#ECEFF4;">&quot;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>在此目录中创建一个 <code>examples/order/main.tf</code></p><div class="language-terraform line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="terraform" data-title="terraform"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-terraform;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">terraform </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  required_providers </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    hashicups</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      source</span><span style="color:#81A1C1;">  =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicorp.com/edu/hashicups-pf</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  required_version</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&gt;= 1.1.0</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">provider </span><span style="color:#D8DEE9;">&quot;hashicups&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  username</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">education</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  password</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">test123</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  host</span><span style="color:#81A1C1;">     =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">http://localhost:19090</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">resource </span><span style="color:#D8DEE9;">&quot;hashicups_order&quot;</span><span style="color:#D8DEE9;"> &quot;edu&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  items</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> [{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    coffee</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      id</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    quantity</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    },</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    coffee</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      id</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    quantity</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">output </span><span style="color:#D8DEE9;">&quot;edu_order&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  value</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> hashicups_order</span><span style="color:#81A1C1;">.</span><span style="color:#D8DEE9;">edu</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行 terraform apply 并输入 yes</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> apply</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Terraform</span><span style="color:#A3BE8C;"> used</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> selected</span><span style="color:#A3BE8C;"> providers</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> generate</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> execution</span><span style="color:#A3BE8C;"> plan.</span><span style="color:#A3BE8C;"> Resource</span><span style="color:#A3BE8C;"> actions</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> indicated</span><span style="color:#A3BE8C;"> with</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> symbols:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  +</span><span style="color:#A3BE8C;"> create</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Terraform</span><span style="color:#A3BE8C;"> will</span><span style="color:#A3BE8C;"> perform</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> actions:</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">  # hashicups_order.edu will be created</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  +</span><span style="color:#A3BE8C;"> resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      +</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;">           =</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">      ## ...</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Plan:</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> add,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> change,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> destroy.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Changes</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> Outputs:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  +</span><span style="color:#A3BE8C;"> edu_order</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      +</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;">           =</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      +</span><span style="color:#A3BE8C;"> items</span><span style="color:#A3BE8C;">        =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">          +</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Do</span><span style="color:#A3BE8C;"> you</span><span style="color:#A3BE8C;"> want</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> perform</span><span style="color:#A3BE8C;"> these</span><span style="color:#A3BE8C;"> actions?</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  Terraform</span><span style="color:#A3BE8C;"> will</span><span style="color:#A3BE8C;"> perform</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> actions</span><span style="color:#A3BE8C;"> described</span><span style="color:#A3BE8C;"> above.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  Only</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> will</span><span style="color:#A3BE8C;"> be</span><span style="color:#A3BE8C;"> accepted</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> approve.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  Enter</span><span style="color:#A3BE8C;"> a</span><span style="color:#A3BE8C;"> value:</span><span style="color:#A3BE8C;"> yes</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Creating...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Creation</span><span style="color:#A3BE8C;"> complete</span><span style="color:#A3BE8C;"> after</span><span style="color:#A3BE8C;"> 0s</span><span style="color:#D8DEE9FF;"> [id=21]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Apply</span><span style="color:#A3BE8C;"> complete!</span><span style="color:#A3BE8C;"> Resources:</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> added,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> changed,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> destroyed.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Outputs:</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">edu_order</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;id&quot;</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;items&quot;</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> tolist</span><span style="color:#ECEFF4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">coffee</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/vault.png</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Vaulatte</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Nothing gives you a safe and secure feeling like a Vaulatte</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">coffee</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 1</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HCP Aeropress</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 200</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Automation in a cup</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  ])</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;last_updated&quot;</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Thursday, 09-Feb-23 11:32:05 EST</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>一旦申请完成，provider 将 resource 的详细信息保存在 Terraform 的 state 中。执行 <code>terraform state show resource_name</code> 命令查看状态。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> state</span><span style="color:#A3BE8C;"> show</span><span style="color:#A3BE8C;"> hashicups_order.edu</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># hashicups_order.edu:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#A3BE8C;">           =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    items</span><span style="color:#A3BE8C;">        =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">      # (2 unchanged elements hidden)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    last_updated</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Thursday, 22-Jul-21 03:26:51 PDT</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证创建的订单" tabindex="-1"><a class="header-anchor" href="#验证创建的订单"><span>验证创建的订单</span></a></h3><p>使用 RESTful api 查询订单信息，验证 Terraform 是否通过 API 检索订单详细信息创建了订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> curl</span><span style="color:#A3BE8C;"> -X</span><span style="color:#A3BE8C;"> GET</span><span style="color:#A3BE8C;">  -H</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Authorization: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">HASHICUPS_TOKEN</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> localhost:19090/orders/1</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span><span style="color:#88C0D0;">&quot;id&quot;</span><span style="color:#88C0D0;">:1,</span><span style="color:#88C0D0;">&quot;items&quot;</span><span style="color:#88C0D0;">:</span><span style="color:#A3BE8C;">[{</span><span style="color:#D8DEE9FF;">&quot;</span><span style="color:#88C0D0;">coffee</span><span style="color:#88C0D0;">&quot;:{&quot;</span><span style="color:#88C0D0;">id</span><span style="color:#88C0D0;">&quot;:3,&quot;</span><span style="color:#88C0D0;">name</span><span style="color:#88C0D0;">&quot;:&quot;</span><span style="color:#88C0D0;">Vaulatte</span><span style="color:#88C0D0;">&quot;,&quot;</span><span style="color:#88C0D0;">teaser</span><span style="color:#88C0D0;">&quot;:&quot;</span><span style="color:#88C0D0;">Nothing</span><span style="color:#A3BE8C;"> gives</span><span style="color:#A3BE8C;"> you</span><span style="color:#A3BE8C;"> a</span><span style="color:#A3BE8C;"> safe</span><span style="color:#A3BE8C;"> and</span><span style="color:#A3BE8C;"> secure</span><span style="color:#A3BE8C;"> feeling</span><span style="color:#A3BE8C;"> like</span><span style="color:#A3BE8C;"> a</span><span style="color:#A3BE8C;"> Vaulatte</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">collection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Foundations</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">origin</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Spring</span><span style="color:#B48EAD;"> 2015</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">color</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#FFD814</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:200,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/vault.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ingredients</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:[{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ingredient_id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:1},{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ingredient_id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:2}]},</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:2},{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">coffee</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:1,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">HCP</span><span style="color:#A3BE8C;"> Aeropress</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Automation</span><span style="color:#A3BE8C;"> in</span><span style="color:#A3BE8C;"> a</span><span style="color:#A3BE8C;"> cup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">collection</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Foundations</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">origin</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Summer</span><span style="color:#B48EAD;"> 2020</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">color</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">#444</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:200,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ingredients</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:[{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">ingredient_id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:6}]},</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">:2}]}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>订单的属性应该与 <code>hashicups_order.edu</code> resource 的属性相同</p><h3 id="实现-resource-update" tabindex="-1"><a class="header-anchor" href="#实现-resource-update"><span>实现 Resource update</span></a></h3><ol><li>验证 schema 和 model</li><li>实现 resource update</li><li>使用 plan modifier 增强 plan output</li><li>验证 update 功能</li></ol><h4 id="修改-schema-和-model" tabindex="-1"><a class="header-anchor" href="#修改-schema-和-model"><span>修改 schema 和 model</span></a></h4><p>添加 last_updated 的属性</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">last_updated</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">items</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ListNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                // ...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 <code>orderResourceModel</code> 中添加 <code>last_updated</code> 字段</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> orderResourceModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String     </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Items</span><span style="color:#ECEFF4;">       []</span><span style="color:#D8DEE9FF;">orderItemModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;items&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    LastUpdated</span><span style="color:#D8DEE9FF;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String     </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;last_updated&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-update" tabindex="-1"><a class="header-anchor" href="#实现-update"><span>实现 update</span></a></h3><p>Provider 使用 Update 方法基于 schema 数据更新现有 resource，Update 方法遵循以下步骤：</p><ol><li>从 plan 中检索值</li><li>从 plan 值生成 API 请求体</li><li>更新订单</li><li>将 response 正文映射到 resource schema 属性</li><li>设置 <code>LastUpdated</code> 属性</li><li>使用更新后的订单设置 Terraform state</li></ol><p>编辑 <code>internal/provider/order_resource.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">fmt</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">strconv</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">time</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema/planmodifier</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema/stringplanmodifier</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Update</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">UpdateRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">UpdateResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Retrieve values from plan</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> plan</span><span style="color:#D8DEE9FF;"> orderResourceModel</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Plan</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Get</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Generate API request body from plan</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> hashicupsItems</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">OrderItem</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> item</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        hashicupsItems</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">hashicupsItems</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">OrderItem</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Coffee</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> hashicups</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Coffee</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> int</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueInt64</span><span style="color:#ECEFF4;">()),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Quantity</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> int</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Quantity</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueInt64</span><span style="color:#ECEFF4;">()),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Update existing order</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">UpdateOrder</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">(),</span><span style="color:#D8DEE9;"> hashicupsItems</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Error Updating HashiCups Order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Could not update order, unexpected error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Fetch updated items from GetOrder as UpdateOrder items are not</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // populated.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    order</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">GetOrder</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Error Reading HashiCups Order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Could not read HashiCups order ID </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">+</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Update resource state with updated items and timestamp</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">orderItemModel</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    for</span><span style="color:#D8DEE9;"> _</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> item</span><span style="color:#81A1C1;"> :=</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9;"> order</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#81A1C1;"> =</span><span style="color:#88C0D0;"> append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Items</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> orderItemModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Coffee</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> orderItemCoffeeModel</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ID</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">          types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Name</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">        types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Name</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Teaser</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Teaser</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Description</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Description</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Price</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Float64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Price</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Image</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;">       types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Coffee</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Image</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Quantity</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Int64Value</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int64</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">item</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Quantity</span><span style="color:#ECEFF4;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    plan</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LastUpdated</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">time</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Now</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">Format</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">time</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RFC850</span><span style="color:#ECEFF4;">))</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Set</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> plan</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>更新 provider</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="验证-update-功能" tabindex="-1"><a class="header-anchor" href="#验证-update-功能"><span>验证 update 功能</span></a></h3><p>导航到目录 <code>examples/order</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> examples/order</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>编辑 <code>examples/order/main.tf</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#D8DEE9;">resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">  items</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> [{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    coffee</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      id</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    quantity</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      coffee</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        id</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">      quantity</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  }]</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>执行 terraform plan</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> plan</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Refreshing</span><span style="color:#A3BE8C;"> state...</span><span style="color:#D8DEE9FF;"> [id=1]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Terraform</span><span style="color:#A3BE8C;"> used</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> selected</span><span style="color:#A3BE8C;"> providers</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> generate</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> execution</span><span style="color:#A3BE8C;"> plan.</span><span style="color:#A3BE8C;"> Resource</span><span style="color:#A3BE8C;"> actions</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> indicated</span><span style="color:#A3BE8C;"> with</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> symbols:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  ~</span><span style="color:#A3BE8C;"> update</span><span style="color:#A3BE8C;"> in-place</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Terraform</span><span style="color:#A3BE8C;"> will</span><span style="color:#A3BE8C;"> perform</span><span style="color:#A3BE8C;"> the</span><span style="color:#A3BE8C;"> following</span><span style="color:#A3BE8C;"> actions:</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">  # hashicups_order.edu will be updated in-place</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  ~</span><span style="color:#A3BE8C;"> resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      ~</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;">           =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      ~</span><span style="color:#A3BE8C;"> items</span><span style="color:#A3BE8C;">        =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">          ~</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              ~</span><span style="color:#A3BE8C;"> coffee</span><span style="color:#A3BE8C;">   =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  +</span><span style="color:#A3BE8C;"> description</span><span style="color:#A3BE8C;"> =</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                    id</span><span style="color:#A3BE8C;">          =</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;">       =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/vault.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> name</span><span style="color:#A3BE8C;">        =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Vaulatte</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> price</span><span style="color:#A3BE8C;">       =</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> teaser</span><span style="color:#A3BE8C;">      =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Nothing gives you a safe and secure feeling like a Vaulatte</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                # (1 unchanged attribute hidden)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">          ~</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              ~</span><span style="color:#A3BE8C;"> coffee</span><span style="color:#A3BE8C;">   =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  +</span><span style="color:#A3BE8C;"> description</span><span style="color:#A3BE8C;"> =</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> id</span><span style="color:#A3BE8C;">          =</span><span style="color:#B48EAD;"> 1</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;">       =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> name</span><span style="color:#A3BE8C;">        =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HCP Aeropress</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> price</span><span style="color:#A3BE8C;">       =</span><span style="color:#B48EAD;"> 200</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">                  ~</span><span style="color:#A3BE8C;"> teaser</span><span style="color:#A3BE8C;">      =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Automation in a cup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">                }</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">              ~</span><span style="color:#A3BE8C;"> quantity</span><span style="color:#A3BE8C;"> =</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#B48EAD;"> 3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        ]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">      ~</span><span style="color:#A3BE8C;"> last_updated</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Thursday, 09-Feb-23 11:32:05 EST</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> -</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;"> (known </span><span style="color:#A3BE8C;">after</span><span style="color:#A3BE8C;"> apply</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Plan:</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> add,</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> change,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> to</span><span style="color:#A3BE8C;"> destroy.</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="增强-plan-output" tabindex="-1"><a class="header-anchor" href="#增强-plan-output"><span>增强 plan output</span></a></h4><p>可配置的 Terraform Plugin Framework 属性不应该显示现有状态值的更新，应该使用 <code>UseStateForUnknown()</code> plan 修饰符</p><p>编辑 <code>internal/provider/order_resource.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    PlanModifiers</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">planmodifier</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        stringplanmodifier</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">UseStateForUnknown</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">},</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-delete" tabindex="-1"><a class="header-anchor" href="#实现-resource-delete"><span>实现 Resource Delete</span></a></h3><h4 id="实现-delete" tabindex="-1"><a class="header-anchor" href="#实现-delete"><span>实现 delete</span></a></h4><p>provider 使用 <code>Delete</code> 方法删除现有资源</p><p>删除方法遵循以下步骤：</p><ol><li>从 state 中检索值</li><li>删除现有订单</li></ol><p>编辑文件 <code>internal/provider/order_resource.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Delete</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DeleteRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">DeleteResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Retrieve values from state</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    var</span><span style="color:#D8DEE9;"> state</span><span style="color:#D8DEE9FF;"> orderResourceModel</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Get</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Delete existing order</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    err</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> r</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">client</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">DeleteOrder</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ValueString</span><span style="color:#ECEFF4;">())</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> err</span><span style="color:#81A1C1;"> !=</span><span style="color:#81A1C1;"> nil</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">AddError</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Error Deleting HashiCups Order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">Could not delete order, unexpected error: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">+</span><span style="color:#D8DEE9;">err</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Error</span><span style="color:#ECEFF4;">(),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="更新-provider" tabindex="-1"><a class="header-anchor" href="#更新-provider"><span>更新 provider</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="验证-delete" tabindex="-1"><a class="header-anchor" href="#验证-delete"><span>验证 delete</span></a></h4><p>导航到目录 <code>examples/order</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> examples/order</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>执行 terraform destroy 将删除订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> destroy</span><span style="color:#A3BE8C;"> -auto-approve</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Destroy</span><span style="color:#A3BE8C;"> complete!</span><span style="color:#A3BE8C;"> Resources:</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> destroyed.</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 HashiCups API 验证提供商是否删除了订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> curl</span><span style="color:#A3BE8C;"> -X</span><span style="color:#A3BE8C;"> GET</span><span style="color:#A3BE8C;"> -H</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Authorization: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">HASHICUPS_TOKEN</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> localhost:19090/orders/1</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-import" tabindex="-1"><a class="header-anchor" href="#实现-resource-import"><span>实现 Resource import</span></a></h3><p>resource 的 import 的方法，能从 <code>terraform import</code> 命令中获取给定的订单 id，使得 Terraform 能使用此订单 id 将对应的信息导入到 Terraform state 文件中</p><h4 id="实现-import-功能" tabindex="-1"><a class="header-anchor" href="#实现-import-功能"><span>实现 import 功能</span></a></h4><p>resource 使用 <code>ImportState</code> 方法导入现有资源，import 方法只有一个步骤：</p><ol><li>检索导入标识符并保存为属性状态。该方法将使用 <code>resource.ImportStatePassthroughID()</code> 函数从 <code>terraform import</code> 命令中检索 ID 值，并将其保存到 <code>ID</code> 属性中。</li></ol><p>如果没有错误，Terraform 将自动调用资源的 <code>Read</code> 方法来导入 <code>Terraform state</code> 的其余部分。由于 <code>id</code> 属性是 <code>Read</code> 方法所必需的，因此不需要额外的实现</p><p>编辑文件 <code>internal/provider/order_resource.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">context</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">fmt</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">strconv</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">time</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp-demoapp/hashicups-client-go</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/path</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema/planmodifier</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/resource/schema/stringplanmodifier</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/types</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Ensure the implementation satisfies the expected interfaces.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Resource                </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ResourceWithConfigure   </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    _</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ResourceWithImportState </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">{}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">r </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">orderResource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> ImportState</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ImportStateRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ImportStateResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Retrieve import ID and save to id attribute</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ImportStatePassthroughID</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> path</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Root</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span><span style="color:#D8DEE9;"> req</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="生成-provider-1" tabindex="-1"><a class="header-anchor" href="#生成-provider-1"><span>生成 provider</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> .</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="验证-import-功能" tabindex="-1"><a class="header-anchor" href="#验证-import-功能"><span>验证 import 功能</span></a></h4><p>导航到该目录。这包含 Terraform HashiCups 提供程序的示例 Terraform 配置。<code>examples/order</code></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> cd</span><span style="color:#A3BE8C;"> examples/order</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>应用此配置以确保 HashiCups API 包含订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> apply</span><span style="color:#A3BE8C;"> -auto-approve</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Apply</span><span style="color:#A3BE8C;"> complete!</span><span style="color:#A3BE8C;"> Resources:</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> added,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> changed,</span><span style="color:#B48EAD;"> 0</span><span style="color:#A3BE8C;"> destroyed.</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Outputs:</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">edu_order</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;id&quot;</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;items&quot;</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> tolist</span><span style="color:#ECEFF4;">([</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从 Terraform state 检索订单 ID，将在下一步中使用此订单 ID 导入订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> show</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># hashicups_order.edu:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#A3BE8C;">           =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    items</span><span style="color:#A3BE8C;">        =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        # (2 unchanged elements hidden)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    last_updated</span><span style="color:#A3BE8C;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Wednesday, 14-Dec-22 11:18:20 CST</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>从 Terraform state 中删除现有的订单，订单仍然存在于 HashiCups API 中</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> state</span><span style="color:#A3BE8C;"> rm</span><span style="color:#A3BE8C;"> hashicups_order.edu</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Removed</span><span style="color:#A3BE8C;"> hashicups_order.edu</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Successfully</span><span style="color:#A3BE8C;"> removed</span><span style="color:#B48EAD;"> 1</span><span style="color:#A3BE8C;"> resource</span><span style="color:#A3BE8C;"> instance</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">s</span><span style="color:#ECEFF4;">)</span><span style="color:#A3BE8C;">.</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>确认 Terraform state 不再包含订单资源。之前的 <code>edu_order</code> 输出值仍然保留。</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> show</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Outputs:</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">edu_order</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#A3BE8C;">           =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    items</span><span style="color:#A3BE8C;">        =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>验证 HashiCups API 是否仍然有订单。如果需要，可以将 2 替换为 terraform show 命令输出的订单号</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> curl</span><span style="color:#A3BE8C;"> -X</span><span style="color:#A3BE8C;"> GET</span><span style="color:#A3BE8C;"> -H</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Authorization: </span><span style="color:#81A1C1;">${</span><span style="color:#D8DEE9;">HASHICUPS_TOKEN</span><span style="color:#81A1C1;">}</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> localhost:19090/orders/2</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>将现有的 HashiCups API 订单导入 Terraform，将订单 ID 替换为你的订单 ID</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> import</span><span style="color:#A3BE8C;"> hashicups_order.edu</span><span style="color:#B48EAD;"> 2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Importing</span><span style="color:#A3BE8C;"> from</span><span style="color:#A3BE8C;"> ID</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Import</span><span style="color:#A3BE8C;"> prepared!</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  Prepared</span><span style="color:#A3BE8C;"> hashicups_order</span><span style="color:#A3BE8C;"> for</span><span style="color:#A3BE8C;"> import</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">hashicups_order.edu:</span><span style="color:#A3BE8C;"> Refreshing</span><span style="color:#A3BE8C;"> state...</span><span style="color:#D8DEE9FF;"> [id=2]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">Import</span><span style="color:#A3BE8C;"> successful!</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">The</span><span style="color:#A3BE8C;"> resources</span><span style="color:#A3BE8C;"> that</span><span style="color:#A3BE8C;"> were</span><span style="color:#A3BE8C;"> imported</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> shown</span><span style="color:#A3BE8C;"> above.</span><span style="color:#A3BE8C;"> These</span><span style="color:#A3BE8C;"> resources</span><span style="color:#A3BE8C;"> are</span><span style="color:#A3BE8C;"> now</span><span style="color:#A3BE8C;"> in</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">your</span><span style="color:#A3BE8C;"> Terraform</span><span style="color:#A3BE8C;"> state</span><span style="color:#A3BE8C;"> and</span><span style="color:#A3BE8C;"> will</span><span style="color:#A3BE8C;"> henceforth</span><span style="color:#A3BE8C;"> be</span><span style="color:#A3BE8C;"> managed</span><span style="color:#A3BE8C;"> by</span><span style="color:#A3BE8C;"> Terraform.</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>再次验证 Terraform state 是否包含订单</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> terraform</span><span style="color:#A3BE8C;"> show</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># hashicups_order.edu:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">resource</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hashicups_order</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">edu</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    id</span><span style="color:#A3BE8C;">    =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    items</span><span style="color:#A3BE8C;"> =</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        # (2 unchanged elements hidden)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动化测试" tabindex="-1"><a class="header-anchor" href="#自动化测试"><span>自动化测试</span></a></h2><p>Go 模块 <code>terra-plugin-testing</code> 中的 <code>helper/resource</code> 包能使 provider 实现自动化验收测试。测试框架建立在标准的 <code>go test</code> 命令功能之上，并调用实际的 Terraform 命令，如 <code>Terraform apply</code>、<code>Terraform import</code> 和 <code>Terraform destroy</code>。</p><h3 id="实现-data-source-id-属性" tabindex="-1"><a class="header-anchor" href="#实现-data-source-id-属性"><span>实现 data source id 属性</span></a></h3><p>测试框架要求在每个 data source 和 resource 中都有一个 id 属性。为了在没有 ID 的 data source 和 resource 上运行测试，必须使用占位符值实现 ID 字段</p><p>编辑文件 <code>internal/provider/coffees_data_source.go</code></p><p>向 Schema 方法添加 id 属性</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Schema</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">_</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> _</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">SchemaResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Schema</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Schema</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Attributes</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#D8DEE9FF;">schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Attribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">StringAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Computed</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            &quot;</span><span style="color:#A3BE8C;">coffees</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9FF;"> schema</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ListNestedAttribute</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                //...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>用下面的代码替换 <code>coffeesDataSourceModel</code> 数据源模型</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#616E88;">// coffeesDataSourceModel maps the data source schema data.</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">type</span><span style="color:#D8DEE9FF;"> coffeesDataSourceModel </span><span style="color:#81A1C1;">struct</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    Coffees</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">coffeesModel </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;coffees&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    ID</span><span style="color:#D8DEE9FF;">      types</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">String   </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">tfsdk:&quot;id&quot;</span><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 data source 的 Read 方法的末尾附近设置一个占位符值</p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9;">d </span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">coffeesDataSource</span><span style="color:#ECEFF4;">)</span><span style="color:#88C0D0;"> Read</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#D8DEE9FF;"> context</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">Context</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> req</span><span style="color:#D8DEE9FF;"> datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadRequest</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> resp</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">datasource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ReadResponse</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    //...</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    state</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ID</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> types</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">StringValue</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">placeholder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // Set state</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    diags</span><span style="color:#81A1C1;"> :=</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">State</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Set</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ctx</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> &amp;</span><span style="color:#D8DEE9;">state</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Append</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">diags</span><span style="color:#81A1C1;">...</span><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    if</span><span style="color:#D8DEE9;"> resp</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">Diagnostics</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">HasError</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-data-source-验收测试" tabindex="-1"><a class="header-anchor" href="#实现-data-source-验收测试"><span>实现 data source 验收测试</span></a></h3><p>Data source 验收测试用于验证从 API 读取后 Terraform state 包含数据</p><p>大多数 provider 将在单个测试文件中管理一些共享实现详细信息，以简化 data source 和 resource 测试实现</p><p>编辑 <code>internal/provider/provider_test.go</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-framework/providerserver</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-go/tfprotov6</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">const</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // providerConfig is a shared configuration to combine with the actual</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // test configuration so the HashiCups client is properly configured.</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // It is also possible to use the HASHICUPS_ environment variables instead,</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // such as updating the Makefile and running the testing through that tool.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    providerConfig</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> `</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">provider &quot;hashicups&quot; {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  username = &quot;education&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  password = &quot;test123&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  host     = &quot;http://localhost:19090&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">var</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // testAccProtoV6ProviderFactories are used to instantiate a provider during</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // acceptance testing. The factory function will be invoked for every Terraform</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // CLI command executed to create a provider server to which the CLI can</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">    // reattach.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    testAccProtoV6ProviderFactories</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> map</span><span style="color:#ECEFF4;">[</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">func</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">tfprotov6</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">ProviderServer</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> error</span><span style="color:#ECEFF4;">){</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        &quot;</span><span style="color:#A3BE8C;">hashicups</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> providerserver</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">NewProtocol6WithError</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">New</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)()),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>创建 <code>internal/provider/coffees_data_source_test</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">testing</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-testing/helper/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> TestAccCoffeesDataSource</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">t</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">testing</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">T</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Test</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">t</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TestCase</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        ProtoV6ProviderFactories</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> testAccProtoV6ProviderFactories</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Steps</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TestStep</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // Read testing</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Config</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> providerConfig</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">data &quot;hashicups_coffees&quot; &quot;test&quot; {}</span><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Check</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ComposeAggregateTestCheckFunc</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify number of coffees returned</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.#</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">9</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify the first coffee to ensure all attributes are set</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.ingredients.#</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.ingredients.0.id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">6</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HCP Aeropress</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">200</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">coffees.0.teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Automation in a cup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify placeholder id attribute</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">data.hashicups_coffees.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">placeholder</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                ),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证-data-source-测试功能" tabindex="-1"><a class="header-anchor" href="#验证-data-source-测试功能"><span>验证 data source 测试功能</span></a></h3><p>使用 <code>TF_ACC</code> 环境变量运行测试</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_ACC=</span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> test</span><span style="color:#A3BE8C;"> -count=1</span><span style="color:#A3BE8C;"> -v</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">===</span><span style="color:#A3BE8C;"> RUN</span><span style="color:#A3BE8C;">   TestAccCoffeesDataSource</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">---</span><span style="color:#A3BE8C;"> PASS:</span><span style="color:#A3BE8C;"> TestAccCoffeesDataSource</span><span style="color:#D8DEE9FF;"> (1.23s)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">PASS</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ok</span><span style="color:#A3BE8C;">      terraform-provider-hashicups-pf/internal/provider</span><span style="color:#A3BE8C;">   2.120s</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="实现-resource-验收测试功能" tabindex="-1"><a class="header-anchor" href="#实现-resource-验收测试功能"><span>实现 resource 验收测试功能</span></a></h3><p>资源验收测试用于验证整个 resource 生命周期，例如 <code>create</code>、<code>read</code>、<code>update</code> 和 <code>delete</code> 功能，以及 import 功能。测试框架自动处理销毁测试资源并返回任何错误</p><p>创建 <code>internal/provider/order_resource_test</code></p><div class="language-go line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="go" data-title="go"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-go;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#D8DEE9FF;"> provider</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#ECEFF4;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">testing</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">github.com/hashicorp/terraform-plugin-testing/helper/resource</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">func</span><span style="color:#88C0D0;"> TestAccOrderResource</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">t</span><span style="color:#81A1C1;"> *</span><span style="color:#D8DEE9FF;">testing</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">T</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">Test</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">t</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TestCase</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        ProtoV6ProviderFactories</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> testAccProtoV6ProviderFactories</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        Steps</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> []</span><span style="color:#D8DEE9FF;">resource</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9FF;">TestStep</span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // Create and Read testing</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Config</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> providerConfig</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> `</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">resource &quot;hashicups_order&quot; &quot;test&quot; {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  items = [</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      coffee = {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">        id = 1</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      quantity = 2</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Check</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ComposeAggregateTestCheckFunc</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify number of items</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.#</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify first order item</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify first coffee item has Computed attributes filled.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/hashicorp.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">HCP Aeropress</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">200</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Automation in a cup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify dynamic values have any value set in the state.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttrSet</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttrSet</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">last_updated</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                ),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // ImportState testing</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ResourceName</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;">      &quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ImportState</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;">       true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ImportStateVerify</span><span style="color:#ECEFF4;">:</span><span style="color:#81A1C1;"> true</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                // The last_updated attribute does not exist in the HashiCups</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                // API, therefore there is no value for it during import.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                ImportStateVerifyIgnore</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> []</span><span style="color:#81A1C1;">string</span><span style="color:#ECEFF4;">{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">last_updated</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">},</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // Update and Read testing</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Config</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> providerConfig</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> `</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">resource &quot;hashicups_order&quot; &quot;test&quot; {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  items = [</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">    {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      coffee = {</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">        id = 2</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      }</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">      quantity = 2</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">    },</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">`</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                Check</span><span style="color:#ECEFF4;">:</span><span style="color:#D8DEE9;"> resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">ComposeAggregateTestCheckFunc</span><span style="color:#ECEFF4;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify first order item updated</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.quantity</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.id</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                    // Verify first coffee item has Computed attributes updated.</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.description</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.image</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">/packer.png</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.name</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Packer Spiced Latte</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.price</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">350</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                    resource</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">TestCheckResourceAttr</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">hashicups_order.test</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">items.0.coffee.teaser</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Packed with goodness to spice up your images</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">                ),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            },</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // Delete testing automatically occurs in TestCase</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        },</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    })</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证-resource-测试功能" tabindex="-1"><a class="header-anchor" href="#验证-resource-测试功能"><span>验证 resource 测试功能</span></a></h3><p>使用 <code>TF_ACC</code> 环境变量运行测试</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">$</span><span style="color:#A3BE8C;"> TF_ACC=</span><span style="color:#B48EAD;">1</span><span style="color:#A3BE8C;"> go</span><span style="color:#A3BE8C;"> test</span><span style="color:#A3BE8C;"> -count=1</span><span style="color:#A3BE8C;"> -run=</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">TestAccOrderResource</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;"> -v</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">===</span><span style="color:#A3BE8C;"> RUN</span><span style="color:#A3BE8C;">   TestAccOrderResource</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">---</span><span style="color:#A3BE8C;"> PASS:</span><span style="color:#A3BE8C;"> TestAccOrderResource</span><span style="color:#D8DEE9FF;"> (2.01s)</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">PASS</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ok</span><span style="color:#A3BE8C;">      terraform-provider-hashicups-pf/internal/provider</span><span style="color:#A3BE8C;">   2.754s</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/hyfly233/blog/edit/main/md/article/iac/terraform/TerraformFramework实现Provider.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hyfly233@outlook.com">hyfly233</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-chPKMbRn.js" defer></script>
  </body>
</html>
