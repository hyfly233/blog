<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>JVM 完全指南 | とんぼの気持ち</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-nxaj3WOG.css" as="style"><link rel="stylesheet" href="/blog/assets/style-nxaj3WOG.css">
    <link rel="modulepreload" href="/blog/assets/app-chPKMbRn.js"><link rel="modulepreload" href="/blog/assets/JVM.html-DNvsmY-J.js">
    <link rel="prefetch" href="/blog/assets/directory.html-CM077g0X.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WkqGtERh.js" as="script"><link rel="prefetch" href="/blog/assets/directory.html-BH0WGkAw.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible扩充OSD节点.html-DQGhyA8S.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible的OSD存储满后的临时解决方案.html-BDuF8Lky.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible部署Ceph.html-B1ua_UqN.js" as="script"><link rel="prefetch" href="/blog/assets/iSCSI安装.html-HVTL7fJU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BceON7lL.js" as="script"><link rel="prefetch" href="/blog/assets/如何升级系统构架.html-B16ubYTA.js" as="script"><link rel="prefetch" href="/blog/assets/如何正确加锁.html-DjvlAowS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3nYQ7aQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BmNefUmR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJsvdjYt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlgG4jCN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bp1xrcuH.js" as="script"><link rel="prefetch" href="/blog/assets/linear_search.html-Dr3lRrFe.js" as="script"><link rel="prefetch" href="/blog/assets/binary_tree_sort.html-BZSaHXpo.js" as="script"><link rel="prefetch" href="/blog/assets/bitonic_sort.html-DZHRyZF8.js" as="script"><link rel="prefetch" href="/blog/assets/bubble_sort.html-XLBBj8rD.js" as="script"><link rel="prefetch" href="/blog/assets/bucket_sort.html-D1NDEl5q.js" as="script"><link rel="prefetch" href="/blog/assets/cocktail_shaker_sort.html-sQF3C84o.js" as="script"><link rel="prefetch" href="/blog/assets/comb_sort.html-B6Z7wIqt.js" as="script"><link rel="prefetch" href="/blog/assets/counting_sort.html-D8wkfUEd.js" as="script"><link rel="prefetch" href="/blog/assets/gnome_sort.html-ClFIwPrf.js" as="script"><link rel="prefetch" href="/blog/assets/heap_sort.html-Rp3rKaBj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DSXsiBgb.js" as="script"><link rel="prefetch" href="/blog/assets/insertion_sort.html-Cb45Fk0s.js" as="script"><link rel="prefetch" href="/blog/assets/merge_sort.html-DKhyfHNj.js" as="script"><link rel="prefetch" href="/blog/assets/odd_even_sort.html-BUUtGCfM.js" as="script"><link rel="prefetch" href="/blog/assets/pancake_sort.html-CLbqQfeK.js" as="script"><link rel="prefetch" href="/blog/assets/quick_sort.html-DsTl6rI_.js" as="script"><link rel="prefetch" href="/blog/assets/radix_sort.html-DGfsIMQr.js" as="script"><link rel="prefetch" href="/blog/assets/selection_sort.html-CWB7HCPo.js" as="script"><link rel="prefetch" href="/blog/assets/shell_sort.html-RYeqqTj9.js" as="script"><link rel="prefetch" href="/blog/assets/smooth_sort.html-B0t6JSLd.js" as="script"><link rel="prefetch" href="/blog/assets/stooge_sort.html-YfhFB3iG.js" as="script"><link rel="prefetch" href="/blog/assets/tim_sort.html-BoCSzhxx.js" as="script"><link rel="prefetch" href="/blog/assets/ESXI虚机迁移至OpenStack.html-6EM4grfG.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla使用Libvirt.html-BH6Q3PvO.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla及Ceph部署.html-DBRpVcxj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlM2okaw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DuySOOS7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COYjVXza.js" as="script"><link rel="prefetch" href="/blog/assets/环境搭建.html-BwslABub.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bk5wCQBA.js" as="script"><link rel="prefetch" href="/blog/assets/Schema变更.html-CmXDyeR-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bl4wowJu.js" as="script"><link rel="prefetch" href="/blog/assets/动态分区和RoutineLoad.html-BYzTxZd0.js" as="script"><link rel="prefetch" href="/blog/assets/存算分离.html-9GVDpuqQ.js" as="script"><link rel="prefetch" href="/blog/assets/数据划分.html-yeEAwxQ-.js" as="script"><link rel="prefetch" href="/blog/assets/数据库建表最佳实践.html-CU31WBJ2.js" as="script"><link rel="prefetch" href="/blog/assets/日志存储最佳实践.html-BJPmJmHB.js" as="script"><link rel="prefetch" href="/blog/assets/表模型.html-lvuDP8dJ.js" as="script"><link rel="prefetch" href="/blog/assets/表索引.html-Ck9S3vCk.js" as="script"><link rel="prefetch" href="/blog/assets/表设计.html-tk_DoCsV.js" as="script"><link rel="prefetch" href="/blog/assets/集群部署.html-4idh13Cl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cth5DVaR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZicgUK5U.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DoXHiDiT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CrHNcY8F.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUx8GfJe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHVKGkTF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COz27HnP.js" as="script"><link rel="prefetch" href="/blog/assets/query.html-DoPeGCPi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-w3kLOssO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTpqBRxQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxORDID2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-k7IOKuSo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CQB9Z0b8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EtRq-J4i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVp3vOGH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DQBe6C8G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHiZJrZY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DIai_jYU.js" as="script"><link rel="prefetch" href="/blog/assets/TerraformFramework实现Provider.html-DmR-BbHm.js" as="script"><link rel="prefetch" href="/blog/assets/Terraform命令.html-CSe_xkG9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-1hZwCU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DCKXXjZh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C0awBswM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wn39Nn3s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bzvj5tms.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BE5TLZ79.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BH9xzrDi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fENjPdqb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DBCYo0z6.js" as="script"><link rel="prefetch" href="/blog/assets/Rsyslog日志转存.html-VynoGpA4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-49epSqc8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B_flGDt0.js" as="script"><link rel="prefetch" href="/blog/assets/SeaTunnel数据库CDC配置.html-ON8CoGPS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ChXgdJTg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bc5oNQiy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-dcPYv2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ck1dZsqe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3t4G-zts.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KRPZcEBU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RQaezZK1.js" as="script"><link rel="prefetch" href="/blog/assets/ZabbixAgent安装及自定义脚本.html-DKURZalB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C29L2VNh.js" as="script"><link rel="prefetch" href="/blog/assets/zabbix安装.html-FEQL6thK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-R3ii_NIK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5_B4zlm.js" as="script"><link rel="prefetch" href="/blog/assets/SQL.html-89x0k9Cm.js" as="script"><link rel="prefetch" href="/blog/assets/数据库优化.html-K6nWNgZK.js" as="script"><link rel="prefetch" href="/blog/assets/数据库索引.html-BX4K5xTn.js" as="script"><link rel="prefetch" href="/blog/assets/数据库锁与事务.html-CS8d_ANn.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatis.html-CIkBxdDk.js" as="script"><link rel="prefetch" href="/blog/assets/Java基础.html-D_QRBbpt.js" as="script"><link rel="prefetch" href="/blog/assets/Java调优.html-B4RoEDf7.js" as="script"><link rel="prefetch" href="/blog/assets/Java进阶.html-Db99JmhM.js" as="script"><link rel="prefetch" href="/blog/assets/反射.html-B9fatXTn.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-CxbSCpUd.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html-B6SpjkfJ.js" as="script"><link rel="prefetch" href="/blog/assets/集合.html-CUZ1m7It.js" as="script"><link rel="prefetch" href="/blog/assets/面向对象.html-UMaUbHDD.js" as="script"><link rel="prefetch" href="/blog/assets/jvm.html-BWNS3e3B.js" as="script"><link rel="prefetch" href="/blog/assets/JUC.html-DLUivWNX.js" as="script"><link rel="prefetch" href="/blog/assets/ThreadLocal.html-BYxYh7yT.js" as="script"><link rel="prefetch" href="/blog/assets/多线程.html-BmpsxTLI.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-DwozZdb4.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html--5qDdUfD.js" as="script"><link rel="prefetch" href="/blog/assets/Redis.html-BsKKSiRX.js" as="script"><link rel="prefetch" href="/blog/assets/ElasticSearch.html-Pn1J3Cur.js" as="script"><link rel="prefetch" href="/blog/assets/JVM内存模型.html-CZyniu0B.js" as="script"><link rel="prefetch" href="/blog/assets/JVM对高效并发的支持.html-eb1cM9Dq.js" as="script"><link rel="prefetch" href="/blog/assets/JVM工具和JVM调优.html--xINkAvq.js" as="script"><link rel="prefetch" href="/blog/assets/垃圾回收.html-WnvI2chO.js" as="script"><link rel="prefetch" href="/blog/assets/Spring.html-B4O33Fe1.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot.html-O44ccL2x.js" as="script"><link rel="prefetch" href="/blog/assets/SpringMvc.html-C8kgBqP7.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloud.html-DTSK6rgN.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudAlibaba.html-BXlIalpv.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudNetflix.html-BP0KK0nB.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-BlOTU2g8.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-BphbxoLK.js" as="script"><link rel="prefetch" href="/blog/assets/分布式锁.html-CgINm6oC.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-5cdhF5yj.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-CYpgxpoD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="vp-site-logo" src="/blog/assets/img/game.ico" alt="とんぼの気持ち"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">とんぼの気持ち</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">JVM 完全指南 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h2 id="jvm-基础概念" tabindex="-1"><a class="header-anchor" href="#jvm-基础概念"><span>JVM 基础概念</span></a></h2><h3 id="jvm-是什么" tabindex="-1"><a class="header-anchor" href="#jvm-是什么"><span>JVM 是什么</span></a></h3><ul><li>JVM：Java Virtual Machine，Java 虚拟机</li><li>虚拟机是指通过软件模拟的具有完整硬件系统功能，并且运行在一个完全隔离环境中的计算机系统</li><li>JVM 是通过软件来模拟 Java 字节码的指令集，是 Java 程序的运行环境</li></ul><h3 id="jvm-有什么" tabindex="-1"><a class="header-anchor" href="#jvm-有什么"><span>JVM 有什么</span></a></h3><p>主要包括四个部分</p><ul><li>类加载器（ClassLoader）</li><li>运行时数据区（Runtime Data Area）</li><li>执行引擎（Execution Engine）</li><li>本地库接口（Native Interface）</li></ul><p><img src="/blog/img/Snipaste_2021-03-23_10-08-27.png" alt="Snipaste_2021-03-23_10-08-27.png"></p><h3 id="jvm-主要功能" tabindex="-1"><a class="header-anchor" href="#jvm-主要功能"><span>JVM 主要功能</span></a></h3><ol><li>通过 ClassLoader 寻找和装载 class 文件</li><li>解释字节码成为指令并执行，提供 class 文件的运行环境</li><li>进行运行期间的内存分配和垃圾回收</li><li>提供与硬件交互的平台</li></ol><h3 id="jvm-怎么实现平台无关" tabindex="-1"><a class="header-anchor" href="#jvm-怎么实现平台无关"><span>JVM 怎么实现平台无关</span></a></h3><p>JDK 的安装包是和平台相关的，自己写的代码和平台无关的</p><p><img src="/blog/img/Snipaste_2021-03-23_10-14-34.png" alt="Snipaste_2021-03-23_10-14-34.png"></p><h2 id="jvm-规范" tabindex="-1"><a class="header-anchor" href="#jvm-规范"><span>JVM 规范</span></a></h2><h3 id="jvm-规范的作用" tabindex="-1"><a class="header-anchor" href="#jvm-规范的作用"><span>JVM 规范的作用</span></a></h3><ul><li>JVM 规范为不同硬件平台提供了一种编译 Java 技术代码的规范</li><li>JVM 规范使得 Java 软件独立于平台</li><li>编程语言只要符合 JVM 规范，JVM 就可以运行对应的 class 文件，实现了编程语言无关性</li></ul><h3 id="jvm-规范的主要内容" tabindex="-1"><a class="header-anchor" href="#jvm-规范的主要内容"><span>JVM 规范的主要内容</span></a></h3><ol><li>字节码指令集：JVM 的指令由一个字节长度代表着某种特殊操作含义的操作码（opcode）以及跟随其后的零个或多个代表此操作所需参数的操作数（operand）所构成</li><li>Class 文件的格式</li><li>数据类型和值</li><li>运行时的数据区</li><li>栈帧</li><li>特殊方法 <ul><li>〈init〉：实例初始化方法，通过 JVM 的 invokespecial 指令来调用</li><li>〈clinit〉：类或接口的初始化方法，不含参数，返回 void</li></ul></li><li>类库：JVM 必须对一些 Java 类库提供支持，否则这些类库根本无法实现 <ul><li>反射</li><li>加载和创建类或接口，如：ClassLoader</li><li>连接和初始化类和接口的类</li><li>安全类，如：security</li><li>多线程</li><li>弱引用</li></ul></li><li>异常</li><li>虚拟机的启动、加载、链接和初始化</li></ol><h2 id="class-文件" tabindex="-1"><a class="header-anchor" href="#class-文件"><span>Class 文件</span></a></h2><p>Class 文件是 JVM 的输入，Class 文件是 JVM 实现平台无关、技术无关的基础</p><h3 id="class-文件格式" tabindex="-1"><a class="header-anchor" href="#class-文件格式"><span>Class 文件格式</span></a></h3><ul><li>Class 文件是一组以 8 字节为单位的字节流，各个数据项目按顺序紧凑排列</li><li>对于占用空间大于 8 字节的数据项，按照高位在前的方式分割成多个 8 字节进行存储</li><li>Class 文件格式里面只有两种类型：无符号数、表 <ul><li>无符号数：基本数据类型，以 u1、u2、u4、u8 来代表几个字节的无符号数</li><li>表：由多个无符号数和其他表构成的复合数据类型，通常以 _info 结尾</li></ul></li></ul><p><img src="/blog/img/image23141312.png" alt="image23141312.png"></p><h4 id="查看方式" tabindex="-1"><a class="header-anchor" href="#查看方式"><span>查看方式</span></a></h4><ul><li>vim 查看 16 进制源文件</li><li>javap 工具生成非正式的&quot;虚拟机汇编语言&quot;</li></ul><h4 id="例子" tabindex="-1"><a class="header-anchor" href="#例子"><span>例子</span></a></h4><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> test</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> Hello</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    private</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> final</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> msg</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>使用 javac ./test/Hello.java 将其编译为 class 文件</li><li>使用 vim ./test/Hello.class 并使用命令 :%!xxd 将文件转换为 16 进制显示源文件</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">00000000:</span><span style="color:#A3BE8C;"> cafe</span><span style="color:#A3BE8C;"> babe</span><span style="color:#B48EAD;"> 0000</span><span style="color:#A3BE8C;"> 003d</span><span style="color:#B48EAD;"> 0020</span><span style="color:#A3BE8C;"> 0a00</span><span style="color:#B48EAD;"> 0200</span><span style="color:#B48EAD;"> 0307</span><span style="color:#A3BE8C;">  .......=.</span><span style="color:#A3BE8C;"> ......</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000010:</span><span style="color:#B48EAD;"> 0004</span><span style="color:#A3BE8C;"> 0c00</span><span style="color:#B48EAD;"> 0500</span><span style="color:#B48EAD;"> 0601</span><span style="color:#B48EAD;"> 0010</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f6c</span><span style="color:#A3BE8C;">  ..........java/l</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000020:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#A3BE8C;"> 672f</span><span style="color:#A3BE8C;"> 4f62</span><span style="color:#A3BE8C;"> 6a65</span><span style="color:#B48EAD;"> 6374</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 063c</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;">  ang/Object...</span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;">in</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000030:</span><span style="color:#B48EAD;"> 6974</span><span style="color:#A3BE8C;"> 3e01</span><span style="color:#B48EAD;"> 0003</span><span style="color:#B48EAD;"> 2829</span><span style="color:#B48EAD;"> 5609</span><span style="color:#B48EAD;"> 0008</span><span style="color:#B48EAD;"> 0009</span><span style="color:#B48EAD;"> 0700</span><span style="color:#A3BE8C;">  i</span><span style="color:#D8DEE9FF;">t</span><span style="color:#81A1C1;">&gt;</span><span style="color:#A3BE8C;">...</span><span style="color:#ECEFF4;">()</span><span style="color:#A3BE8C;">V.......</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000040:</span><span style="color:#A3BE8C;"> 0a0c</span><span style="color:#A3BE8C;"> 000b</span><span style="color:#A3BE8C;"> 000c</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 106a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 6c61</span><span style="color:#A3BE8C;">  .........java/la</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000050:</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;"> 2f53</span><span style="color:#B48EAD;"> 7973</span><span style="color:#B48EAD;"> 7465</span><span style="color:#A3BE8C;"> 6d01</span><span style="color:#B48EAD;"> 0003</span><span style="color:#A3BE8C;"> 6f75</span><span style="color:#B48EAD;"> 7401</span><span style="color:#A3BE8C;">  ng/System...out.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000060:</span><span style="color:#B48EAD;"> 0015</span><span style="color:#A3BE8C;"> 4c6a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 696f</span><span style="color:#A3BE8C;"> 2f50</span><span style="color:#B48EAD;"> 7269</span><span style="color:#A3BE8C;"> 6e74</span><span style="color:#A3BE8C;">  ..Ljava/io/Print</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000070:</span><span style="color:#B48EAD;"> 5374</span><span style="color:#B48EAD;"> 7265</span><span style="color:#A3BE8C;"> 616d</span><span style="color:#A3BE8C;"> 3b07</span><span style="color:#A3BE8C;"> 000e</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0a74</span><span style="color:#B48EAD;"> 6573</span><span style="color:#A3BE8C;">  Stream</span><span style="color:#81A1C1;">;</span><span style="color:#88C0D0;">.....</span><span style="color:#A3BE8C;">.tes</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000080:</span><span style="color:#A3BE8C;"> 742f</span><span style="color:#B48EAD;"> 4865</span><span style="color:#A3BE8C;"> 6c6c</span><span style="color:#A3BE8C;"> 6f08</span><span style="color:#B48EAD;"> 0010</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0b68</span><span style="color:#A3BE8C;"> 656c</span><span style="color:#A3BE8C;">  t/Hello......hel</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000090:</span><span style="color:#A3BE8C;"> 6c6f</span><span style="color:#B48EAD;"> 2077</span><span style="color:#A3BE8C;"> 6f72</span><span style="color:#A3BE8C;"> 6c64</span><span style="color:#A3BE8C;"> 0a00</span><span style="color:#B48EAD;"> 1200</span><span style="color:#B48EAD;"> 1307</span><span style="color:#B48EAD;"> 0014</span><span style="color:#A3BE8C;">  lo</span><span style="color:#A3BE8C;"> world........</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000a0:</span><span style="color:#A3BE8C;"> 0c00</span><span style="color:#B48EAD;"> 1500</span><span style="color:#B48EAD;"> 1601</span><span style="color:#B48EAD;"> 0013</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f69</span><span style="color:#A3BE8C;"> 6f2f</span><span style="color:#A3BE8C;">  ........java/io/</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000b0:</span><span style="color:#B48EAD;"> 5072</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#B48EAD;"> 7453</span><span style="color:#B48EAD;"> 7472</span><span style="color:#B48EAD;"> 6561</span><span style="color:#A3BE8C;"> 6d01</span><span style="color:#B48EAD;"> 0007</span><span style="color:#B48EAD;"> 7072</span><span style="color:#A3BE8C;">  PrintStream...pr</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000c0:</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;"> 746c</span><span style="color:#A3BE8C;"> 6e01</span><span style="color:#B48EAD;"> 0015</span><span style="color:#A3BE8C;"> 284c</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f6c</span><span style="color:#A3BE8C;">  intln...</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">Ljava/l</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000d0:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#A3BE8C;"> 672f</span><span style="color:#B48EAD;"> 5374</span><span style="color:#B48EAD;"> 7269</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;"> 3b29</span><span style="color:#B48EAD;"> 5601</span><span style="color:#B48EAD;"> 0003</span><span style="color:#A3BE8C;">  ang/String</span><span style="color:#81A1C1;">;</span><span style="color:#ECEFF4;">)</span><span style="color:#A3BE8C;">V...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000e0:</span><span style="color:#A3BE8C;"> 6d73</span><span style="color:#B48EAD;"> 6701</span><span style="color:#B48EAD;"> 0012</span><span style="color:#A3BE8C;"> 4c6a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 6c61</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;">  msg...Ljava/lang</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000f0:</span><span style="color:#A3BE8C;"> 2f53</span><span style="color:#B48EAD;"> 7472</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;"> 673b</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0d43</span><span style="color:#A3BE8C;"> 6f6e</span><span style="color:#B48EAD;"> 7374</span><span style="color:#A3BE8C;">  /String</span><span style="color:#81A1C1;">;</span><span style="color:#88C0D0;">..</span><span style="color:#A3BE8C;">.Const</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000100:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#B48EAD;"> 7456</span><span style="color:#A3BE8C;"> 616c</span><span style="color:#B48EAD;"> 7565</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 0443</span><span style="color:#A3BE8C;"> 6f64</span><span style="color:#B48EAD;"> 6501</span><span style="color:#A3BE8C;">  antValue...Code.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000110:</span><span style="color:#A3BE8C;"> 000f</span><span style="color:#A3BE8C;"> 4c69</span><span style="color:#A3BE8C;"> 6e65</span><span style="color:#A3BE8C;"> 4e75</span><span style="color:#A3BE8C;"> 6d62</span><span style="color:#B48EAD;"> 6572</span><span style="color:#B48EAD;"> 5461</span><span style="color:#A3BE8C;"> 626c</span><span style="color:#A3BE8C;">  ..LineNumberTabl</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000120:</span><span style="color:#B48EAD;"> 6501</span><span style="color:#B48EAD;"> 0004</span><span style="color:#A3BE8C;"> 6d61</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 1628</span><span style="color:#A3BE8C;"> 5b4c</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#A3BE8C;">  e...main...</span><span style="color:#ECEFF4;">([</span><span style="color:#D8DEE9FF;">Lja</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000130: </span><span style="color:#B48EAD;">7661</span><span style="color:#D8DEE9FF;"> 2f6c 616e 672f </span><span style="color:#B48EAD;">5374</span><span style="color:#B48EAD;"> 7269</span><span style="color:#D8DEE9FF;"> 6e67 3b29  va/lang/String</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000140: </span><span style="color:#B48EAD;">5601</span><span style="color:#D8DEE9FF;"> 000a 536f </span><span style="color:#B48EAD;">7572</span><span style="color:#B48EAD;"> 6365</span><span style="color:#B48EAD;"> 4669</span><span style="color:#D8DEE9FF;"> 6c65 </span><span style="color:#B48EAD;">0100</span><span style="color:#D8DEE9FF;">  V...SourceFile..</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000150: 0a48 656c 6c6f 2e6a </span><span style="color:#B48EAD;">6176</span><span style="color:#B48EAD;"> 6100</span><span style="color:#B48EAD;"> 2100</span><span style="color:#D8DEE9FF;"> 0d00  .Hello.java.</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9FF;">...</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000160: </span><span style="color:#B48EAD;">0200</span><span style="color:#B48EAD;"> 0000</span><span style="color:#B48EAD;"> 0100</span><span style="color:#D8DEE9FF;"> 1a00 </span><span style="color:#B48EAD;">1700</span><span style="color:#B48EAD;"> 1800</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 1900</span><span style="color:#D8DEE9FF;">  ................</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000170: </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0200</span><span style="color:#D8DEE9FF;"> 0f00 </span><span style="color:#B48EAD;">0200</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 0500</span><span style="color:#B48EAD;"> 0600</span><span style="color:#B48EAD;"> 0100</span><span style="color:#D8DEE9FF;">  ................</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000180: 1a00 </span><span style="color:#B48EAD;">0000</span><span style="color:#D8DEE9FF;"> 1d00 </span><span style="color:#B48EAD;">0100</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 0000</span><span style="color:#D8DEE9FF;"> 052a b700  .............</span><span style="color:#81A1C1;">*</span><span style="color:#D8DEE9FF;">..</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000190: 01b1 </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0001</span><span style="color:#D8DEE9FF;"> 001b </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0006</span><span style="color:#B48EAD;"> 0001</span><span style="color:#B48EAD;"> 0000</span><span style="color:#D8DEE9FF;">  ................</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">000001a0: </span><span style="color:#B48EAD;">0003</span><span style="color:#B48EAD;"> 0009</span><span style="color:#D8DEE9FF;"> 001c 001d </span><span style="color:#B48EAD;">0001</span><span style="color:#D8DEE9FF;"> 001a </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0025</span><span style="color:#D8DEE9FF;">  ...............%</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">000001b0: </span><span style="color:#B48EAD;">0002</span><span style="color:#B48EAD;"> 0001</span><span style="color:#B48EAD;"> 0000</span><span style="color:#B48EAD;"> 0009</span><span style="color:#D8DEE9FF;"> b200 </span><span style="color:#B48EAD;">0712</span><span style="color:#D8DEE9FF;"> 0fb6 </span><span style="color:#B48EAD;">0011</span><span style="color:#D8DEE9FF;">  ................</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">000001c0: b100 </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0100</span><span style="color:#D8DEE9FF;"> 1b00 </span><span style="color:#B48EAD;">0000</span><span style="color:#D8DEE9FF;"> 0a00 </span><span style="color:#B48EAD;">0200</span><span style="color:#B48EAD;"> 0000</span><span style="color:#D8DEE9FF;">  ................</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">000001d0: </span><span style="color:#B48EAD;">0700</span><span style="color:#B48EAD;"> 0800</span><span style="color:#B48EAD;"> 0800</span><span style="color:#B48EAD;"> 0100</span><span style="color:#D8DEE9FF;"> 1e00 </span><span style="color:#B48EAD;">0000</span><span style="color:#B48EAD;"> 0200</span><span style="color:#D8DEE9FF;"> 1f0a  ................</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><ol start="3"><li>使用 javap -verbose ./test/Hello.class 查看 class 文件解析后的内容</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">Classfile </span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">Users</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">xxx</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">test</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9;">Hello</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">class</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  Last</span><span style="color:#D8DEE9FF;"> modified 2023年3月27日</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> size </span><span style="color:#B48EAD;">479</span><span style="color:#D8DEE9FF;"> bytes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  SHA</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">256</span><span style="color:#D8DEE9FF;"> checksum 8f00f7dfcd98f34e709426dd8e2311c216f576cbd02bbea3cf189562d56523c9</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  Compiled</span><span style="color:#D8DEE9FF;"> from </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hello.java</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> test</span><span style="color:#D8DEE9FF;">.Hello</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  minor version: 0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  major version: 61</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  this_class: #13                         </span><span style="color:#616E88;">// test/Hello</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  super_class: #2                         </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  interfaces: 0, fields: 1, methods: 2, attributes: 1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Constant pool:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #1 = Methodref          #2.#3          </span><span style="color:#616E88;">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #2 = Class              #4             </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #3 = NameAndType        #5:#6          </span><span style="color:#616E88;">// &quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #4 = Utf8               java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #5 = Utf8               </span><span style="color:#ECEFF4;">&lt;</span><span style="color:#8FBCBB;">init</span><span style="color:#ECEFF4;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #6 = Utf8               ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #7 = Fieldref           #8.#9          </span><span style="color:#616E88;">// java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #8 = Class              #10            </span><span style="color:#616E88;">// java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #9 = NameAndType        #11:#12        </span><span style="color:#616E88;">// out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #10 = Utf8               java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #11 = Utf8               out</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #12 = Utf8               Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #13 = Class              #14            </span><span style="color:#616E88;">// test/Hello</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #14 = Utf8               test/Hello</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #15 = String             #16            </span><span style="color:#616E88;">// hello world</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #16 = Utf8               hello world</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #17 = Methodref          #18.#19        </span><span style="color:#616E88;">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #18 = Class              #20            </span><span style="color:#616E88;">// java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #19 = NameAndType        #21:#22        </span><span style="color:#616E88;">// println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #20 = Utf8               java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #21 = Utf8               println</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #22 = Utf8               (Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #23 = Utf8               msg</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #24 = Utf8               Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #25 = Utf8               ConstantValue</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #26 = Utf8               Code</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #27 = Utf8               LineNumberTable</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #28 = Utf8               main</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #29 = Utf8               ([Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #30 = Utf8               SourceFile</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #31 = Utf8               Hello.java</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#D8DEE9FF;"> test.</span><span style="color:#88C0D0;">Hello</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=1, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: aload_0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         1: invokespecial #1                  </span><span style="color:#616E88;">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         4: return</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 3: 0</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">java</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">lang</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[])</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ([Ljava/lang/String</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">)</span><span style="color:#8FBCBB;">V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0009) ACC_PUBLIC, ACC_STATIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=2, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: getstatic     #7                  </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         3: ldc           #15                 </span><span style="color:#616E88;">// String hello world</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         5: invokevirtual #17                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         8: return</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 7: 0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 8: 8</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">SourceFile</span><span style="color:#81A1C1;">:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Hello.java</span><span style="color:#ECEFF4;">&quot;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="class-字节码" tabindex="-1"><a class="header-anchor" href="#class-字节码"><span>Class 字节码</span></a></h3><h4 id="常量池-constant-pool" tabindex="-1"><a class="header-anchor" href="#常量池-constant-pool"><span>常量池 Constant pool</span></a></h4><p>请阅读官方 JVM 规范获取更多信息！！！</p><h4 id="类定义和属性" tabindex="-1"><a class="header-anchor" href="#类定义和属性"><span>类定义和属性</span></a></h4><p>请阅读官方 JVM 规范获取更多信息！！！属性的通用格式</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">attribute_info </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 attribute_name_index</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u4 attribute_length</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u1 info</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="方法和调用" tabindex="-1"><a class="header-anchor" href="#方法和调用"><span>方法和调用</span></a></h4><p>请阅读官方 JVM 规范获取更多信息！！！方法的通用格式</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">method_info </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 access_flag</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 name_index</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 attribute_count</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    attribute_info attributes</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">attribute_count</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="asm" tabindex="-1"><a class="header-anchor" href="#asm"><span>ASM</span></a></h2><ul><li>ASM 是 Java 字节码操作框架，用来动态生成类或增强既有类的功能</li><li>ASM 可以直接产生二进制 class 文件，也可以在类被加载入虚拟机之前动态改变类行为，ASM 从类文件中读入信息后，能改变类行为、分析类信息、根据要求生成新类</li><li>cglib、hibernate、spring 都直接或间接使用了 ASM 操作字节码</li></ul><h3 id="asm-编程模型" tabindex="-1"><a class="header-anchor" href="#asm-编程模型"><span>ASM 编程模型</span></a></h3><ul><li>Core API：提供了基于事件形式的编程模型，该模型不需要一次性将整个类的结构读取到内存中，因此这种方式更快，需要更少的内存，但编程难度较大</li><li>Tree API：提供基于树形的编程模型，该模型需要一次性将一个类的完整结构全部读取到内存中，所以需要更多的内存，较简单</li></ul><h3 id="core-api" tabindex="-1"><a class="header-anchor" href="#core-api"><span>Core API</span></a></h3><ul><li>Core API 操作字节码是基于 ClassVisitor 接口，这个接口的每个方法对应了 class 文件中的每一项</li><li>ASM 提供了三个基于 ClassVisitor 接口的类来实现 class 文件的生成和转换 <ul><li>ClassReader：解析一个类的 class 字节码</li><li>ClassAdapter：主要功能是将 Classreader 解析的字节码进行改造</li><li>ClassWriter：输出变化后的字节码</li></ul></li><li>ASMifier：ASMifier 工具可以生成 ASM 结构</li></ul><h3 id="asmifier" tabindex="-1"><a class="header-anchor" href="#asmifier"><span>ASMifier</span></a></h3><p>idea 插件有 ASM Bytecode Outline、ASM Bytecode Viewer 等，可以生成 ASM 结构文件</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * java -cp .:../lib/asm-9.1.jar:../lib/asm-util-9.1.jar org.objectweb.asm.util.ASMifier com.hyfly.asm.TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * idea plugin: ASM Bytecode Outline / ASM Bytecode Viewer</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> *</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * </span><span style="color:#8FBCBB;">@author</span><span style="color:#616E88;"> flyhy</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 --------</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">endTime </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> startTime</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>通过 ASM Bytecode Viewer 生成的 ASM 文件为</p><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">AnnotationVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Attribute</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassReader</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassWriter</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ConstantDynamic</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">FieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Handle</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Label</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Opcodes</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">RecordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Type</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">TypePath</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClassDump</span><span style="color:#81A1C1;"> implements</span><span style="color:#8FBCBB;font-weight:bold;"> Opcodes</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#88C0D0;"> dump</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FieldVisitor</span><span style="color:#D8DEE9;"> fieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        RecordComponentVisitor</span><span style="color:#D8DEE9;"> recordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        AnnotationVisitor</span><span style="color:#D8DEE9;"> annotationVisitor0</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">V17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> ACC_PUBLIC </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_SUPER</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitSource</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass.java</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInnerClass</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java/lang/invoke/MethodHandles$Lookup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/invoke/MethodHandles</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lookup</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> ACC_PUBLIC </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_FINAL </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_STATIC</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESPECIAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fun01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label2</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitTryCatchBlock</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label3</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">12</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label4</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">13</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 --------</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">15</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Long</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Thread</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sleep</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">18</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label5</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitJumpInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GOTO</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">16</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_FULL</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LONG</span><span style="color:#ECEFF4;">},</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ASTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label6</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">printStackTrace</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">19</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_SAME</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label7</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">20</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">LSUB</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInvokeDynamicInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)Ljava/lang/String;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Handle</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">H_INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/invoke/StringConcatFactory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">),</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#EBCB8B;">\u</span><span style="color:#A3BE8C;">0001</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label8</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">21</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label9</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label9</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">e</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/lang/InterruptedException;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label9</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">startTime</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label4</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label9</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">endTime</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label9</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="asm-代码演示" tabindex="-1"><a class="header-anchor" href="#asm-代码演示"><span>ASM 代码演示</span></a></h3><p>代码可参考 <a href="https://github.com/hyfly233/jvm-test" target="_blank" rel="noopener noreferrer">https://github.com/hyfly233/jvm-test</a></p><h4 id="asm-演示例子-01" tabindex="-1"><a class="header-anchor" href="#asm-演示例子-01"><span>ASM 演示例子 01</span></a></h4><p>创建三个类，分别为 TargetClass、MyClassVisiter、Generator，其中的 MyClassVisiter 是有 bug 的</p><ul><li>TargetClass</li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * </span><span style="color:#8FBCBB;">@author</span><span style="color:#616E88;"> flyhy</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>MyClassVisiter 代码如下</li></ul><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#81A1C1;">*;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyClassVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> ClassVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#D8DEE9;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visit</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> version</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">version</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#8FBCBB;"> MethodVisitor</span><span style="color:#88C0D0;"> visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> mv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#ECEFF4;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">equals</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> mv </span><span style="color:#81A1C1;">!=</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 为这种方法增加记录执行时间的功能</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            mv </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">mv</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9FF;"> mv</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    static</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyMethodVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> MethodVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法开始处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法返回处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            if</span><span style="color:#ECEFF4;"> ((</span><span style="color:#D8DEE9FF;">opcode </span><span style="color:#81A1C1;">&gt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">IRETURN</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> ||</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">==</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ATHROW</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                // 下面的代码是通过 ASM Bytecode Viewer 生成的 ASM 文件中复制出来的</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">                Label</span><span style="color:#D8DEE9;"> label7</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">20</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSUB</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInvokeDynamicInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)Ljava/lang/String;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Handle</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">H_INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/invoke/StringConcatFactory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">),</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#EBCB8B;">\u</span><span style="color:#A3BE8C;">0001</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">                Label</span><span style="color:#D8DEE9;"> label8</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">21</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><ul><li>Generator 代码如下</li></ul><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassReader</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassWriter</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> java</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">io</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">File</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> java</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">io</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">FileOutputStream</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> Generator</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassReader</span><span style="color:#D8DEE9;"> cr</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassReader</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> cw</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ClassWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">COMPUTE_MAXS</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassVisitor</span><span style="color:#D8DEE9;"> cv</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">cw</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cr</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">accept</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">cv</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ClassReader</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">SKIP_DEBUG</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cw</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // 输出到文件</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        File</span><span style="color:#D8DEE9;"> file</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> File</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/Users/flyhy/workspace/jvm-test/asm/bin/com/hyfly/asm/TargetClass.class</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FileOutputStream</span><span style="color:#D8DEE9;"> fileOutputStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> FileOutputStream</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">file</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        fileOutputStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        fileOutputStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>执行 Generator 中的 main 方法生成 TargetClass.class 文件，并通过 idea 打开得到的内容为，能清楚的看到代码 13 行是错误的</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Source code recreated from a .class file by IntelliJ IDEA</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// (powered by FernFlower decompiler)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        InterruptedException</span><span style="color:#D8DEE9;"> var1</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> var5</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            var1 </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> var5</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            var5</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> var3</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">var3 </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> var1</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 javap -verbose 命令得到的内容</p><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">Classfile </span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">Users</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">flyhy</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">workspace</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">jvm</span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;">test</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">asm</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">bin</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">com</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">hyfly</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">asm</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9;">TargetClass</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">class</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  Last</span><span style="color:#D8DEE9FF;"> modified 2023年4月1日</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> size </span><span style="color:#B48EAD;">961</span><span style="color:#D8DEE9FF;"> bytes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  SHA</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">256</span><span style="color:#D8DEE9FF;"> checksum 5fd3906b265448870bbff62db9ed106d9527d38b2b43f5d305ecf51992b68e4c</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> com</span><span style="color:#D8DEE9FF;">.hyfly.asm.TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  minor version: 0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  major version: 61</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  this_class: #2                          </span><span style="color:#616E88;">// com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  super_class: #4                         </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  interfaces: 0, fields: 0, methods: 2, attributes: 1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Constant pool:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #1 = Utf8               com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #2 = Class              #1             </span><span style="color:#616E88;">// com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #3 = Utf8               java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #4 = Class              #3             </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #5 = Utf8               </span><span style="color:#ECEFF4;">&lt;</span><span style="color:#8FBCBB;">init</span><span style="color:#ECEFF4;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #6 = Utf8               ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #7 = NameAndType        #5:#6          </span><span style="color:#616E88;">// &quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #8 = Methodref          #4.#7          </span><span style="color:#616E88;">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #9 = Utf8               fun01</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #10 = Utf8               java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #11 = Class              #10            </span><span style="color:#616E88;">// java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #12 = Utf8               currentTimeMillis</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #13 = Utf8               ()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #14 = NameAndType        #12:#13        </span><span style="color:#616E88;">// currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #15 = Methodref          #11.#14        </span><span style="color:#616E88;">// java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #16 = Utf8               java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #17 = Class              #16            </span><span style="color:#616E88;">// java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #18 = Long               100l</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #20 = Utf8               java/lang/Thread</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #21 = Class              #20            </span><span style="color:#616E88;">// java/lang/Thread</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #22 = Utf8               sleep</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #23 = Utf8               (J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #24 = NameAndType        #22:#23        </span><span style="color:#616E88;">// sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #25 = Methodref          #21.#24        </span><span style="color:#616E88;">// java/lang/Thread.sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #26 = Utf8               out</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #27 = Utf8               Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #28 = NameAndType        #26:#27        </span><span style="color:#616E88;">// out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #29 = Fieldref           #11.#28        </span><span style="color:#616E88;">// java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #30 = Utf8               TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #31 = String             #30            </span><span style="color:#616E88;">// TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #32 = Utf8               java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #33 = Class              #32            </span><span style="color:#616E88;">// java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #34 = Utf8               println</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #35 = Utf8               (Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #36 = NameAndType        #34:#35        </span><span style="color:#616E88;">// println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #37 = Methodref          #33.#36        </span><span style="color:#616E88;">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #38 = Utf8               printStackTrace</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #39 = NameAndType        #38:#6         </span><span style="color:#616E88;">// printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #40 = Methodref          #17.#39        </span><span style="color:#616E88;">// java/lang/InterruptedException.printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #41 = Utf8               TargetClass#fun01 cost: \u0001</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #42 = String             #41            </span><span style="color:#616E88;">// TargetClass#fun01 cost: \u0001</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #43 = Utf8               java/lang/invoke/StringConcatFactory</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #44 = Class              #43            </span><span style="color:#616E88;">// java/lang/invoke/StringConcatFactory</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #45 = Utf8               makeConcatWithConstants</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #46 = Utf8               (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #47 = NameAndType        #45:#46        </span><span style="color:#616E88;">// makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #48 = Methodref          #44.#47        </span><span style="color:#616E88;">// java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #49 = MethodHandle       6:#48          </span><span style="color:#616E88;">// REF_invokeStatic java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #50 = Utf8               (J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #51 = NameAndType        #45:#50        </span><span style="color:#616E88;">// makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #52 = InvokeDynamic      #0:#51         </span><span style="color:#616E88;">// #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #53 = Utf8               Code</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #54 = Utf8               StackMapTable</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #55 = Utf8               LineNumberTable</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #56 = Utf8               BootstrapMethods</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#D8DEE9FF;"> com.hyfly.asm.</span><span style="color:#88C0D0;">TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=1, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: aload_0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         1: invokespecial #8                  </span><span style="color:#616E88;">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         4: return</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=5, locals=5, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         3: lstore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         4: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         7: lstore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         8: ldc2_w        #18                 </span><span style="color:#616E88;">// long 100l</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        11: invokestatic  #25                 </span><span style="color:#616E88;">// Method java/lang/Thread.sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        14: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        17: ldc           #31                 </span><span style="color:#616E88;">// String TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        19: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        22: goto          30</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        25: astore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        26: aload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        27: invokevirtual #40                 </span><span style="color:#616E88;">// Method java/lang/InterruptedException.printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        30: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        33: lstore_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        34: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        37: lload_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        38: lload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        39: lsub</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        40: invokedynamic #52,  0             </span><span style="color:#616E88;">// InvokeDynamic #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        45: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        48: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        51: lstore_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        52: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        55: lload_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        56: lload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        57: lsub</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        58: invokedynamic #52,  0             </span><span style="color:#616E88;">// InvokeDynamic #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        63: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        66: return</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      Exception table:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         from    to  target type</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">             8    22    25   Class java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      StackMapTable: number_of_entries = 2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        frame_type = 89 </span><span style="color:#616E88;">/* same_locals_1_stack_item */</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">          stack = [ class java/lang/InterruptedException ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        frame_type = 4 </span><span style="color:#616E88;">/* same */</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 20: 52</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 21: 66</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">BootstrapMethods</span><span style="color:#81A1C1;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  0: #49 REF_invokeStatic java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">String</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">invoke</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">MethodType</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">String</span><span style="color:#81A1C1;">;</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">Object</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">)Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">invoke</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">CallSite</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    Method</span><span style="color:#D8DEE9;"> arguments</span><span style="color:#81A1C1;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      #</span><span style="color:#B48EAD;">42</span><span style="color:#D8DEE9FF;"> TargetClass#fun01 cost</span><span style="color:#81A1C1;">:</span><span style="color:#D8DEE9FF;"> \u0001</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h5 id="测试生成的-targetclass-class" tabindex="-1"><a class="header-anchor" href="#测试生成的-targetclass-class"><span>测试生成的 TargetClass.class</span></a></h5><p>将生成的 TargetClass.class 文件替换 target 文件夹中的 TargetClass.class 文件，执行 TestTargetClass 的 main() 方法将报错</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TestTargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        TargetClass</span><span style="color:#D8DEE9;"> targetClass</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        targetClass</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>报错信息</p><div class="language-text line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-text;"><code><span class="line"><span class="line"><span>Exception in thread &quot;main&quot; java.lang.VerifyError: Bad local variable type</span></span></span>
<span class="line"><span class="line"><span>Exception Details:</span></span></span>
<span class="line"><span class="line"><span>  Location:</span></span></span>
<span class="line"><span class="line"><span>    com/hyfly/asm/TargetClass.fun01()V @34: lload_1</span></span></span>
<span class="line"><span class="line"><span>  Reason:</span></span></span>
<span class="line"><span class="line"><span>    Type top (current frame, locals[1]) is not assignable to long</span></span></span>
<span class="line"><span class="line"><span>  Current Frame:</span></span></span>
<span class="line"><span class="line"><span>    bci: @34</span></span></span>
<span class="line"><span class="line"><span>    flags: { }</span></span></span>
<span class="line"><span class="line"><span>    locals: { &#39;com/hyfly/asm/TargetClass&#39;, top, top, long, long_2nd }</span></span></span>
<span class="line"><span class="line"><span>    stack: { &#39;java/io/PrintStream&#39;, long, long_2nd }</span></span></span>
<span class="line"><span class="line"><span>  Bytecode:</span></span></span>
<span class="line"><span class="line"><span>    0000000: b800 0f40 1400 12b8 0019 b200 1d12 1fb6</span></span></span>
<span class="line"><span class="line"><span>    0000010: 0025 a700 084c 2bb6 0028 b800 0f42 b200</span></span></span>
<span class="line"><span class="line"><span>    0000020: 1d21 1f65 ba00 3400 00b6 0025 b1</span></span></span>
<span class="line"><span class="line"><span>  Exception Handler Table:</span></span></span>
<span class="line"><span class="line"><span>    bci [4, 18] =&gt; handler: 21</span></span></span>
<span class="line"><span class="line"><span>  Stackmap Table:</span></span></span>
<span class="line"><span class="line"><span>    same_locals_1_stack_item_frame(@21,Object[#17])</span></span></span>
<span class="line"><span class="line"><span>    same_frame(@26)</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>	at com.hyfly.asm.TestTargetClass.main(TestTargetClass.java:5)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="报错原因" tabindex="-1"><a class="header-anchor" href="#报错原因"><span>报错原因</span></a></h5><p>在 MyClassVisitor 的内部类 MyMethodVisitor 的 visitCode() 方法中，mv.visitVarInsn(Opcodes.LSTORE, 1); 是用于存储局部变量的，而 TargetClass 也存储了局部变量 InterruptedException e，两次存储变量冲突</p><h4 id="asm-演示例子-02" tabindex="-1"><a class="header-anchor" href="#asm-演示例子-02"><span>ASM 演示例子 02</span></a></h4><h5 id="修改相关类" tabindex="-1"><a class="header-anchor" href="#修改相关类"><span>修改相关类</span></a></h5><p>修改 ASM 演示例子 01 中的相关类，生成 ASM 文件</p><ol><li>添加 MyTimeLogger 类</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyTimeLogger</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    private</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> long</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0L</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> start</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        startTime </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> end</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">MyTimeLogger invoke method cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">endTime </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> startTime</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>修改 TargetClass 并对其 javac 编译为 class 文件</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>通过 ASM Bytecode Viewer 生成的 ASM 文件为</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">AnnotationVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Attribute</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassReader</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassWriter</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ConstantDynamic</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">FieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Handle</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Label</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Opcodes</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">RecordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Type</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">TypePath</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClassDump</span><span style="color:#81A1C1;"> implements</span><span style="color:#8FBCBB;font-weight:bold;"> Opcodes</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#88C0D0;"> dump</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FieldVisitor</span><span style="color:#D8DEE9;"> fieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        RecordComponentVisitor</span><span style="color:#D8DEE9;"> recordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        AnnotationVisitor</span><span style="color:#D8DEE9;"> annotationVisitor0</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">V17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> ACC_PUBLIC </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_SUPER</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitSource</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass.java</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESPECIAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fun01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label2</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitTryCatchBlock</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label3</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">12</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">15</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Long</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Thread</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sleep</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label4</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">16</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">19</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label5</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitJumpInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GOTO</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_SAME1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ASTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label6</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">18</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">printStackTrace</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">21</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_SAME</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label7</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">22</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label8</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">e</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/lang/InterruptedException;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label8</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><ol start="4"><li>复制 ASM 文件中的相关内容，修改 MyClassVisitor 类</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Label</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Opcodes</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyClassVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> ClassVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#D8DEE9;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visit</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> version</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">version</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#8FBCBB;"> MethodVisitor</span><span style="color:#88C0D0;"> visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> mv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#ECEFF4;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">equals</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> mv </span><span style="color:#81A1C1;">!=</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 为这种方法增加记录执行时间的功能</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            mv </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">mv</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9FF;"> mv</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    static</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyMethodVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> MethodVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法开始处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法返回处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            if</span><span style="color:#ECEFF4;"> ((</span><span style="color:#D8DEE9FF;">opcode </span><span style="color:#81A1C1;">&gt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">IRETURN</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> ||</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">==</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ATHROW</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h5 id="测试" tabindex="-1"><a class="header-anchor" href="#测试"><span>测试</span></a></h5><p>使用到的类有 MyTimeLogger、TargetClass、Generator、TestTargetClass、MyClassVisitor。其中为修改的类有 Generator、MyClassVisitor，新增的类为 MyTimeLogger，需要回滚的类为 TargetClass</p><ol><li>执行 Generator 中的 main 方法生成 TargetClass.class 文件，并通过 idea 打开得到的内容为</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Source code recreated from a .class file by IntelliJ IDEA</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// (powered by FernFlower decompiler)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> var2</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            var2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将生成的 TargetClass.class 文件替换 target 文件夹中的 TargetClass.class 文件，执行 TestTargetClass 的 main() 方法，控制台输出内容</li></ol><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">TargetClass#fun01</span><span style="color:#A3BE8C;"> run</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">MyTimeLogger</span><span style="color:#A3BE8C;"> invoke</span><span style="color:#A3BE8C;"> method</span><span style="color:#A3BE8C;"> cost:</span><span style="color:#B48EAD;"> 104</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="asm-总结" tabindex="-1"><a class="header-anchor" href="#asm-总结"><span>ASM 总结</span></a></h3><p>在使用 ASM 增强原始类的功能时，不应该在 MethodVisitor 的相关方法中使用局部变量，而是将增强的方法封装到类的方法中，以避免在存储局部变量时增强类中的局部变量与原始类中的局部变量冲突</p><h2 id="类加载、连接和初始化" tabindex="-1"><a class="header-anchor" href="#类加载、连接和初始化"><span>类加载、连接和初始化</span></a></h2><h3 id="类在-jvm-中的生命周期" tabindex="-1"><a class="header-anchor" href="#类在-jvm-中的生命周期"><span>类在 JVM 中的生命周期</span></a></h3><ol><li>加载：查找并加载类文件的二进制数据</li><li>连接：将已经读入内存的类的二进制数据合并到 JVM 运行时环境中去 <ol><li>验证：确保被加载类的正确性</li><li>装备：为类的静态变量分配内存，创建静态变量</li><li>解析：把常量池中的符号引用转换成直接引用</li></ol></li><li>初始化：为类的静态变量赋初始值</li><li>使用</li><li>卸载</li></ol><p><img src="/blog/img/Snipaste_2021-04-03_21-50-25.png" alt="Snipaste_2021-04-03_21-50-25.png"></p><h3 id="类加载" tabindex="-1"><a class="header-anchor" href="#类加载"><span>类加载</span></a></h3><ol><li>通过类的全限定名来获取该类的二进制字节流</li><li>把二进制字节流转化为方法区的运行时数据结构</li><li>在堆上创建一个 java.lang.Class 对象，用来封装类在方法区内的数据结构，并向外提供了访问方法区内数据结构的接口</li></ol><h3 id="加载类的方法" tabindex="-1"><a class="header-anchor" href="#加载类的方法"><span>加载类的方法</span></a></h3><ul><li>常见方式：从本地文件系统中加载，从 jar 等归档文件中加载</li><li>动态方式：将 Java 源文件动态编译成 class</li><li>其他：网络下载，从专有数据库中加载</li></ul><h3 id="类加载器" tabindex="-1"><a class="header-anchor" href="#类加载器"><span>类加载器</span></a></h3><ul><li>类加载器并不需要等到某个类首次主动使用的时候才加载它，JVM 规范允许类加载器在预料到某个类将要被使用的时候就预先加载它</li><li>如果在加载的时候 .class 文件缺失。会在该类首次主动使用时抛出 LinkageError 错误，如果一直没有被使用，则不会报错</li></ul><h4 id="jvm-自带的加载器" tabindex="-1"><a class="header-anchor" href="#jvm-自带的加载器"><span>JVM 自带的加载器</span></a></h4><ul><li>启动类加载器（BootstrapClassLoader） <ul><li>Java 程序不能直接引用启动类加载器，直接设置 classLoader 为 null，默认使用启动类加载器</li><li>用于加载启动的基础模块，比如：java.base、java.management、java.xml 等，启动类加载器是 JVM 平台自身的，不允许被其他方式修改，通过 Object.getClass().getClassLoader() 得到的结果是 null</li><li>JDK 8 的启动类加载器负责将 JAVA_HONME/lib，或者 -Xbootclasspath 参数指定的路径中的，且是虚拟机识别的类库加载到内存中（按照名字识别，如：rt.jar，对于不能识别的文件不予加载）</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">String</span><span style="color:#D8DEE9;"> str</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hello class loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// str class loader null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">str class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> str</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClass</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>扩展类加载器（ExtensionClassLoader）、平台类加载器（PlatformClassLoader） <ul><li>JDK 8 之前是扩展类加载器，JDK 8 之后为平台类加载器，扩展类加载器的扩展性较差、安全性较低，所以被移除</li><li>JDK 8 的扩展类加载器负责加载 JRE_HOME/lib/ext，或者 java.ext.dirs 系统变量所指定路径上的所有类库</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">Class</span><span style="color:#ECEFF4;">&lt;</span><span style="color:#8FBCBB;">?</span><span style="color:#ECEFF4;">&gt;</span><span style="color:#D8DEE9;"> sqlDriver</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Class</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forName</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java.sql.Driver</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader</span><span style="color:#D8DEE9;"> classLoader</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> sqlDriver</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$PlatformClassLoader@1f32e575</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sqlDriver class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> classLoader</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sqlDriver parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>应用程序类加载器（AppClassLoader） <ul><li>用于加载应用级别的模块，比如：jdk.compiler、jdk.jartool、jdk.jshell 等等，还加载 classpath 路径中的所有类库</li><li>JDK 8 的应用程序类加载器只加载 classpath 路径中的所有类库</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader01</span><span style="color:#D8DEE9;"> classLoader01</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassLoader01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> classLoader01</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClass</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$AppClassLoader@251a69d7</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> classLoader03</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$PlatformClassLoader@1f32e575</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 parent parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">Class</span><span style="color:#D8DEE9;"> jShell</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Class</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forName</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">jdk.jshell.JShell</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$AppClassLoader@251a69d7</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">jShell class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> jShell</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="用户自定义类加载器" tabindex="-1"><a class="header-anchor" href="#用户自定义类加载器"><span>用户自定义类加载器</span></a></h4><p>是 java,lang.ClassLoader 的子类，用户可以定制类的加载方式，其加载顺序在所有系统类加载器之后</p><h4 id="类加载器的关系" tabindex="-1"><a class="header-anchor" href="#类加载器的关系"><span>类加载器的关系</span></a></h4><p><img src="/blog/img/Snipaste_2021-04-03_22-28-17.png" alt="Snipaste_2021-04-03_22-28-17.png"></p><h3 id="双亲委派模型" tabindex="-1"><a class="header-anchor" href="#双亲委派模型"><span>双亲委派模型</span></a></h3><p>JVM 中的 ClassLoader 通常采用双亲委派模型，要求除了启动类加载器外，其余的类加载器都应该有自己的父级加载器，这个父子关系是组合而不是继承</p><h4 id="工作过程" tabindex="-1"><a class="header-anchor" href="#工作过程"><span>工作过程</span></a></h4><ol><li>一个类加载器接收到类加载请求后，首先搜索它内建加载器定义的所有“具名模块”</li><li>如果找到了合适的模块定义，即该模块中存在该需要加载的类，将会使用该加载器来加载</li><li>如果 class 没有在这些加载器定义的具名模块中找到，那么将会委托给父级加载器，直到启动类加载器</li><li>如果父级加载器反馈它不能完成加载请求，比如在搜索路径下找不到这个类。那子的类加载器才自己来加载</li><li>在类路径下找到的类将成为这些加载器的无名模块</li><li>都没找到抛出 ClassNotFound</li><li>JDK 8 没有模块化，所以直接委派个父加载器</li></ol><h4 id="作用" tabindex="-1"><a class="header-anchor" href="#作用"><span>作用</span></a></h4><ul><li>双亲委派模型对于保证了 Java 程序的稳定运行很重要</li><li>公用且具有一致性的类都只会被加载一次</li><li>对于已经加载的系统级别的类，不管是哪一级别的类都不能再次加载，保证了系统级别的类不会被恶意修改或被覆盖</li></ul><h4 id="其他" tabindex="-1"><a class="header-anchor" href="#其他"><span>其他</span></a></h4><ul><li>实现双亲委派的代码在 java.lang.ClassLoader 的 loadClass() 方法中，如果自定义类加载器的话，推荐覆盖实现 findClass() 方法</li><li>如果有一个类加载器能加载某个类，则该加载器称为定义类加载的，所有能成功返回该类的 Class 的类加载器都被称为初始类加载器</li><li>如果没有指定父加载器，默认就是启动类加载器</li><li>每个类加载器都有自己的命名空间，命名空间由该加载器及其所有父加载器所加载的类构成，不同的命名空间可以出现类的全路径名相同的情况</li><li>运行时包由同一个类加载器的类构成，决定两个类是否属于同一个运行时包，不及要看全路径名是否一样，还要看定义类加载器是否相同，只有属于同一个运行时包的类才能实现相互包内可见</li></ul><h3 id="破坏双亲委派模型" tabindex="-1"><a class="header-anchor" href="#破坏双亲委派模型"><span>破坏双亲委派模型</span></a></h3><ul><li>双亲委派模型的问题：父加载器无法向下识别子加载器加载的资源</li><li>Java 不太完美的解决方式：引入线程上下文类加载器，可以通过 Thread 的 setContextClassLoader() 进行设置</li><li>另一种情况：实现热替换，比如 OSGI 的模块化热部署，它的类加载器不再严格按照双亲委派模型，更多的使用平级的类加载器</li></ul><h3 id="类连接" tabindex="-1"><a class="header-anchor" href="#类连接"><span>类连接</span></a></h3><h4 id="类连接主要验证的内容" tabindex="-1"><a class="header-anchor" href="#类连接主要验证的内容"><span>类连接主要验证的内容</span></a></h4><ul><li>类文件结构检查：按照 JVM 规范规定的类文件结构进行检查</li><li>元数据验证：对字节码描述的信息进行语义分析，保证其符合 Java 语言规范的要求</li><li>字节码验证：通过对数据流和控制流进行分析，确保程序语义是合法和符合逻辑的</li><li>符号引用验证：对类自身以外的信息，即常量池中的各种符号引用，进行匹配校验</li></ul><h4 id="类连接的解析" tabindex="-1"><a class="header-anchor" href="#类连接的解析"><span>类连接的解析</span></a></h4><ul><li>解析是把常量池中的符号引用转换成直接引用的过程，包括：符号引用（以一组无歧义的符号来描述所引用的目标，与虚拟机的实现无关）</li><li>直接引用：直接指向目标的指针、相对偏移量、或能间接定位到目标的句柄，是和虚拟机的实现相关</li><li>主要针对：类、接口、字段、类方法、接口方法、方法类型、方法句柄、调用点限定符</li></ul><h3 id="类的初始化" tabindex="-1"><a class="header-anchor" href="#类的初始化"><span>类的初始化</span></a></h3><p>类的初始化是类的静态变量赋初始值，或者说是执行类构造器 clinit 方法的过程</p><ul><li>如果类还没有加载和连接，就先加载和连接</li><li>如果类存在父类，且父类没有初始化，就先初始化父类</li><li>如果类中存在初始化语句，则会依次执行初始化语句</li><li>如果是接口 <ul><li>初始化一个类的时候，并不会先初始化它的接口</li><li>初始化一个接口时，并不会初始化它的父接口</li><li>只有当程序首次使用接口里面的变量或者调用接口方法的时候，才会导致接口初始化</li></ul></li><li>调用 ClassLoader 类的 loadClass 方法来装载一个类，并不会初始化这个类，这不是对类的主动使用</li></ul><h4 id="初始化的时机" tabindex="-1"><a class="header-anchor" href="#初始化的时机"><span>初始化的时机</span></a></h4><ul><li>Java 程序对类的使用方式分成：主动使用和被动使用，JVM 必须在每个类或接口“首次主动使用”时才初始化它们；被动使用类不会导致类的初始化</li><li>主动使用： <ul><li>创建类实例</li><li>访问某个类或接口的静态变量</li><li>调用类的静态方法</li><li>反射某个类</li><li>某个父类还没有初始化时，初始化父类的子类</li><li>JVM 启动的时候运行的主类</li><li>定义了 default 方法的接口，当接口实现类初始化时</li></ul></li></ul><h4 id="类初始化机制" tabindex="-1"><a class="header-anchor" href="#类初始化机制"><span>类初始化机制</span></a></h4><p>在 Java 中，类的初始化可以分为以下两种情况：</p><ol><li>类的静态初始化：当一个类被加载时，会执行类的静态初始化过程。类的静态初始化会按照以下顺序进行： <ol><li>静态变量的赋值操作：静态变量会按照定义的顺序依次初始化，如果一个静态变量在定义时没有指定初始值，那么它将被赋予默认值。</li><li>静态代码块的执行：如果一个类包含静态代码块，那么这些代码块会在静态变量的初始化之后执行，且按照代码块的顺序执行。</li></ol></li><li>对象的初始化：当一个对象被创建时，会执行对象的初始化过程。对象的初始化会按照以下顺序进行： <ol><li>成员变量的赋值操作：成员变量会按照定义的顺序依次初始化，如果一个成员变量在定义时没有指定初始值，那么它将被赋予默认值。</li><li>构造代码块的执行：如果一个类包含构造代码块，那么这些代码块会在成员变量的初始化之后执行，且按照代码块的顺序执行。</li><li>构造函数的执行：最后，会执行对象的构造函数。</li></ol></li></ol><p>需要注意的是，如果一个类被继承，那么子类的初始化过程中，会先执行父类的初始化过程，然后再执行子类的初始化过程。此外，静态变量和静态代码块只会在类被加载时执行一次，而成员变量和构造代码块会在每次创建对象时都执行</p><h4 id="类初始化顺序" tabindex="-1"><a class="header-anchor" href="#类初始化顺序"><span>类初始化顺序</span></a></h4><p>Java 中，类的初始化顺序可以分为以下三个步骤：</p><ol><li>父类的静态成员变量和静态代码块的初始化，按照代码顺序执行。</li><li>子类的静态成员变量和静态代码块的初始化，按照代码顺序执行。</li><li>父类和子类的实例成员变量和构造函数的初始化，按照代码顺序执行。如果有多个构造函数，则以调用的构造函数为准。</li></ol><p>具体来说，Java 类的初始化顺序如下：</p><ol><li>加载父类的类对象，并初始化其静态成员变量和静态代码块。</li><li>加载子类的类对象，并初始化其静态成员变量和静态代码块。</li><li>创建父类的实例对象，并按照代码顺序初始化其实例成员变量和构造函数。</li><li>创建子类的实例对象，并按照代码顺序初始化其实例成员变量和构造函数。</li></ol><p>需要注意的是，父类和子类的静态成员变量和静态代码块只会在类被加载时执行一次，而实例成员变量和构造函数会在每次创建对象时都执行。另外，如果父类和子类中有同名的成员变量，子类的成员变量会覆盖父类的成员变量</p><h3 id="类的卸载" tabindex="-1"><a class="header-anchor" href="#类的卸载"><span>类的卸载</span></a></h3><ul><li>当代表一个类的 Class 对象不再被引用，那么 Class 对象的生命周期就结束了，对应在方法区中的数据也会被卸载</li><li>JVM 自带的类加载器装载的类，是不会卸载的，由用户自定义的类加载器加载的类是可以被卸载的</li></ul><h1 id="jvm-完全指南" tabindex="-1"><a class="header-anchor" href="#jvm-完全指南"><span>JVM 完全指南</span></a></h1><p>本文档全面介绍 Java 虚拟机（JVM）的核心概念、工作机制、字节码操作、类加载机制等重要内容。</p><h2 id="_1-jvm-基础概念" tabindex="-1"><a class="header-anchor" href="#_1-jvm-基础概念"><span>1. JVM 基础概念</span></a></h2><h3 id="_1-1-jvm-定义与作用" tabindex="-1"><a class="header-anchor" href="#_1-1-jvm-定义与作用"><span>1.1 JVM 定义与作用</span></a></h3><p><strong>JVM（Java Virtual Machine）</strong> 是 Java 虚拟机的简称，是 Java 程序运行的核心环境。</p><h4 id="_1-1-1-基本概念" tabindex="-1"><a class="header-anchor" href="#_1-1-1-基本概念"><span>1.1.1 基本概念</span></a></h4><ul><li><strong>虚拟机定义</strong>：通过软件模拟的具有完整硬件系统功能，并且运行在完全隔离环境中的计算机系统</li><li><strong>JVM 本质</strong>：通过软件模拟 Java 字节码指令集的执行环境</li><li><strong>核心价值</strong>：提供 Java 程序的跨平台运行能力</li></ul><h4 id="_1-1-2-平台无关性实现" tabindex="-1"><a class="header-anchor" href="#_1-1-2-平台无关性实现"><span>1.1.2 平台无关性实现</span></a></h4><ul><li><strong>编译时</strong>：Java 源码编译为平台无关的字节码文件（.class）</li><li><strong>运行时</strong>：JVM 负责将字节码翻译为特定平台的机器码</li><li><strong>关键原理</strong>：JDK 安装包与平台相关，用户编写的 Java 代码与平台无关</li></ul><p><img src="/blog/img/Snipaste_2021-03-23_10-14-34.png" alt="平台无关性示意图"></p><h3 id="_1-2-jvm-架构组成" tabindex="-1"><a class="header-anchor" href="#_1-2-jvm-架构组成"><span>1.2 JVM 架构组成</span></a></h3><p>JVM 主要包含四个核心组件：</p><h4 id="_1-2-1-架构总览" tabindex="-1"><a class="header-anchor" href="#_1-2-1-架构总览"><span>1.2.1 架构总览</span></a></h4><ol><li><strong>类加载器（ClassLoader）</strong>：负责加载.class 文件到内存</li><li><strong>运行时数据区（Runtime Data Area）</strong>：JVM 管理的内存区域</li><li><strong>执行引擎（Execution Engine）</strong>：负责执行字节码指令</li><li><strong>本地库接口（Native Interface）</strong>：与操作系统底层交互</li></ol><p><img src="/blog/img/Snipaste_2021-03-23_10-08-27.png" alt="JVM架构图"></p><h4 id="_1-2-2-核心功能" tabindex="-1"><a class="header-anchor" href="#_1-2-2-核心功能"><span>1.2.2 核心功能</span></a></h4><ol><li><strong>类文件管理</strong>：通过 ClassLoader 寻找和装载 class 文件</li><li><strong>字节码执行</strong>：解释字节码为机器指令并执行，提供 class 文件的运行环境</li><li><strong>内存管理</strong>：进行运行期间的内存分配和垃圾回收</li><li><strong>平台交互</strong>：提供与硬件交互的统一平台接口</li></ol><h2 id="_2-jvm-规范详解" tabindex="-1"><a class="header-anchor" href="#_2-jvm-规范详解"><span>2. JVM 规范详解</span></a></h2><h3 id="_2-1-规范的重要性" tabindex="-1"><a class="header-anchor" href="#_2-1-规范的重要性"><span>2.1 规范的重要性</span></a></h3><h4 id="_2-1-1-规范作用" tabindex="-1"><a class="header-anchor" href="#_2-1-1-规范作用"><span>2.1.1 规范作用</span></a></h4><ul><li><strong>统一标准</strong>：为不同硬件平台提供统一的 Java 技术代码编译规范</li><li><strong>平台独立</strong>：确保 Java 软件能够独立于具体的硬件平台</li><li><strong>语言无关</strong>：任何编程语言只要符合 JVM 规范，都可以在 JVM 上运行</li></ul><h4 id="_2-1-2-核心价值" tabindex="-1"><a class="header-anchor" href="#_2-1-2-核心价值"><span>2.1.2 核心价值</span></a></h4><p>JVM 规范使得&quot;一次编写，到处运行&quot;成为可能，实现了真正的跨平台编程。</p><h3 id="_2-2-规范主要内容" tabindex="-1"><a class="header-anchor" href="#_2-2-规范主要内容"><span>2.2 规范主要内容</span></a></h3><h4 id="_2-2-1-字节码指令集" tabindex="-1"><a class="header-anchor" href="#_2-2-1-字节码指令集"><span>2.2.1 字节码指令集</span></a></h4><ul><li><strong>指令结构</strong>：每条指令由操作码（opcode）和操作数（operand）组成</li><li><strong>操作码</strong>：一个字节长度，代表特定的操作含义</li><li><strong>操作数</strong>：零个或多个参数，提供操作所需的数据</li></ul><h4 id="_2-2-2-核心规范要素" tabindex="-1"><a class="header-anchor" href="#_2-2-2-核心规范要素"><span>2.2.2 核心规范要素</span></a></h4><ol><li><strong>Class 文件格式</strong>：定义字节码文件的标准结构</li><li><strong>数据类型和值</strong>：规定 JVM 支持的数据类型及其表示方法</li><li><strong>运行时数据区</strong>：定义 JVM 内存管理的区域划分</li><li><strong>栈帧结构</strong>：规定方法调用的数据组织形式</li></ol><h4 id="_2-2-3-特殊方法规范" tabindex="-1"><a class="header-anchor" href="#_2-2-3-特殊方法规范"><span>2.2.3 特殊方法规范</span></a></h4><ul><li><strong><code>&lt;init&gt;</code></strong>：实例初始化方法，通过 invokespecial 指令调用</li><li><strong><code>&lt;clinit&gt;</code></strong>：类或接口的初始化方法，无参数，返回 void</li></ul><h4 id="_2-2-4-必需类库支持" tabindex="-1"><a class="header-anchor" href="#_2-2-4-必需类库支持"><span>2.2.4 必需类库支持</span></a></h4><p>JVM 必须提供对以下 Java 类库的支持：</p><ul><li><strong>反射机制</strong>：运行时类型信息和动态调用</li><li><strong>类加载器</strong>：ClassLoader 及相关类的加载和创建</li><li><strong>类连接和初始化</strong>：类生命周期管理</li><li><strong>安全框架</strong>：Security 相关的安全机制</li><li><strong>多线程支持</strong>：并发编程的基础设施</li><li><strong>弱引用</strong>：内存管理的高级特性</li></ul><h4 id="_2-2-5-其他重要规范" tabindex="-1"><a class="header-anchor" href="#_2-2-5-其他重要规范"><span>2.2.5 其他重要规范</span></a></h4><ul><li><strong>异常处理机制</strong>：异常的抛出、捕获和处理规范</li><li><strong>虚拟机生命周期</strong>：启动、加载、链接和初始化的标准流程</li></ul><h2 id="_3-class-文件深入解析" tabindex="-1"><a class="header-anchor" href="#_3-class-文件深入解析"><span>3. Class 文件深入解析</span></a></h2><h3 id="_3-1-class-文件概述" tabindex="-1"><a class="header-anchor" href="#_3-1-class-文件概述"><span>3.1 Class 文件概述</span></a></h3><h4 id="_3-1-1-核心地位" tabindex="-1"><a class="header-anchor" href="#_3-1-1-核心地位"><span>3.1.1 核心地位</span></a></h4><ul><li><strong>JVM 输入</strong>：Class 文件是 JVM 的标准输入格式</li><li><strong>技术基础</strong>：实现 JVM 平台无关、技术无关特性的根本</li><li><strong>字节码载体</strong>：承载 Java 程序编译后的字节码指令</li></ul><h3 id="_3-2-class-文件格式详解" tabindex="-1"><a class="header-anchor" href="#_3-2-class-文件格式详解"><span>3.2 Class 文件格式详解</span></a></h3><h4 id="_3-2-1-基本结构特征" tabindex="-1"><a class="header-anchor" href="#_3-2-1-基本结构特征"><span>3.2.1 基本结构特征</span></a></h4><ul><li><strong>存储单位</strong>：以 8 字节为基本单位的字节流</li><li><strong>排列方式</strong>：各数据项按顺序紧凑排列，无填充字节</li><li><strong>多字节处理</strong>：大于 8 字节的数据项采用高位在前（Big-Endian）的方式分割存储</li></ul><h4 id="_3-2-2-数据类型系统" tabindex="-1"><a class="header-anchor" href="#_3-2-2-数据类型系统"><span>3.2.2 数据类型系统</span></a></h4><p>Class 文件格式采用两种基本数据类型：</p><p><strong>无符号数（基本数据类型）</strong>：</p><ul><li><code>u1</code>：1 字节无符号数</li><li><code>u2</code>：2 字节无符号数</li><li><code>u4</code>：4 字节无符号数</li><li><code>u8</code>：8 字节无符号数</li></ul><p><strong>表（复合数据类型）</strong>：</p><ul><li>由多个无符号数和其他表构成</li><li>命名约定：通常以<code>_info</code>结尾</li><li>用于描述有层次关系的复合结构</li></ul><p><img src="/blog/img/image23141312.png" alt="Class文件格式结构图"></p><h3 id="_3-3-class-文件分析方法" tabindex="-1"><a class="header-anchor" href="#_3-3-class-文件分析方法"><span>3.3 Class 文件分析方法</span></a></h3><h4 id="_3-3-1-分析工具" tabindex="-1"><a class="header-anchor" href="#_3-3-1-分析工具"><span>3.3.1 分析工具</span></a></h4><ul><li><strong>vim 十六进制查看</strong>：使用<code>:%!xxd</code>命令查看二进制内容</li><li><strong>javap 反汇编</strong>：生成人类可读的&quot;虚拟机汇编语言&quot;</li></ul><h4 id="_3-3-2-实战示例" tabindex="-1"><a class="header-anchor" href="#_3-3-2-实战示例"><span>3.3.2 实战示例</span></a></h4><p>以下通过一个简单的 Java 类来演示 Class 文件的结构：</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> test</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> Hello</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    private</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> final</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> msg</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hello world</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">msg</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>编译与分析步骤</strong>：</p><ol><li><code>javac ./test/Hello.java</code> - 编译为 Class 文件</li><li><code>vim ./test/Hello.class</code> - 查看二进制内容</li><li><code>javap -verbose ./test/Hello.class</code> - 查看详细结构</li></ol><details class="hint-container details"><summary>十六进制内容示例</summary><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">00000000:</span><span style="color:#A3BE8C;"> cafe</span><span style="color:#A3BE8C;"> babe</span><span style="color:#B48EAD;"> 0000</span><span style="color:#A3BE8C;"> 003d</span><span style="color:#B48EAD;"> 0020</span><span style="color:#A3BE8C;"> 0a00</span><span style="color:#B48EAD;"> 0200</span><span style="color:#B48EAD;"> 0307</span><span style="color:#A3BE8C;">  .......=.</span><span style="color:#A3BE8C;"> ......</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000010:</span><span style="color:#B48EAD;"> 0004</span><span style="color:#A3BE8C;"> 0c00</span><span style="color:#B48EAD;"> 0500</span><span style="color:#B48EAD;"> 0601</span><span style="color:#B48EAD;"> 0010</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f6c</span><span style="color:#A3BE8C;">  ..........java/l</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000020:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#A3BE8C;"> 672f</span><span style="color:#A3BE8C;"> 4f62</span><span style="color:#A3BE8C;"> 6a65</span><span style="color:#B48EAD;"> 6374</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 063c</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;">  ang/Object...</span><span style="color:#81A1C1;">&lt;</span><span style="color:#A3BE8C;">in</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000030:</span><span style="color:#B48EAD;"> 6974</span><span style="color:#A3BE8C;"> 3e01</span><span style="color:#B48EAD;"> 0003</span><span style="color:#B48EAD;"> 2829</span><span style="color:#B48EAD;"> 5609</span><span style="color:#B48EAD;"> 0008</span><span style="color:#B48EAD;"> 0009</span><span style="color:#B48EAD;"> 0700</span><span style="color:#A3BE8C;">  i</span><span style="color:#D8DEE9FF;">t</span><span style="color:#81A1C1;">&gt;</span><span style="color:#A3BE8C;">...</span><span style="color:#ECEFF4;">()</span><span style="color:#A3BE8C;">V.......</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000040:</span><span style="color:#A3BE8C;"> 0a0c</span><span style="color:#A3BE8C;"> 000b</span><span style="color:#A3BE8C;"> 000c</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 106a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 6c61</span><span style="color:#A3BE8C;">  .........java/la</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000050:</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;"> 2f53</span><span style="color:#B48EAD;"> 7973</span><span style="color:#B48EAD;"> 7465</span><span style="color:#A3BE8C;"> 6d01</span><span style="color:#B48EAD;"> 0003</span><span style="color:#A3BE8C;"> 6f75</span><span style="color:#B48EAD;"> 7401</span><span style="color:#A3BE8C;">  ng/System...out.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000060:</span><span style="color:#B48EAD;"> 0015</span><span style="color:#A3BE8C;"> 4c6a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 696f</span><span style="color:#A3BE8C;"> 2f50</span><span style="color:#B48EAD;"> 7269</span><span style="color:#A3BE8C;"> 6e74</span><span style="color:#A3BE8C;">  ..Ljava/io/Print</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000070:</span><span style="color:#B48EAD;"> 5374</span><span style="color:#B48EAD;"> 7265</span><span style="color:#A3BE8C;"> 616d</span><span style="color:#A3BE8C;"> 3b07</span><span style="color:#A3BE8C;"> 000e</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0a74</span><span style="color:#B48EAD;"> 6573</span><span style="color:#A3BE8C;">  Stream</span><span style="color:#81A1C1;">;</span><span style="color:#88C0D0;">.....</span><span style="color:#A3BE8C;">.tes</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000080:</span><span style="color:#A3BE8C;"> 742f</span><span style="color:#B48EAD;"> 4865</span><span style="color:#A3BE8C;"> 6c6c</span><span style="color:#A3BE8C;"> 6f08</span><span style="color:#B48EAD;"> 0010</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0b68</span><span style="color:#A3BE8C;"> 656c</span><span style="color:#A3BE8C;">  t/Hello......hel</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000090:</span><span style="color:#A3BE8C;"> 6c6f</span><span style="color:#B48EAD;"> 2077</span><span style="color:#A3BE8C;"> 6f72</span><span style="color:#A3BE8C;"> 6c64</span><span style="color:#A3BE8C;"> 0a00</span><span style="color:#B48EAD;"> 1200</span><span style="color:#B48EAD;"> 1307</span><span style="color:#B48EAD;"> 0014</span><span style="color:#A3BE8C;">  lo</span><span style="color:#A3BE8C;"> world........</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000a0:</span><span style="color:#A3BE8C;"> 0c00</span><span style="color:#B48EAD;"> 1500</span><span style="color:#B48EAD;"> 1601</span><span style="color:#B48EAD;"> 0013</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f69</span><span style="color:#A3BE8C;"> 6f2f</span><span style="color:#A3BE8C;">  ........java/io/</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000b0:</span><span style="color:#B48EAD;"> 5072</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#B48EAD;"> 7453</span><span style="color:#B48EAD;"> 7472</span><span style="color:#B48EAD;"> 6561</span><span style="color:#A3BE8C;"> 6d01</span><span style="color:#B48EAD;"> 0007</span><span style="color:#B48EAD;"> 7072</span><span style="color:#A3BE8C;">  PrintStream...pr</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000c0:</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;"> 746c</span><span style="color:#A3BE8C;"> 6e01</span><span style="color:#B48EAD;"> 0015</span><span style="color:#A3BE8C;"> 284c</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#B48EAD;"> 7661</span><span style="color:#A3BE8C;"> 2f6c</span><span style="color:#A3BE8C;">  intln...</span><span style="color:#ECEFF4;">(</span><span style="color:#88C0D0;">Ljava/l</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000d0:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#A3BE8C;"> 672f</span><span style="color:#B48EAD;"> 5374</span><span style="color:#B48EAD;"> 7269</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;"> 3b29</span><span style="color:#B48EAD;"> 5601</span><span style="color:#B48EAD;"> 0003</span><span style="color:#A3BE8C;">  ang/String</span><span style="color:#81A1C1;">;</span><span style="color:#ECEFF4;">)</span><span style="color:#A3BE8C;">V...</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000e0:</span><span style="color:#A3BE8C;"> 6d73</span><span style="color:#B48EAD;"> 6701</span><span style="color:#B48EAD;"> 0012</span><span style="color:#A3BE8C;"> 4c6a</span><span style="color:#B48EAD;"> 6176</span><span style="color:#A3BE8C;"> 612f</span><span style="color:#A3BE8C;"> 6c61</span><span style="color:#A3BE8C;"> 6e67</span><span style="color:#A3BE8C;">  msg...Ljava/lang</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">000000f0:</span><span style="color:#A3BE8C;"> 2f53</span><span style="color:#B48EAD;"> 7472</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#A3BE8C;"> 673b</span><span style="color:#B48EAD;"> 0100</span><span style="color:#A3BE8C;"> 0d43</span><span style="color:#A3BE8C;"> 6f6e</span><span style="color:#B48EAD;"> 7374</span><span style="color:#A3BE8C;">  /String</span><span style="color:#81A1C1;">;</span><span style="color:#88C0D0;">..</span><span style="color:#A3BE8C;">.Const</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000100:</span><span style="color:#A3BE8C;"> 616e</span><span style="color:#B48EAD;"> 7456</span><span style="color:#A3BE8C;"> 616c</span><span style="color:#B48EAD;"> 7565</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 0443</span><span style="color:#A3BE8C;"> 6f64</span><span style="color:#B48EAD;"> 6501</span><span style="color:#A3BE8C;">  antValue...Code.</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000110:</span><span style="color:#A3BE8C;"> 000f</span><span style="color:#A3BE8C;"> 4c69</span><span style="color:#A3BE8C;"> 6e65</span><span style="color:#A3BE8C;"> 4e75</span><span style="color:#A3BE8C;"> 6d62</span><span style="color:#B48EAD;"> 6572</span><span style="color:#B48EAD;"> 5461</span><span style="color:#A3BE8C;"> 626c</span><span style="color:#A3BE8C;">  ..LineNumberTabl</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">00000120:</span><span style="color:#B48EAD;"> 6501</span><span style="color:#B48EAD;"> 0004</span><span style="color:#A3BE8C;"> 6d61</span><span style="color:#A3BE8C;"> 696e</span><span style="color:#B48EAD;"> 0100</span><span style="color:#B48EAD;"> 1628</span><span style="color:#A3BE8C;"> 5b4c</span><span style="color:#A3BE8C;"> 6a61</span><span style="color:#A3BE8C;">  e...main...</span><span style="color:#ECEFF4;">([</span><span style="color:#D8DEE9FF;">Lja</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000130: </span><span style="color:#B48EAD;">7661</span><span style="color:#D8DEE9FF;"> 2f6c 616e 672f </span><span style="color:#B48EAD;">5374</span><span style="color:#B48EAD;"> 7269</span><span style="color:#D8DEE9FF;"> 6e67 3b29  va/lang/String</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000140: </span><span style="color:#B48EAD;">5601</span><span style="color:#D8DEE9FF;"> 000a 536f </span><span style="color:#B48EAD;">7572</span><span style="color:#B48EAD;"> 6365</span><span style="color:#B48EAD;"> 4669</span><span style="color:#D8DEE9FF;"> 6c65 </span><span style="color:#B48EAD;">0100</span><span style="color:#D8DEE9FF;">  V...SourceFile..</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">00000150: 0a48 656c 6c6f 2e6a </span><span style="color:#B48EAD;">6176</span><span style="color:#B48EAD;"> 6100</span><span style="color:#B48EAD;"> 2100</span><span style="color:#D8DEE9FF;"> 0d00  .Hello.java.</span><span style="color:#81A1C1;">!</span><span style="color:#D8DEE9FF;">...</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p><strong>关键信息解读</strong>：</p><ul><li><code>CAFEBABE</code>：Class 文件魔数，标识这是一个有效的 Class 文件</li><li>版本信息：主版本号和次版本号</li><li>常量池：存储字符串常量、类和接口名、字段和方法信息 00000160: 0200 0000 0100 1a00 1700 1800 0100 1900 ................ 00000170: 0000 0200 0f00 0200 0100 0500 0600 0100 ................ 00000180: 1a00 0000 1d00 0100 0100 0000 052a b700 .............*.. 00000190: 01b1 0000 0001 001b 0000 0006 0001 0000 ................ 000001a0: 0003 0009 001c 001d 0001 001a 0000 0025 ...............% 000001b0: 0002 0001 0000 0009 b200 0712 0fb6 0011 ................ 000001c0: b100 0000 0100 1b00 0000 0a00 0200 0000 ................ 000001d0: 0700 0800 0800 0100 1e00 0000 0200 1f0a ................</li></ul><div class="language-text line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-text;"><code><span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>:::</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>3. 使用 javap -verbose ./test/Hello.class 查看 class 文件解析后的内容</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>::: details 点击查看代码</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>```java</span></span></span>
<span class="line"><span class="line"><span>Classfile /Users/xxx/test/Hello.class</span></span></span>
<span class="line"><span class="line"><span>  Last modified 2023年3月27日; size 479 bytes</span></span></span>
<span class="line"><span class="line"><span>  SHA-256 checksum 8f00f7dfcd98f34e709426dd8e2311c216f576cbd02bbea3cf189562d56523c9</span></span></span>
<span class="line"><span class="line"><span>  Compiled from &quot;Hello.java&quot;</span></span></span>
<span class="line"><span class="line"><span>::: details javap详细输出示例</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>```java</span></span></span>
<span class="line"><span class="line"><span>Classfile /Users/xxx/test/Hello.class</span></span></span>
<span class="line"><span class="line"><span>  Last modified 2023年3月27日; size 479 bytes</span></span></span>
<span class="line"><span class="line"><span>  SHA-256 checksum 8f00f7dfcd98f34e709426dd8e2311c216f576cbd02bbea3cf189562d56523c9</span></span></span>
<span class="line"><span class="line"><span>  Compiled from &quot;Hello.java&quot;</span></span></span>
<span class="line"><span class="line"><span>public class test.Hello</span></span></span>
<span class="line"><span class="line"><span>  minor version: 0</span></span></span>
<span class="line"><span class="line"><span>  major version: 61</span></span></span>
<span class="line"><span class="line"><span>  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span></span></span>
<span class="line"><span class="line"><span>  this_class: #13                         // test/Hello</span></span></span>
<span class="line"><span class="line"><span>  super_class: #2                         // java/lang/Object</span></span></span>
<span class="line"><span class="line"><span>  interfaces: 0, fields: 1, methods: 2, attributes: 1</span></span></span>
<span class="line"><span class="line"><span>Constant pool:</span></span></span>
<span class="line"><span class="line"><span>   #1 = Methodref          #2.#3          // java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span>   #2 = Class              #4             // java/lang/Object</span></span></span>
<span class="line"><span class="line"><span>   #3 = NameAndType        #5:#6          // &quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span>   #4 = Utf8               java/lang/Object</span></span></span>
<span class="line"><span class="line"><span>   #5 = Utf8               &lt;init&gt;</span></span></span>
<span class="line"><span class="line"><span>   #6 = Utf8               ()V</span></span></span>
<span class="line"><span class="line"><span>   #7 = Fieldref           #8.#9          // java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span>   #8 = Class              #10            // java/lang/System</span></span></span>
<span class="line"><span class="line"><span>   #9 = NameAndType        #11:#12        // out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span>  #10 = Utf8               java/lang/System</span></span></span>
<span class="line"><span class="line"><span>  #11 = Utf8               out</span></span></span>
<span class="line"><span class="line"><span>  #12 = Utf8               Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span>  #13 = Class              #14            // test/Hello</span></span></span>
<span class="line"><span class="line"><span>  #14 = Utf8               test/Hello</span></span></span>
<span class="line"><span class="line"><span>  #15 = String             #16            // hello world</span></span></span>
<span class="line"><span class="line"><span>  #16 = Utf8               hello world</span></span></span>
<span class="line"><span class="line"><span>  #17 = Methodref          #18.#19        // java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>  #18 = Class              #20            // java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span>  #19 = NameAndType        #21:#22        // println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>  #20 = Utf8               java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span>  #21 = Utf8               println</span></span></span>
<span class="line"><span class="line"><span>  #22 = Utf8               (Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>  #23 = Utf8               msg</span></span></span>
<span class="line"><span class="line"><span>  #24 = Utf8               Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span>  #25 = Utf8               ConstantValue</span></span></span>
<span class="line"><span class="line"><span>  #26 = Utf8               Code</span></span></span>
<span class="line"><span class="line"><span>  #27 = Utf8               LineNumberTable</span></span></span>
<span class="line"><span class="line"><span>  #28 = Utf8               main</span></span></span>
<span class="line"><span class="line"><span>  #29 = Utf8               ([Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>  #30 = Utf8               SourceFile</span></span></span>
<span class="line"><span class="line"><span>  #31 = Utf8               Hello.java</span></span></span>
<span class="line"><span class="line"><span>{</span></span></span>
<span class="line"><span class="line"><span>  public test.Hello();</span></span></span>
<span class="line"><span class="line"><span>    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span>    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span>    Code:</span></span></span>
<span class="line"><span class="line"><span>      stack=1, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span>         0: aload_0</span></span></span>
<span class="line"><span class="line"><span>         1: invokespecial #1                  // Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span>         4: return</span></span></span>
<span class="line"><span class="line"><span>      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span>        line 3: 0</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>  public static void main(java.lang.String[]);</span></span></span>
<span class="line"><span class="line"><span>    descriptor: ([Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>    flags: (0x0009) ACC_PUBLIC, ACC_STATIC</span></span></span>
<span class="line"><span class="line"><span>    Code:</span></span></span>
<span class="line"><span class="line"><span>      stack=2, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span>         0: getstatic     #7                  // Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span>         3: ldc           #15                 // String hello world</span></span></span>
<span class="line"><span class="line"><span>         5: invokevirtual #17                 // Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span>         8: return</span></span></span>
<span class="line"><span class="line"><span>      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span>        line 7: 0</span></span></span>
<span class="line"><span class="line"><span>        line 8: 8</span></span></span>
<span class="line"><span class="line"><span>}</span></span></span>
<span class="line"><span class="line"><span>SourceFile: &quot;Hello.java&quot;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><h3 id="_3-4-class-字节码结构详解" tabindex="-1"><a class="header-anchor" href="#_3-4-class-字节码结构详解"><span>3.4 Class 字节码结构详解</span></a></h3><h4 id="_3-4-1-常量池-constant-pool" tabindex="-1"><a class="header-anchor" href="#_3-4-1-常量池-constant-pool"><span>3.4.1 常量池（Constant Pool）</span></a></h4><p>常量池是 Class 文件的重要组成部分，包含以下信息：</p><p><strong>常量类型</strong>：</p><ul><li><strong>字面量</strong>：文本字符串、final 常量值等</li><li><strong>符号引用</strong>： <ul><li>类和接口的全限定名</li><li>字段的名称和描述符</li><li>方法的名称和描述符</li></ul></li></ul><p><strong>设计优势</strong>：</p><ul><li>节省空间：相同常量只存储一份</li><li>提高效率：通过索引快速访问</li><li>支持动态链接：符号引用在运行时解析</li></ul><blockquote><p>💡 <strong>详细内容参考</strong>：请查阅官方 JVM 规范获取常量池的完整定义和所有常量类型</p></blockquote><h4 id="_3-4-2-类定义和属性" tabindex="-1"><a class="header-anchor" href="#_3-4-2-类定义和属性"><span>3.4.2 类定义和属性</span></a></h4><p><strong>属性通用格式</strong>：</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">attribute_info </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 attribute_name_index</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">    // 属性名称索引</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u4 attribute_length</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">        // 属性长度</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u1 info</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">attribute_length</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">  // 属性信息</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>重要属性类型</strong>：</p><ul><li><code>Code</code>：方法的字节码指令</li><li><code>ConstantValue</code>：final 常量的值</li><li><code>SourceFile</code>：源文件名称</li><li><code>LineNumberTable</code>：行号映射表</li></ul><h4 id="_3-4-3-方法结构" tabindex="-1"><a class="header-anchor" href="#_3-4-3-方法结构"><span>3.4.3 方法结构</span></a></h4><p><strong>方法通用格式</strong>：</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">method_info </span><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 access_flags</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">               // 访问标志</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 name_index</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">                 // 方法名索引</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 descriptor_index</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">           // 方法描述符索引</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    u2 attributes_count</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;">           // 属性计数</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    attribute_info attributes</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">attributes_count</span><span style="color:#ECEFF4;">]</span><span style="color:#81A1C1;">;</span><span style="color:#616E88;"> // 属性表</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>关键信息解读</strong>：</p><ul><li><code>access_flags</code>：访问修饰符（public、private、static 等）</li><li><code>descriptor</code>：方法签名，包含参数类型和返回值类型</li><li><code>Code属性</code>：包含具体的字节码指令序列</li></ul><blockquote><p>📚 <strong>深入学习</strong>：建议阅读官方 JVM 规范以获取完整的 Class 文件格式定义</p></blockquote><h2 id="_4-asm-字节码操作框架" tabindex="-1"><a class="header-anchor" href="#_4-asm-字节码操作框架"><span>4. ASM 字节码操作框架</span></a></h2><h3 id="_4-1-asm-框架概述" tabindex="-1"><a class="header-anchor" href="#_4-1-asm-框架概述"><span>4.1 ASM 框架概述</span></a></h3><h4 id="_4-1-1-核心功能" tabindex="-1"><a class="header-anchor" href="#_4-1-1-核心功能"><span>4.1.1 核心功能</span></a></h4><p><strong>ASM</strong>是一个强大的 Java 字节码操作框架，主要用于：</p><ul><li><strong>动态生成类</strong>：在运行时创建新的类文件</li><li><strong>增强既有类</strong>：修改现有类的行为和功能</li><li><strong>字节码分析</strong>：深入分析类文件的结构和内容</li></ul><h4 id="_4-1-2-技术特点" tabindex="-1"><a class="header-anchor" href="#_4-1-2-技术特点"><span>4.1.2 技术特点</span></a></h4><ul><li><strong>直接操作</strong>：可以直接产生二进制 class 文件</li><li><strong>动态修改</strong>：在类被加载入虚拟机之前动态改变类行为</li><li><strong>全面支持</strong>：能够读取、分析、修改和生成 class 文件</li><li><strong>广泛应用</strong>：被 CGLib、Hibernate、Spring 等知名框架广泛使用</li></ul><h3 id="_4-2-asm-编程模型" tabindex="-1"><a class="header-anchor" href="#_4-2-asm-编程模型"><span>4.2 ASM 编程模型</span></a></h3><p>ASM 提供两种不同的编程模型，各有特点：</p><h4 id="_4-2-1-core-api-核心-api" tabindex="-1"><a class="header-anchor" href="#_4-2-1-core-api-核心-api"><span>4.2.1 Core API（核心 API）</span></a></h4><p><strong>特性</strong>：</p><ul><li><strong>事件驱动</strong>：基于事件形式的编程模型</li><li><strong>流式处理</strong>：不需要将整个类结构一次性读入内存</li><li><strong>高性能</strong>：速度快，内存占用少</li><li><strong>高难度</strong>：编程复杂度较高，需要深入了解字节码结构</li></ul><p><strong>适用场景</strong>：</p><ul><li>对性能要求极高的应用</li><li>内存受限的环境</li><li>简单的字节码修改操作</li></ul><h4 id="_4-2-2-tree-api-树形-api" tabindex="-1"><a class="header-anchor" href="#_4-2-2-tree-api-树形-api"><span>4.2.2 Tree API（树形 API）</span></a></h4><p><strong>特性</strong>：</p><ul><li><strong>对象模型</strong>：基于树形结构的编程模型</li><li><strong>内存加载</strong>：需要将完整类结构读入内存</li><li><strong>易于使用</strong>：编程相对简单，API 更加直观</li><li><strong>内存消耗</strong>：需要更多内存空间</li></ul><p><strong>适用场景</strong>：</p><ul><li>复杂的字节码操作</li><li>需要多次访问和修改的场景</li><li>开发和调试阶段</li></ul><h3 id="_4-3-core-api-核心组件" tabindex="-1"><a class="header-anchor" href="#_4-3-core-api-核心组件"><span>4.3 Core API 核心组件</span></a></h3><h4 id="_4-3-1-核心类介绍" tabindex="-1"><a class="header-anchor" href="#_4-3-1-核心类介绍"><span>4.3.1 核心类介绍</span></a></h4><p><strong>ClassVisitor 接口</strong>：</p><ul><li>ASM 操作字节码的核心接口</li><li>每个方法对应 class 文件中的一项内容</li><li>采用访问者模式设计</li></ul><h4 id="_4-3-2-三大核心类" tabindex="-1"><a class="header-anchor" href="#_4-3-2-三大核心类"><span>4.3.2 三大核心类</span></a></h4><p><strong>ClassReader</strong>：</p><ul><li><strong>功能</strong>：解析现有类的字节码</li><li><strong>作用</strong>：读取.class 文件并解析其结构</li><li><strong>使用</strong>：作为字节码处理的数据源</li></ul><p><strong>ClassWriter</strong>：</p><ul><li><strong>功能</strong>：生成新的字节码</li><li><strong>作用</strong>：输出修改后的字节码内容</li><li><strong>使用</strong>：作为字节码处理的输出目标</li></ul><p><strong>ClassAdapter/ClassVisitor</strong>：</p><ul><li><strong>功能</strong>：修改和转换字节码</li><li><strong>作用</strong>：在读取和写入之间进行处理</li><li><strong>使用</strong>：实现具体的字节码修改逻辑</li></ul><h3 id="_4-4-asmifier-工具" tabindex="-1"><a class="header-anchor" href="#_4-4-asmifier-工具"><span>4.4 ASMifier 工具</span></a></h3><h4 id="_4-4-1-工具介绍" tabindex="-1"><a class="header-anchor" href="#_4-4-1-工具介绍"><span>4.4.1 工具介绍</span></a></h4><p><strong>ASMifier</strong>是 ASM 提供的实用工具，能够将现有的 Java 类转换为对应的 ASM 代码。</p><h4 id="_4-4-2-使用方式" tabindex="-1"><a class="header-anchor" href="#_4-4-2-使用方式"><span>4.4.2 使用方式</span></a></h4><p><strong>命令行工具</strong>：</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">java</span><span style="color:#A3BE8C;"> -cp</span><span style="color:#A3BE8C;"> .:../lib/asm-9.1.jar:../lib/asm-util-9.1.jar</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">     org.objectweb.asm.util.ASMifier</span><span style="color:#A3BE8C;"> com.hyfly.asm.TargetClass</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>IDE 插件</strong>（推荐）：</p><ul><li><strong>ASM Bytecode Outline</strong>：轻量级 ASM 代码生成</li><li><strong>ASM Bytecode Viewer</strong>：功能全面的 ASM 分析工具</li></ul><h4 id="_4-4-3-实战示例" tabindex="-1"><a class="header-anchor" href="#_4-4-3-实战示例"><span>4.4.3 实战示例</span></a></h4><p><strong>目标类</strong>：</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * ASM字节码操作示例类</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * </span><span style="color:#8FBCBB;">@author</span><span style="color:#616E88;"> flyhy</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 --------</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">endTime </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> startTime</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ASMifier 生成的代码</strong>：</p><details class="hint-container details"><summary>ASMifier 生成的完整代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#81A1C1;">*;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClassDump</span><span style="color:#81A1C1;"> implements</span><span style="color:#8FBCBB;font-weight:bold;"> Opcodes</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#88C0D0;"> dump</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FieldVisitor</span><span style="color:#D8DEE9;"> fieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        AnnotationVisitor</span><span style="color:#D8DEE9;"> annotationVisitor0</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">V17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> ACC_PUBLIC </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_SUPER</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">                         null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitSource</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass.java</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // 构造方法</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESPECIAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // ... 更多字节码指令</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // fun01方法</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fun01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 异常处理标签</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label2</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitTryCatchBlock</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 方法体字节码</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // ... 更多字节码指令</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h3 id="_4-5-asm-实战演示" tabindex="-1"><a class="header-anchor" href="#_4-5-asm-实战演示"><span>4.5 ASM 实战演示</span></a></h3><p><strong>完整代码参考</strong>：<a href="https://github.com/hyfly233/jvm-test" target="_blank" rel="noopener noreferrer">GitHub 项目链接</a></p><h4 id="_4-5-1-演示案例一-方法执行时间统计-错误示例" tabindex="-1"><a class="header-anchor" href="#_4-5-1-演示案例一-方法执行时间统计-错误示例"><span>4.5.1 演示案例一：方法执行时间统计（错误示例）</span></a></h4><p><strong>⚠️ 注意</strong>：此示例存在问题，用于演示常见错误</p><p><strong>目标类</strong>：</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">/**</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * 被增强的目标类</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> * </span><span style="color:#8FBCBB;">@author</span><span style="color:#616E88;"> flyhy</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"> */</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> MyClassVisiter 代码如下</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">:::</span><span style="color:#D8DEE9FF;"> details 点击查看代码</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">```java</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#81A1C1;">*;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyClassVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> ClassVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#D8DEE9;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visit</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> version</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">version</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#8FBCBB;"> MethodVisitor</span><span style="color:#88C0D0;"> visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> mv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#ECEFF4;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">equals</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> mv </span><span style="color:#81A1C1;">!=</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 为这种方法增加记录执行时间的功能</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            mv </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">mv</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9FF;"> mv</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    static</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyMethodVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> MethodVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法开始处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法返回处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            if</span><span style="color:#ECEFF4;"> ((</span><span style="color:#D8DEE9FF;">opcode </span><span style="color:#81A1C1;">&gt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">IRETURN</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> ||</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">==</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ATHROW</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">                // 下面的代码是通过 ASM Bytecode Viewer 生成的 ASM 文件中复制出来的</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">currentTimeMillis</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()J</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">                Label</span><span style="color:#D8DEE9;"> label7</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">20</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LLOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">LSUB</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInvokeDynamicInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)Ljava/lang/String;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Handle</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">H_INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/invoke/StringConcatFactory</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">makeConcatWithConstants</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">),</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#EBCB8B;">\u</span><span style="color:#A3BE8C;">0001</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">                Label</span><span style="color:#D8DEE9;"> label8</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">21</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>:::</p><ul><li>Generator 代码如下</li></ul><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassReader</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassWriter</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> java</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">io</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">File</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> java</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">io</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">FileOutputStream</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> Generator</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassReader</span><span style="color:#D8DEE9;"> cr</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassReader</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> cw</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">ClassWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">COMPUTE_MAXS</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassVisitor</span><span style="color:#D8DEE9;"> cv</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">cw</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cr</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">accept</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">cv</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9;"> ClassReader</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">SKIP_DEBUG</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> data</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cw</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">        // 输出到文件</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        File</span><span style="color:#D8DEE9;"> file</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> File</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">/Users/flyhy/workspace/jvm-test/asm/bin/com/hyfly/asm/TargetClass.class</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FileOutputStream</span><span style="color:#D8DEE9;"> fileOutputStream</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> FileOutputStream</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">file</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        fileOutputStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">write</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">data</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        fileOutputStream</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">close</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><p>执行 Generator 中的 main 方法生成 TargetClass.class 文件，并通过 idea 打开得到的内容为，能清楚的看到代码 13 行是错误的</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Source code recreated from a .class file by IntelliJ IDEA</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// (powered by FernFlower decompiler)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        InterruptedException</span><span style="color:#D8DEE9;"> var1</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> var5</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            var1 </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> var5</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            var5</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> var3</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">var3 </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> var1</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用 javap -verbose 命令得到的内容</p><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">Classfile </span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">Users</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">flyhy</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">workspace</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">jvm</span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;">test</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">asm</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">bin</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">com</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">hyfly</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">asm</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9;">TargetClass</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">class</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  Last</span><span style="color:#D8DEE9FF;"> modified 2023年4月1日</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;"> size </span><span style="color:#B48EAD;">961</span><span style="color:#D8DEE9FF;"> bytes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  SHA</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">256</span><span style="color:#D8DEE9FF;"> checksum 5fd3906b265448870bbff62db9ed106d9527d38b2b43f5d305ecf51992b68e4c</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> com</span><span style="color:#D8DEE9FF;">.hyfly.asm.TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  minor version: 0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  major version: 61</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  flags: (0x0021) ACC_PUBLIC, ACC_SUPER</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  this_class: #2                          </span><span style="color:#616E88;">// com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  super_class: #4                         </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  interfaces: 0, fields: 0, methods: 2, attributes: 1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Constant pool:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #1 = Utf8               com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #2 = Class              #1             </span><span style="color:#616E88;">// com/hyfly/asm/TargetClass</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #3 = Utf8               java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #4 = Class              #3             </span><span style="color:#616E88;">// java/lang/Object</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #5 = Utf8               </span><span style="color:#ECEFF4;">&lt;</span><span style="color:#8FBCBB;">init</span><span style="color:#ECEFF4;">&gt;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #6 = Utf8               ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #7 = NameAndType        #5:#6          </span><span style="color:#616E88;">// &quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #8 = Methodref          #4.#7          </span><span style="color:#616E88;">// java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   #9 = Utf8               fun01</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #10 = Utf8               java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #11 = Class              #10            </span><span style="color:#616E88;">// java/lang/System</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #12 = Utf8               currentTimeMillis</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #13 = Utf8               ()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #14 = NameAndType        #12:#13        </span><span style="color:#616E88;">// currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #15 = Methodref          #11.#14        </span><span style="color:#616E88;">// java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #16 = Utf8               java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #17 = Class              #16            </span><span style="color:#616E88;">// java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #18 = Long               100l</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #20 = Utf8               java/lang/Thread</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #21 = Class              #20            </span><span style="color:#616E88;">// java/lang/Thread</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #22 = Utf8               sleep</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #23 = Utf8               (J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #24 = NameAndType        #22:#23        </span><span style="color:#616E88;">// sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #25 = Methodref          #21.#24        </span><span style="color:#616E88;">// java/lang/Thread.sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #26 = Utf8               out</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #27 = Utf8               Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #28 = NameAndType        #26:#27        </span><span style="color:#616E88;">// out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #29 = Fieldref           #11.#28        </span><span style="color:#616E88;">// java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #30 = Utf8               TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #31 = String             #30            </span><span style="color:#616E88;">// TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #32 = Utf8               java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #33 = Class              #32            </span><span style="color:#616E88;">// java/io/PrintStream</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #34 = Utf8               println</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #35 = Utf8               (Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #36 = NameAndType        #34:#35        </span><span style="color:#616E88;">// println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #37 = Methodref          #33.#36        </span><span style="color:#616E88;">// java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #38 = Utf8               printStackTrace</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #39 = NameAndType        #38:#6         </span><span style="color:#616E88;">// printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #40 = Methodref          #17.#39        </span><span style="color:#616E88;">// java/lang/InterruptedException.printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #41 = Utf8               TargetClass#fun01 cost: \u0001</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #42 = String             #41            </span><span style="color:#616E88;">// TargetClass#fun01 cost: \u0001</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #43 = Utf8               java/lang/invoke/StringConcatFactory</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #44 = Class              #43            </span><span style="color:#616E88;">// java/lang/invoke/StringConcatFactory</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #45 = Utf8               makeConcatWithConstants</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #46 = Utf8               (Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #47 = NameAndType        #45:#46        </span><span style="color:#616E88;">// makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #48 = Methodref          #44.#47        </span><span style="color:#616E88;">// java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #49 = MethodHandle       6:#48          </span><span style="color:#616E88;">// REF_invokeStatic java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup;Ljava/lang/String;Ljava/lang/invoke/MethodType;Ljava/lang/String;[Ljava/lang/Object;)Ljava/lang/invoke/CallSite;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #50 = Utf8               (J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #51 = NameAndType        #45:#50        </span><span style="color:#616E88;">// makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #52 = InvokeDynamic      #0:#51         </span><span style="color:#616E88;">// #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #53 = Utf8               Code</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #54 = Utf8               StackMapTable</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #55 = Utf8               LineNumberTable</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  #56 = Utf8               BootstrapMethods</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#D8DEE9FF;"> com.hyfly.asm.</span><span style="color:#88C0D0;">TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=1, locals=1, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: aload_0</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         1: invokespecial #8                  </span><span style="color:#616E88;">// Method java/lang/Object.&quot;&lt;init&gt;&quot;:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         4: return</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    descriptor: ()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    flags: (0x0001) ACC_PUBLIC</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    Code:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      stack=5, locals=5, args_size=1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         0: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         3: lstore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         4: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         7: lstore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         8: ldc2_w        #18                 </span><span style="color:#616E88;">// long 100l</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        11: invokestatic  #25                 </span><span style="color:#616E88;">// Method java/lang/Thread.sleep:(J)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        14: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        17: ldc           #31                 </span><span style="color:#616E88;">// String TargetClass#fun01 run</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        19: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        22: goto          30</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        25: astore_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        26: aload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        27: invokevirtual #40                 </span><span style="color:#616E88;">// Method java/lang/InterruptedException.printStackTrace:()V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        30: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        33: lstore_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        34: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        37: lload_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        38: lload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        39: lsub</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        40: invokedynamic #52,  0             </span><span style="color:#616E88;">// InvokeDynamic #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        45: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        48: invokestatic  #15                 </span><span style="color:#616E88;">// Method java/lang/System.currentTimeMillis:()J</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        51: lstore_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        52: getstatic     #29                 </span><span style="color:#616E88;">// Field java/lang/System.out:Ljava/io/PrintStream;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        55: lload_3</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        56: lload_1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        57: lsub</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        58: invokedynamic #52,  0             </span><span style="color:#616E88;">// InvokeDynamic #0:makeConcatWithConstants:(J)Ljava/lang/String;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        63: invokevirtual #37                 </span><span style="color:#616E88;">// Method java/io/PrintStream.println:(Ljava/lang/String;)V</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        66: return</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      Exception table:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">         from    to  target type</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">             8    22    25   Class java/lang/InterruptedException</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      StackMapTable: number_of_entries = 2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        frame_type = 89 </span><span style="color:#616E88;">/* same_locals_1_stack_item */</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">          stack = [ class java/lang/InterruptedException ]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        frame_type = 4 </span><span style="color:#616E88;">/* same */</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      LineNumberTable:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 20: 52</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        line 21: 66</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">BootstrapMethods</span><span style="color:#81A1C1;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  0: #49 REF_invokeStatic java/lang/invoke/StringConcatFactory.makeConcatWithConstants:(Ljava/lang/invoke/MethodHandles$Lookup</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">String</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">invoke</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">MethodType</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">String</span><span style="color:#81A1C1;">;</span><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">Object</span><span style="color:#81A1C1;">;</span><span style="color:#D8DEE9FF;">)Ljava</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">lang</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">invoke</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">CallSite</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    Method</span><span style="color:#D8DEE9;"> arguments</span><span style="color:#81A1C1;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">      #</span><span style="color:#B48EAD;">42</span><span style="color:#D8DEE9FF;"> TargetClass#fun01 cost</span><span style="color:#81A1C1;">:</span><span style="color:#D8DEE9FF;"> \u0001</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h5 id="测试生成的-targetclass-class-1" tabindex="-1"><a class="header-anchor" href="#测试生成的-targetclass-class-1"><span>测试生成的 TargetClass.class</span></a></h5><p>将生成的 TargetClass.class 文件替换 target 文件夹中的 TargetClass.class 文件，执行 TestTargetClass 的 main() 方法将报错</p><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TestTargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> main</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> args</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        TargetClass</span><span style="color:#D8DEE9;"> targetClass</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        targetClass</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>报错信息</p><div class="language-text line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="text" data-title="text"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-text;"><code><span class="line"><span class="line"><span>Exception in thread &quot;main&quot; java.lang.VerifyError: Bad local variable type</span></span></span>
<span class="line"><span class="line"><span>Exception Details:</span></span></span>
<span class="line"><span class="line"><span>  Location:</span></span></span>
<span class="line"><span class="line"><span>    com/hyfly/asm/TargetClass.fun01()V @34: lload_1</span></span></span>
<span class="line"><span class="line"><span>  Reason:</span></span></span>
<span class="line"><span class="line"><span>    Type top (current frame, locals[1]) is not assignable to long</span></span></span>
<span class="line"><span class="line"><span>  Current Frame:</span></span></span>
<span class="line"><span class="line"><span>    bci: @34</span></span></span>
<span class="line"><span class="line"><span>    flags: { }</span></span></span>
<span class="line"><span class="line"><span>    locals: { &#39;com/hyfly/asm/TargetClass&#39;, top, top, long, long_2nd }</span></span></span>
<span class="line"><span class="line"><span>    stack: { &#39;java/io/PrintStream&#39;, long, long_2nd }</span></span></span>
<span class="line"><span class="line"><span>  Bytecode:</span></span></span>
<span class="line"><span class="line"><span>    0000000: b800 0f40 1400 12b8 0019 b200 1d12 1fb6</span></span></span>
<span class="line"><span class="line"><span>    0000010: 0025 a700 084c 2bb6 0028 b800 0f42 b200</span></span></span>
<span class="line"><span class="line"><span>    0000020: 1d21 1f65 ba00 3400 00b6 0025 b1</span></span></span>
<span class="line"><span class="line"><span>  Exception Handler Table:</span></span></span>
<span class="line"><span class="line"><span>    bci [4, 18] =&gt; handler: 21</span></span></span>
<span class="line"><span class="line"><span>  Stackmap Table:</span></span></span>
<span class="line"><span class="line"><span>    same_locals_1_stack_item_frame(@21,Object[#17])</span></span></span>
<span class="line"><span class="line"><span>    same_frame(@26)</span></span></span>
<span class="line"><span class="line"><span></span></span></span>
<span class="line"><span class="line"><span>	at com.hyfly.asm.TestTargetClass.main(TestTargetClass.java:5)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="报错原因-1" tabindex="-1"><a class="header-anchor" href="#报错原因-1"><span>报错原因</span></a></h5><p>在 MyClassVisitor 的内部类 MyMethodVisitor 的 visitCode() 方法中，mv.visitVarInsn(Opcodes.LSTORE, 1); 是用于存储局部变量的，而 TargetClass 也存储了局部变量 InterruptedException e，两次存储变量冲突</p><h4 id="asm-演示例子-02-1" tabindex="-1"><a class="header-anchor" href="#asm-演示例子-02-1"><span>ASM 演示例子 02</span></a></h4><h5 id="修改相关类-1" tabindex="-1"><a class="header-anchor" href="#修改相关类-1"><span>修改相关类</span></a></h5><p>修改 ASM 演示例子 01 中的相关类，生成 ASM 文件</p><ol><li>添加 MyTimeLogger 类</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyTimeLogger</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    private</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> long</span><span style="color:#D8DEE9;"> startTime</span><span style="color:#81A1C1;"> =</span><span style="color:#B48EAD;"> 0L</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> start</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">        startTime </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> end</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        long</span><span style="color:#D8DEE9;"> endTime</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> System</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">currentTimeMillis</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">MyTimeLogger invoke method cost: </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#ECEFF4;"> (</span><span style="color:#D8DEE9FF;">endTime </span><span style="color:#81A1C1;">-</span><span style="color:#D8DEE9FF;"> startTime</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>修改 TargetClass 并对其 javac 编译为 class 文件</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> e</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            e</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>通过 ASM Bytecode Viewer 生成的 ASM 文件为</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">AnnotationVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Attribute</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassReader</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassWriter</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ConstantDynamic</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">FieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Handle</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Label</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Opcodes</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">RecordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Type</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">TypePath</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClassDump</span><span style="color:#81A1C1;"> implements</span><span style="color:#8FBCBB;font-weight:bold;"> Opcodes</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> static</span><span style="color:#81A1C1;"> byte</span><span style="color:#ECEFF4;">[]</span><span style="color:#88C0D0;"> dump</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;"> throws</span><span style="color:#8FBCBB;"> Exception</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        ClassWriter</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassWriter</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        FieldVisitor</span><span style="color:#D8DEE9;"> fieldVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        RecordComponentVisitor</span><span style="color:#D8DEE9;"> recordComponentVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        AnnotationVisitor</span><span style="color:#D8DEE9;"> annotationVisitor0</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">V17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> ACC_PUBLIC </span><span style="color:#81A1C1;">|</span><span style="color:#D8DEE9FF;"> ACC_SUPER</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/TargetClass</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitSource</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass.java</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESPECIAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Object</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            methodVisitor </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ACC_PUBLIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">fun01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label0</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label1</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label2</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitTryCatchBlock</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label3</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">12</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">15</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">new</span><span style="color:#88C0D0;"> Long</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">))</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/Thread</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">sleep</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(J)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label4</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">16</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label4</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFieldInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GETSTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/System</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">out</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/io/PrintStream;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLdcInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/io/PrintStream</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">println</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">(Ljava/lang/String;)V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">19</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label5</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitJumpInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">GOTO</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">17</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_SAME1</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> new</span><span style="color:#8FBCBB;"> Object</span><span style="color:#ECEFF4;">[]{</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">})</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ASTORE</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label6</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">18</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitVarInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">ALOAD</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKEVIRTUAL</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">java/lang/InterruptedException</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">printStackTrace</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">21</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitFrame</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">F_SAME</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label7</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLineNumber</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">22</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label7</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">            Label</span><span style="color:#D8DEE9;"> label8</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> Label</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLabel</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">label8</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">e</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Ljava/lang/InterruptedException;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label6</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label5</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 1</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitLocalVariable</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">this</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">Lcom/hyfly/asm/TargetClass;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label3</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> label8</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 0</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMaxs</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">2</span><span style="color:#ECEFF4;">,</span><span style="color:#B48EAD;"> 2</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            methodVisitor</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitEnd</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9;"> classWriter</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">toByteArray</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><ol start="4"><li>复制 ASM 文件中的相关内容，修改 MyClassVisitor 类</li></ol><details class="hint-container details"><summary>点击查看代码</summary><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Label</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">import</span><span style="color:#8FBCBB;"> org</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">objectweb</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">Opcodes</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyClassVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> ClassVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> MyClassVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">ClassVisitor</span><span style="color:#D8DEE9;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> classVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visit</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> version</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visit</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">version</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> superName</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> interfaces</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#8FBCBB;"> MethodVisitor</span><span style="color:#88C0D0;"> visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> access</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#D8DEE9;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#8FBCBB;"> String</span><span style="color:#ECEFF4;">[]</span><span style="color:#D8DEE9;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">        MethodVisitor</span><span style="color:#D8DEE9;"> mv</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> cv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethod</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">access</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> name</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> descriptor</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> signature</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> exceptions</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        if</span><span style="color:#ECEFF4;"> (</span><span style="color:#81A1C1;">!</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">&lt;init&gt;</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">equals</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">name</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> mv </span><span style="color:#81A1C1;">!=</span><span style="color:#81A1C1;"> null</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 为这种方法增加记录执行时间的功能</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">            mv </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">mv</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        return</span><span style="color:#D8DEE9FF;"> mv</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    static</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> MyMethodVisitor</span><span style="color:#81A1C1;"> extends</span><span style="color:#8FBCBB;font-weight:bold;"> MethodVisitor</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#88C0D0;"> MyMethodVisitor</span><span style="color:#ECEFF4;">(</span><span style="color:#8FBCBB;">MethodVisitor</span><span style="color:#D8DEE9;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ASM9</span><span style="color:#ECEFF4;">,</span><span style="color:#D8DEE9FF;"> methodVisitor</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitCode</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法开始处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        @</span><span style="color:#D08770;">Override</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#81A1C1;">int</span><span style="color:#D8DEE9;"> opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">            // 在方法返回处插入代码</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            if</span><span style="color:#ECEFF4;"> ((</span><span style="color:#D8DEE9FF;">opcode </span><span style="color:#81A1C1;">&gt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">IRETURN</span><span style="color:#81A1C1;"> &amp;&amp;</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">&lt;=</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">RETURN</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;"> ||</span><span style="color:#D8DEE9FF;"> opcode </span><span style="color:#81A1C1;">==</span><span style="color:#D8DEE9;"> Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">ATHROW</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">                mv</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitMethodInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9;">Opcodes</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">INVOKESTATIC</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">com/hyfly/asm/MyTimeLogger</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">()V</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">,</span><span style="color:#81A1C1;"> false</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">            }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">            super</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">visitInsn</span><span style="color:#ECEFF4;">(</span><span style="color:#D8DEE9FF;">opcode</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></details><h5 id="测试-1" tabindex="-1"><a class="header-anchor" href="#测试-1"><span>测试</span></a></h5><p>使用到的类有 MyTimeLogger、TargetClass、Generator、TestTargetClass、MyClassVisitor。其中为修改的类有 Generator、MyClassVisitor，新增的类为 MyTimeLogger，需要回滚的类为 TargetClass</p><ol><li>执行 Generator 中的 main 方法生成 TargetClass.class 文件，并通过 idea 打开得到的内容为</li></ol><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// Source code recreated from a .class file by IntelliJ IDEA</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// (powered by FernFlower decompiler)</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">//</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">package</span><span style="color:#8FBCBB;"> com</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">hyfly</span><span style="color:#ECEFF4;">.</span><span style="color:#8FBCBB;">asm</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">public</span><span style="color:#81A1C1;"> class</span><span style="color:#8FBCBB;"> TargetClass</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#88C0D0;"> TargetClass</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    public</span><span style="color:#81A1C1;"> void</span><span style="color:#88C0D0;"> fun01</span><span style="color:#ECEFF4;">()</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">start</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">        try</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            Thread</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">sleep</span><span style="color:#ECEFF4;">(</span><span style="color:#B48EAD;">100L</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">TargetClass#fun01 run</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span><span style="color:#81A1C1;"> catch</span><span style="color:#ECEFF4;"> (</span><span style="color:#8FBCBB;">InterruptedException</span><span style="color:#D8DEE9;"> var2</span><span style="color:#ECEFF4;">)</span><span style="color:#ECEFF4;"> {</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">            var2</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">printStackTrace</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">        }</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">        MyTimeLogger</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">end</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    }</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>将生成的 TargetClass.class 文件替换 target 文件夹中的 TargetClass.class 文件，执行 TestTargetClass 的 main() 方法，控制台输出内容</li></ol><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">TargetClass#fun01</span><span style="color:#A3BE8C;"> run</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">MyTimeLogger</span><span style="color:#A3BE8C;"> invoke</span><span style="color:#A3BE8C;"> method</span><span style="color:#A3BE8C;"> cost:</span><span style="color:#B48EAD;"> 104</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="asm-总结-1" tabindex="-1"><a class="header-anchor" href="#asm-总结-1"><span>ASM 总结</span></a></h3><p>在使用 ASM 增强原始类的功能时，不应该在 MethodVisitor 的相关方法中使用局部变量，而是将增强的方法封装到类的方法中，以避免在存储局部变量时增强类中的局部变量与原始类中的局部变量冲突</p><h2 id="类加载、连接和初始化-1" tabindex="-1"><a class="header-anchor" href="#类加载、连接和初始化-1"><span>类加载、连接和初始化</span></a></h2><h3 id="类在-jvm-中的生命周期-1" tabindex="-1"><a class="header-anchor" href="#类在-jvm-中的生命周期-1"><span>类在 JVM 中的生命周期</span></a></h3><ol><li>加载：查找并加载类文件的二进制数据</li><li>连接：将已经读入内存的类的二进制数据合并到 JVM 运行时环境中去 <ol><li>验证：确保被加载类的正确性</li><li>装备：为类的静态变量分配内存，创建静态变量</li><li>解析：把常量池中的符号引用转换成直接引用</li></ol></li><li>初始化：为类的静态变量赋初始值</li><li>使用</li><li>卸载</li></ol><p><img src="/blog/img/Snipaste_2021-04-03_21-50-25.png" alt="Snipaste_2021-04-03_21-50-25.png"></p><h3 id="类加载-1" tabindex="-1"><a class="header-anchor" href="#类加载-1"><span>类加载</span></a></h3><ol><li>通过类的全限定名来获取该类的二进制字节流</li><li>把二进制字节流转化为方法区的运行时数据结构</li><li>在堆上创建一个 java.lang.Class 对象，用来封装类在方法区内的数据结构，并向外提供了访问方法区内数据结构的接口</li></ol><h3 id="加载类的方法-1" tabindex="-1"><a class="header-anchor" href="#加载类的方法-1"><span>加载类的方法</span></a></h3><ul><li>常见方式：从本地文件系统中加载，从 jar 等归档文件中加载</li><li>动态方式：将 Java 源文件动态编译成 class</li><li>其他：网络下载，从专有数据库中加载</li></ul><h3 id="类加载器-1" tabindex="-1"><a class="header-anchor" href="#类加载器-1"><span>类加载器</span></a></h3><ul><li>类加载器并不需要等到某个类首次主动使用的时候才加载它，JVM 规范允许类加载器在预料到某个类将要被使用的时候就预先加载它</li><li>如果在加载的时候 .class 文件缺失。会在该类首次主动使用时抛出 LinkageError 错误，如果一直没有被使用，则不会报错</li></ul><h4 id="jvm-自带的加载器-1" tabindex="-1"><a class="header-anchor" href="#jvm-自带的加载器-1"><span>JVM 自带的加载器</span></a></h4><ul><li>启动类加载器（BootstrapClassLoader） <ul><li>Java 程序不能直接引用启动类加载器，直接设置 classLoader 为 null，默认使用启动类加载器</li><li>用于加载启动的基础模块，比如：java.base、java.management、java.xml 等，启动类加载器是 JVM 平台自身的，不允许被其他方式修改，通过 Object.getClass().getClassLoader() 得到的结果是 null</li><li>JDK 8 的启动类加载器负责将 JAVA_HONME/lib，或者 -Xbootclasspath 参数指定的路径中的，且是虚拟机识别的类库加载到内存中（按照名字识别，如：rt.jar，对于不能识别的文件不予加载）</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">String</span><span style="color:#D8DEE9;"> str</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">hello class loader</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// str class loader null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">str class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> str</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClass</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>扩展类加载器（ExtensionClassLoader）、平台类加载器（PlatformClassLoader） <ul><li>JDK 8 之前是扩展类加载器，JDK 8 之后为平台类加载器，扩展类加载器的扩展性较差、安全性较低，所以被移除</li><li>JDK 8 的扩展类加载器负责加载 JRE_HOME/lib/ext，或者 java.ext.dirs 系统变量所指定路径上的所有类库</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">Class</span><span style="color:#ECEFF4;">&lt;</span><span style="color:#8FBCBB;">?</span><span style="color:#ECEFF4;">&gt;</span><span style="color:#D8DEE9;"> sqlDriver</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Class</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forName</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">java.sql.Driver</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader</span><span style="color:#D8DEE9;"> classLoader</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> sqlDriver</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$PlatformClassLoader@1f32e575</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sqlDriver class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> classLoader</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">sqlDriver parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ul><li>应用程序类加载器（AppClassLoader） <ul><li>用于加载应用级别的模块，比如：jdk.compiler、jdk.jartool、jdk.jshell 等等，还加载 classpath 路径中的所有类库</li><li>JDK 8 的应用程序类加载器只加载 classpath 路径中的所有类库</li></ul></li></ul><div class="language-java line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="java" data-title="java"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-java;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader01</span><span style="color:#D8DEE9;"> classLoader01</span><span style="color:#81A1C1;"> =</span><span style="color:#81A1C1;"> new</span><span style="color:#88C0D0;"> ClassLoader01</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">ClassLoader</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> classLoader01</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClass</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">()</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$AppClassLoader@251a69d7</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9FF;"> classLoader03</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$PlatformClassLoader@1f32e575</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">classLoader01 parent parent class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> classLoader03</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">().</span><span style="color:#88C0D0;">getParent</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">Class</span><span style="color:#D8DEE9;"> jShell</span><span style="color:#81A1C1;"> =</span><span style="color:#D8DEE9;"> Class</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">forName</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">jdk.jshell.JShell</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#ECEFF4;">)</span><span style="color:#81A1C1;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">// jdk.internal.loader.ClassLoaders$AppClassLoader@251a69d7</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">System</span><span style="color:#ECEFF4;">.</span><span style="color:#D8DEE9;">out</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">println</span><span style="color:#ECEFF4;">(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">jShell class loader </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> +</span><span style="color:#D8DEE9;"> jShell</span><span style="color:#ECEFF4;">.</span><span style="color:#88C0D0;">getClassLoader</span><span style="color:#ECEFF4;">())</span><span style="color:#81A1C1;">;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="用户自定义类加载器-1" tabindex="-1"><a class="header-anchor" href="#用户自定义类加载器-1"><span>用户自定义类加载器</span></a></h4><p>是 java,lang.ClassLoader 的子类，用户可以定制类的加载方式，其加载顺序在所有系统类加载器之后</p><h4 id="类加载器的关系-1" tabindex="-1"><a class="header-anchor" href="#类加载器的关系-1"><span>类加载器的关系</span></a></h4><p><img src="/blog/img/Snipaste_2021-04-03_22-28-17.png" alt="Snipaste_2021-04-03_22-28-17.png"></p><h3 id="双亲委派模型-1" tabindex="-1"><a class="header-anchor" href="#双亲委派模型-1"><span>双亲委派模型</span></a></h3><p>JVM 中的 ClassLoader 通常采用双亲委派模型，要求除了启动类加载器外，其余的类加载器都应该有自己的父级加载器，这个父子关系是组合而不是继承</p><h4 id="工作过程-1" tabindex="-1"><a class="header-anchor" href="#工作过程-1"><span>工作过程</span></a></h4><ol><li>一个类加载器接收到类加载请求后，首先搜索它内建加载器定义的所有“具名模块”</li><li>如果找到了合适的模块定义，即该模块中存在该需要加载的类，将会使用该加载器来加载</li><li>如果 class 没有在这些加载器定义的具名模块中找到，那么将会委托给父级加载器，直到启动类加载器</li><li>如果父级加载器反馈它不能完成加载请求，比如在搜索路径下找不到这个类。那子的类加载器才自己来加载</li><li>在类路径下找到的类将成为这些加载器的无名模块</li><li>都没找到抛出 ClassNotFound</li><li>JDK 8 没有模块化，所以直接委派个父加载器</li></ol><h4 id="作用-1" tabindex="-1"><a class="header-anchor" href="#作用-1"><span>作用</span></a></h4><ul><li>双亲委派模型对于保证了 Java 程序的稳定运行很重要</li><li>公用且具有一致性的类都只会被加载一次</li><li>对于已经加载的系统级别的类，不管是哪一级别的类都不能再次加载，保证了系统级别的类不会被恶意修改或被覆盖</li></ul><h4 id="其他-1" tabindex="-1"><a class="header-anchor" href="#其他-1"><span>其他</span></a></h4><ul><li>实现双亲委派的代码在 java.lang.ClassLoader 的 loadClass() 方法中，如果自定义类加载器的话，推荐覆盖实现 findClass() 方法</li><li>如果有一个类加载器能加载某个类，则该加载器称为定义类加载的，所有能成功返回该类的 Class 的类加载器都被称为初始类加载器</li><li>如果没有指定父加载器，默认就是启动类加载器</li><li>每个类加载器都有自己的命名空间，命名空间由该加载器及其所有父加载器所加载的类构成，不同的命名空间可以出现类的全路径名相同的情况</li><li>运行时包由同一个类加载器的类构成，决定两个类是否属于同一个运行时包，不及要看全路径名是否一样，还要看定义类加载器是否相同，只有属于同一个运行时包的类才能实现相互包内可见</li></ul><h3 id="破坏双亲委派模型-1" tabindex="-1"><a class="header-anchor" href="#破坏双亲委派模型-1"><span>破坏双亲委派模型</span></a></h3><ul><li>双亲委派模型的问题：父加载器无法向下识别子加载器加载的资源</li><li>Java 不太完美的解决方式：引入线程上下文类加载器，可以通过 Thread 的 setContextClassLoader() 进行设置</li><li>另一种情况：实现热替换，比如 OSGI 的模块化热部署，它的类加载器不再严格按照双亲委派模型，更多的使用平级的类加载器</li></ul><h3 id="类连接-1" tabindex="-1"><a class="header-anchor" href="#类连接-1"><span>类连接</span></a></h3><h4 id="类连接主要验证的内容-1" tabindex="-1"><a class="header-anchor" href="#类连接主要验证的内容-1"><span>类连接主要验证的内容</span></a></h4><ul><li>类文件结构检查：按照 JVM 规范规定的类文件结构进行检查</li><li>元数据验证：对字节码描述的信息进行语义分析，保证其符合 Java 语言规范的要求</li><li>字节码验证：通过对数据流和控制流进行分析，确保程序语义是合法和符合逻辑的</li><li>符号引用验证：对类自身以外的信息，即常量池中的各种符号引用，进行匹配校验</li></ul><h4 id="类连接的解析-1" tabindex="-1"><a class="header-anchor" href="#类连接的解析-1"><span>类连接的解析</span></a></h4><ul><li>解析是把常量池中的符号引用转换成直接引用的过程，包括：符号引用（以一组无歧义的符号来描述所引用的目标，与虚拟机的实现无关）</li><li>直接引用：直接指向目标的指针、相对偏移量、或能间接定位到目标的句柄，是和虚拟机的实现相关</li><li>主要针对：类、接口、字段、类方法、接口方法、方法类型、方法句柄、调用点限定符</li></ul><h3 id="类的初始化-1" tabindex="-1"><a class="header-anchor" href="#类的初始化-1"><span>类的初始化</span></a></h3><p>类的初始化是类的静态变量赋初始值，或者说是执行类构造器 clinit 方法的过程</p><ul><li>如果类还没有加载和连接，就先加载和连接</li><li>如果类存在父类，且父类没有初始化，就先初始化父类</li><li>如果类中存在初始化语句，则会依次执行初始化语句</li><li>如果是接口 <ul><li>初始化一个类的时候，并不会先初始化它的接口</li><li>初始化一个接口时，并不会初始化它的父接口</li><li>只有当程序首次使用接口里面的变量或者调用接口方法的时候，才会导致接口初始化</li></ul></li><li>调用 ClassLoader 类的 loadClass 方法来装载一个类，并不会初始化这个类，这不是对类的主动使用</li></ul><h4 id="初始化的时机-1" tabindex="-1"><a class="header-anchor" href="#初始化的时机-1"><span>初始化的时机</span></a></h4><ul><li>Java 程序对类的使用方式分成：主动使用和被动使用，JVM 必须在每个类或接口“首次主动使用”时才初始化它们；被动使用类不会导致类的初始化</li><li>主动使用： <ul><li>创建类实例</li><li>访问某个类或接口的静态变量</li><li>调用类的静态方法</li><li>反射某个类</li><li>某个父类还没有初始化时，初始化父类的子类</li><li>JVM 启动的时候运行的主类</li><li>定义了 default 方法的接口，当接口实现类初始化时</li></ul></li></ul><h4 id="类初始化机制-1" tabindex="-1"><a class="header-anchor" href="#类初始化机制-1"><span>类初始化机制</span></a></h4><p>在 Java 中，类的初始化可以分为以下两种情况：</p><ol><li>类的静态初始化：当一个类被加载时，会执行类的静态初始化过程。类的静态初始化会按照以下顺序进行： <ol><li>静态变量的赋值操作：静态变量会按照定义的顺序依次初始化，如果一个静态变量在定义时没有指定初始值，那么它将被赋予默认值。</li><li>静态代码块的执行：如果一个类包含静态代码块，那么这些代码块会在静态变量的初始化之后执行，且按照代码块的顺序执行。</li></ol></li><li>对象的初始化：当一个对象被创建时，会执行对象的初始化过程。对象的初始化会按照以下顺序进行： <ol><li>成员变量的赋值操作：成员变量会按照定义的顺序依次初始化，如果一个成员变量在定义时没有指定初始值，那么它将被赋予默认值。</li><li>构造代码块的执行：如果一个类包含构造代码块，那么这些代码块会在成员变量的初始化之后执行，且按照代码块的顺序执行。</li><li>构造函数的执行：最后，会执行对象的构造函数。</li></ol></li></ol><p>需要注意的是，如果一个类被继承，那么子类的初始化过程中，会先执行父类的初始化过程，然后再执行子类的初始化过程。此外，静态变量和静态代码块只会在类被加载时执行一次，而成员变量和构造代码块会在每次创建对象时都执行</p><h4 id="类初始化顺序-1" tabindex="-1"><a class="header-anchor" href="#类初始化顺序-1"><span>类初始化顺序</span></a></h4><p>Java 中，类的初始化顺序可以分为以下三个步骤：</p><ol><li>父类的静态成员变量和静态代码块的初始化，按照代码顺序执行。</li><li>子类的静态成员变量和静态代码块的初始化，按照代码顺序执行。</li><li>父类和子类的实例成员变量和构造函数的初始化，按照代码顺序执行。如果有多个构造函数，则以调用的构造函数为准。</li></ol><p>具体来说，Java 类的初始化顺序如下：</p><ol><li>加载父类的类对象，并初始化其静态成员变量和静态代码块。</li><li>加载子类的类对象，并初始化其静态成员变量和静态代码块。</li><li>创建父类的实例对象，并按照代码顺序初始化其实例成员变量和构造函数。</li><li>创建子类的实例对象，并按照代码顺序初始化其实例成员变量和构造函数。</li></ol><p>需要注意的是，父类和子类的静态成员变量和静态代码块只会在类被加载时执行一次，而实例成员变量和构造函数会在每次创建对象时都执行。另外，如果父类和子类中有同名的成员变量，子类的成员变量会覆盖父类的成员变量</p><h3 id="类的卸载-1" tabindex="-1"><a class="header-anchor" href="#类的卸载-1"><span>类的卸载</span></a></h3><ul><li>当代表一个类的 Class 对象不再被引用，那么 Class 对象的生命周期就结束了，对应在方法区中的数据也会被卸载</li><li>JVM 自带的类加载器装载的类，是不会卸载的，由用户自定义的类加载器加载的类是可以被卸载的</li></ul></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/hyfly233/blog/edit/main/md/article/language/java/jvm/JVM.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hyfly233@outlook.com">hyfly233</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-chPKMbRn.js" defer></script>
  </body>
</html>
