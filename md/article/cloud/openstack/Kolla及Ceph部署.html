<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>Kolla及Ceph部署 | とんぼの気持ち</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-nxaj3WOG.css" as="style"><link rel="stylesheet" href="/blog/assets/style-nxaj3WOG.css">
    <link rel="modulepreload" href="/blog/assets/app-chPKMbRn.js"><link rel="modulepreload" href="/blog/assets/Kolla及Ceph部署.html-DBRpVcxj.js">
    <link rel="prefetch" href="/blog/assets/directory.html-CM077g0X.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WkqGtERh.js" as="script"><link rel="prefetch" href="/blog/assets/directory.html-BH0WGkAw.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible扩充OSD节点.html-DQGhyA8S.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible的OSD存储满后的临时解决方案.html-BDuF8Lky.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible部署Ceph.html-B1ua_UqN.js" as="script"><link rel="prefetch" href="/blog/assets/iSCSI安装.html-HVTL7fJU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BceON7lL.js" as="script"><link rel="prefetch" href="/blog/assets/如何升级系统构架.html-B16ubYTA.js" as="script"><link rel="prefetch" href="/blog/assets/如何正确加锁.html-DjvlAowS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3nYQ7aQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BmNefUmR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJsvdjYt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlgG4jCN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bp1xrcuH.js" as="script"><link rel="prefetch" href="/blog/assets/linear_search.html-Dr3lRrFe.js" as="script"><link rel="prefetch" href="/blog/assets/binary_tree_sort.html-BZSaHXpo.js" as="script"><link rel="prefetch" href="/blog/assets/bitonic_sort.html-DZHRyZF8.js" as="script"><link rel="prefetch" href="/blog/assets/bubble_sort.html-XLBBj8rD.js" as="script"><link rel="prefetch" href="/blog/assets/bucket_sort.html-D1NDEl5q.js" as="script"><link rel="prefetch" href="/blog/assets/cocktail_shaker_sort.html-sQF3C84o.js" as="script"><link rel="prefetch" href="/blog/assets/comb_sort.html-B6Z7wIqt.js" as="script"><link rel="prefetch" href="/blog/assets/counting_sort.html-D8wkfUEd.js" as="script"><link rel="prefetch" href="/blog/assets/gnome_sort.html-ClFIwPrf.js" as="script"><link rel="prefetch" href="/blog/assets/heap_sort.html-Rp3rKaBj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DSXsiBgb.js" as="script"><link rel="prefetch" href="/blog/assets/insertion_sort.html-Cb45Fk0s.js" as="script"><link rel="prefetch" href="/blog/assets/merge_sort.html-DKhyfHNj.js" as="script"><link rel="prefetch" href="/blog/assets/odd_even_sort.html-BUUtGCfM.js" as="script"><link rel="prefetch" href="/blog/assets/pancake_sort.html-CLbqQfeK.js" as="script"><link rel="prefetch" href="/blog/assets/quick_sort.html-DsTl6rI_.js" as="script"><link rel="prefetch" href="/blog/assets/radix_sort.html-DGfsIMQr.js" as="script"><link rel="prefetch" href="/blog/assets/selection_sort.html-CWB7HCPo.js" as="script"><link rel="prefetch" href="/blog/assets/shell_sort.html-RYeqqTj9.js" as="script"><link rel="prefetch" href="/blog/assets/smooth_sort.html-B0t6JSLd.js" as="script"><link rel="prefetch" href="/blog/assets/stooge_sort.html-YfhFB3iG.js" as="script"><link rel="prefetch" href="/blog/assets/tim_sort.html-BoCSzhxx.js" as="script"><link rel="prefetch" href="/blog/assets/ESXI虚机迁移至OpenStack.html-6EM4grfG.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla使用Libvirt.html-BH6Q3PvO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlM2okaw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DuySOOS7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COYjVXza.js" as="script"><link rel="prefetch" href="/blog/assets/环境搭建.html-BwslABub.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bk5wCQBA.js" as="script"><link rel="prefetch" href="/blog/assets/Schema变更.html-CmXDyeR-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bl4wowJu.js" as="script"><link rel="prefetch" href="/blog/assets/动态分区和RoutineLoad.html-BYzTxZd0.js" as="script"><link rel="prefetch" href="/blog/assets/存算分离.html-9GVDpuqQ.js" as="script"><link rel="prefetch" href="/blog/assets/数据划分.html-yeEAwxQ-.js" as="script"><link rel="prefetch" href="/blog/assets/数据库建表最佳实践.html-CU31WBJ2.js" as="script"><link rel="prefetch" href="/blog/assets/日志存储最佳实践.html-BJPmJmHB.js" as="script"><link rel="prefetch" href="/blog/assets/表模型.html-lvuDP8dJ.js" as="script"><link rel="prefetch" href="/blog/assets/表索引.html-Ck9S3vCk.js" as="script"><link rel="prefetch" href="/blog/assets/表设计.html-tk_DoCsV.js" as="script"><link rel="prefetch" href="/blog/assets/集群部署.html-4idh13Cl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cth5DVaR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZicgUK5U.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DoXHiDiT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CrHNcY8F.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUx8GfJe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHVKGkTF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COz27HnP.js" as="script"><link rel="prefetch" href="/blog/assets/query.html-DoPeGCPi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-w3kLOssO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTpqBRxQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxORDID2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-k7IOKuSo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CQB9Z0b8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EtRq-J4i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVp3vOGH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DQBe6C8G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHiZJrZY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DIai_jYU.js" as="script"><link rel="prefetch" href="/blog/assets/TerraformFramework实现Provider.html-DmR-BbHm.js" as="script"><link rel="prefetch" href="/blog/assets/Terraform命令.html-CSe_xkG9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-1hZwCU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DCKXXjZh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C0awBswM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wn39Nn3s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bzvj5tms.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BE5TLZ79.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BH9xzrDi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fENjPdqb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DBCYo0z6.js" as="script"><link rel="prefetch" href="/blog/assets/Rsyslog日志转存.html-VynoGpA4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-49epSqc8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B_flGDt0.js" as="script"><link rel="prefetch" href="/blog/assets/SeaTunnel数据库CDC配置.html-ON8CoGPS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ChXgdJTg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bc5oNQiy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-dcPYv2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ck1dZsqe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3t4G-zts.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KRPZcEBU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RQaezZK1.js" as="script"><link rel="prefetch" href="/blog/assets/ZabbixAgent安装及自定义脚本.html-DKURZalB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C29L2VNh.js" as="script"><link rel="prefetch" href="/blog/assets/zabbix安装.html-FEQL6thK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-R3ii_NIK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5_B4zlm.js" as="script"><link rel="prefetch" href="/blog/assets/SQL.html-89x0k9Cm.js" as="script"><link rel="prefetch" href="/blog/assets/数据库优化.html-K6nWNgZK.js" as="script"><link rel="prefetch" href="/blog/assets/数据库索引.html-BX4K5xTn.js" as="script"><link rel="prefetch" href="/blog/assets/数据库锁与事务.html-CS8d_ANn.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatis.html-CIkBxdDk.js" as="script"><link rel="prefetch" href="/blog/assets/Java基础.html-D_QRBbpt.js" as="script"><link rel="prefetch" href="/blog/assets/Java调优.html-B4RoEDf7.js" as="script"><link rel="prefetch" href="/blog/assets/Java进阶.html-Db99JmhM.js" as="script"><link rel="prefetch" href="/blog/assets/反射.html-B9fatXTn.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-CxbSCpUd.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html-B6SpjkfJ.js" as="script"><link rel="prefetch" href="/blog/assets/集合.html-CUZ1m7It.js" as="script"><link rel="prefetch" href="/blog/assets/面向对象.html-UMaUbHDD.js" as="script"><link rel="prefetch" href="/blog/assets/jvm.html-BWNS3e3B.js" as="script"><link rel="prefetch" href="/blog/assets/JUC.html-DLUivWNX.js" as="script"><link rel="prefetch" href="/blog/assets/ThreadLocal.html-BYxYh7yT.js" as="script"><link rel="prefetch" href="/blog/assets/多线程.html-BmpsxTLI.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-DwozZdb4.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html--5qDdUfD.js" as="script"><link rel="prefetch" href="/blog/assets/Redis.html-BsKKSiRX.js" as="script"><link rel="prefetch" href="/blog/assets/ElasticSearch.html-Pn1J3Cur.js" as="script"><link rel="prefetch" href="/blog/assets/JVM.html-DNvsmY-J.js" as="script"><link rel="prefetch" href="/blog/assets/JVM内存模型.html-CZyniu0B.js" as="script"><link rel="prefetch" href="/blog/assets/JVM对高效并发的支持.html-eb1cM9Dq.js" as="script"><link rel="prefetch" href="/blog/assets/JVM工具和JVM调优.html--xINkAvq.js" as="script"><link rel="prefetch" href="/blog/assets/垃圾回收.html-WnvI2chO.js" as="script"><link rel="prefetch" href="/blog/assets/Spring.html-B4O33Fe1.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot.html-O44ccL2x.js" as="script"><link rel="prefetch" href="/blog/assets/SpringMvc.html-C8kgBqP7.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloud.html-DTSK6rgN.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudAlibaba.html-BXlIalpv.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudNetflix.html-BP0KK0nB.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-BlOTU2g8.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-BphbxoLK.js" as="script"><link rel="prefetch" href="/blog/assets/分布式锁.html-CgINm6oC.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-5cdhF5yj.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-CYpgxpoD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="vp-site-logo" src="/blog/assets/img/game.ico" alt="とんぼの気持ち"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">とんぼの気持ち</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading">Kolla及Ceph部署 <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h2 id="基础配置" tabindex="-1"><a class="header-anchor" href="#基础配置"><span>基础配置</span></a></h2><ul><li>CentOS 7.4 x86</li><li>Kolla-ansible Train</li><li>Ceph-ansible stable-4.0</li></ul><h2 id="基础环境配置" tabindex="-1"><a class="header-anchor" href="#基础环境配置"><span>基础环境配置</span></a></h2><h3 id="安装基础软件" tabindex="-1"><a class="header-anchor" href="#安装基础软件"><span>安装基础软件</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 设置 yun 源</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> sed</span><span style="color:#A3BE8C;"> -e</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">s|^mirrorlist=|#mirrorlist=|g</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">         -e</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">s|^#baseurl=http://mirror.centos.org/centos|baseurl=https://mirrors.tuna.tsinghua.edu.cn/centos|g</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">         -i.bak</span><span style="color:#EBCB8B;"> \s</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">         /etc/yum.repos.d/CentOS-*.repo</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum</span><span style="color:#A3BE8C;"> makecache</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum</span><span style="color:#A3BE8C;"> update</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 安装基础软件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> vim</span><span style="color:#A3BE8C;"> git</span><span style="color:#A3BE8C;"> wget</span><span style="color:#A3BE8C;"> gcc</span><span style="color:#A3BE8C;"> libffi-devel</span><span style="color:#A3BE8C;"> openssl-devel</span><span style="color:#A3BE8C;"> lvm2</span><span style="color:#A3BE8C;"> chrony</span><span style="color:#A3BE8C;"> -y</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改主机-host-文件" tabindex="-1"><a class="header-anchor" href="#修改主机-host-文件"><span>修改主机 host 文件</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/hosts</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">192.168.93.101</span><span style="color:#A3BE8C;">  node01</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">192.168.93.102</span><span style="color:#A3BE8C;">  node02</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">192.168.93.103</span><span style="color:#A3BE8C;">  node03</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">192.168.93.104</span><span style="color:#A3BE8C;">  node04</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">192.168.93.105</span><span style="color:#A3BE8C;">  node05</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置免密" tabindex="-1"><a class="header-anchor" href="#配置免密"><span>配置免密</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 生成密钥</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ssh-keygen</span><span style="color:#A3BE8C;"> -b</span><span style="color:#B48EAD;"> 1024</span><span style="color:#A3BE8C;"> -t</span><span style="color:#A3BE8C;"> rsa</span><span style="color:#A3BE8C;"> -P</span><span style="color:#ECEFF4;"> &#39;&#39;</span><span style="color:#A3BE8C;"> -f</span><span style="color:#A3BE8C;"> ~/.ssh/id_rsa</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 所有节点配置免密</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9;"> i</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9FF;"> {</span><span style="color:#88C0D0;">1..5}</span><span style="color:#81A1C1;">;</span><span style="color:#81A1C1;"> do</span><span style="color:#88C0D0;"> sudo</span><span style="color:#A3BE8C;"> ssh-copy-id</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> ~/.ssh/id_rsa.pub</span><span style="color:#A3BE8C;"> node0</span><span style="color:#D8DEE9;">$i</span><span style="color:#81A1C1;">;</span><span style="color:#81A1C1;"> done</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关闭-selinux" tabindex="-1"><a class="header-anchor" href="#关闭-selinux"><span>关闭 Selinux</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">setenforce</span><span style="color:#B48EAD;"> 0</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/selinux/config</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 修改内容</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">SELINUX</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">disabled</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="关闭防火墙" tabindex="-1"><a class="header-anchor" href="#关闭防火墙"><span>关闭防火墙</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">systemctl</span><span style="color:#A3BE8C;"> stop</span><span style="color:#A3BE8C;"> firewalld</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">systemctl</span><span style="color:#A3BE8C;"> disable</span><span style="color:#A3BE8C;"> firewalld</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="磁盘结构" tabindex="-1"><a class="header-anchor" href="#磁盘结构"><span>磁盘结构</span></a></h3><p>执行 lsblk 命令，输出如下，使用 sdc、sdd 两个磁盘分区</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">lsblk</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">NAME</span><span style="color:#A3BE8C;">            MAJ:MIN</span><span style="color:#A3BE8C;"> RM</span><span style="color:#A3BE8C;">   SIZE</span><span style="color:#A3BE8C;"> RO</span><span style="color:#A3BE8C;"> TYPE</span><span style="color:#A3BE8C;"> MOUNTPOINT</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sda</span><span style="color:#A3BE8C;">               8:0</span><span style="color:#B48EAD;">    0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">├─sda1</span><span style="color:#A3BE8C;">            8:1</span><span style="color:#B48EAD;">    0</span><span style="color:#A3BE8C;">     1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> part</span><span style="color:#A3BE8C;"> /boot</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">└─sda2</span><span style="color:#A3BE8C;">            8:2</span><span style="color:#B48EAD;">    0</span><span style="color:#A3BE8C;"> 446.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> part</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  ├─centos-root</span><span style="color:#A3BE8C;"> 253:0</span><span style="color:#B48EAD;">    0</span><span style="color:#A3BE8C;"> 877.3G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> lvm</span><span style="color:#A3BE8C;">  /</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  └─centos-swap</span><span style="color:#A3BE8C;"> 253:1</span><span style="color:#B48EAD;">    0</span><span style="color:#A3BE8C;">    16G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> lvm</span><span style="color:#D8DEE9FF;">  [SWAP]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sdb</span><span style="color:#A3BE8C;">               8:16</span><span style="color:#B48EAD;">   0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sdc</span><span style="color:#A3BE8C;">               8:32</span><span style="color:#B48EAD;">   0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sdd</span><span style="color:#A3BE8C;">               8:48</span><span style="color:#B48EAD;">   0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装-docker" tabindex="-1"><a class="header-anchor" href="#安装-docker"><span>安装 Docker</span></a></h2><h3 id="安装-docker-1" tabindex="-1"><a class="header-anchor" href="#安装-docker-1"><span>安装 docker</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -y</span><span style="color:#A3BE8C;"> yum-utils</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum-config-manager</span><span style="color:#A3BE8C;"> --add-repo</span><span style="color:#A3BE8C;"> http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> docker-ce</span><span style="color:#A3BE8C;"> docker-ce-cli</span><span style="color:#A3BE8C;"> containerd.io</span><span style="color:#A3BE8C;"> docker-buildx-plugin</span><span style="color:#A3BE8C;"> docker-compose-plugin</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 配置 Docker 镜像源</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">touch</span><span style="color:#A3BE8C;"> /etc/docker/daemon.json</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> vim</span><span style="color:#A3BE8C;"> /etc/docker/daemon.json</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">{</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  &quot;registry-mirrors&quot;</span><span style="color:#88C0D0;">:</span><span style="color:#D8DEE9FF;"> [</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    &quot;https://dockerproxy.com&quot;</span><span style="color:#88C0D0;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    &quot;https://hub-mirror.c.163.com&quot;</span><span style="color:#88C0D0;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    &quot;https://mirror.baidubce.com&quot;</span><span style="color:#88C0D0;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    &quot;https://ccr.ccs.tencentyun.com&quot;</span><span style="color:#88C0D0;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    &quot;https://registry.docker-cn.com&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  ]</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">systemctl</span><span style="color:#A3BE8C;"> daemon-reload</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">systemctl</span><span style="color:#A3BE8C;"> enable</span><span style="color:#A3BE8C;"> docker</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> systemctl</span><span style="color:#A3BE8C;"> start</span><span style="color:#A3BE8C;"> docker</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置-docker-私有仓库" tabindex="-1"><a class="header-anchor" href="#配置-docker-私有仓库"><span>配置 Docker 私有仓库</span></a></h3><h4 id="编写-etc-docker-docker-compose-yaml" tabindex="-1"><a class="header-anchor" href="#编写-etc-docker-docker-compose-yaml"><span>编写 /etc/docker/docker-compose.yaml</span></a></h4><div class="language-yaml line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-yaml;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">version</span><span style="color:#ECEFF4;">:</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">3</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">services</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">  registry</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    image</span><span style="color:#ECEFF4;">:</span><span style="color:#A3BE8C;"> registry:2.8.2</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    container_name</span><span style="color:#ECEFF4;">:</span><span style="color:#A3BE8C;"> docker_registry</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    restart</span><span style="color:#ECEFF4;">:</span><span style="color:#A3BE8C;"> always</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    ports</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#A3BE8C;"> 4000:5000</span></span></span>
<span class="line"><span class="line"><span style="color:#8FBCBB;">    volumes</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">      -</span><span style="color:#A3BE8C;"> ./registry:/var/lib/registry</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装-pip" tabindex="-1"><a class="header-anchor" href="#安装-pip"><span>安装 PIP</span></a></h2><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> epel-release</span><span style="color:#A3BE8C;"> python-pip</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mkdir</span><span style="color:#A3BE8C;"> ~/.pip</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 配置 pip 源</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#A3BE8C;"> ~/.pip/pip.conf</span><span style="color:#81A1C1;"> &lt;&lt;</span><span style="color:#ECEFF4;">EOF</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">[global]</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">timeout = 6000</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">index-url = http://mirrors.aliyun.com/pypi/simple/</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">trusted-host = mirrors.aliyun.com</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">EOF</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="安装-ceph-ansible" tabindex="-1"><a class="header-anchor" href="#安装-ceph-ansible"><span>安装 Ceph-Ansible</span></a></h2><h3 id="创建虚拟环境" tabindex="-1"><a class="header-anchor" href="#创建虚拟环境"><span>创建虚拟环境</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 安装虚拟环境依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> python-devel</span><span style="color:#A3BE8C;"> libselinux-python</span><span style="color:#A3BE8C;"> python-virtualenv</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建虚拟环境</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virtualenv</span><span style="color:#A3BE8C;"> /opt/ceph/venv/</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 激活虚拟环境</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /opt/ceph/venv/bin/activate</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="虚拟环境中安装-ceph-ansible-stable-4-0" tabindex="-1"><a class="header-anchor" href="#虚拟环境中安装-ceph-ansible-stable-4-0"><span>虚拟环境中安装 Ceph-Ansible stable-4.0</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 克隆源码</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">git</span><span style="color:#A3BE8C;"> clone</span><span style="color:#A3BE8C;"> https://github.com/ceph/ceph-ansible.git</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> git</span><span style="color:#A3BE8C;"> checkout</span><span style="color:#A3BE8C;"> stable-4.0</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> pip</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> setuptools</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 安装 ceph-ansible 依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -r</span><span style="color:#A3BE8C;"> requirements.txt</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 编辑 ansible 配置</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/ansible/ansible.cfg</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">defaults</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">host_key_checking</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">False</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">pipelining</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">True</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">forks</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">100</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编写-ceph-inventory" tabindex="-1"><a class="header-anchor" href="#编写-ceph-inventory"><span>编写 Ceph Inventory</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/hosts</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容 mons osds grafana-server 是必须要的</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mons</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:5]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">osds</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:5]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mgrs</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">mdss</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">grafana-server</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node01</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-group-vars-all-yml-配置" tabindex="-1"><a class="header-anchor" href="#修改-group-vars-all-yml-配置"><span>修改 group_vars/all.yml 配置</span></a></h3><p>在 Docker 中部署 Ceph</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/group_vars</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 备份 group_vars 下的文件</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">for</span><span style="color:#D8DEE9;"> file</span><span style="color:#81A1C1;"> in</span><span style="color:#A3BE8C;"> *</span><span style="color:#81A1C1;">;</span><span style="color:#81A1C1;"> do</span><span style="color:#88C0D0;"> cp</span><span style="color:#D8DEE9;"> $file</span><span style="color:#81A1C1;"> ${</span><span style="color:#D8DEE9;">file</span><span style="color:#81A1C1;">%</span><span style="color:#D8DEE9FF;">.</span><span style="color:#81A1C1;">*};</span><span style="color:#81A1C1;"> done</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 编辑 all.yml</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible/group_vars/all.yml</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">---</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">dummy:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cluster:</span><span style="color:#A3BE8C;"> ceph</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mon_group_name:</span><span style="color:#A3BE8C;"> mons</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">osd_group_name:</span><span style="color:#A3BE8C;"> osds</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rgw_group_name:</span><span style="color:#A3BE8C;"> rgws</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mds_group_name:</span><span style="color:#A3BE8C;"> mdss</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">nfs_group_name:</span><span style="color:#A3BE8C;"> nfss</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbdmirror_group_name:</span><span style="color:#A3BE8C;"> rbdmirrors</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">client_group_name:</span><span style="color:#A3BE8C;"> clients</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">iscsi_gw_group_name:</span><span style="color:#A3BE8C;"> iscsigws</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">mgr_group_name:</span><span style="color:#A3BE8C;"> mgrs</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rgwloadbalancer_group_name:</span><span style="color:#A3BE8C;"> rgwloadbalancers</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">grafana_server_group_name:</span><span style="color:#A3BE8C;"> grafana-server</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">configure_firewall:</span><span style="color:#A3BE8C;"> False</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ntp_service_enabled:</span><span style="color:#81A1C1;"> false</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">upgrade_ceph_packages:</span><span style="color:#A3BE8C;"> False</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_origin:</span><span style="color:#A3BE8C;"> repository</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_repository:</span><span style="color:#A3BE8C;"> community</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_mirror:</span><span style="color:#A3BE8C;"> http://mirrors.aliyun.com/ceph</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_key:</span><span style="color:#A3BE8C;"> http://mirrors.aliyun.com/ceph/keys/release.asc</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_release:</span><span style="color:#A3BE8C;"> nautilus</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_stable_repo:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">{{ ceph_mirror }}/rpm-{{ ceph_stable_release }}</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">monitor_interface:</span><span style="color:#A3BE8C;"> ens33</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">public_network:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.93.0/24</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">radosgw_interface:</span><span style="color:#A3BE8C;"> ens33</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph_docker_image_tag:</span><span style="color:#A3BE8C;"> v4.0.22-stable-4.0-nautilus-centos-7-x86_64</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">containerized_deployment:</span><span style="color:#A3BE8C;"> True</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">dashboard_admin_password:</span><span style="color:#A3BE8C;"> password@123456</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">grafana_admin_password:</span><span style="color:#A3BE8C;"> password@123456</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">no_log_on_ceph_key_tasks:</span><span style="color:#A3BE8C;"> False</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-group-vars-osds-yml" tabindex="-1"><a class="header-anchor" href="#修改-group-vars-osds-yml"><span>修改 group_vars/osds.yml</span></a></h3><div class="language-yaml line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="yml" data-title="yml"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-yaml;"><code><span class="line"><span class="line"><span style="color:#8FBCBB;">devices</span><span style="color:#ECEFF4;">:</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdb</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdc</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">	-</span><span style="color:#A3BE8C;"> /dev/sdd</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="docker-ceph-部署" tabindex="-1"><a class="header-anchor" href="#docker-ceph-部署"><span>Docker Ceph 部署</span></a></h3><p>可能遇到 ceph-ansible 和已安装的 docker 冲突的情况</p><ul><li><a href="https://github.com/ceph/ceph-ansible/issues/5159" target="_blank" rel="noopener noreferrer">https://github.com/ceph/ceph-ansible/issues/5159</a></li><li><a href="https://github.com/ceph/ceph-ansible/issues/3609" target="_blank" rel="noopener noreferrer">https://github.com/ceph/ceph-ansible/issues/3609</a></li></ul><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> site-container.yml.sample</span><span style="color:#A3BE8C;"> site-container.yml</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 验证连通性</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> all</span><span style="color:#A3BE8C;"> -m</span><span style="color:#A3BE8C;"> ping</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 部署 ceph</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> site-container.yml</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/opt/ceph/venv/bin/python</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 或者指定 /usr/bin/python2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> site-container.yml</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/usr/bin/python2</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="部署后-ceph-service-位置" tabindex="-1"><a class="header-anchor" href="#部署后-ceph-service-位置"><span>部署后 Ceph Service 位置</span></a></h3><p>ceph-ansible 将会把所有的 ceph 组件分别对应到各自的 service 中</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">ls</span><span style="color:#A3BE8C;"> -l</span><span style="color:#A3BE8C;"> /etc/systemd/system/ceph</span><span style="color:#81A1C1;">*</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="出错回滚" tabindex="-1"><a class="header-anchor" href="#出错回滚"><span>出错回滚</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 清理集群，会将所有的容器和镜像全部清除</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> infrastructure-playbooks/purge-cluster.yml</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 手动清除 ceph 相关文件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rm</span><span style="color:#A3BE8C;"> -rf</span><span style="color:#A3BE8C;"> /etc/ceph/</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> rm</span><span style="color:#A3BE8C;"> -rf</span><span style="color:#A3BE8C;"> /var/lib/ceph/</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 检测硬盘分区</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">lsblk</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 如输出内容，需要移除 LVM 逻辑卷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sdc</span><span style="color:#A3BE8C;">     8:32</span><span style="color:#B48EAD;">   0</span><span style="color:#A3BE8C;"> 447.1G</span><span style="color:#B48EAD;">  0</span><span style="color:#A3BE8C;"> disk</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">└─ceph--399e8b5a--4348xxxx</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 移除 LVM 逻辑卷</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">lvremove</span><span style="color:#A3BE8C;"> /dev/ceph-399e8b5a--4348xxxx</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="集群升级" tabindex="-1"><a class="header-anchor" href="#集群升级"><span>集群升级</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># 升级集群</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/ceph/ceph-ansible</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible-playbook</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> hosts</span><span style="color:#A3BE8C;"> infrastructure-playbooks/rolling_update.yml</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_package_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_service_name=docker-ce</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> container_binding_name=python-docker-py</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问控制台" tabindex="-1"><a class="header-anchor" href="#访问控制台"><span>访问控制台</span></a></h3><ul><li>Ceph 控制台：https://192.168.93.101:8443/#/login，账号密码 admin/password@123456</li><li>Grafana 控制台：https://10.247.53.6:3000/login，账号密码 admin/password@123456</li></ul><h2 id="安装-kolla-ansible-train" tabindex="-1"><a class="header-anchor" href="#安装-kolla-ansible-train"><span>安装 Kolla Ansible Train</span></a></h2><h3 id="创建虚拟环境-1" tabindex="-1"><a class="header-anchor" href="#创建虚拟环境-1"><span>创建虚拟环境</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 安装虚拟环境依赖</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> python-devel</span><span style="color:#A3BE8C;"> libselinux-python</span><span style="color:#A3BE8C;"> python-virtualenv</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建虚拟环境</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virtualenv</span><span style="color:#A3BE8C;"> /opt/openstack/venv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 激活</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /opt/openstack/venv/bin/activate</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装并配置-ansible" tabindex="-1"><a class="header-anchor" href="#安装并配置-ansible"><span>安装并配置 Ansible</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/openstack</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 在虚拟环境中执行</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> pip</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> setuptools</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">ansible&lt;2.10</span><span style="color:#ECEFF4;">&#39;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/ansible/ansible.cfg</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">defaults</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">host_key_checking</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">False</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">pipelining</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">True</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">forks</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">100</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="安装-kolla-ansible" tabindex="-1"><a class="header-anchor" href="#安装-kolla-ansible"><span>安装 Kolla Ansible</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/openstack</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 拟环境中执行</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> kolla-ansible</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> docker</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> -U</span><span style="color:#A3BE8C;"> websocket-client</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> mkdir</span><span style="color:#A3BE8C;"> -p</span><span style="color:#A3BE8C;"> /etc/kolla</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">sudo</span><span style="color:#A3BE8C;"> chown</span><span style="color:#D8DEE9;"> $USER</span><span style="color:#A3BE8C;">:</span><span style="color:#D8DEE9;">$USER</span><span style="color:#A3BE8C;"> /etc/kolla</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 复制 kolla 的文件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> -r</span><span style="color:#A3BE8C;"> /opt/openstack/venv/share/kolla-ansible/etc_examples/kolla/</span><span style="color:#81A1C1;">*</span><span style="color:#A3BE8C;"> /etc/kolla</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> /opt/openstack/venv/share/kolla-ansible/ansible/inventory/</span><span style="color:#81A1C1;">*</span><span style="color:#A3BE8C;"> .</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ll</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-kolla-ansible-配置" tabindex="-1"><a class="header-anchor" href="#修改-kolla-ansible-配置"><span>修改 Kolla Ansible 配置</span></a></h3><h3 id="修改-inventory-文件-multinode" tabindex="-1"><a class="header-anchor" href="#修改-inventory-文件-multinode"><span>修改 Inventory 文件（multinode）</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">control</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:3]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">network</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:3]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">compute</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:5]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">monitoring</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node05</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">storage</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">node0[1:3]</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">deployment</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">localhost</span><span style="color:#A3BE8C;">       ansible_connection=local</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="生成-kolla-密钥" tabindex="-1"><a class="header-anchor" href="#生成-kolla-密钥"><span>生成 Kolla 密钥</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 执行</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-genpwd</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 查看内容，keystone_admin_password 可修改，登录 dashboard 会用到</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /etc/kolla/passwords.yml</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="修改-globals-yml" tabindex="-1"><a class="header-anchor" href="#修改-globals-yml"><span>修改 globals.yml</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/globals.yml</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 修改内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla_base_distro:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">centos</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla_install_type:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">binary</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack_release:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">train</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla_internal_vip_address:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">192.168.93.100</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">network_interface:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ens33</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">neutron_external_interface:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ens35</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">enable_cinder:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">enable_neutron_provider_networks:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack_region_name:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">RegionOne</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">enable_chrony:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">no</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">enable_ceph:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">no</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">glance_backend_ceph:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cinder_backend_ceph:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">nova_backend_ceph:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">gnocchi_backend_storage:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">ceph</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">enable_manila_backend_cephfs_native:</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">yes</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">docker_custom_config:</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">  registry-mirrors:</span><span style="color:#D8DEE9FF;"> </span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> http://192.168.93.1:4000</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> https://dockerproxy.com</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> https://hub-mirror.c.163.com</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> https://mirror.baidubce.com</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> https://ccr.ccs.tencentyun.com</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    -</span><span style="color:#A3BE8C;"> https://registry.docker-cn.com</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="设置-external-ceph" tabindex="-1"><a class="header-anchor" href="#设置-external-ceph"><span>设置 External ceph</span></a></h3><h4 id="创建-ceph-pool" tabindex="-1"><a class="header-anchor" href="#创建-ceph-pool"><span>创建 ceph pool</span></a></h4><p>在 ceph 中创建存储池 pool</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 进入 ceph 容器</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> exec</span><span style="color:#A3BE8C;"> -it</span><span style="color:#A3BE8C;"> ceph-mon</span><span style="color:#A3BE8C;"> /bin/sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 分别创建备份 pool</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> images</span><span style="color:#B48EAD;"> 128</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> instances</span><span style="color:#B48EAD;"> 128</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> volumes</span><span style="color:#B48EAD;"> 128</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> backups</span><span style="color:#B48EAD;"> 128</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 初始化 pool</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> init</span><span style="color:#A3BE8C;"> images</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> init</span><span style="color:#A3BE8C;"> instances</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> init</span><span style="color:#A3BE8C;"> volumes</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> init</span><span style="color:#A3BE8C;"> backups</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 查看 pool 的情况</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> ls</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="创建-ceph-user" tabindex="-1"><a class="header-anchor" href="#创建-ceph-user"><span>创建 ceph user</span></a></h4><p>在 ceph 中创建对应 pool 的 user，输出的 keyring 将用于 openstack 集成 ceph</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 进入 ceph 容器</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">docker</span><span style="color:#A3BE8C;"> exec</span><span style="color:#A3BE8C;"> -it</span><span style="color:#A3BE8C;"> ceph-mon</span><span style="color:#A3BE8C;"> /bin/sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建 glance</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> get-or-create</span><span style="color:#A3BE8C;"> client.glance</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mon</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	osd</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=images</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mgr</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=images</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/tmp/ceph.client.glance.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 输出 keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /tmp/ceph.client.glance.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.glance</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQC627hkgS2WKhAAQLPn80a8m7CxysJ/vasvJA==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 创建 cinder</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> get-or-create</span><span style="color:#A3BE8C;"> client.cinder</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mon</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	osd</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=volumes, profile rbd pool=instances, profile rbd-read-only pool=images</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mgr</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=volumes, profile rbd pool=instances</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/tmp/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 输出 keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /tmp/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQD627hkgs6+KhAAjveZJ159j0oKAGdGp7Ss8A==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 创建 cinder-backup</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> get-or-create</span><span style="color:#A3BE8C;"> client.cinder-backup</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mon</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	osd</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=backups</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mgr</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=backups</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/tmp/ceph.client.cinder-backup.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 输出 keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /tmp/ceph.client.cinder-backup.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder-backup</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQAw3LhkgXPpLRAAUTqHmwNh29+nswRWjsUo+Q==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 创建 nova</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> get-or-create</span><span style="color:#A3BE8C;"> client.nova</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mon</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	osd</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=instances</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mgr</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=instances</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#81A1C1;"> &gt;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	/tmp/ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 输出 keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /tmp/ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.nova</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQBY3LhkGmfyARAA25e4H/Dc3Fd02NSCSN3UmA==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.6 查看 user 的情况</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> ls</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="glance-external-ceph" tabindex="-1"><a class="header-anchor" href="#glance-external-ceph"><span>Glance External ceph</span></a></h4><h5 id="设置-glance-api-conf" tabindex="-1"><a class="header-anchor" href="#设置-glance-api-conf"><span>设置 glance-api.conf</span></a></h5><p>在 glance-api.conf 中配置 RBD 后端存储</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 创建并编辑 glance-api.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/glance/glance-api.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">glance_store</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">stores</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> rbd</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">default_store</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> rbd</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_store_pool</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> images</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_store_user</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> glance</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_store_ceph_conf</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> /etc/ceph/ceph.conf</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="设置-ceph-conf" tabindex="-1"><a class="header-anchor" href="#设置-ceph-conf"><span>设置 ceph.conf</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 复制 ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> /etc/ceph/ceph.conf</span><span style="color:#A3BE8C;"> /etc/kolla/config/glance/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/glance/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">global</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">fsid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> 1d89fec3-325a-4963-a950-c4afedd37fe3</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> cluster</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> service</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> client</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建-keyring" tabindex="-1"><a class="header-anchor" href="#创建-keyring"><span>创建 keyring</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 创建并编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/glance/ceph.client.glance.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容复制 /tmp/ceph.client.glance.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.glance</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQAX9LNkAAAAABAA2qfvgDC4wqZm8PKBcWBY4g==</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="cinder-external-ceph" tabindex="-1"><a class="header-anchor" href="#cinder-external-ceph"><span>Cinder External ceph</span></a></h4><h5 id="设置-cinder-volume-conf" tabindex="-1"><a class="header-anchor" href="#设置-cinder-volume-conf"><span>设置 cinder-volume.conf</span></a></h5><p>cinder_rbd_secret_uuid 在 /etc/kolla/passwords.yml 文件中</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 输出 cinder_rbd_secret_uuid</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cat</span><span style="color:#A3BE8C;"> /etc/kolla/passwords.yml</span><span style="color:#81A1C1;"> |</span><span style="color:#88C0D0;"> grep</span><span style="color:#A3BE8C;"> cinder_rbd_secret_uuid</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建并编辑 cinder-volume.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-volume.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 内容 cinder_rbd_secret_uuid 在 /etc/kolla/passwords.yml 文件中</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">DEFAULT</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">enabled_backends</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd-1</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">rbd-1</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_ceph_conf</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">/etc/ceph/ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_user</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backend_host</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd:volumes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_pool</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">volumes</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_backend_name</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd-1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_driver</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder.volume.drivers.rbd.RBDDriver</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_secret_uuid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {{ cinder_rbd_secret_uuid }}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h6 id="挂载多个存储池" tabindex="-1"><a class="header-anchor" href="#挂载多个存储池"><span>挂载多个存储池</span></a></h6><ol><li><p>创建新的 pool</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> osd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> create</span><span style="color:#A3BE8C;"> volumes_two</span><span style="color:#B48EAD;"> 128</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd</span><span style="color:#A3BE8C;"> pool</span><span style="color:#A3BE8C;"> init</span><span style="color:#A3BE8C;"> volumes_two</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>更新 ceph 的 client.cinder user</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">ceph</span><span style="color:#A3BE8C;"> auth</span><span style="color:#A3BE8C;"> caps</span><span style="color:#A3BE8C;"> client.cinder</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mon</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	osd</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=volumes, profile rbd pool=volumes_two, profile rbd pool=instances, profile rbd-read-only pool=images</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	mgr</span><span style="color:#ECEFF4;"> &#39;</span><span style="color:#A3BE8C;">profile rbd pool=volumes, profile rbd pool=volumes_two, profile rbd pool=instances</span><span style="color:#ECEFF4;">&#39;</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>设置 cinder-volume.conf</p><p>cinder-volume 挂载多个池时的 cinder-volume.conf，如果已经使用 kolla 部署了 Openstack 则可以直接修改对应的 cinder 节点上的 /etc/kolla/cinder-volume/cinder.conf 后重启 cinder_volume 容器</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">DEFAULT</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">enabled_backends</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd-1,rbd-2</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">rbd-1</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_ceph_conf</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">/etc/ceph/ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_user</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backend_host</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd:volumes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_pool</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">volumes</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_backend_name</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd-1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_driver</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder.volume.drivers.rbd.RBDDriver</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_secret_uuid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {{ cinder_rbd_secret_uuid }}</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">rbd-2</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_ceph_conf</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">/etc/ceph/ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_user</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder</span><span style="color:#616E88;">                   # 需要 ceph auth caps 命令更新 user</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backend_host</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd:volumes</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_pool</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">volumes_two</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_backend_name</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd-2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">volume_driver</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder.volume.drivers.rbd.RBDDriver</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">rbd_secret_uuid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> {{ cinder_rbd_secret_uuid }}</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ol><h5 id="设置-cinder-backup-conf" tabindex="-1"><a class="header-anchor" href="#设置-cinder-backup-conf"><span>设置 cinder-backup.conf</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 创建并编辑 cinder-volume.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-backup.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">DEFAULT</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backup_ceph_conf</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">/etc/ceph/ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backup_ceph_user</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">cinder-backup</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">backup_ceph_chunk_size</span><span style="color:#A3BE8C;"> =</span><span style="color:#B48EAD;"> 134217728</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">backup_ceph_pool</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">backups</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">backup_driver</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cinder.backup.drivers.ceph.CephBackupDriver</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">backup_ceph_stripe_unit</span><span style="color:#A3BE8C;"> =</span><span style="color:#B48EAD;"> 0</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">backup_ceph_stripe_count</span><span style="color:#A3BE8C;"> =</span><span style="color:#B48EAD;"> 0</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">restore_discard_excess_bytes</span><span style="color:#A3BE8C;"> =</span><span style="color:#81A1C1;"> true</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="设置-ceph-conf-1" tabindex="-1"><a class="header-anchor" href="#设置-ceph-conf-1"><span>设置 ceph.conf</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 复制 ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> /etc/ceph/ceph.conf</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">global</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">fsid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> 1d89fec3-325a-4963-a950-c4afedd37fe3</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> cluster</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> service</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> client</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建-keyring-1" tabindex="-1"><a class="header-anchor" href="#创建-keyring-1"><span>创建 keyring</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 创建并编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-backup/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容复制 /tmp/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQAg5YRXpChaGRAAlTSCleesthCRmCYrfQVX1w==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 创建并编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-backup/ceph.client.cinder-backup.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 内容复制 /tmp/ceph.client.cinder-backup.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder-backup</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQAg5YRXpChaGRAAlTSCleesthCRmCYrfQVX1w==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 创建并编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-volume/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 内容复制 /tmp/ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQAg5YRXpChaGRAAlTSCleesthCRmCYrfQVX1w==</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="nova-external-ceph" tabindex="-1"><a class="header-anchor" href="#nova-external-ceph"><span>Nova External ceph</span></a></h4><p>如果使用 ceph-ansible 部署的 ceph，需要将 ceph.client.cinder.keyring 复制为 /etc/kolla/config/nova/ceph.client.nova.keyring</p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 复制 ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> /etc/ceph/ceph.conf</span><span style="color:#A3BE8C;"> /etc/kolla/config/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/ceph.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">global</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">fsid</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> 1d89fec3-325a-4963-a950-c4afedd37fe3</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 添加内容</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> cluster</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> service</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">auth</span><span style="color:#A3BE8C;"> client</span><span style="color:#A3BE8C;"> required</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> cephx</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 复制 ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cp</span><span style="color:#A3BE8C;"> /etc/kolla/config/cinder/cinder-volume/ceph.client.cinder.keyring</span><span style="color:#A3BE8C;"> /etc/kolla/config/nova/ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 编辑 ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/nova/ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 添加内容复制 /tmp/ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.nova</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQBY3LhkGmfyARAA25e4H/Dc3Fd02NSCSN3UmA==</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">client.cinder</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">key</span><span style="color:#A3BE8C;"> =</span><span style="color:#A3BE8C;"> AQD627hkgs6+KhAAjveZJ159j0oKAGdGp7Ss8A==</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h5 id="创建-nova-compute-conf" tabindex="-1"><a class="header-anchor" href="#创建-nova-compute-conf"><span>创建 nova-compute.conf</span></a></h5><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 创建并编辑</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">vim</span><span style="color:#A3BE8C;"> /etc/kolla/config/nova/nova-compute.conf</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.1 内容</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">[</span><span style="color:#D8DEE9FF;">libvirt</span><span style="color:#ECEFF4;">]</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">images_rbd_pool</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">instances</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">images_type</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">rbd</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">images_rbd_ceph_conf</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">/etc/ceph/ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9;">rbd_user</span><span style="color:#81A1C1;">=</span><span style="color:#A3BE8C;">nova</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="目录结构" tabindex="-1"><a class="header-anchor" href="#目录结构"><span>目录结构</span></a></h4><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#88C0D0;">tree</span><span style="color:#A3BE8C;"> /etc/kolla/config/</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">/etc/kolla/config/</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">├──</span><span style="color:#A3BE8C;"> cinder</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> cinder-backup</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   │</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> ceph.client.cinder-backup.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   │</span><span style="color:#A3BE8C;">   └──</span><span style="color:#A3BE8C;"> ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> cinder-backup.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> cinder-volume</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   │</span><span style="color:#A3BE8C;">   └──</span><span style="color:#A3BE8C;"> ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   └──</span><span style="color:#A3BE8C;"> cinder-volume.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">├──</span><span style="color:#A3BE8C;"> glance</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> ceph.client.glance.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   ├──</span><span style="color:#A3BE8C;"> ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">│</span><span style="color:#A3BE8C;">   └──</span><span style="color:#A3BE8C;"> glance-api.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">└──</span><span style="color:#A3BE8C;"> nova</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    ├──</span><span style="color:#A3BE8C;"> ceph.client.cinder.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    ├──</span><span style="color:#A3BE8C;"> ceph.client.nova.keyring</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    ├──</span><span style="color:#A3BE8C;"> ceph.conf</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">    └──</span><span style="color:#A3BE8C;"> nova-compute.conf</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="部署-openstack" tabindex="-1"><a class="header-anchor" href="#部署-openstack"><span>部署 OpenStack</span></a></h2><h3 id="安装-openstack" tabindex="-1"><a class="header-anchor" href="#安装-openstack"><span>安装 OpenStack</span></a></h3><ul><li>virtualenv: <a href="https://docs.openstack.org/kolla-ansible/train/reference/deployment-and-bootstrapping/bootstrap-servers.html" target="_blank" rel="noopener noreferrer">https://docs.openstack.org/kolla-ansible/train/reference/deployment-and-bootstrapping/bootstrap-servers.html</a></li><li>ansible_python_interpreter: <a href="https://docs.openstack.org/kolla-ansible/train/user/virtual-environments.html" target="_blank" rel="noopener noreferrer">https://docs.openstack.org/kolla-ansible/train/user/virtual-environments.html</a></li></ul><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 检测节点连通性</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /opt/openstack</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> all</span><span style="color:#A3BE8C;"> -m</span><span style="color:#A3BE8C;"> ping</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> certificates</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 根据 Kolla 部署依赖创建服务器</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> bootstrap-servers</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-v</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 部署前检查主机</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> prechecks</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/opt/openstack/venv/bin/python</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.5 拉取镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> pull</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/opt/openstack/venv/bin/python</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.6 部署 OpenStack</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> deploy</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> ansible_python_interpreter=/opt/openstack/venv/bin/python</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> deploy</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">	</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">##################</span></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 启动所有节点 openstack 服务</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> start</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--yes-i-really-really-mean-it</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 停止所有节点 openstack 服务</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> stop</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--yes-i-really-really-mean-it</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 销毁所有节点 openstack 服务</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> destroy</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-e</span><span style="color:#A3BE8C;"> virtualenv=/opt/openstack/venv</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	--yes-i-really-really-mean-it</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">	-vvvv</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># 重置所有节点的数据库</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> -i</span><span style="color:#A3BE8C;"> multinode</span><span style="color:#A3BE8C;"> mariadb_recovery</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="使用-openstack" tabindex="-1"><a class="header-anchor" href="#使用-openstack"><span>使用 OpenStack</span></a></h3><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1 安装 OpenStack CLI 客户端</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">pip</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> python-openstackclient</span><span style="color:#A3BE8C;"> python-glanceclient</span><span style="color:#A3BE8C;"> python-neutronclient</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2 生成 openrc 文件</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">kolla-ansible</span><span style="color:#A3BE8C;"> post-deploy</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 执行脚本，将密码设置到环境变量中</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">source</span><span style="color:#A3BE8C;"> /etc/kolla/admin-openrc.sh</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 执行脚本生成示例网络、镜像、实例等</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">cd</span><span style="color:#A3BE8C;"> /usr/local/share/kolla-ansible</span><span style="color:#ECEFF4;"> &amp;&amp;</span><span style="color:#88C0D0;"> ./init-runonce</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="访问-horizon" tabindex="-1"><a class="header-anchor" href="#访问-horizon"><span>访问 horizon</span></a></h3><p>访问 ip 地址可进入 horizon 登录界面</p><ul><li>用户名：admin</li><li>密码：查看 /etc/kolla/passwords.yml</li></ul><h2 id="创建镜像" tabindex="-1"><a class="header-anchor" href="#创建镜像"><span>创建镜像</span></a></h2><p>OpenStack 默认支持的镜像 <a href="https://docs.openstack.org/image-guide/obtain-images.html" target="_blank" rel="noopener noreferrer">https://docs.openstack.org/image-guide/obtain-images.html</a></p><div class="language-bash line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sh" data-title="sh"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-bash;"><code><span class="line"><span class="line"><span style="color:#616E88;"># step.1</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">yum</span><span style="color:#A3BE8C;"> install</span><span style="color:#A3BE8C;"> libguestfs-tools</span><span style="color:#A3BE8C;"> -y</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.2</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">export</span><span style="color:#D8DEE9;"> LIBGUESTFS_BACKEND</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9;">direct</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.3 设置镜像密码，否则会创建虚拟机时会随机生成密码</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virt-customize</span><span style="color:#A3BE8C;"> -a</span><span style="color:#A3BE8C;"> ./CentOS-7-x86_64-GenericCloud-2009.qcow2</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --root-password</span><span style="color:#A3BE8C;"> password:123456</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">virt-customize</span><span style="color:#A3BE8C;"> -a</span><span style="color:#A3BE8C;"> ./debian-9.13.42-20220706-openstack-amd64.qcow2</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --root-password</span><span style="color:#A3BE8C;"> password:123456</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;"># step.4 创建 glance 镜像</span></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> create</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">CentOS-7-x86_64-GenericCloud-2009</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --public</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --min-ram</span><span style="color:#B48EAD;"> 512</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --min-disk</span><span style="color:#B48EAD;"> 20</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --disk-format</span><span style="color:#A3BE8C;"> qcow2</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --container-format</span><span style="color:#A3BE8C;"> bare</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --file</span><span style="color:#A3BE8C;"> ./CentOS-7-x86_64-GenericCloud-2009.qcow2</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#88C0D0;">openstack</span><span style="color:#A3BE8C;"> image</span><span style="color:#A3BE8C;"> create</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">debian-9.13.42-20220706-openstack-amd64</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --public</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --min-ram</span><span style="color:#B48EAD;"> 512</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --min-disk</span><span style="color:#B48EAD;"> 20</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --disk-format</span><span style="color:#A3BE8C;"> qcow2</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --container-format</span><span style="color:#A3BE8C;"> bare</span><span style="color:#EBCB8B;"> \</span></span></span>
<span class="line"><span class="line"><span style="color:#A3BE8C;">  --file</span><span style="color:#A3BE8C;"> ./debian-9.13.42-20220706-openstack-amd64.qcow2</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/hyfly233/blog/edit/main/md/article/cloud/openstack/Kolla及Ceph部署.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hyfly233@outlook.com">hyfly233</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: 1274694743@qq.com">hyfly233</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-chPKMbRn.js" defer></script>
  </body>
</html>
