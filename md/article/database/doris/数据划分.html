<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.19" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const userMode = localStorage.getItem('vuepress-color-scheme')
      const systemDarkMode =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (userMode === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (userMode === 'dark' || systemDarkMode) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <title>とんぼの気持ち</title><meta name="description" content="">
    <link rel="preload" href="/blog/assets/style-nxaj3WOG.css" as="style"><link rel="stylesheet" href="/blog/assets/style-nxaj3WOG.css">
    <link rel="modulepreload" href="/blog/assets/app-chPKMbRn.js"><link rel="modulepreload" href="/blog/assets/数据划分.html-yeEAwxQ-.js">
    <link rel="prefetch" href="/blog/assets/directory.html-CM077g0X.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-WkqGtERh.js" as="script"><link rel="prefetch" href="/blog/assets/directory.html-BH0WGkAw.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible扩充OSD节点.html-DQGhyA8S.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible的OSD存储满后的临时解决方案.html-BDuF8Lky.js" as="script"><link rel="prefetch" href="/blog/assets/CephAnsible部署Ceph.html-B1ua_UqN.js" as="script"><link rel="prefetch" href="/blog/assets/iSCSI安装.html-HVTL7fJU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BceON7lL.js" as="script"><link rel="prefetch" href="/blog/assets/如何升级系统构架.html-B16ubYTA.js" as="script"><link rel="prefetch" href="/blog/assets/如何正确加锁.html-DjvlAowS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C3nYQ7aQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BmNefUmR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DJsvdjYt.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlgG4jCN.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bp1xrcuH.js" as="script"><link rel="prefetch" href="/blog/assets/linear_search.html-Dr3lRrFe.js" as="script"><link rel="prefetch" href="/blog/assets/binary_tree_sort.html-BZSaHXpo.js" as="script"><link rel="prefetch" href="/blog/assets/bitonic_sort.html-DZHRyZF8.js" as="script"><link rel="prefetch" href="/blog/assets/bubble_sort.html-XLBBj8rD.js" as="script"><link rel="prefetch" href="/blog/assets/bucket_sort.html-D1NDEl5q.js" as="script"><link rel="prefetch" href="/blog/assets/cocktail_shaker_sort.html-sQF3C84o.js" as="script"><link rel="prefetch" href="/blog/assets/comb_sort.html-B6Z7wIqt.js" as="script"><link rel="prefetch" href="/blog/assets/counting_sort.html-D8wkfUEd.js" as="script"><link rel="prefetch" href="/blog/assets/gnome_sort.html-ClFIwPrf.js" as="script"><link rel="prefetch" href="/blog/assets/heap_sort.html-Rp3rKaBj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DSXsiBgb.js" as="script"><link rel="prefetch" href="/blog/assets/insertion_sort.html-Cb45Fk0s.js" as="script"><link rel="prefetch" href="/blog/assets/merge_sort.html-DKhyfHNj.js" as="script"><link rel="prefetch" href="/blog/assets/odd_even_sort.html-BUUtGCfM.js" as="script"><link rel="prefetch" href="/blog/assets/pancake_sort.html-CLbqQfeK.js" as="script"><link rel="prefetch" href="/blog/assets/quick_sort.html-DsTl6rI_.js" as="script"><link rel="prefetch" href="/blog/assets/radix_sort.html-DGfsIMQr.js" as="script"><link rel="prefetch" href="/blog/assets/selection_sort.html-CWB7HCPo.js" as="script"><link rel="prefetch" href="/blog/assets/shell_sort.html-RYeqqTj9.js" as="script"><link rel="prefetch" href="/blog/assets/smooth_sort.html-B0t6JSLd.js" as="script"><link rel="prefetch" href="/blog/assets/stooge_sort.html-YfhFB3iG.js" as="script"><link rel="prefetch" href="/blog/assets/tim_sort.html-BoCSzhxx.js" as="script"><link rel="prefetch" href="/blog/assets/ESXI虚机迁移至OpenStack.html-6EM4grfG.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla使用Libvirt.html-BH6Q3PvO.js" as="script"><link rel="prefetch" href="/blog/assets/Kolla及Ceph部署.html-DBRpVcxj.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BlM2okaw.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DuySOOS7.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COYjVXza.js" as="script"><link rel="prefetch" href="/blog/assets/环境搭建.html-BwslABub.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bk5wCQBA.js" as="script"><link rel="prefetch" href="/blog/assets/Schema变更.html-CmXDyeR-.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bl4wowJu.js" as="script"><link rel="prefetch" href="/blog/assets/动态分区和RoutineLoad.html-BYzTxZd0.js" as="script"><link rel="prefetch" href="/blog/assets/存算分离.html-9GVDpuqQ.js" as="script"><link rel="prefetch" href="/blog/assets/数据库建表最佳实践.html-CU31WBJ2.js" as="script"><link rel="prefetch" href="/blog/assets/日志存储最佳实践.html-BJPmJmHB.js" as="script"><link rel="prefetch" href="/blog/assets/表模型.html-lvuDP8dJ.js" as="script"><link rel="prefetch" href="/blog/assets/表索引.html-Ck9S3vCk.js" as="script"><link rel="prefetch" href="/blog/assets/表设计.html-tk_DoCsV.js" as="script"><link rel="prefetch" href="/blog/assets/集群部署.html-4idh13Cl.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Cth5DVaR.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ZicgUK5U.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DoXHiDiT.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CrHNcY8F.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CUx8GfJe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHVKGkTF.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-COz27HnP.js" as="script"><link rel="prefetch" href="/blog/assets/query.html-DoPeGCPi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-w3kLOssO.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DTpqBRxQ.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BxORDID2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-k7IOKuSo.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-CQB9Z0b8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-EtRq-J4i.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-JVp3vOGH.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DQBe6C8G.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BHiZJrZY.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DIai_jYU.js" as="script"><link rel="prefetch" href="/blog/assets/TerraformFramework实现Provider.html-DmR-BbHm.js" as="script"><link rel="prefetch" href="/blog/assets/Terraform命令.html-CSe_xkG9.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-1hZwCU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DCKXXjZh.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C0awBswM.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Wn39Nn3s.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bzvj5tms.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BE5TLZ79.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-BH9xzrDi.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-fENjPdqb.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-DBCYo0z6.js" as="script"><link rel="prefetch" href="/blog/assets/Rsyslog日志转存.html-VynoGpA4.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-49epSqc8.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B_flGDt0.js" as="script"><link rel="prefetch" href="/blog/assets/SeaTunnel数据库CDC配置.html-ON8CoGPS.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-ChXgdJTg.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Bc5oNQiy.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-B-dcPYv2.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-Ck1dZsqe.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-3t4G-zts.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-KRPZcEBU.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-RQaezZK1.js" as="script"><link rel="prefetch" href="/blog/assets/ZabbixAgent安装及自定义脚本.html-DKURZalB.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C29L2VNh.js" as="script"><link rel="prefetch" href="/blog/assets/zabbix安装.html-FEQL6thK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-R3ii_NIK.js" as="script"><link rel="prefetch" href="/blog/assets/index.html-C5_B4zlm.js" as="script"><link rel="prefetch" href="/blog/assets/SQL.html-89x0k9Cm.js" as="script"><link rel="prefetch" href="/blog/assets/数据库优化.html-K6nWNgZK.js" as="script"><link rel="prefetch" href="/blog/assets/数据库索引.html-BX4K5xTn.js" as="script"><link rel="prefetch" href="/blog/assets/数据库锁与事务.html-CS8d_ANn.js" as="script"><link rel="prefetch" href="/blog/assets/Mybatis.html-CIkBxdDk.js" as="script"><link rel="prefetch" href="/blog/assets/Java基础.html-D_QRBbpt.js" as="script"><link rel="prefetch" href="/blog/assets/Java调优.html-B4RoEDf7.js" as="script"><link rel="prefetch" href="/blog/assets/Java进阶.html-Db99JmhM.js" as="script"><link rel="prefetch" href="/blog/assets/反射.html-B9fatXTn.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-CxbSCpUd.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html-B6SpjkfJ.js" as="script"><link rel="prefetch" href="/blog/assets/集合.html-CUZ1m7It.js" as="script"><link rel="prefetch" href="/blog/assets/面向对象.html-UMaUbHDD.js" as="script"><link rel="prefetch" href="/blog/assets/jvm.html-BWNS3e3B.js" as="script"><link rel="prefetch" href="/blog/assets/JUC.html-DLUivWNX.js" as="script"><link rel="prefetch" href="/blog/assets/ThreadLocal.html-BYxYh7yT.js" as="script"><link rel="prefetch" href="/blog/assets/多线程.html-BmpsxTLI.js" as="script"><link rel="prefetch" href="/blog/assets/线程池.html-DwozZdb4.js" as="script"><link rel="prefetch" href="/blog/assets/锁.html--5qDdUfD.js" as="script"><link rel="prefetch" href="/blog/assets/Redis.html-BsKKSiRX.js" as="script"><link rel="prefetch" href="/blog/assets/ElasticSearch.html-Pn1J3Cur.js" as="script"><link rel="prefetch" href="/blog/assets/JVM.html-DNvsmY-J.js" as="script"><link rel="prefetch" href="/blog/assets/JVM内存模型.html-CZyniu0B.js" as="script"><link rel="prefetch" href="/blog/assets/JVM对高效并发的支持.html-eb1cM9Dq.js" as="script"><link rel="prefetch" href="/blog/assets/JVM工具和JVM调优.html--xINkAvq.js" as="script"><link rel="prefetch" href="/blog/assets/垃圾回收.html-WnvI2chO.js" as="script"><link rel="prefetch" href="/blog/assets/Spring.html-B4O33Fe1.js" as="script"><link rel="prefetch" href="/blog/assets/SpringBoot.html-O44ccL2x.js" as="script"><link rel="prefetch" href="/blog/assets/SpringMvc.html-C8kgBqP7.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloud.html-DTSK6rgN.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudAlibaba.html-BXlIalpv.js" as="script"><link rel="prefetch" href="/blog/assets/SpringCloudNetflix.html-BP0KK0nB.js" as="script"><link rel="prefetch" href="/blog/assets/Zookeeper.html-BlOTU2g8.js" as="script"><link rel="prefetch" href="/blog/assets/分布式事务.html-BphbxoLK.js" as="script"><link rel="prefetch" href="/blog/assets/分布式锁.html-CgINm6oC.js" as="script"><link rel="prefetch" href="/blog/assets/404.html-5cdhF5yj.js" as="script"><link rel="prefetch" href="/blog/assets/setupDevtools-7MC2TMWH-CYpgxpoD.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/blog/"><img class="vp-site-logo" src="/blog/assets/img/game.ico" alt="とんぼの気持ち"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">とんぼの気持ち</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/blog/" aria-label="Home"><!---->Home<!----></a></div><div class="vp-navbar-item"><div class="vp-navbar-dropdown-wrapper"><button class="vp-navbar-dropdown-title" type="button" aria-label="八股文"><span class="title">八股文</span><span class="arrow down"></span></button><button class="vp-navbar-dropdown-title-mobile" type="button" aria-label="八股文"><span class="title">八股文</span><span class="right arrow"></span></button><ul style="display:none;" class="vp-navbar-dropdown"><!--[--><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Spring Cloud</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloud.html" aria-label="Spring Cloud"><!---->Spring Cloud<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudAlibaba.html" aria-label="Spring Cloud Alibaba"><!---->Spring Cloud Alibaba<!----></a></li><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/SpringCloudNetflix.html" aria-label="Spring Cloud Netflix"><!---->Spring Cloud Netflix<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>Zookeeper</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/Zookeeper.html" aria-label="Zookeeper"><!---->Zookeeper<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式锁</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式锁.html" aria-label="分布式锁"><!---->分布式锁<!----></a></li><!--]--></ul><!--]--></li><li class="vp-navbar-dropdown-item"><!--[--><h4 class="vp-navbar-dropdown-subtitle"><span>分布式事务</span></h4><ul class="vp-navbar-dropdown-subitem-wrapper"><!--[--><li class="vp-navbar-dropdown-subitem"><a class="route-link auto-link" href="/blog/md/微服务/分布式事务.html" aria-label="分布式事务"><!---->分布式事务<!----></a></li><!--]--></ul><!--]--></li><!--]--></ul></div></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/hyfly233/blog" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!---->GitHub<!----></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading"> <!----></p><!----></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div class="theme-default-content" vp-content><!--[--><!--]--><div><h2 id="概念" tabindex="-1"><a class="header-anchor" href="#概念"><span>概念</span></a></h2><p>在 Doris 中，数据分布通过合理的分区和分桶策略，将数据高效地映射到各个数据分片（Tablet）上，从而充分利用多节点的存储和计算能力，支持大规模数据的高效存储和查询。</p><h2 id="数据分布概览" tabindex="-1"><a class="header-anchor" href="#数据分布概览"><span>数据分布概览</span></a></h2><h3 id="数据写入" tabindex="-1"><a class="header-anchor" href="#数据写入"><span>数据写入</span></a></h3><p>数据写入时，Doris 首先根据表的分区策略将数据行分配到对应的分区。接着，根据分桶策略将数据行进一步映射到分区内的具体分片，从而确定了数据行的存储位置。</p><h3 id="查询执行" tabindex="-1"><a class="header-anchor" href="#查询执行"><span>查询执行</span></a></h3><p>查询运行时，Doris 的优化器会根据分区和分桶策略裁剪数据，最大化减少扫描范围。在涉及 JOIN 或聚合查询时，可能会发生跨节点的数据传输（Shuffle）。合理的分区和分桶设计可以减少 Shuffle 并充分利用 Colocate Join 优化查询性能。</p><h3 id="节点类型" tabindex="-1"><a class="header-anchor" href="#节点类型"><span>节点类型</span></a></h3><p>Doris 集群由以下两种节点组成：</p><ul><li>FE 节点（Frontend）：管理集群元数据（如表、分片），负责 SQL 的解析与执行规划。</li><li>BE 节点（Backend）：存储数据，负责计算任务的执行。BE 的结果汇总后返回至 FE，再返回给用户。</li></ul><h3 id="数据分片-tablet" tabindex="-1"><a class="header-anchor" href="#数据分片-tablet"><span>数据分片（Tablet）</span></a></h3><p>BE 节点的存储数据分片的数据，每个分片是 Doris 中数据管理的最小单元，也是数据移动和复制的基本单位。</p><h2 id="分区策略" tabindex="-1"><a class="header-anchor" href="#分区策略"><span>分区策略</span></a></h2><p>分区是数据组织的第一层逻辑划分，用于将表中的数据划分为更小的子集。Doris 提供以下两种分区类型和三种分区模式：</p><h3 id="分区类型" tabindex="-1"><a class="header-anchor" href="#分区类型"><span>分区类型</span></a></h3><ul><li>Range 分区：根据分区列的值范围将数据行分配到对应分区。</li><li>List 分区：根据分区列的具体值将数据行分配到对应分区。</li></ul><h3 id="分区模式" tabindex="-1"><a class="header-anchor" href="#分区模式"><span>分区模式</span></a></h3><ul><li>手动分区：用户手动创建分区（如建表时指定或通过 ALTER 语句增加）。</li><li>动态分区：系统根据时间调度规则自动创建分区，但写入数据时不会按需创建分区。</li><li>自动分区：数据写入时，系统根据需要自动创建相应的分区，使用时注意脏数据生成过多的分区。</li></ul><h2 id="分桶策略" tabindex="-1"><a class="header-anchor" href="#分桶策略"><span>分桶策略</span></a></h2><p>分桶是数据组织的第二层逻辑划分，用于在分区内将数据行进一步划分到更小的单元。Doris 支持以下两种分桶方式：</p><ul><li>Hash 分桶：通过计算分桶列值的 crc32 哈希值，并对分桶数取模，将数据行均匀分布到分片中。</li><li>Random 分桶：随机分配数据行到分片中。使用 Random 分桶时，可以使用 load_to_single_tablet 优化小规模数据的快速写入。</li></ul><h2 id="数据分布优化" tabindex="-1"><a class="header-anchor" href="#数据分布优化"><span>数据分布优化</span></a></h2><h3 id="colocate-join" tabindex="-1"><a class="header-anchor" href="#colocate-join"><span>Colocate Join</span></a></h3><p>对于需要频繁进行 JOIN 或聚合查询的大表，可以启用 Colocate 策略，将相同分桶列值的数据放置在同一物理节点上，减少跨节点的数据传输，从而显著提升查询性能。</p><h3 id="分区裁剪" tabindex="-1"><a class="header-anchor" href="#分区裁剪"><span>分区裁剪</span></a></h3><p>查询时，Doris 可以通过过滤条件裁剪掉不相关的分区，从而减少数据扫描范围，降低 I/O 开销。</p><h3 id="分桶并行" tabindex="-1"><a class="header-anchor" href="#分桶并行"><span>分桶并行</span></a></h3><p>查询时，合理的分桶数可以充分利用机器的计算资源和 I/O 资源。</p><h2 id="数据分布目标" tabindex="-1"><a class="header-anchor" href="#数据分布目标"><span>数据分布目标</span></a></h2><ol><li>均匀数据分布 确保数据均匀分布在各 BE 节点上，避免数据倾斜导致部分节点过载，从而提高系统整体性能。</li><li>优化查询性能 合理的分区裁剪可以大幅减少扫描的数据量，合理的分桶数可以提升计算并行度，合理利用 Colocate 可以降低 Shuffle 成本，提升 JOIN 和聚合查询效率。</li><li>灵活数据管理 <ul><li>按时间分区保存冷数据（HDD）与热数据（SSD）。</li><li>定期删除历史分区释放存储空间。</li></ul></li><li>控制元数据规模 每个分片的元数据存储在 FE 和 BE 中，因此需要合理控制分片数量。经验值建议： <ul><li>每 1000 万分片，FE 至少需 100G 内存。</li><li>单个 BE 承载的分片数应小于 2 万。</li></ul></li><li>优化写入吞吐 <ul><li>分桶数应合理控制（建议 &lt; 128），以避免写入性能下降。</li><li>每次写入的分区数量应适量（建议每次写入少量分区）。</li></ul></li></ol><h2 id="分区列" tabindex="-1"><a class="header-anchor" href="#分区列"><span>分区列</span></a></h2><ul><li>分区列可以指定一列或多列，分区列必须为 KEY 列。</li><li>不论分区列是什么类型，在写分区值时，都需要加双引号。</li><li>分区数量理论上没有上限。但默认限制每张表 4096 个分区，如果想突破这个限制，可以修改 FE 配置max_multi_partition_num和max_dynamic_partition_num 。</li><li>当不使用分区建表时，系统会自动生成一个和表名同名的，全值范围的分区。该分区对用户不可见，并且不可删改。</li><li>创建分区时不可添加范围重叠的分区。</li></ul><h2 id="手动分区" tabindex="-1"><a class="header-anchor" href="#手动分区"><span>手动分区</span></a></h2><h3 id="range-分区" tabindex="-1"><a class="header-anchor" href="#range-分区"><span>Range 分区</span></a></h3><p>分区列通常为时间列，以方便的管理新旧数据。Range 分区支持的列类型 DATE, DATETIME, TINYINT, SMALLINT, INT, BIGINT, LARGEINT。</p><p>分区信息，支持四种写法：</p><ol><li>FIXED RANGE：定义分区的左闭右开区间。</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(col1[, col2, ...])                                                                                             (                                                                                                                                     </span><span style="color:#81A1C1;">PARTITION</span><span style="color:#D8DEE9FF;"> partition_name1 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k1-lower1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k2-lower1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k3-lower1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,...), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k1-upper1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k2-upper1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k3-upper1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, ...)),     </span><span style="color:#81A1C1;">PARTITION</span><span style="color:#D8DEE9FF;"> partition_name2 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k1-lower1-2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k2-lower1-2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, ...), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">k1-upper1-2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, MAXVALUE, ))                           </span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>示例：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">date</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201701</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-01-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),  (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-02-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201702</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-02-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-03-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201703</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-03-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-04-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>LESS THAN：仅定义分区上界。下界由上一个分区的上界决定。</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(col1[, col2, ...])                                                                                             (                                                                                                                                     </span><span style="color:#81A1C1;">PARTITION</span><span style="color:#D8DEE9FF;"> partition_name1 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN MAXVALUE | (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">value1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">value2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, ...),                                                 </span><span style="color:#81A1C1;">PARTITION</span><span style="color:#D8DEE9FF;"> partition_name2 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN MAXVALUE | (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">value1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">value2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, ...)                                               )</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>示例如下：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">date</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201701</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-02-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201702</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-03-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p201703</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2017-04-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p2018</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2018-01-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2019-01-01</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">other</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN (MAXVALUE)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="3"><li>BATCH RANGE：批量创建数字类型和时间类型的 RANGE 分区，定义分区的左闭右开区间，设定步长。</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(int_col)                                                                                                       (                                                                                                                                     </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (start_num) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (end_num) INTERVAL interval_value                                                                         )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(date_col)                                                                                                     (                                                                                                                                     </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">start_date</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">end_date</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL num </span><span style="color:#81A1C1;">YEAR</span><span style="color:#D8DEE9FF;"> | num </span><span style="color:#81A1C1;">MONTH</span><span style="color:#D8DEE9FF;"> | num </span><span style="color:#81A1C1;">WEEK</span><span style="color:#D8DEE9FF;"> | num </span><span style="color:#81A1C1;">DAY</span><span style="color:#D8DEE9FF;"> ｜ </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> HOUR</span><span style="color:#D8DEE9FF;">                             )</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>示例如下：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(age)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">100</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">10</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">date</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2000-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2021-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">2</span><span style="color:#81A1C1;"> YEAR</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>4.MULTI RANGE：批量创建 RANGE 分区，定义分区的左闭右开区间。示例如下：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(col)                                                                                                           (                                                                                                                                    </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2000-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2021-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> YEAR</span><span style="color:#D8DEE9FF;">,                                                                            </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2021-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2022-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> MONTH</span><span style="color:#D8DEE9FF;">,                                                                          </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2022-11-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2023-01-03</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> WEEK</span><span style="color:#D8DEE9FF;">,                                                                            </span><span style="color:#81A1C1;">FROM</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2023-01-03</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">TO</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2023-01-14</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) INTERVAL </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> DAY</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">   PARTITION</span><span style="color:#D8DEE9FF;"> p_20230114 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2023-01-14</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2023-01-15</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))                                                                   )</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="list-分区" tabindex="-1"><a class="header-anchor" href="#list-分区"><span>List 分区</span></a></h3><p>分区列支持 BOOLEAN, TINYINT, SMALLINT, INT, BIGINT, LARGEINT, DATE, DATETIME, CHAR, VARCHAR 数据类型，分区值为枚举值。只有当数据为目标分区枚举值其中之一时，才可以命中分区。</p><p>Partition 支持通过 VALUES IN (...) 来指定每个分区包含的枚举值。</p><p>举例如下：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> LIST(city)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p_cn</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Beijing</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Shanghai</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Hong Kong</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p_usa</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">New York</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">San Francisco</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">p_jp</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Tokyo</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>List 分区也支持多列分区，示例如下：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> LIST(id, city)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#D8DEE9FF;"> p1_city </span><span style="color:#81A1C1;">VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> ((</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Beijing</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Shanghai</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#D8DEE9FF;"> p2_city </span><span style="color:#81A1C1;">VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> ((</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Beijing</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Shanghai</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    PARTITION</span><span style="color:#D8DEE9FF;"> p3_city </span><span style="color:#81A1C1;">VALUES</span><span style="color:#81A1C1;"> IN</span><span style="color:#D8DEE9FF;"> ((</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Beijing</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">Shanghai</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="null-分区" tabindex="-1"><a class="header-anchor" href="#null-分区"><span>NULL 分区</span></a></h3><p>PARTITION 列默认必须为 NOT NULL 列，如果需要使用 NULL 列，应设置 session variable allow_partition_column_nullable = true。对于 LIST PARTITION，我们支持真正的 NULL 分区。对于 RANGE PARTITION，NULL 值会被划归最小的 LESS THAN 分区。分列如下：</p><ol><li>LIST 分区</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> create</span><span style="color:#81A1C1;"> table</span><span style="color:#D8DEE9FF;"> null_list(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> k0 </span><span style="color:#81A1C1;">varchar</span><span style="color:#81A1C1;"> null</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> partition</span><span style="color:#81A1C1;"> by</span><span style="color:#D8DEE9FF;"> list (k0)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> pX </span><span style="color:#81A1C1;">values</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9FF;"> ((</span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k0</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">1</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Query OK, </span><span style="color:#B48EAD;">0</span><span style="color:#81A1C1;"> rows</span><span style="color:#D8DEE9FF;"> affected (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">11</span><span style="color:#D8DEE9FF;"> sec)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> insert into</span><span style="color:#D8DEE9FF;"> null_list </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Query OK, </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> row</span><span style="color:#D8DEE9FF;"> affected (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">19</span><span style="color:#D8DEE9FF;"> sec)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> select</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> from</span><span style="color:#D8DEE9FF;"> null_list;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| k0   |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;"> |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> row</span><span style="color:#81A1C1;"> in</span><span style="color:#81A1C1;"> set</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">18</span><span style="color:#D8DEE9FF;"> sec)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>RANGE 分区 —— 归属最小的 LESS THAN 分区</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> create</span><span style="color:#81A1C1;"> table</span><span style="color:#D8DEE9FF;"> null_range(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> k0 </span><span style="color:#81A1C1;">int</span><span style="color:#81A1C1;"> null</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> partition</span><span style="color:#81A1C1;"> by</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9FF;"> (k0)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> p10 </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> less than (</span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> p100 </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> less than (</span><span style="color:#B48EAD;">100</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> pMAX </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> less than (maxvalue)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k0</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">1</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Query OK, </span><span style="color:#B48EAD;">0</span><span style="color:#81A1C1;"> rows</span><span style="color:#D8DEE9FF;"> affected (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;"> sec)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> insert into</span><span style="color:#D8DEE9FF;"> null_range </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Query OK, </span><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> row</span><span style="color:#D8DEE9FF;"> affected (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">19</span><span style="color:#D8DEE9FF;"> sec)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> select</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> from</span><span style="color:#D8DEE9FF;"> null_range </span><span style="color:#81A1C1;">partition</span><span style="color:#D8DEE9FF;">(p10);</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| k0   |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;"> |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#B48EAD;">1</span><span style="color:#81A1C1;"> row</span><span style="color:#81A1C1;"> in</span><span style="color:#81A1C1;"> set</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">18</span><span style="color:#D8DEE9FF;"> sec)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol><li>RANGE 分区 —— 没有 LESS THAN 分区时，无法插入</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> create</span><span style="color:#81A1C1;"> table</span><span style="color:#D8DEE9FF;"> null_range2(</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> k0 </span><span style="color:#81A1C1;">int</span><span style="color:#81A1C1;"> null</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> partition</span><span style="color:#81A1C1;"> by</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9FF;"> (k0)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> p200 </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> [(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">100</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">200</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#81A1C1;"> DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k0</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">1</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">    -&gt;</span><span style="color:#D8DEE9FF;"> properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">Query OK, </span><span style="color:#B48EAD;">0</span><span style="color:#81A1C1;"> rows</span><span style="color:#D8DEE9FF;"> affected (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">13</span><span style="color:#D8DEE9FF;"> sec)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">mysql</span><span style="color:#81A1C1;">&gt;</span><span style="color:#81A1C1;"> insert into</span><span style="color:#D8DEE9FF;"> null_range2 </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">ERROR </span><span style="color:#B48EAD;">5025</span><span style="color:#D8DEE9FF;"> (HY000): </span><span style="color:#81A1C1;">Insert</span><span style="color:#D8DEE9FF;"> has filtered </span><span style="color:#81A1C1;">data</span><span style="color:#81A1C1;"> in</span><span style="color:#D8DEE9FF;"> strict mode, tracking_url</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">......</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="动态分区" tabindex="-1"><a class="header-anchor" href="#动态分区"><span>动态分区</span></a></h2><p>动态分区会按照设定的规则，滚动添加、删除分区，从而实现对表分区的生命周期管理（TTL），减少数据存储压力。在日志管理，时序数据管理等场景，通常可以使用动态分区能力滚动删除过期的数据。</p><h3 id="使用限制" tabindex="-1"><a class="header-anchor" href="#使用限制"><span>使用限制</span></a></h3><p>在使用动态分区时，需要遵守以下规则：</p><ul><li>动态分区与跨集群复制（CCR）同时使用时会失效；</li><li>动态分区只支持在 DATE/DATETIME 列上进行 Range 类型的分区；</li><li>动态分区只支持单一分区键。</li></ul><h3 id="创建动态分区" tabindex="-1"><a class="header-anchor" href="#创建动态分区"><span>创建动态分区</span></a></h3><p>在建表时，通过指定 dynamic_partition 属性，可以创建动态分区表。</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#88C0D0;"> test_dynamic_partition</span><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    order_id    </span><span style="color:#81A1C1;">BIGINT</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    create_dt   </span><span style="color:#81A1C1;">DATE</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    username    </span><span style="color:#81A1C1;">VARCHAR</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">DUPLICATE </span><span style="color:#81A1C1;">KEY</span><span style="color:#D8DEE9FF;">(order_id)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(create_dt) </span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(order_id) BUCKETS </span><span style="color:#B48EAD;">10</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">PROPERTIES(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.enable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.time_unit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DAY</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.prefix</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">p</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.create_history_partition</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="管理动态分区" tabindex="-1"><a class="header-anchor" href="#管理动态分区"><span>管理动态分区</span></a></h3><h4 id="修改动态分区属性" tabindex="-1"><a class="header-anchor" href="#修改动态分区属性"><span>修改动态分区属性</span></a></h4><p>提示：</p><p>在使用 ALTER TABLE 语句修改动态分区时，不会立即生效。会以 dynamic_partition_check_interval_seconds 参数指定的时间间隔轮训检查 dynamic partition 分区，完成需要的分区创建与删除操作。</p><p>下例中通过 ALTER TABLE 语句，将非动态分区表修改为动态分区：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#88C0D0;"> test_dynamic_partition</span><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    order_id    </span><span style="color:#81A1C1;">BIGINT</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    create_dt   </span><span style="color:#81A1C1;">DATE</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    username    </span><span style="color:#81A1C1;">VARCHAR</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">DUPLICATE </span><span style="color:#81A1C1;">KEY</span><span style="color:#D8DEE9FF;">(order_id)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(order_id) BUCKETS </span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ALTER</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> test_partition </span><span style="color:#81A1C1;">SET</span><span style="color:#D8DEE9FF;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.enable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.time_unit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DAY</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">2</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.prefix</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">p</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.create_history_partition</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="查看动态分区调度情况" tabindex="-1"><a class="header-anchor" href="#查看动态分区调度情况"><span>查看动态分区调度情况</span></a></h4><p>通过 SHOW-DYNAMIC-PARTITION 可以查看当前数据库下，所有动态分区表的调度情况：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">SHOW </span><span style="color:#81A1C1;">DYNAMIC</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> TABLES;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| TableName | </span><span style="color:#81A1C1;">Enable</span><span style="color:#D8DEE9FF;"> | TimeUnit | </span><span style="color:#81A1C1;">Start</span><span style="color:#D8DEE9FF;">       | </span><span style="color:#81A1C1;">End</span><span style="color:#D8DEE9FF;">  | Prefix | Buckets | StartOf   | LastUpdateTime | LastSchedulerTime   | </span><span style="color:#81A1C1;">State</span><span style="color:#D8DEE9FF;">  | LastCreatePartitionMsg | LastDropPartitionMsg | ReservedHistoryPeriods  |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d3        | true   | </span><span style="color:#81A1C1;">WEEK</span><span style="color:#D8DEE9FF;">     | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">          | </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">       | MONDAY    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | [2021-12-01,2021-12-31] |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d5        | true   | </span><span style="color:#81A1C1;">DAY</span><span style="color:#D8DEE9FF;">      | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">7</span><span style="color:#D8DEE9FF;">          | </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">      | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A       | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                    |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d4        | true   | </span><span style="color:#81A1C1;">WEEK</span><span style="color:#D8DEE9FF;">     | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">          | </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">       | WEDNESDAY | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                    | </span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d6        | true   | </span><span style="color:#81A1C1;">MONTH</span><span style="color:#D8DEE9FF;">    | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">2147483648</span><span style="color:#D8DEE9FF;"> | </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">8</span><span style="color:#D8DEE9FF;">       | 3rd       | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                    |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d2        | true   | </span><span style="color:#81A1C1;">DAY</span><span style="color:#D8DEE9FF;">      | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">          | </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">32</span><span style="color:#D8DEE9FF;">      | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A       | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                    |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| d7        | true   | </span><span style="color:#81A1C1;">MONTH</span><span style="color:#D8DEE9FF;">    | </span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">2147483648</span><span style="color:#D8DEE9FF;"> | </span><span style="color:#B48EAD;">5</span><span style="color:#D8DEE9FF;">    | p      | </span><span style="color:#B48EAD;">8</span><span style="color:#D8DEE9FF;">       | 24th      | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A            | </span><span style="color:#B48EAD;">2020</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">05</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">25</span><span style="color:#B48EAD;"> 14</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">24</span><span style="color:#D8DEE9FF;"> | NORMAL | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                    | N</span><span style="color:#81A1C1;">/</span><span style="color:#D8DEE9FF;">A                  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                    |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-----------+--------+----------+-------------+------+--------+---------+-----------+----------------+---------------------+--------+------------------------+----------------------+-------------------------+</span></span></span>
<span class="line"><span class="line"><span style="color:#B48EAD;">7</span><span style="color:#81A1C1;"> rows</span><span style="color:#81A1C1;"> in</span><span style="color:#81A1C1;"> set</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">02</span><span style="color:#D8DEE9FF;"> sec)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="历史分区管理" tabindex="-1"><a class="header-anchor" href="#历史分区管理"><span>历史分区管理</span></a></h4><p>在使用 start 与 end 属性指定动态分区数量时，为了避免一次性创建所有的分区造成等待时间过长，不会创建历史分区，只会创建当前时间以后得分区。如果需要一次性创建所有分区，需要开启 create_history_partition 参数。</p><p>例如当前日期为 2024-10-11，指定 start = -2，end = 2：</p><ul><li>如果指定了 create_history_partition = true，立即创建所有分区，即 [10-09, 10-13] 五个分区；</li><li>如果指定了 create_history_partition = false，只创建包含 10-11 以后的分区，即 [10-11, 10-13] 三个分区。</li></ul><h3 id="动态分区属性参数" tabindex="-1"><a class="header-anchor" href="#动态分区属性参数"><span>动态分区属性参数</span></a></h3><p>动态分区的规则参数以 dynamic_partition 为前缀</p><table><thead><tr><th>参数</th><th>必选</th><th>说明</th></tr></thead><tbody><tr><td>dynamic_partition.enable</td><td>否</td><td>是否开启动态分区特性。可以指定为 TRUE 或 FALSE。如果指定了动态分区其他必填参数，默认为 TRUE。</td></tr><tr><td>dynamic_partition.time_unit</td><td>是</td><td>动态分区调度的单位。可指定为 HOUR、DAY、WEEK、MONTH、YEAR。分别表示按小时、按天、按星期、按月、按年进行分区创建或删除：</td></tr><tr><td>dynamic_partition.start</td><td>否</td><td>动态分区的起始偏移，为负数。默认值为 -2147483648，即不删除历史分区。根据 time_unit 属性的不同，以当天（星期/月）为基准，分区范围在此偏移之前的分区将会被删除。此偏移之后至当前时间的历史分区如不存在，是否创建取决于 dynamic_partition.create_history_partition。</td></tr><tr><td>dynamic_partition.end</td><td>是</td><td>动态分区的结束偏移，为正数。根据 time_unit 属性的不同，以当天（星期/月）为基准，提前创建对应范围的分区。</td></tr><tr><td>dynamic_partition.prefix</td><td>是</td><td>动态创建的分区名前缀。</td></tr><tr><td>dynamic_partition.buckets</td><td>否</td><td>动态创建的分区所对应的分桶数。设置该参数后会覆盖 DISTRIBUTED 中指定的分桶数。量。</td></tr><tr><td>dynamic_partition.replication_num</td><td>否</td><td>动态创建的分区所对应的副本数量，如果不填写，则默认为该表创建时指定的副本数量。</td></tr><tr><td>dynamic_partition.create_history_partition</td><td>否</td><td>默认为 false。当置为 true 时，Doris 会自动创建所有分区，具体创建规则见下文。同时，FE 的参数 max_dynamic_partition_num 会限制总分区数量，以避免一次性创建过多分区。当期望创建的分区个数大于 max_dynamic_partition_num 值时，操作将被禁止。当不指定 start 属性时，该参数不生效。</td></tr><tr><td>dynamic_partition.history_partition_num</td><td>否</td><td>当create_history_partition 为 true 时，该参数用于指定创建历史分区数量。默认值为 -1，即未设置。该变量与 dynamic_partition.start 作用相同，建议同时只设置一个。</td></tr><tr><td>dynamic_partition.start_day_of_week</td><td>否</td><td>当 time_unit 为 WEEK 时，该参数用于指定每周的起始点。取值为 1 到 7。其中 1 表示周一，7 表示周日。默认为 1，即表示每周以周一为起始点。</td></tr><tr><td>dynamic_partition.start_day_of_month</td><td>否</td><td>当 time_unit 为 MONTH 时，该参数用于指定每月的起始日期。取值为 1 到 28。其中 1 表示每月 1 号，28 表示每月 28 号。默认为 1，即表示每月以 1 号为起始点。暂不支持以 29、30、31 号为起始日，以避免因闰年或闰月带来的歧义。</td></tr><tr><td>dynamic_partition.reserved_history_periods</td><td>否</td><td>需要保留的历史分区的时间范围。当dynamic_partition.time_unit 设置为 &quot;DAY/WEEK/MONTH/YEAR&quot; 时，需要以 [yyyy-MM-dd,yyyy-MM-dd],[...,...] 格式进行设置。当dynamic_partition.time_unit 设置为 &quot;HOUR&quot; 时，需要以 [yyyy-MM-dd HH:mm:ss,yyyy-MM-dd HH:mm:ss],[...,...] 的格式来进行设置。如果不设置，默认为 &quot;NULL&quot;。</td></tr><tr><td>dynamic_partition.time_zone</td><td>否</td><td>动态分区时区，默认为当前服务器的系统时区，如 Asia/Shanghai。</td></tr></tbody></table><h3 id="示例" tabindex="-1"><a class="header-anchor" href="#示例"><span>示例</span></a></h3><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#88C0D0;"> tbl1</span><span style="color:#D8DEE9FF;"> (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    order_id    </span><span style="color:#81A1C1;">BIGINT</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    create_dt   </span><span style="color:#81A1C1;">DATE</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    username    </span><span style="color:#81A1C1;">VARCHAR</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">20</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;">(create_dt) </span><span style="color:#ECEFF4;">()</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(create_dt)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">PROPERTIES (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.enable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.time_unit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">DAY</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  	&quot;</span><span style="color:#A3BE8C;">dynamic_partition.create_history_partition</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-7</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">3</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.prefix</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">p</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.buckets</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">32</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="自动分区" tabindex="-1"><a class="header-anchor" href="#自动分区"><span>自动分区</span></a></h2><p>建表时，使用以下语法填充CREATE-TABLE时的 partition_info 部分：</p><ol><li>AUTO RANGE PARTITION:</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">   AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;"> (FUNC_CALL_EXPR)</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">   ()</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>其中</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">   FUNC_CALL_EXPR ::</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> date_trunc ( </span><span style="color:#81A1C1;">&lt;</span><span style="color:#D8DEE9FF;">partition_column</span><span style="color:#81A1C1;">&gt;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">&lt;interval&gt;</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;"> )</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><ol><li>AUTO LIST PARTITION:</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">    AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> LIST(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">partition_col1</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">[, `partition_col2`, ...])</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    ()</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="用法示例" tabindex="-1"><a class="header-anchor" href="#用法示例"><span>用法示例</span></a></h3><ol><li>AUTO RANGE PARTITION</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">   CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> `</span><span style="color:#88C0D0;">date_table</span><span style="color:#D8DEE9FF;">` (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       `</span><span style="color:#A3BE8C;">TIME_STAMP</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;"> datev2 </span><span style="color:#81A1C1;">NOT NULL</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   ) ENGINE</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">OLAP</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   DUPLICATE </span><span style="color:#81A1C1;">KEY</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TIME_STAMP</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">   AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;"> (date_trunc(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TIME_STAMP</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">month</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">   DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TIME_STAMP</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">10</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   PROPERTIES (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">   &quot;</span><span style="color:#A3BE8C;">replication_allocation</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">tag.location.default: 1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   );</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>AUTO LIST PARTITION</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">   CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> `</span><span style="color:#88C0D0;">str_table</span><span style="color:#D8DEE9FF;">` (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">       `</span><span style="color:#A3BE8C;">str</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> varchar</span><span style="color:#81A1C1;"> not null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   ) ENGINE</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">OLAP</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   DUPLICATE </span><span style="color:#81A1C1;">KEY</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">str</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">   AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> LIST (</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">str</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">   DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">str</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">10</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   PROPERTIES (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">   &quot;</span><span style="color:#A3BE8C;">replication_allocation</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">tag.location.default: 1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">   );</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>LIST 自动分区支持多个分区列，分区列写法同普通 LIST 分区一样： AUTO PARTITION BY LIST (col1, col2, ...)</p><h3 id="约束" tabindex="-1"><a class="header-anchor" href="#约束"><span>约束</span></a></h3><ol><li>在 AUTO LIST PARTITION 中，分区名长度不得超过 50. 该长度来自于对应数据行上各分区列内容的拼接与转义，因此实际容许长度可能更短。</li><li>在 AUTO RANGE PARTITION 中，分区函数仅支持 date_trunc，分区列仅支持 DATE 或者 DATETIME 类型；</li><li>在 AUTO LIST PARTITION 中，不支持函数调用，分区列支持 BOOLEAN, TINYINT, SMALLINT, INT, BIGINT, LARGEINT, DATE, DATETIME, CHAR, VARCHAR 数据类型，分区值为枚举值。</li><li>在 AUTO LIST PARTITION 中，分区列的每个当前不存在对应分区的取值，都会创建一个独立的新 PARTITION。</li></ol><h3 id="null-值分区" tabindex="-1"><a class="header-anchor" href="#null-值分区"><span>NULL 值分区</span></a></h3><p>当开启 session variable allow_partition_column_nullable 后：</p><ol><li>对于 AUTO LIST PARTITION，可以使用 NULLABLE 列作为分区列，会正常创建对应的 NULL 值分区：</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">  create</span><span style="color:#81A1C1;"> table</span><span style="color:#88C0D0;"> auto_null_list</span><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    k0 </span><span style="color:#81A1C1;">varchar</span><span style="color:#81A1C1;"> null</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  auto</span><span style="color:#81A1C1;"> partition</span><span style="color:#81A1C1;"> by</span><span style="color:#D8DEE9FF;"> list (k0)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k0</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">1</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  insert into</span><span style="color:#D8DEE9FF;"> auto_null_list </span><span style="color:#81A1C1;">values</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#81A1C1;">null</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  select</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> from</span><span style="color:#D8DEE9FF;"> auto_null_list;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  | k0   |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;"> |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  select</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> from</span><span style="color:#D8DEE9FF;"> auto_null_list </span><span style="color:#81A1C1;">partition</span><span style="color:#D8DEE9FF;">(pX);</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  | k0   |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;"> |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  +</span><span style="color:#616E88;">------+</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><ol start="2"><li>对于 AUTO RANGE PARTITION，不支持 NULLABLE 列作为分区列。</li></ol><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">  CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> `</span><span style="color:#88C0D0;">range_table_nullable</span><span style="color:#D8DEE9FF;">` (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">k1</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> INT</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">k2</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;"> DATETIMEV2(</span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">),</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">k3</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;"> DATETIMEV2(</span><span style="color:#B48EAD;">6</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  ) ENGINE</span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;">OLAP</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  DUPLICATE </span><span style="color:#81A1C1;">KEY</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k1</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;"> (date_trunc(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k2</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">day</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  (</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  )</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">  DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k1</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">16</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  PROPERTIES (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">replication_allocation</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">tag.location.default: 1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">  );</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">ERROR </span><span style="color:#B48EAD;">1105</span><span style="color:#D8DEE9FF;"> (HY000): errCode </span><span style="color:#81A1C1;">=</span><span style="color:#B48EAD;"> 2</span><span style="color:#D8DEE9FF;">, detailMessage </span><span style="color:#81A1C1;">=</span><span style="color:#81A1C1;"> AUTO</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> doesn</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">t support NULL column</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="示例-1" tabindex="-1"><a class="header-anchor" href="#示例-1"><span>示例</span></a></h3><p>在使用场景一节中的示例，在使用 AUTO PARTITION 后，该表 DDL 可以改写为：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">CREATE</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> `</span><span style="color:#88C0D0;">DAILY_TRADE_VALUE</span><span style="color:#D8DEE9FF;">`</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">TRADE_DATE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">              datev2 </span><span style="color:#81A1C1;">NOT NULL</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    `</span><span style="color:#A3BE8C;">TRADE_ID</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;">                varchar</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">40</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">NOT NULL</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    ......</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">UNIQUE</span><span style="color:#81A1C1;"> KEY</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TRADE_DATE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TRADE_ID</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">AUTO</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> RANGE</span><span style="color:#D8DEE9FF;"> (date_trunc(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TRADE_DATE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">year</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">TRADE_DATE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">10</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">PROPERTIES (</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">  &quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>以此表只有两列为例，此时新表没有默认分区：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#D8DEE9FF;">show partitions </span><span style="color:#81A1C1;">from</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">DAILY_TRADE_VALUE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">Empty</span><span style="color:#81A1C1;"> set</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">12</span><span style="color:#D8DEE9FF;"> sec)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>经过插入数据后再查看，发现该表已经创建了对应的分区：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">insert into</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">DAILY_TRADE_VALUE</span><span style="color:#ECEFF4;">`</span><span style="color:#81A1C1;"> values</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2012-12-13</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2008-02-03</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">), (</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2014-11-11</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#B48EAD;">3</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">show partitions </span><span style="color:#81A1C1;">from</span><span style="color:#ECEFF4;"> `</span><span style="color:#A3BE8C;">DAILY_TRADE_VALUE</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">;</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| PartitionId | PartitionName   | VisibleVersion | VisibleVersionTime  | </span><span style="color:#81A1C1;">State</span><span style="color:#D8DEE9FF;">  | PartitionKey | </span><span style="color:#81A1C1;">Range</span><span style="color:#D8DEE9FF;">                                                                          | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize | IsInMemory | ReplicaAllocation       | IsMutable |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| </span><span style="color:#B48EAD;">180060</span><span style="color:#D8DEE9FF;">      | p20080101000000 | </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">              | </span><span style="color:#B48EAD;">2023</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">09</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">18</span><span style="color:#B48EAD;"> 21</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">49</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;"> | NORMAL | TRADE_DATE   | [types: [DATEV2]; keys: [2008-01-01]; ..types: [DATEV2]; keys: [2009-01-01]; ) | TRADE_DATE      | </span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">      | </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">              | HDD           | </span><span style="color:#B48EAD;">9999</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">12</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">31</span><span style="color:#B48EAD;"> 23</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;"> |                     | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                     | </span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">000</span><span style="color:#D8DEE9FF;">    | false      | tag.location.</span><span style="color:#81A1C1;">default</span><span style="color:#D8DEE9FF;">: </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> | true      |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| </span><span style="color:#B48EAD;">180039</span><span style="color:#D8DEE9FF;">      | p20120101000000 | </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">              | </span><span style="color:#B48EAD;">2023</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">09</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">18</span><span style="color:#B48EAD;"> 21</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">49</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;"> | NORMAL | TRADE_DATE   | [types: [DATEV2]; keys: [2012-01-01]; ..types: [DATEV2]; keys: [2013-01-01]; ) | TRADE_DATE      | </span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">      | </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">              | HDD           | </span><span style="color:#B48EAD;">9999</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">12</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">31</span><span style="color:#B48EAD;"> 23</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;"> |                     | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                     | </span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">000</span><span style="color:#D8DEE9FF;">    | false      | tag.location.</span><span style="color:#81A1C1;">default</span><span style="color:#D8DEE9FF;">: </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> | true      |</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| </span><span style="color:#B48EAD;">180018</span><span style="color:#D8DEE9FF;">      | p20140101000000 | </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;">              | </span><span style="color:#B48EAD;">2023</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">09</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">18</span><span style="color:#B48EAD;"> 21</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">49</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;"> | NORMAL | TRADE_DATE   | [types: [DATEV2]; keys: [2014-01-01]; ..types: [DATEV2]; keys: [2015-01-01]; ) | TRADE_DATE      | </span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;">      | </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;">              | HDD           | </span><span style="color:#B48EAD;">9999</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">12</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">31</span><span style="color:#B48EAD;"> 23</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;"> |                     | </span><span style="color:#81A1C1;">NULL</span><span style="color:#D8DEE9FF;">                     | </span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">000</span><span style="color:#D8DEE9FF;">    | false      | tag.location.</span><span style="color:#81A1C1;">default</span><span style="color:#D8DEE9FF;">: </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> | true      |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+----------+------------+-------------------------+-----------+</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>经过自动分区功能所创建的 PARTITION，与手动创建的 PARTITION 具有完全一致的功能性质。</p><h3 id="与动态分区联用" tabindex="-1"><a class="header-anchor" href="#与动态分区联用"><span>与动态分区联用</span></a></h3><p>Doris 支持自动分区和动态分区同时使用。此时，二者的功能都生效：</p><ol><li>自动分区将会自动在数据导入过程中按需创建分区；</li><li>动态分区将会自动创建、回收、转储分区。</li></ol><p>二者语法功能不存在冲突，同时设置对应的子句/属性即可。</p><h4 id="最佳实践" tabindex="-1"><a class="header-anchor" href="#最佳实践"><span>最佳实践</span></a></h4><p>需要对分区生命周期设限的场景，可以将 Dynamic Partition 的创建功能关闭，创建分区完全交由 Auto Partition 完成，通过 Dynamic Partition 动态回收分区的功能完成分区生命周期的管理：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">create</span><span style="color:#81A1C1;"> table</span><span style="color:#88C0D0;"> auto_dynamic</span><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">    k0 </span><span style="color:#81A1C1;">datetime</span><span style="color:#D8DEE9FF;">(</span><span style="color:#B48EAD;">6</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">NOT NULL</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">auto</span><span style="color:#81A1C1;"> partition</span><span style="color:#81A1C1;"> by</span><span style="color:#81A1C1;"> range</span><span style="color:#D8DEE9FF;"> (date_trunc(k0, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">year</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">))</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">(</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(</span><span style="color:#ECEFF4;">`</span><span style="color:#A3BE8C;">k0</span><span style="color:#ECEFF4;">`</span><span style="color:#D8DEE9FF;">) BUCKETS </span><span style="color:#B48EAD;">2</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">properties(</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.enable</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">true</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.prefix</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">p</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.start</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">-50</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.end</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">0</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#616E88;">--- Dynamic Partition 不创建分区</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">dynamic_partition.time_unit</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">year</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span></span></span>
<span class="line"><span class="line"><span style="color:#ECEFF4;">    &quot;</span><span style="color:#A3BE8C;">replication_num</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">1</span><span style="color:#ECEFF4;">&quot;</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样我们同时具有了 Auto Partition 的灵活性，且分区名上保持了一致性。</p><h3 id="分区管理" tabindex="-1"><a class="header-anchor" href="#分区管理"><span>分区管理</span></a></h3><p>当启用自动分区后，分区名可以通过 auto_partition_name 函数映射到分区。partitions 表函数可以通过分区名产生详细的分区信息。仍然以 DAILY_TRADE_VALUE 表为例，在我们插入数据后，查看其当前分区：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#81A1C1;">select</span><span style="color:#81A1C1;"> *</span><span style="color:#81A1C1;"> from</span><span style="color:#D8DEE9FF;"> partitions(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">catalog</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">internal</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">database</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">optest</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">,</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">table</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">DAILY_TRADE_VALUE</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">) </span><span style="color:#81A1C1;">where</span><span style="color:#D8DEE9FF;"> PartitionName </span><span style="color:#81A1C1;">=</span><span style="color:#D8DEE9FF;"> auto_partition_name(</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">range</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">year</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">, </span><span style="color:#ECEFF4;">&#39;</span><span style="color:#A3BE8C;">2008-02-03</span><span style="color:#ECEFF4;">&#39;</span><span style="color:#D8DEE9FF;">);</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">| PartitionId | PartitionName   | VisibleVersion | VisibleVersionTime  | </span><span style="color:#81A1C1;">State</span><span style="color:#D8DEE9FF;">  | PartitionKey | </span><span style="color:#81A1C1;">Range</span><span style="color:#D8DEE9FF;">                                                                          | DistributionKey | Buckets | ReplicationNum | StorageMedium | CooldownTime        | RemoteStoragePolicy | LastConsistencyCheckTime | DataSize  | IsInMemory | ReplicaAllocation       | IsMutable | SyncWithBaseTables | UnsyncTables |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">|      </span><span style="color:#B48EAD;">127095</span><span style="color:#D8DEE9FF;"> | p20080101000000 |              </span><span style="color:#B48EAD;">2</span><span style="color:#D8DEE9FF;"> | </span><span style="color:#B48EAD;">2024</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">11</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">14</span><span style="color:#B48EAD;"> 17</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">29</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">02</span><span style="color:#D8DEE9FF;"> | NORMAL | TRADE_DATE   | [types: [DATEV2]; keys: [2008-01-01]; ..types: [DATEV2]; keys: [2009-01-01]; ) | TRADE_DATE      |      </span><span style="color:#B48EAD;">10</span><span style="color:#D8DEE9FF;"> |              </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> | HDD           | </span><span style="color:#B48EAD;">9999</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">12</span><span style="color:#81A1C1;">-</span><span style="color:#B48EAD;">31</span><span style="color:#B48EAD;"> 23</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;">:</span><span style="color:#B48EAD;">59</span><span style="color:#D8DEE9FF;"> |                     | \N                       | </span><span style="color:#B48EAD;">985</span><span style="color:#D8DEE9FF;">.</span><span style="color:#B48EAD;">000</span><span style="color:#D8DEE9FF;"> B |          </span><span style="color:#B48EAD;">0</span><span style="color:#D8DEE9FF;"> | tag.location.</span><span style="color:#81A1C1;">default</span><span style="color:#D8DEE9FF;">: </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> |         </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> |                  </span><span style="color:#B48EAD;">1</span><span style="color:#D8DEE9FF;"> | \N           |</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">+</span><span style="color:#616E88;">-------------+-----------------+----------------+---------------------+--------+--------------+--------------------------------------------------------------------------------+-----------------+---------+----------------+---------------+---------------------+---------------------+--------------------------+-----------+------------+-------------------------+-----------+--------------------+--------------+</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这样每个分区的 ID 和取值就可以精准地被筛选出，用于后续针对分区的具体操作（例如 insert overwrite partition）。</p><p>详细语法说明请见：auto_partition_name 函数文档，partitions 表函数文档。</p><h3 id="注意事项" tabindex="-1"><a class="header-anchor" href="#注意事项"><span>注意事项</span></a></h3><ul><li>如同普通分区表一样，AUTO LIST PARTITION 支持多列分区，语法并无区别。</li><li>在数据的插入或导入过程中如果创建了分区，而整个导入过程没有完成（失败或被取消），被创建的分区不会被自动删除。</li><li>使用 AUTO PARTITION 的表，只是分区创建方式上由手动转为了自动。表及其所创建分区的原本使用方法都与非 AUTO PARTITION 的表或分区相同。</li><li>为防止意外创建过多分区，我们通过FE 配置项中的max_auto_partition_num控制了一个 AUTO PARTITION 表最大容纳分区数。如有需要可以调整该值</li><li>向开启了 AUTO PARTITION 的表导入数据时，Coordinator 发送数据的轮询间隔与普通表有所不同。具体请见BE 配置项中的olap_table_sink_send_interval_auto_partition_factor。开启前移（enable_memtable_on_sink_node = true）后该变量不产生影响。</li><li>在使用insert-overwrite插入数据时 AUTO PARTITION 表的行为详见 INSERT OVERWRITE 文档。</li><li>如果导入创建分区时，该表涉及其他元数据操作（如 Schema Change、Rebalance），则导入可能失败。</li></ul><h2 id="数据分桶" tabindex="-1"><a class="header-anchor" href="#数据分桶"><span>数据分桶</span></a></h2><p>一个分区可以根据业务需求进一步划分为多个数据分桶（bucket）。每个分桶都作为一个物理数据分片（tablet）存储。合理的分桶策略可以有效降低查询时的数据扫描量，提升查询性能并增加并发处理能力。</p><h3 id="分桶方式" tabindex="-1"><a class="header-anchor" href="#分桶方式"><span>分桶方式</span></a></h3><p>Doris 支持两种分桶方式：Hash 分桶与 Random 分桶。</p><h4 id="hash-分桶" tabindex="-1"><a class="header-anchor" href="#hash-分桶"><span>Hash 分桶</span></a></h4><p>在创建表或新增分区时，用户需选择一列或多列作为分桶列，并明确指定分桶的数量。在同一分区内，系统会根据分桶键和分桶数量进行哈希计算。哈希值相同的数据会被分配到同一个分桶中。</p><p>推荐在以下场景中使用 Hash 分桶：</p><ul><li>业务需求频繁基于某个字段进行过滤时，可将该字段作为分桶键，利用 Hash 分桶提高查询效率。</li><li>当表中的数据分布较为均匀时，Hash 分桶同样是一种有效的选择。</li></ul><h4 id="random-分桶" tabindex="-1"><a class="header-anchor" href="#random-分桶"><span>Random 分桶</span></a></h4><p>在每个分区中，使用 Random 分桶会随机地将数据分散到各个分桶中，不依赖于某个字段的 Hash 值进行数据划分。Random 分桶能够确保数据均匀分散，从而避免由于分桶键选择不当而引发的数据倾斜问题。</p><p>在使用 Random 分桶时，可以启用单分片导入模式（通过设置 load_to_single_tablet 为 true）。这样，在大规模数据导入过程中，单个批次的数据仅写入一个数据分片，能够提高数据导入的并发度和吞吐量，减少因数据导入和压缩（Compaction）操作造成的写放大问题，从而确保集群稳定性。</p><p>在以下场景中，建议使用 Random 分桶：</p><ul><li>在任意维度分析的场景中，业务没有特别针对某一列频繁进行过滤或关联查询时，可以选择 Random 分桶；</li><li>当经常查询的列或组合列数据分布极其不均匀时，使用 Random 分桶可以避免数据倾斜。</li><li>Random 分桶无法根据分桶键进行剪裁，会扫描命中分区的所有数据，不建议在点查场景下使用；</li><li>只有 DUPLICATE 表可以使用 Random 分区，UNIQUE 与 AGGREGATE 表无法使用 Random 分桶；</li></ul><h3 id="选择分桶键" tabindex="-1"><a class="header-anchor" href="#选择分桶键"><span>选择分桶键</span></a></h3><p>只有 Hash 分桶需要选择分桶键，Random 分桶不需要选择分桶键。</p><p>分桶键可以是一列或者多列。如果是 DUPLICATE 表，任何 Key 列与 Value 列都可以作为分桶键。如果是 AGGREGATE 或 UNIQUE 表，为了保证逐渐的聚合性，分桶列必须是 Key 列。</p><p>通常情况下，可以根据以下规则选择分桶键：</p><ul><li>利用查询过滤条件：使用查询中的过滤条件进行 Hash 分桶，有助于数据的剪裁，减少数据扫描量；</li><li>利用高基数列：选择高基数（唯一值较多）的列进行 Hash 分桶，有助于数据均匀的分散在每一个分桶中；</li><li>高并发点查场景：建议选择单列或较少列进行分桶。点查可能仅触发一个分桶扫描，不同查询之间触发不同分桶扫描的概率较大，从而减小查询间的 IO 影响。</li><li>大吞吐查询场景：建议选择多列进行分桶，使数据更均匀分布。若查询条件不能包含所有分桶键的等值条件，将增加查询吞吐，降低单个查询延迟。</li></ul><h3 id="选择分桶数量" tabindex="-1"><a class="header-anchor" href="#选择分桶数量"><span>选择分桶数量</span></a></h3><p>在 Doris 中，一个 bucket 会被存储为一个物理文件（tablet）。一个表的 Tablet 数量等于 partition_num（分区数）乘以 bucket_num（分桶数）。一旦指定 Partition 的数量，便不可更改。</p><p>在确定 bucket 数量时，需预先考虑机器扩容情况。自 2.0 版本起，Doris 支持根据机器资源和集群信息自动设置分区中的分桶数。</p><h4 id="手动设置分桶数" tabindex="-1"><a class="header-anchor" href="#手动设置分桶数"><span>手动设置分桶数</span></a></h4><p>通过 DISTRIBUTED 语句可以指定分桶数量：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#616E88;">-- Set hash bucket num to 8</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(region) BUCKETS </span><span style="color:#B48EAD;">8</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">-- Set random bucket num to 8</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> RANDOM BUCKETS </span><span style="color:#B48EAD;">8</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在决定分桶数量时，通常遵循数量与大小两个原则，当发生冲突时，优先考虑大小原则：</p><ul><li>大小原则：建议一个 tablet 的大小在 1-10G 范围内。过小的 tablet 可能导致聚合效果不佳，增加元数据管理压力；过大的 tablet 则不利于副本迁移、补齐，且会增加 Schema Change 操作的失败重试代价；</li><li>数量原则：在不考虑扩容的情况下，一个表的 tablet 数量建议略多于整个集群的磁盘数量。</li></ul><p>例如，假设有 10 台 BE 机器，每个 BE 一块磁盘，可以按照以下建议进行数据分桶：</p><table><thead><tr><th>单表大小</th><th>建议分桶数量</th></tr></thead><tbody><tr><td>500MB</td><td>4-8 个分桶</td></tr><tr><td>5GB</td><td>6-16 个分桶</td></tr><tr><td>50GB</td><td>32 个分桶</td></tr><tr><td>500GB</td><td>建议分区，每个分区 50GB，每个分区 16-32 个分桶</td></tr><tr><td>5TB</td><td>建议分区，每个分区 50GB，每个分桶 16-32 个分桶</td></tr></tbody></table><h3 id="自动设置分桶数" tabindex="-1"><a class="header-anchor" href="#自动设置分桶数"><span>自动设置分桶数</span></a></h3><p>自动推算分桶数功能会根据过去一段时间的分区大小，自动预测未来的分区大小，并据此确定分桶数量。</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#616E88;">-- Set hash bucket auto</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(region) BUCKETS </span><span style="color:#81A1C1;">AUTO</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">estimate_partition_size</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">20G</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">-- Set random bucket auto</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(region) BUCKETS </span><span style="color:#81A1C1;">AUTO</span></span></span>
<span class="line"><span class="line"><span style="color:#D8DEE9FF;">properties(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">estimate_partition_size</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;"> =</span><span style="color:#ECEFF4;"> &quot;</span><span style="color:#A3BE8C;">20G</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在创建分桶时，可以通过 estimate_partition_size 属性来调整前期估算的分区大小。此参数为可选设置，若未给出，Doris 将默认取值为 10GB。请注意，该参数与后期系统通过历史分区数据推算出的未来分区大小无关。</p><h3 id="维护数据分桶" tabindex="-1"><a class="header-anchor" href="#维护数据分桶"><span>维护数据分桶</span></a></h3><p>目前，Doris 仅支持修改新增分区的分桶数量，对于以下操作暂不支持：</p><ol><li>不支持修改分桶类型</li><li>不支持修改分桶键</li><li>不支持修改已创建的分桶的分桶数量</li></ol><p>通过 ALTER TABLE 命令来修改新增分区的分桶数：</p><div class="language-sql line-numbers-mode line-numbers-mode" data-highlighter="prismjs" data-ext="sql" data-title="sql"><pre class="shiki nord vp-code" style="background-color:#2e3440ff;color:#d8dee9ff language-sql;"><code><span class="line"><span class="line"><span style="color:#616E88;">-- Modify hash bucket table</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ALTER</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> demo.hash_bucket_tbl </span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ADD</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> p250103 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2025-01-03</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#81A1C1;"> HASH</span><span style="color:#D8DEE9FF;">(region) BUCKETS </span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">-- Modify random bucket table</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ALTER</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> demo.random_bucket_tbl </span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ADD</span><span style="color:#81A1C1;"> PARTITION</span><span style="color:#D8DEE9FF;"> p250103 </span><span style="color:#81A1C1;">VALUES</span><span style="color:#D8DEE9FF;"> LESS THAN(</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">2025-01-03</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">)</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">DISTRIBUTED</span><span style="color:#81A1C1;"> BY</span><span style="color:#D8DEE9FF;"> RANDOM BUCKETS </span><span style="color:#B48EAD;">16</span><span style="color:#D8DEE9FF;">;</span></span></span>
<span class="line"><span class="line"></span></span>
<span class="line"><span class="line"><span style="color:#616E88;">-- Modify dynamic partition table</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">ALTER</span><span style="color:#81A1C1;"> TABLE</span><span style="color:#D8DEE9FF;"> demo.dynamic_partition_tbl</span></span></span>
<span class="line"><span class="line"><span style="color:#81A1C1;">SET</span><span style="color:#D8DEE9FF;"> (</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">dynamic_partition.buckets</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#81A1C1;">=</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#A3BE8C;">16</span><span style="color:#ECEFF4;">&quot;</span><span style="color:#D8DEE9FF;">);</span></span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在修改分桶数量后，可以通过 SHOW PARTITION 命令查看修改后的分桶数量。</p></div><!--[--><!--]--></div><footer class="vp-page-meta"><div class="vp-meta-item edit-link"><a class="auto-link external-link label" href="https://github.com/hyfly233/blog/edit/main/md/article/database/doris/数据划分.md" aria-label="Edit this page" rel="noopener noreferrer" target="_blank"><!--[--><svg class="edit-icon" viewbox="0 0 1024 1024"><g fill="currentColor"><path d="M430.818 653.65a60.46 60.46 0 0 1-50.96-93.281l71.69-114.012 7.773-10.365L816.038 80.138A60.46 60.46 0 0 1 859.225 62a60.46 60.46 0 0 1 43.186 18.138l43.186 43.186a60.46 60.46 0 0 1 0 86.373L588.879 565.55l-8.637 8.637-117.466 68.234a60.46 60.46 0 0 1-31.958 11.229z"></path><path d="M728.802 962H252.891A190.883 190.883 0 0 1 62.008 771.98V296.934a190.883 190.883 0 0 1 190.883-192.61h267.754a60.46 60.46 0 0 1 0 120.92H252.891a69.962 69.962 0 0 0-69.098 69.099V771.98a69.962 69.962 0 0 0 69.098 69.098h475.911A69.962 69.962 0 0 0 797.9 771.98V503.363a60.46 60.46 0 1 1 120.922 0V771.98A190.883 190.883 0 0 1 728.802 962z"></path></g></svg><!--]-->Edit this page<!----></a></div><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">最后更新时间: </span><!----></div><div class="vp-meta-item contributors"><span class="meta-item-label">贡献者: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: hyfly233@outlook.com">hyfly233</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/blog/assets/app-chPKMbRn.js" defer></script>
  </body>
</html>
