## 基础环境
MacBook Pro M1 MacOS 13.3
VMware Fusion 13
CentOS-Stream-9-latest-aarch64-dvd1.iso 最小化安装
## CentOS 配置
### 配置 ssh
#### 开启root用户远程登录
linux系统是默认禁止远程登录root用户
```shell
vi /etc/ssh/sshd_config
```
在文件中找到(可以使用搜索功能： 输入/Permit，找到后再按i进行编辑)
```shell
#PermitRootLogin prohibit-password

# 变更为

PermitRootLogin yes
```
按 esc，输入 :wq 保存，重启 ssh
```shell
service sshd restart
```
#### 导入ssh公钥
然后使用远程工具通过root用户的密码登录CentOS 9
```shell
vim ~/.ssh/authorized_keys
```
将已有的 id_rsa.pub 公钥的内容复制进去，按 esc，输入 :wq 保存，在通过远程工具使用 ssh 登录CentOS 9
### 更换 yum 源
#### 备份源配置
```shell
mv /etc/yum.repos.d/centos.repo /etc/yum.repos.d/centos.repo.backup

mv /etc/yum.repos.d/centos-addons.repo /etc/yum.repos.d/centos-addons.repo.backup
```
#### 重写源配置
将 [清华大学开源软件镜像站-CentOS Stream 软件仓库镜像使用帮助](https://mirrors.tuna.tsinghua.edu.cn/help/centos-stream/) 
```shell
vim /etc/yum.repos.d/centos.repo

vim /etc/yum.repos.d/centos-addons.repo
```
#### 更新缓存
```shell
yum makecache && yum update
```
### 设置静态IP
先查看 CentOS 使用的网卡，然后需要修改的网卡信息
```shell
ip addr

cd /etc/NetworkManager/system-connections/

ls  # 如 ens160.nmconnection

vim ens160.nmconnection
```
配置参考
```shell
[connection]
id=ens160
uuid=e3e7f376-9406-3500-813a-6f9fb790b7fb
type=ethernet
autoconnect-priority=-999
interface-name=ens160
timestamp=1684422360

[ipv4]
address1=192.168.64.135/24,192.168.64.2
dns=114.114.114.114
method=manual
```
重启网卡
```shell
nmcli c reload && nmcli c up ens160 # 网卡名 ens160
```
关闭防火墙
```shell
systemctl stop firewalld

systemctl disable firewalld
```
## 配置 Docker
使用 [清华大学开源软件镜像站-Docker CE 软件仓库镜像使用帮助](https://mirrors.tuna.tsinghua.edu.cn/help/docker-ce/) 脚本安装 Docker
```shell
export DOWNLOAD_URL="https://mirrors.tuna.tsinghua.edu.cn/docker-ce"

# 如您使用 wget
wget -O- https://get.docker.com/ | sudo -E sh
```
启动并加入开机启动
```shell
systemctl start docker

systemctl enable docker
```
配置 Docker 源镜像
```shell
cat > /etc/docker/daemon.json <<EOF
{
  "registry-mirrors": [
  	"http://hub-mirror.c.163.com"
  ],
  "exec-opts": ["native.cgroupdriver=systemd"]
}
EOF
```

配置 docker.service，修改 ExecStart ??????  docker 起不来
```shell
ExecStart=/usr/bin/dockerd -H fd:// --containerd=/run/containerd/containerd.sock --exec-opt native.cgroupdriver=systemd
```

重启docker服务使配置生效
```shell
systemctl daemon-reload

systemctl enable docker

systemctl restart docker
```
## 配置 K8s
### k8s-master
#### 前置条件
更改主机名
```shell
hostnamectl set-hostname k8s-master
```
配置节点的域名
```shell
vim /etc/hosts
```
配置样例
```shell
192.168.64.135 k8s-master
192.168.64.136 k8s-node1
192.168.64.137 k8s-node2
```
关闭 SeLinux
```shell
setenforce 0

sed -i "s/SELINUX=enforcing/SELINUX=disabled/g" /etc/selinux/config
```
关闭 swap
```shell
swapoff -a

yes | cp /etc/fstab /etc/fstab_bak

cat /etc/fstab_bak |grep -v swap > /etc/fstab
```
#### 安装 kubectl
参考官方教程

1. 下载最新发行版
```shell
curl -LO "https://dl.k8s.io/release/$(curl -L -s https://dl.k8s.io/release/stable.txt)/bin/linux/arm64/kubectl"
```

2. 安装 kubectl
```shell
sudo install -o root -g root -m 0755 kubectl /usr/local/bin/kubectl
```

3. 执行测试
```shell
kubectl version --client
```
或者使用 Homebrew 安装
```shell
brew install kubectl
kubectl version --client
```



安装 bash-completion
[https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/](https://kubernetes.io/zh-cn/docs/tasks/tools/install-kubectl-linux/)
启动 kubectl 自动补全功能
安装 kubectl convert 插件

