# 实施文档生成

- 7分
- |
- 大地形态大地形态



经常引用这个？ [创建一个帐户](https://developer.hashicorp.com/sign-up)以书签教程。



在本教程中，您将向与名为 HashiCups 的虚构咖啡店应用程序的 API 交互的提供程序添加文档生成功能。为此，您将：

1. **将 terraform-plugin-docs 添加到提供程序。**
   这使提供程序能够自动生成数据源和资源文档。
2. **添加架构说明。**
   这将增强文档，以包含提供程序本身、其数据源和资源及其每个属性的说明。
3. **添加配置示例。**
   这增强了文档，以包含示例 Terraform 配置。
4. **添加资源导入文档。**
   这增强了资源文档，以包含如何导入支持它的资源的示例。
5. **运行文档生成。**
   这可确保文档生成按预期工作。

Go 模块命令使提供程序能够实现文档生成。该生成使用架构说明和常规放置的文件来生成与 Terraform 注册表兼容的提供程序文档。`terraform-plugin-docs``cmd/tfplugindocs`

## 先决条件

要学习本教程，您需要：

- [Go 1.19+](https://golang.org/doc/install) 已安装并配置。
- [Terraform v1.0.3+](https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli) 本地安装。

继续上一教程新设置

导航到您的目录。`terraform-provider-hashicups-pf`

您的代码应与示例存储库中的[`验收测试`分支](https://github.com/hashicorp/terraform-provider-hashicups-pf/tree/acceptance-tests)匹配。

如果在本教程中的任何时间点遇到困难，请参阅分支以查看本教程中实现的更改。`documentation-generation`

## 添加架构说明

该工具将自动包含基于架构的描述，如果 存在于数据源、提供程序或资源的架构中。类型的字段描述数据源、提供程序或资源 本身。每个属性或块的字段描述 特定属性或块。这些描述应针对 从业者的用法，包括任何警告或价值期望，例如 特殊语法。`tfplugindocs``schema.Schema``Description``Description`

打开文件。`internal/provider/provider.go`

通过替换整个方法将文档添加到提供程序 以下内容，将字段添加到提供程序的架构中，以及 它的每一个属性。`Schema``Description`



internal/provider/provider.go

复制

```go
// Schema defines the provider-level schema for configuration data.
func (p *hashicupsProvider) Schema(_ context.Context, _ provider.SchemaRequest, resp *provider.SchemaResponse) {
    resp.Schema = schema.Schema{
        Description: "Interact with HashiCups.",
        Attributes: map[string]schema.Attribute{
            "host": schema.StringAttribute{
                Description: "URI for HashiCups API. May also be provided via HASHICUPS_HOST environment variable.",
                Optional:    true,
            },
            "username": schema.StringAttribute{
                Description: "Username for HashiCups API. May also be provided via HASHICUPS_USERNAME environment variable.",
                Optional:    true,
            },
            "password": schema.StringAttribute{
                Description: "Password for HashiCups API. May also be provided via HASHICUPS_PASSWORD environment variable.",
                Optional:    true,
                Sensitive:   true,
            },
        },
    }
}
```

打开文件。`internal/provider/coffees_data_source.go`

通过替换整个方法将文档添加到数据源 与以下内容。`Schema`



内部/提供商/coffees_data_source.go

复制

```go
// Schema defines the schema for the data source.
func (d *coffeesDataSource) Schema(_ context.Context, _ datasource.SchemaRequest, resp *datasource.SchemaResponse) {
    resp.Schema = schema.Schema{
        Description: "Fetches the list of coffees.",
        Attributes: map[string]schema.Attribute{
            "id": schema.StringAttribute{
                Description: "Placeholder identifier attribute.",
                Computed:    true,
            },
            "coffees": schema.ListNestedAttribute{
                Description: "List of coffees.",
                Computed:    true,
                NestedObject: schema.NestedAttributeObject{
                    Attributes: map[string]schema.Attribute{
                        "id": schema.Int64Attribute{
                            Description: "Numeric identifier of the coffee.",
                            Computed:    true,
                        },
                        "name": schema.StringAttribute{
                            Description: "Product name of the coffee.",
                            Computed:    true,
                        },
                        "teaser": schema.StringAttribute{
                            Description: "Fun tagline for the coffee.",
                            Computed:    true,
                        },
                        "description": schema.StringAttribute{
                            Description: "Product description of the coffee.",
                            Computed:    true,
                        },
                        "price": schema.Float64Attribute{
                            Description: "Suggested cost of the coffee.",
                            Computed:    true,
                        },
                        "image": schema.StringAttribute{
                            Description: "URI for an image of the coffee.",
                            Computed:    true,
                        },
                        "ingredients": schema.ListNestedAttribute{
                            Description: "List of ingredients in the coffee.",
                            Computed:    true,
                            NestedObject: schema.NestedAttributeObject{
                                Attributes: map[string]schema.Attribute{
                                    "id": schema.Int64Attribute{
                                        Description: "Numeric identifier of the coffee ingredient.",
                                        Computed:    true,
                                    },
                                },
                            },
                        },
                    },
                },
            },
        },
    }
}
```

打开文件。`internal/provider/order_resource.go`

通过替换整个方法向资源添加文档 与以下内容。`Schema`



内部/提供商/order_resource.go

复制

```go
// Schema defines the schema for the resource.
func (r *orderResource) Schema(_ context.Context, _ resource.SchemaRequest, resp *resource.SchemaResponse) {
    resp.Schema = schema.Schema{
        Description: "Manages an order.",
        Attributes: map[string]schema.Attribute{
            "id": schema.StringAttribute{
                Description: "Numeric identifier of the order.",
                Computed:    true,
                PlanModifiers: []planmodifier.String{
                    stringplanmodifier.UseStateForUnknown(),
                },
            },
            "last_updated": schema.StringAttribute{
                Description: "Timestamp of the last Terraform update of the order.",
                Computed:    true,
            },
            "items": schema.ListNestedAttribute{
                Description: "List of items in the order.",
                Required:    true,
                NestedObject: schema.NestedAttributeObject{
                    Attributes: map[string]schema.Attribute{
                        "quantity": schema.Int64Attribute{
                            Description: "Count of this item in the order.",
                            Required:    true,
                        },
                        "coffee": schema.SingleNestedAttribute{
                            Description: "Coffee item in the order.",
                            Required:    true,
                            Attributes: map[string]schema.Attribute{
                                "id": schema.Int64Attribute{
                                    Description: "Numeric identifier of the coffee.",
                                    Required:    true,
                                },
                                "name": schema.StringAttribute{
                                    Description: "Product name of the coffee.",
                                    Computed:    true,
                                },
                                "teaser": schema.StringAttribute{
                                    Description: "Fun tagline for the coffee.",
                                    Computed:    true,
                                },
                                "description": schema.StringAttribute{
                                    Description: "Product description of the coffee.",
                                    Computed:    true,
                                },
                                "price": schema.Float64Attribute{
                                    Description: "Suggested cost of the coffee.",
                                    Computed:    true,
                                },
                                "image": schema.StringAttribute{
                                    Description: "URI for an image of the coffee.",
                                    Computed:    true,
                                },
                            },
                        },
                    },
                },
            },
        },
    }
}
```

## 添加配置示例

该工具将自动包含地形配置 具有以下命名约定的文件示例：`tfplugindocs`

- **提供者**：`examples/provider/provider.tf`
- **参考资料**：`examples/resources/TYPE/resource.tf`
- **数据来源**：`examples/data-sources/TYPE/data-source.tf`

替换为资源或数据源的名称。例如：。`TYPE``examples/resources/hashicups_order/resource.tf`

打开该文件并将现有代码替换为以下内容。`examples/provider/provider.tf`



examples/provider/provider.tf

复制

```terraform
# Configuration-based authentication
provider "hashicups" {
  username = "education"
  password = "test123"
  host     = "http://localhost:19090"
}
```

创建目录。`examples/data-sources/hashicups_coffees`

```shell-session
$ mkdir -p examples/data-sources/hashicups_coffees
```

复制

使用以下命令创建文件。`examples/data-sources/hashicups_coffees/data-source.tf`



示例/数据源/hashicups_coffees/数据 source.tf

复制

```terraform
# List all coffees.
data "hashicups_coffees" "all" {}
```

创建目录。`examples/resources/hashicups_order`

```shell-session
$ mkdir -p examples/resources/hashicups_order
```

复制

使用以下命令创建文件。`examples/resources/hashicups_order/resource.tf`



examples/resources/hashicups_order/resource.tf

复制

```terraform
# Manage example order.
resource "hashicups_order" "example" {
  items = [
    {
      coffee = {
        id = 3
      }
      quantity = 2
    },
  ]
}
```

## 添加资源导入文档

该工具将自动包含 Terraform 导入示例 具有文件命名约定的资源。`tfplugindocs``examples/resources/TYPE/import.sh`

使用以下方法创建一个新文件。`examples/resources/hashicups_order/import.sh`



示例/资源/hashicups_order/导入.sh

复制

```shell
# Order can be imported by specifying the numeric identifier.
terraform import hashicups_order.example 123
```

## 运行文档生成

现在，您已经为提供程序实现了文档生成功能，请运行命令以生成文档。`go generate ./...`

```shell-session
$ go generate ./...
rendering website for provider "hashicups" (as "hashicups")
exporting schema from Terraform
compiling provider "hashicups"
using Terraform CLI binary from PATH if available, otherwise downloading latest Terraform CLI binary
running terraform init
getting provider schema
rendering missing docs
generating missing resource content
generating template for "hashicups_order"
generating missing data source content
generating template for "hashicups_coffees"
generating missing provider content
generating template for "hashicups"
rendering static website
cleaning rendered website dir
rendering templated website to static markdown
rendering "data-sources/coffees.md.tmpl"
rendering "index.md.tmpl"
rendering "resources/order.md.tmpl"
```

复制

查看目录中生成的文件，以验证数据源、提供程序和资源文档是否包含预期的说明、示例和架构信息。`docs`

## 后续步骤

祝贺！您已通过文档生成功能增强了提供程序。

如果在本教程中遇到困难，请查看[`文档生成`](https://github.com/hashicorp/terraform-provider-hashicups-pf/tree/documentation-generation)分支以查看本教程中实现的更改。

- 了解有关 Terraform 插件的更多信息 框架，参考 [Terraform 插件框架 文档](https://developer.hashicorp.com/terraform/plugin/framework)。
- 有关 SDKv2 和插件框架之间的完整功能比较， 请参阅[我应该使用哪个 SDK？ 文档](https://developer.hashicorp.com/terraform/plugin/which-sdk)。
- The Terraform HashiCups （plugin-framework） 提供程序的主[``分支](https://github.com/hashicorp/terraform-provider-hashicups-pf)包含完整的 HashiCups 提供程序。它包括一个数据源 使用插件框架编写并实现创建、读取、更新和删除 订单资源的功能。
- 向 [Terraform 插件框架 Github 存储库](https://github.com/hashicorp/terraform-plugin-framework)中的开发团队提交任何 Terraform 插件框架错误报告或功能请求。
- 在 [Terraform 插件框架讨论论坛中提交任何 Terraform 插件框架](https://discuss.hashicorp.com/c/terraform-providers/tf-plugin-sdk/43)问题。