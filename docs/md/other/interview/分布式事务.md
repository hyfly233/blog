# 分布式事务

## 解决方案

+ 强一致性
  + 二阶段提交
  + Raft
+ 最终一致性
  + 异步确保型
  + 事务型消息
  + TCC型



## 二阶段提交

排它锁保证强一致性

二阶段提交非常影响性能



## Raft协议

对N个节点的集群中，同步成功一半以上（N/2 + 1）个节点就算同步成功，外加二阶段提交



## TCC

依照二阶段提交设计的，Try，Confirm，Cancel

需要中间状态字段，log表

需要定时补偿机制



## 异步确保型

消息中间件需要持久化消息，并且开启重试

回滚操作发送mq可能会失败



## 事务型消息

本地事务开始前，先向RocketMQ发送prepare消息，再执行本地事务后commit，send commit消息

RocketMQ会根据prepare消息进行会查